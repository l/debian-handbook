<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">11.7. LDAP-mappe</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-8-nb-NO-1.0-1" /><meta
        name="keywords"
        content="Postfix, Apache, NFS, Samba, Squid, OpenLDAP, SIP" /><link
        rel="home"
        href="index.html"
        title="Håndbok for Debian-administratoren" /><link
        rel="up"
        href="network-services.html"
        title="Kapittel 11. Nettverkstjenester: Postfix, Apache, NFS, Samba, Squid, LDAP, SIP, XMPP, TURN" /><link
        rel="prev"
        href="sect.http-ftp-proxy.html"
        title="11.6. HTTP/FTP-mellomtjener" /><link
        rel="next"
        href="sect.rtc-services.html"
        title="11.8. Sanntids kommunikasjonstjenester" /><meta
        name="viewport"
        content="width=device-width, initial-scale=1" /><link
        rel="canonical"
        href="http://l.github.io/debian-handbook/html/nb-NO/sect.ldap-directory.html" /></head><body><noscript><iframe
          src="//www.googletagmanager.com/ns.html?id=GTM-5H35QX"
          height="0"
          width="0"
          style="display:none;visibility:hidden"></iframe></noscript><script
        type="text/javascript">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&amp;l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5H35QX');</script><div
        id="banner"><a
          href="../../"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="index.html"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="sect.http-ftp-proxy.html"><strong>Forrige</strong></a></li><li
          class="home">Håndbok for Debian-administratoren</li><li
          class="next"><a
            accesskey="n"
            href="sect.rtc-services.html"><strong>Neste</strong></a></li></ul><div
        class="section"><div
          class="titlepage"><div><div><h2
                class="title"><a
                  id="sect.ldap-directory"></a>11.7. LDAP-mappe</h2></div></div></div><a
          id="id-1.14.10.2"
          class="indexterm"></a><a
          id="id-1.14.10.3"
          class="indexterm"></a><a
          id="id-1.14.10.4"
          class="indexterm"></a><div
          class="para">
			OpenLDAP er en implementering av LDAP-protokollen; med andre ord, den er en database med spesialformål å lagre kataloger. I det mest vanlige brukertilfellet, tillater bruk av en LDAP-tjener sentral forvaltning av brukerkontoer og de tilhørende rettighetene. Dessuten er det lett å kopiere LDAP-databasen, som tillater oppsett av flere synkroniserte LDAP-tjenere. Når nettverket og brukerbasen vokser raskt, kan lasten så bli balansert over flere tjenere.
		</div><div
          class="para">
			LDAP-data er strukturert og hierarkisk. Strukturen er definert av «skjemaer», som beskriver den type objekter som databasen kan lagre, med en liste over alle de mulige egenskapene deres. Syntaksen brukes for å referere til et bestemt objekt i databasen basert på denne strukturen, noe som forklarer kompleksiten.
		</div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="id-1.14.10.7"></a>11.7.1. Å installere</h3></div></div></div><div
            class="para">
				Pakken <span
              class="pkg pkg">slapd</span> inneholder den åpne OpenLDAP-tjeneren. Pakken <span
              class="pkg pkg">ldap-utils</span> inneholder kommandolinjeverktøy for samhandling med LDAP-tjenere.
			</div><a
            id="id-1.14.10.7.3"
            class="indexterm"></a><div
            class="para">
				Å installere <span
              class="pkg pkg">slapd</span> stiller vanligvis få spørsmål, og det er usannsynlig at den resulterende databasen dekker dine behov. Heldigvis, en enkel <code
              class="command">dpkg-reconfigure slapd</code> vil la deg konfigurere LDAP-databasen med flere detaljer:
			</div><div
            xmlns:d="http://docbook.org/ns/docbook"
            class="itemizedlist"><ul><li
                class="listitem"><div
                  class="para">
						Utelate OpenLDAP-tjeneroppsettet? Nei, selvfølgelig ønsker vi å konfigurere denne tjenesten.
					</div></li><li
                class="listitem"><div
                  class="para">
						DNS-domenenavn: «<code
                    class="literal">falcot.com</code>».
					</div></li><li
                class="listitem"><div
                  class="para">
						Organisasjonsnavn: «Falcot Corp».
					</div></li><li
                class="listitem"><div
                  class="para">
						Et administrativt passord må skrives inn.
					</div></li><li
                class="listitem"><div
                  class="para">
						Database backend to use: “MDB”.
					</div></li><li
                class="listitem"><div
                  class="para">
						Ønsker du at databasen skal fjernes når <span
                    class="pkg pkg">slapd</span> tvinges? Nei. Det er ingen vits i å risikere å miste databasen på grunn av en feil.
					</div></li><li
                class="listitem"><div
                  class="para">
						Flytte den gamle databasen? Dette spørsmålet blir bare spurt når konfigurasjonen er forsøkt, og en database allerede eksisterer. Bare svar «ja» hvis du faktisk ønsker å starte på nytt med en ren database; for eksempel hvis du kjører <code
                    class="command">dpkg-reconfigure slapd</code> rett etter den første installasjonen.
					</div></li><li
                class="listitem"><div
                  class="para">
						Tillate LDAPv2-protokoll? Nei, det er ingen vits i det. Alle verktøyene vi skal bruke forstår LDAPv3-protokollen.
					</div></li></ul></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>DET GRUNNLEGGENDE</em></span> LDIF-format</strong></p></div></div></div><div
              class="para">
				En LDIF-file (<span
                class="emphasis"><em>LDAP Data Interchange Format</em></span>) er en flyttbar tekstfil som beskriver innholdet i en LDAP-database (eller en del av den); denne kan så brukes til å injisere data inn i en hvilken som helst annen LDAP-tjener.
			</div><a
              id="id-1.14.10.7.6.3"
              class="indexterm"></a></div><div
            class="para">
				Nå er en minimal database konfigurert, som demonstrert fra følgende spørring:
			</div><pre
            class="screen">
<code
              class="computeroutput">$ </code><strong
              class="userinput"><code>ldapsearch -x -b dc=falcot,dc=com</code></strong>
<code
              class="computeroutput"># extended LDIF
#
# LDAPv3
# base &lt;dc=falcot,dc=com&gt; with scope sub
# filter: (objectclass=*)
# requesting: ALL
#

# falcot.com
dn: dc=falcot,dc=com
objectClass: top
objectClass: dcObject
objectClass: organization
o: Falcot Corp
dc: falcot

# admin, falcot.com
dn: cn=admin,dc=falcot,dc=com
objectClass: simpleSecurityObject
objectClass: organizationalRole
cn: admin
description: LDAP administrator

# search result
search: 2
result: 0 Success

# numResponses: 3
# numEntries: 2
</code></pre><div
            class="para">
				Spørringen returnerte to objekter: Organisasjonen selv, og den administrative brukeren.
			</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="id-1.14.10.8"></a>11.7.2. Å fylle ut mappen</h3></div></div></div><div
            class="para">
				Ettersom en tom database ikke er spesielt nyttig, har vi tenkt å injisere i den i alle de eksisterende katalogene; Dette inkluderer brukerne, gruppene, tjenestene og vertsdatabasene.
			</div><div
            class="para">
				Pakken <span
              class="pkg pkg">migrationtools</span> inneholder et sett skript øremerket til å hente ut data fra standard Unix-kataloger (<code
              class="filename">/etc/passwd</code>, <code
              class="filename">/etc/group</code>, <code
              class="filename">/etc/services</code>, <code
              class="filename">/etc/hosts</code>, og så videre), konvertere disse dataene, og sette den inn i LDAP-databasen.
			</div><a
            id="id-1.14.10.8.4"
            class="indexterm"></a><div
            class="para">
				Så snart pakken er installert, må <code
              class="filename">/etc/migrationtools/migrate_common.ph</code> redigeres; <code
              class="varname">IGNORE_UID_BELOW</code> og <code
              class="varname">IGNORE_GID_BELOW</code>-valgene må aktiveres (å avkommentere dem er nok), og <code
              class="varname">DEFAULT_MAIL_DOMAIN</code>/<code
              class="varname">DEFAULT_BASE</code> trenger oppdatering.
			</div><div
            class="para">
				Selve overføringsoperasjonen håndteres av <code
              class="command">migrate_all_online.sh</code>-kommandoen, som følger:
			</div><pre
            class="screen">
<code
              class="computeroutput"># </code><strong
              class="userinput"><code>cd /usr/share/migrationtools</code></strong>
<code
              class="computeroutput"># </code><strong
              class="userinput"><code>LDAPADD="/usr/bin/ldapadd -c" ETC_ALIASES=/dev/null ./migrate_all_online.sh</code></strong></pre><div
            class="para">
				<code
              class="command">migrate_all_online.sh</code> stiller noen få spørsmål om LDAP-databasen som dataene skal overføres til. <a
              class="xref"
              href="sect.ldap-directory.html#tab-migrate-all">Tabell 11.1</a> oppsummerer svarene fra Falcots brukereksempel.
			</div><div
            class="table"><a
              id="tab-migrate-all"></a><p
              class="title"><strong>Tabell 11.1. Svar på spørsmål forespurt av <code
                  class="command">migrate_all_online.sh</code>-skriptet</strong></p><div
              class="table-contents"><table
                xmlns:d="http://docbook.org/ns/docbook"
                class="lt-4-cols lt-7-rows"
                summary="Svar på spørsmål forespurt av migrate_all_online.sh-skriptet"><colgroup><col
                    align="justify" /><col
                    align="justify" /></colgroup><thead><tr><th
                      align="justify">Spørsmål</th><th
                      align="justify">Svar</th></tr></thead><tbody><tr><td
                      align="justify">X.500 navnekontekst</td><td
                      align="justify"><code
                        class="literal">dc=falcot,dc=com</code></td></tr><tr><td
                      align="justify">Vertsnavnet på LDAP-serveren</td><td
                      align="justify"><code
                        class="literal">localhost</code></td></tr><tr><td
                      align="justify">Manager DN</td><td
                      align="justify"><code
                        class="literal">cn=admin,dc=falcot,dc=com</code></td></tr><tr><td
                      align="justify">Tilknytningsreferanser</td><td
                      align="justify">det administrative passordet</td></tr><tr><td
                      align="justify">Å lage DUAConfigProfile</td><td
                      align="justify">no</td></tr></tbody></table></div></div><div
            class="para">
				Vi lar bevisst være å flytte <code
              class="filename">/etc/aliases</code>-filen, siden standardskjemaet som leveres av Debian ikke inkluderer strukturer som dette skriptet bruker til å beskrive e-postaliaser. Skulle vi ønske å integrere disse dataene i katalogen, skal <code
              class="filename">/etc/ldap/schema/misc.schema</code>-filen legges til standardskjemaet.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>VERKTØY</em></span> Søke i en LDAP-mappe</strong></p></div></div></div><div
              class="para">
				Kommandoen <code
                class="command">jxplorer</code> (i pakken med samme navn) er et grafisk verktøy som tillater å bla gjennom og redigere en LDAP-database. Dette er et interessant verktøy som gir en administrator en god oversikt over den hierarkiske strukturen i LDAP-dataene.
			</div><a
              id="id-1.14.10.8.11.3"
              class="indexterm"></a></div><div
            class="para">
				Legg også merke til bruken av <code
              class="literal">-c</code>-valget til <code
              class="command">ldapadd</code>-kommandoen; dette alternativet ber om at prosessen ikke stopper i tilfelle feil. Å bruke dette alternativet kreves fordi å konvertere <code
              class="filename">/etc/services</code> ofte generer noen få feil som trygt kan ignoreres.
			</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="id-1.14.10.9"></a>11.7.3. Å håndtere kontoer med LDAP</h3></div></div></div><div
            class="para">
				Nå når LDAP-databasen inneholder en del nyttig informasjon, er tiden kommet for å gjøre bruk av disse dataene. I denne seksjonen skal vi se på hvordan du konfigurerer et Linux-system, slik at de ulike systemmappene bruker LDAP-databasen.
			</div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      id="sect.config-nss"></a>11.7.3.1. Å sette opp NSS</h4></div></div></div><div
              class="para">
					NSS-systemet (Name Service Switch, se sidestolpe <a
                class="xref"
                href="sect.user-group-databases.html#sidebar.intro-nss"><span
                  class="emphasis"><em>GÅR VIDERE</em></span> NSS og systemdatabaser</a>) er et modulært system utformet for å definere eller hente informasjon for systemmapper. Med LDAP som datakilde krever NSS installasjon av <span
                class="pkg pkg">libnss-ldap</span>-pakken. Installasjonen av den stiller noen få spørsmål; svarene er oppsummert i <a
                class="xref"
                href="sect.ldap-directory.html#tab-libnss-ldap">Tabell 11.2</a>.
				</div><a
              id="id-1.14.10.9.3.3"
              class="indexterm"></a><div
              class="table"><a
                id="tab-libnss-ldap"></a><p
                class="title"><strong>Tabell 11.2. Å sette opp <span
                    class="pkg pkg">libnss-ldap</span>-pakken</strong></p><div
                class="table-contents"><table
                  xmlns:d="http://docbook.org/ns/docbook"
                  class="lt-4-cols gt-7-rows"
                  summary="Å sette opp libnss-ldap-pakken"><colgroup><col
                      align="justify" /><col
                      align="justify" /></colgroup><thead><tr><th
                        align="justify">Spørsmål</th><th
                        align="justify">Svar</th></tr></thead><tbody><tr><td
                        align="justify">LDAP-tjener Uniform Resource Identifier</td><td
                        align="justify"><code
                          class="literal">ldap://ldap.falcot.com</code></td></tr><tr><td
                        align="justify">Øremerket navn for søkerbasen</td><td
                        align="justify"><code
                          class="literal">dc=falcot,dc=com</code></td></tr><tr><td
                        align="justify">LDAP-versjon som skal brukes</td><td
                        align="justify"><code
                          class="literal">3</code></td></tr><tr><td
                        align="justify">Krever LDAP-databasen innlogging?</td><td
                        align="justify">no</td></tr><tr><td
                        align="justify">Spesielle LDAP-rotprivilegier</td><td
                        align="justify">ja</td></tr><tr><td
                        align="justify">Gjør konfigurasjonsfilen lesbar/skrivbar bare for sin eier</td><td
                        align="justify">no</td></tr><tr><td
                        align="justify">LDAP-konto for rot</td><td
                        align="justify"><code
                          class="literal">cn=admin,dc=falcot,dc=com</code></td></tr><tr><td
                        align="justify">LDAP-passord for rotkonto</td><td
                        align="justify">det administrative passordet</td></tr></tbody></table></div></div><div
              class="para">
					Filen <code
                class="filename">/etc/nsswitch.conf</code> må deretter endres, for å konfigurere NSS til å bruke den nettopp installerte <code
                class="command">ldap</code>-modulen.
				</div><div
              class="example"><a
                id="id-1.14.10.9.3.6"></a><p
                class="title"><strong>Eksempel 11.26. Filen <code
                    class="filename">/etc/nsswitch.conf</code></strong></p><div
                class="example-contents"><pre
                  class="programlisting">
# /etc/nsswitch.conf
#
# Example configuration of GNU Name Service Switch functionality.
# If you have the `glibc-doc' and `info' packages installed, try:
# `info libc "Name Service Switch"' for information about this file.

passwd: ldap compat
group: ldap compat
shadow: ldap compat

hosts: files dns ldap
networks: ldap files

protocols: ldap db files
services: ldap db files
ethers: ldap db files
rpc: ldap db files

netgroup: ldap files
</pre></div></div><div
              class="para">
					Modulen <code
                class="command">ldap</code> er vanligvis satt inn før de andre, og den vil derfor spørres først. Unntaket å merke seg er <code
                class="literal">hosts</code>-tjenesten, siden LDAP-tjeneren krever å kontakte DNS først (for å løse <code
                class="literal">ldap.falcot.com</code>). Uten dette unntaket, ville en forespørsel om vertsnavn prøve å spørre LDAP-tjeneren; dette ville utløse et navneoppslag for LDAP-tjeneren, og så videre i en uendelig sløyfe.
				</div><div
              class="para">
					Hvis LDAP-tjeneren skal vurderes som autoritative (og de lokale filene som brukes av <code
                class="command">files</code>-modulen ignoreres), kan tjenester konfigureres med følgende syntaks:
				</div><div
              class="para">
					<code
                class="literal"><em
                  class="replaceable">tjeneste</em>: ldap [NOTFOUND=return] files</code>.
				</div><div
              class="para">
					Hvis den forespurte oppføringen ikke finnes i LDAP-databasen, vil søket returnere et «ikke eksisterende» svar, selv om ressursen eksisterer i en av de lokale filene. Disse lokale filene vil bare bli brukt når LDAP-tjenesten er nede.
				</div></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      id="sect.config-pam"></a>11.7.3.2. Å sette opp PAM</h4></div></div></div><div
              class="para">
					Denne delen beskriver en PAM-konfigurasjon (se sidestolpe <a
                class="xref"
                href="basic-configuration.html#sidebar.intro-pam"><span
                  class="emphasis"><em>BAK KULISSENE</em></span> <code
                  class="filename">/etc/environment</code> og <code
                  class="filename">/etc/default/locale</code></a>) som vil tillate programmer å utføre de nødvendige godkjenninger mot LDAP-databasen.
				</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>VÆR VARSOM</em></span> Brutt godkjenning</strong></p></div></div></div><div
                class="para">
					Det er en følsom operasjon å endre den standard PAM-konfigurasjonen som brukes av ulike programmer. En feil kan føre til ødelagt godkjenning, noe som kan hindre innlogging. Å holde et rotskall åpent er derfor en god forholdsregel. Hvis konfigurasjonsfeil oppstår, kan de fikses, og tjenesten startes igjen med minimal innsats.
				</div></div><div
              class="para">
					LDAP-modulen for PAM leveres av <span
                class="pkg pkg">libpam-ldap</span>-pakken. Å installere denne pakken stiller noen spørsmål som er svært lik dem i <span
                class="pkg pkg">libnss-ldap</span>. Noen konfigurasjonsparametere (for eksempel URI for LDAP-tjeneren) er faktisk delt med <span
                class="pkg pkg">libnss-ldap</span>-pakken. Svarene er er oppsummert i <a
                class="xref"
                href="sect.ldap-directory.html#tab-libpam-ldap">Tabell 11.3</a>.
				</div><a
              id="id-1.14.10.9.4.5"
              class="indexterm"></a><div
              class="table"><a
                id="tab-libpam-ldap"></a><p
                class="title"><strong>Tabell 11.3. Å sette opp <span
                    class="emphasis"><em>libpam-ldap</em></span></strong></p><div
                class="table-contents"><table
                  xmlns:d="http://docbook.org/ns/docbook"
                  class="lt-4-cols lt-7-rows"
                  summary="Å sette opp libpam-ldap"><colgroup><col
                      align="justify" /><col
                      align="justify" /></colgroup><thead><tr><th
                        align="justify">Spørsmål</th><th
                        align="justify">Svar</th></tr></thead><tbody><tr><td
                        align="justify">Tillate LDAP-administrasjonskontoen å oppføre seg som lokal rot?</td><td
                        align="justify">Ja. Dette tilllater å bruke den vanlige <code
                          class="command">passwd</code>-kommandoen for å endre passord lagret i LDAP-databasen.</td></tr><tr><td
                        align="justify">Krever LDAP-databasen innlogging?</td><td
                        align="justify">no</td></tr><tr><td
                        align="justify">LDAP-konto for rot</td><td
                        align="justify"><code
                          class="literal">cn=admin,dc=falcot,dc=com</code></td></tr><tr><td
                        align="justify">LDAP-passord for rotkonto</td><td
                        align="justify">LDAP-databasens administrative passord</td></tr><tr><td
                        align="justify">Å bruke lokal krypteringsalgoritme for passord</td><td
                        align="justify">krypten</td></tr></tbody></table></div></div><div
              class="para">
					Installering av <span
                class="pkg pkg">libpam-ldap</span> tilpasser automatisk standard PAM-konfigurasjonen som er definert i <code
                class="filename">/etc/pam.d/common-auth</code>, <code
                class="filename">/etc/pam.d/common-password</code> og <code
                class="filename">/etc/pam.d/common-account</code>-filene. Denne mekanisme bruker det øremerkede <code
                class="command">pam-auth-update</code>-verktøyet (levert av <span
                class="pkg pkg">libpam-runtime</span>-pakken). Dette verktøyet kan også kjøres av administratoren dersom de ønsker å aktivere eller deaktivere PAM-moduler.
				</div><a
              id="id-1.14.10.9.4.8"
              class="indexterm"></a><a
              id="id-1.14.10.9.4.9"
              class="indexterm"></a><a
              id="id-1.14.10.9.4.10"
              class="indexterm"></a><a
              id="id-1.14.10.9.4.11"
              class="indexterm"></a><a
              id="id-1.14.10.9.4.12"
              class="indexterm"></a><a
              id="id-1.14.10.9.4.13"
              class="indexterm"></a></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      id="id-1.14.10.9.5"></a>11.7.3.3. Å sikre LDAP-datautveksling</h4></div></div></div><a
              id="id-1.14.10.9.5.2"
              class="indexterm"></a><div
              class="para">
					Som standard transporterer LDAP-protokollen på nettverket i klartekst. Dette inkluderer (krypterte) passord. Ettersom de krypterte passordene kan være hentet fra nettverket, kan de være sårbare for type ordbokangrep. Dette kan unngås ved hjelp av et ekstra krypteringslag; å aktivere dette laget er tema for denne seksjonen.
				</div><div
              class="section"><div
                class="titlepage"><div><div><h5
                      class="title"><a
                        id="id-1.14.10.9.5.4"></a>11.7.3.3.1. Å sette opp tjeneren</h5></div></div></div><a
                id="id-1.14.10.9.5.4.2"
                class="indexterm"></a><a
                id="id-1.14.10.9.5.4.3"
                class="indexterm"></a><div
                class="para">
						Det første trinnet er å opprette et nøkkelpar (bestående av en offentlig nøkkel og en privat nøkkel) for LDAP-serveren. Falcot-administratorene gjenbruker <span
                  class="emphasis"><em>easy-rsa</em></span> for å genere det (se <a
                  class="xref"
                  href="sect.virtual-private-network.html#sect.easy-rsa">Seksjon 10.2.1.1, «Offentlig nøkkel-infrastruktur: <span
                    class="emphasis"><em>easy-rsa</em></span>»</a>). Kjøring av <code
                  class="command">./build-key-server ldap.falcot.com</code> medfører noen dagligdagse spørsmål (plassering, organisasjonsnavn og så videre). Svaret på spørsmålet «common name» («vanlig navn»-spørsmålet )<span
                  class="emphasis"><em>må</em></span> være det fullstendige vertsnavnet for LDAP-tjeneren; i vårt tilfelle, <code
                  class="literal">ldap.falcot.com</code>.
					</div><div
                class="para">
						Denne kommandoen oppretter et sertifikat i <code
                  class="filename">keys/ldap.falcot.com.crt</code>-filen; den samsvarende private nøkkelen er lagret i <code
                  class="filename">keys/ldap.falcot.com.key</code>.
					</div><div
                class="para">
						Nå må disse nøklene være installert med sin standard plassering, og vi må sørge for at den private filen er lesbar av LDAP-tjeneren, som kjører med <code
                  class="literal">openldap</code>-brukerindentiteten:
					</div><pre
                class="screen"><code
                  class="computeroutput"># </code><strong
                  class="userinput"><code>adduser openldap ssl-cert
</code></strong><code
                  class="computeroutput">Adding user `openldap' to group `ssl-cert' ...
Adding user openldap to group ssl-cert
Done.
# </code><strong
                  class="userinput"><code>mv keys/ldap.falcot.com.key /etc/ssl/private/ldap.falcot.com.key
</code></strong><code
                  class="computeroutput"># </code><strong
                  class="userinput"><code>chown root:ssl-cert /etc/ssl/private/ldap.falcot.com.key
</code></strong><code
                  class="computeroutput"># </code><strong
                  class="userinput"><code>chmod 0640 /etc/ssl/private/ldap.falcot.com.key
</code></strong><code
                  class="computeroutput"># </code><strong
                  class="userinput"><code>mv newcert.pem /etc/ssl/certs/ldap.falcot.com.pem
</code></strong></pre><div
                class="para">
						Nissen <code
                  class="command">slapd</code> må også få beskjed om å bruke disse nøklene/tastene til kryptering. LDAP-tjenerkonfigurasjon styres dynamisk: konfigurasjonen kan oppdateres med normale LDAP-operasjoner på <code
                  class="literal">cn=config</code>-objekthierarki, og tjeneroppdateringer på <code
                  class="filename">/etc/ldap/slapd.d</code> i sann tid for å gjøre konfigurasjonen persistent. <code
                  class="command">ldapmodify</code> er dermed det riktige verktøyet for å oppdatere konfigurasjonen:
					</div><div
                class="example"><a
                  id="id-1.14.10.9.5.4.9"></a><p
                  class="title"><strong>Eksempel 11.27. Konfigurering <code
                      class="command">slapd</code> for kryptifisering</strong></p><div
                  class="example-contents"><pre
                    class="screen"><code
                      class="computeroutput"># </code><strong
                      class="userinput"><code>cat &gt;ssl.ldif &lt;&lt;END
dn: cn=config
changetype: modify
add: olcTLSCertificateFile
olcTLSCertificateFile: /etc/ssl/certs/ldap.falcot.com.pem
-
add: olcTLSCertificateKeyFile
olcTLSCertificateKeyFile: /etc/ssl/private/ldap.falcot.com.key
-
END
</code></strong><code
                      class="computeroutput"># </code><strong
                      class="userinput"><code>ldapmodify -Y EXTERNAL -H ldapi:/// -f ssl.ldif
</code></strong><code
                      class="computeroutput">SASL/EXTERNAL authentication started
SASL username: gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth
SASL SSF: 0
modifying entry "cn=config"
</code></pre></div></div><div
                class="sidebar"><div
                  class="titlepage"><div><div><p
                        class="title"><strong><span
                            class="emphasis"><em>VERKTØY</em></span> <code
                            class="command">ldapvi</code> for å redigere en LDAP-mappe</strong></p></div></div></div><a
                  id="id-1.14.10.9.5.4.10.2"
                  class="indexterm"></a><div
                  class="para">
						Med <code
                    class="command">ldapvi</code> kan du vise en LDIF-utskrift for enhver del av LDAP-katalogen, gjøre endringer i tekstredigereren, og la verktøyet gjøre de overensstemmende LDAP-operasjoner for deg.
					</div><div
                  class="para">
						Dette er derfor en praktisk måte å oppdatere LDAP-tjenerens oppsett, ganske enkelt ved å redigere <code
                    class="literal">cn=config</code>-hierarkiet.
					</div><pre
                  class="screen"><code
                    class="computeroutput"># </code><strong
                    class="userinput"><code>ldapvi -Y EXTERNAL -h ldapi:/// -b cn=config
</code></strong></pre></div><div
                class="para">
						Det siste trinnet for å aktivere kryptering innebærer å endre <code
                  class="varname">SLAPD_SERVICES</code>-variabelen i <code
                  class="filename">/etc/default/slapd</code>-filen. Vi skal gjøre det trygt, og helt deaktivere usikret LDAP.
					</div><div
                class="example"><a
                  id="id-1.14.10.9.5.4.12"></a><p
                  class="title"><strong>Eksempel 11.28. Filen <code
                      class="filename">/etc/default/slapd</code></strong></p><div
                  class="example-contents"><pre
                    class="programlisting">
# Default location of the slapd.conf file or slapd.d cn=config directory. If
# empty, use the compiled-in default (/etc/ldap/slapd.d with a fallback to
# /etc/ldap/slapd.conf).
SLAPD_CONF=

# System account to run the slapd server under. If empty the server
# will run as root.
SLAPD_USER="openldap"

# System group to run the slapd server under. If empty the server will
# run in the primary group of its user.
SLAPD_GROUP="openldap"

# Path to the pid file of the slapd server. If not set the init.d script
# will try to figure it out from $SLAPD_CONF (/etc/ldap/slapd.conf by
# default)
SLAPD_PIDFILE=

# slapd normally serves ldap only on all TCP-ports 389. slapd can also
# service requests on TCP-port 636 (ldaps) and requests via unix
# sockets.
# Example usage:
# SLAPD_SERVICES="ldap://127.0.0.1:389/ ldaps:/// ldapi:///"
SLAPD_SERVICES="ldaps:/// ldapi:///"

# If SLAPD_NO_START is set, the init script will not start or restart
# slapd (but stop will still work).  Uncomment this if you are
# starting slapd via some other means or if you don't want slapd normally
# started at boot.
#SLAPD_NO_START=1

# If SLAPD_SENTINEL_FILE is set to path to a file and that file exists,
# the init script will not start or restart slapd (but stop will still
# work).  Use this for temporarily disabling startup of slapd (when doing
# maintenance, for example, or through a configuration management system)
# when you don't want to edit a configuration file.
SLAPD_SENTINEL_FILE=/etc/ldap/noslapd

# For Kerberos authentication (via SASL), slapd by default uses the system
# keytab file (/etc/krb5.keytab).  To use a different keytab file,
# uncomment this line and change the path.
#export KRB5_KTNAME=/etc/krb5.keytab

# Additional options to pass to slapd
SLAPD_OPTIONS=""
</pre></div></div></div><div
              class="section"><div
                class="titlepage"><div><div><h5
                      class="title"><a
                        id="id-1.14.10.9.5.5"></a>11.7.3.3.2. Å sette opp klienten</h5></div></div></div><div
                class="para">
						På klientsiden trenger oppsettet for <span
                  class="emphasis"><em>libpam-ldap</em></span> og <span
                  class="emphasis"><em>libnss-ldap</em></span>-modulene å bli modifisert til å bruke en <code
                  class="literal">ldaps://</code>-URI.
					</div><div
                class="para">
						LDAP-klienter må også kunne godkjenne serveren. I en X.509 offentlig nøkkelinfrastruktur er offentlige sertifikater signert av nøkkelen til en sertifiseringsinstans (CA). Med <span
                  class="emphasis"><em>easy-rsa</em></span> har Falcot-administratorene laget sin egen CA, og nå trenger de å konfigurere systemet til å stole på underskriftene til Falcots CA. Dette kan gjøres ved å sette CA-sertifikatet inn i <code
                  class="filename">/usr/local/share/ca-certificates</code>, og kjøre <code
                  class="command">update-ca-certificates</code>.
					</div><pre
                class="screen"><code
                  class="computeroutput"># </code><strong
                  class="userinput"><code>cp keys/ca.crt /usr/local/share/ca-certificates/falcot.crt
</code></strong><code
                  class="computeroutput"># </code><strong
                  class="userinput"><code>update-ca-certificates
</code></strong><code
                  class="computeroutput">Updating certificates in /etc/ssl/certs... 1 added, 0 removed; done.
Running hooks in /etc/ca-certificates/update.d....
Adding debian:falcot.pem
done.
done.
</code></pre><div
                class="para">
						Sist men ikke minst kan standard LDAP URI og standard base DN, brukt av de ulike kommandolinjeverktøyene, endres i <code
                  class="filename">/etc/ldap/ldap.conf</code>. Dette vil spare ganske mye skriving.
					</div><div
                class="example"><a
                  id="id-1.14.10.9.5.5.6"></a><p
                  class="title"><strong>Eksempel 11.29. Filen <code
                      class="filename">/etc/ldap/ldap.conf</code></strong></p><div
                  class="example-contents"><pre
                    class="programlisting">#
# LDAP Defaults
#

# See ldap.conf(5) for details
# This file should be world readable but not world writable.

BASE   dc=falcot,dc=com
URI    ldaps://ldap.falcot.com

#SIZELIMIT      12
#TIMELIMIT      15
#DEREF          never

# TLS certificates (needed for GnuTLS)
TLS_CACERT      /etc/ssl/certs/ca-certificates.crt
</pre></div></div></div></div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="sect.http-ftp-proxy.html"><strong>Forrige</strong>11.6. HTTP/FTP-mellomtjener</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>Opp</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>Hjem</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.rtc-services.html"><strong>Neste</strong>11.8. Sanntids kommunikasjonstjenester</a></li></ul><div
        id="translated_pages"><ul><li><a
              href="../ar-MA/sect.ldap-directory.html">ar-MA</a></li><li><a
              href="../da-DK/sect.ldap-directory.html">da-DK</a></li><li><a
              href="../de-DE/sect.ldap-directory.html">de-DE</a></li><li><a
              href="../el-GR/sect.ldap-directory.html">el-GR</a></li><li><a
              href="../en-US/sect.ldap-directory.html">en-US</a></li><li><a
              href="../es-ES/sect.ldap-directory.html">es-ES</a></li><li><a
              href="../fa-IR/sect.ldap-directory.html">fa-IR</a></li><li><a
              href="../fr-FR/sect.ldap-directory.html">fr-FR</a></li><li><a
              href="../hr-HR/sect.ldap-directory.html">hr-HR</a></li><li><a
              href="../id-ID/sect.ldap-directory.html">id-ID</a></li><li><a
              href="../it-IT/sect.ldap-directory.html">it-IT</a></li><li><a
              href="../ja-JP/sect.ldap-directory.html">ja-JP</a></li><li><a
              href="../ko-KR/sect.ldap-directory.html">ko-KR</a></li><li><a
              href="../nb-NO/sect.ldap-directory.html">nb-NO</a></li><li><a
              href="../pl-PL/sect.ldap-directory.html">pl-PL</a></li><li><a
              href="../pt-BR/sect.ldap-directory.html">pt-BR</a></li><li><a
              href="../ro-RO/sect.ldap-directory.html">ro-RO</a></li><li><a
              href="../ru-RU/sect.ldap-directory.html">ru-RU</a></li><li><a
              href="../tr-TR/sect.ldap-directory.html">tr-TR</a></li><li><a
              href="../vi-VN/sect.ldap-directory.html">vi-VN</a></li><li><a
              href="../zh-CN/sect.ldap-directory.html">zh-CN</a></li><li><a
              href="../zh-TW/sect.ldap-directory.html">zh-TW</a></li></ul></div></body></html>
