<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">11.2. Nett-tjener (HTTP)</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-8-nb-NO-1.0-1" /><meta
        name="keywords"
        content="Postfix, Apache, NFS, Samba, Squid, OpenLDAP, SIP" /><link
        rel="home"
        href="index.html"
        title="Debian-administratorens håndbok" /><link
        rel="up"
        href="network-services.html"
        title="Kapittel 11. Nettverkstjenester: Postfix, Apache, NFS, Samba, Squid, LDAP, SIP, XMPP, TURN" /><link
        rel="prev"
        href="network-services.html"
        title="Kapittel 11. Nettverkstjenester: Postfix, Apache, NFS, Samba, Squid, LDAP, SIP, XMPP, TURN" /><link
        rel="next"
        href="sect.ftp-file-server.html"
        title="11.3. FTP Filtjener" /><meta
        name="viewport"
        content="width=device-width, initial-scale=1" /><link
        rel="canonical"
        href="http://l.github.io/debian-handbook/html/nb-NO/sect.http-web-server.html" /></head><body><noscript><iframe
          src="//www.googletagmanager.com/ns.html?id=GTM-5H35QX"
          height="0"
          width="0"
          style="display:none;visibility:hidden"></iframe></noscript><script
        type="text/javascript">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&amp;l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5H35QX');</script><div
        id="banner"><a
          href="../../"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="index.html"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="network-services.html"><strong>Forrige</strong></a></li><li
          class="home">Debian-administratorens håndbok</li><li
          class="next"><a
            accesskey="n"
            href="sect.ftp-file-server.html"><strong>Neste</strong></a></li></ul><div
        class="section"><div
          class="titlepage"><div><div><h2
                class="title"><a
                  id="sect.http-web-server"></a>11.2. Nett-tjener (HTTP)</h2></div></div></div><div
          class="para">
			Falcot Corp-administrtatorene besluttet å bruke Apache HTTP-tjeneren, inkludert i Debian <span
            class="distribution distribution">Jessie</span> med versjon 2.4.10.
		</div><a
          id="id-1.14.5.3"
          class="indexterm"></a><a
          id="id-1.14.5.4"
          class="indexterm"></a><a
          id="id-1.14.5.5"
          class="indexterm"></a><a
          id="id-1.14.5.6"
          class="indexterm"></a><a
          id="id-1.14.5.7"
          class="indexterm"></a><div
          class="sidebar"><div
            class="titlepage"><div><div><p
                  class="title"><strong><span
                      class="emphasis"><em>ALTERNATIVE</em></span> Andre nett-tjenere</strong></p></div></div></div><div
            class="para">
			Apache er rett og slett den mest kjente (og mye brukt) nett-tjeneren, men det finnes andre. De kan tilby bedre ytelse under visse arbeidsbelastninger, men dette har sitt motstykke i færre, tilgjengelige funksjoner og moduler. Men når den potensielle nett-tjeneren bygges for å betjene statiske filer eller å fungere som mellomtjener, er alternativene, for eksempel <span
              class="pkg pkg">nginx</span> og <span
              class="pkg pkg">lighttpd</span>, verdt å se nærmere på.
		</div><a
            id="id-1.14.5.8.3"
            class="indexterm"></a><a
            id="id-1.14.5.8.4"
            class="indexterm"></a></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="id-1.14.5.9"></a>11.2.1. Å installere Apache</h3></div></div></div><div
            class="para">
				Å installere <span
              class="pkg pkg">apache2</span>-pakken er alt som trenges. Den inneholder alle modulene, inkludert <span
              class="emphasis"><em>Multi-Processing Modules</em></span> (MPM-er) som påvirker hvordan Apache håndterer parallell behandling av mange forespørsler (de som bruker å bli levert i separate <span
              class="pkg pkg">apache2-mpm-*</span>-pakker). Den vil også trekke på <span
              class="pkg pkg">apache2-utils</span> som inneholder kommandolinje-verktøy som vi vil oppdage senere.
			</div><div
            class="para">
				Når MPM brukes påvirkes måten Apache vil håndtere samtidige forespørsler på betydelig. Med <span
              class="emphasis"><em>worker</em></span>-MPM, bruker den <span
              class="emphasis"><em>threads</em></span> (lettvektprosesser), mens med <span
              class="emphasis"><em>prefork</em></span>-MPM bruker den en samling prosesser som er laget på forhånd. Med <span
              class="emphasis"><em>event</em></span>-MPM vil den også bruke tråder, men de inaktive tilkoblingene (spesielt de som holdes åpne av HTTP <span
              class="emphasis"><em>keep-alive</em></span>-funksjonen) blir levert tilbake til en øremerket management-tråd.
			</div><div
            class="para">
				Falcot administratorene installerer også <span
              class="pkg pkg">libapache2-mod-php5</span> for å inkludere PHP-støtte i Apache. Dette fører til at standard <span
              class="emphasis"><em>event</em></span>-MPM-en blir deaktivert, og at <span
              class="emphasis"><em>prefork</em></span> blir brukt istedet, ettersom PHP bare virker under denne bestemte MPM-en.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>SECURITY</em></span> Kjøring under <code
                        class="literal">www-data</code>-brukeren</strong></p></div></div></div><a
              id="id-1.14.5.9.5.2"
              class="indexterm"></a><a
              id="id-1.14.5.9.5.3"
              class="indexterm"></a><div
              class="para">
				Som standard håndterer Apache innkommende forespørsler under identiteten til <code
                class="literal">www-data</code>-brukeren. Dette betyr at en sikkerhetssårbarhet i et CGI-skript, utført av Apache (for en dynamisk side), ikke vil kompromittere hele systemet, men bare de filer som eies av denne bestemte brukeren.
			</div><div
              class="para">
				Ved å bruke <span
                class="emphasis"><em>suexec</em></span>-moduler kan en omgå denne regelen slik at noen CGI-skript kjøres med identiteten til en annen bruker. Dette konfigureres med et <code
                class="literal">SuexecUserGroup <em
                  class="replaceable">user</em><em
                  class="replaceable">group</em></code>-direktiv i Apache-oppsettet.
			</div><a
              id="id-1.14.5.9.5.6"
              class="indexterm"></a><div
              class="para">
				En annen mulighet er å bruke en dedikert MPM, slik som den som tilbys i <span
                class="pkg pkg">libapache2-mpm-itk</span>. Akkurat denne har en litt annen oppførsel: Den tillater å "isolere" virtuelle verter (faktisk, sett med sider), slik at de hver av dem kjører som en ulik bruker. En sårbarhet i en nettside kan derfor ikke kompromittere filer som tilhører eieren av et annet nettsted.
			</div></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>QUICK LOOK</em></span> List of modules</strong></p></div></div></div><div
              class="para">
				Den fullstendige listen med Apache standardmoduler finnes på nettet. <div
                class="url">→ <a
                  href="http://httpd.apache.org/docs/2.4/mod/index.html">http://httpd.apache.org/docs/2.4/mod/index.html</a></div>
			</div></div><div
            class="para">
				Apache er en modulbasert tjener, og mange funksjoner legges inn av eksterne moduler som hovedprogrammet laster inn under under sin initialisering. Standard konfigurasjonen kan bare aktivere de mest vanlige moduler, men å tillate nye moduler skjer ved ganske enkelt å kjøre <code
              class="command">a2enmod <em
                class="replaceable">module</em></code>; For å koble fra en modul, er kommandoen <code
              class="command">a2dismod <em
                class="replaceable">module</em></code>. Disse programmene oppretter (eller sletter) bare symbolske lenker i <code
              class="filename">/etc/apache2/mods-enabled/</code>, som peker på de aktuelle filene (lagret i <code
              class="filename">/etc/apache2/mods-available/</code>).
			</div><div
            class="para">
				Med sin standardkonfigurasjon, lytter nettjeneren på port 80 (som konfigurert i <code
              class="filename">/etc/apache2/ports.conf</code>), og betjener sider fra <code
              class="filename">/var/www/html/</code>-mappen (som konfigurert i <code
              class="filename">/etc/apache2/sites-enabled/000-default.conf</code>).
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>GOING FURTHER</em></span> Å legge til støtte for SSL</strong></p></div></div></div><a
              id="id-1.14.5.9.9.2"
              class="indexterm"></a><a
              id="id-1.14.5.9.9.3"
              class="indexterm"></a><div
              class="para">
				Apache 2.4 inkluderer SSL-modulen som kreves for sikker HTTP (HTTPS) ut av boksen. Den må bare være aktivert med <code
                class="command">a2enmod ssl</code>, deretter må de nødvendige direktiver legges til konfigurasjonsfilene. En konfigurasjonseksempel er gitt i <code
                class="filename">/etc/apache2/sites-available/default-ssl.conf</code>. <div
                class="url">→ <a
                  href="http://httpd.apache.org/docs/2.4/mod/mod_ssl.html">http://httpd.apache.org/docs/2.4/mod/mod_ssl.html</a></div>
			</div><div
              class="para">
				Det kreves noe ekstra forsiktighet hvis du ønsker å favorisere SSL-tilkoblinger med <span
                class="emphasis"><em>Perfect Forward Secrecy</em></span> (disse tilkoblingene bruker flyktige øktnøkler som sikrer at kompromittering av tjenerens hemmelige nøkkelen ikke resulterer i kompromittering av gammel kryptert trafikk som kan ha blitt lagret under sniffing på nettverket). Se på Mozillas anbefalinger, spesielt: <div
                class="url">→ <a
                  href="https://wiki.mozilla.org/Security/Server_Side_TLS#Apache">https://wiki.mozilla.org/Security/Server_Side_TLS#Apache</a></div>
			</div><a
              id="id-1.14.5.9.9.6"
              class="indexterm"></a></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="id-1.14.5.10"></a>11.2.2. Å konfigurere virtuelle verter</h3></div></div></div><div
            class="para">
				En virtuell vert er en ekstra identitet for nettjeneren.
			</div><a
            id="id-1.14.5.10.3"
            class="indexterm"></a><div
            class="para">
				Apache vurderer to forskjellige typer virtuelle verter: De som er basert på IP-adressen (eller porten), og de som er avhengige av domenenavnet til nettjeneren. Den første metoden krever tildeling av en annen IP-adresse (eller port) for hvert område, mens den andre kan arbeide på en enkelt IP-adresse (og port), og nettstedene er differensiert etter vertsnavnet sendt av HTTP-klienten (som bare fungerer i versjon 1.1 av HTTP-protokollen - heldigvis at versjonen er gammel nok til at alle kunder bruker den allerede).
			</div><div
            class="para">
				Den (økende) knapphet på IPv4-adresser favoriserer vanligvis den andre metoden; Imidlertid er det gjort mer komplisert om de virtuelle verter må levere HTTPS også, ettersom SSL-protokollen ikke alltid har levert navn-basert virtuell hosting; Ikke alle nettlesere håndterer SNI-forlengelsen (<span
              class="emphasis"><em>Server Name Indication</em></span>). Når flere HTTPS-nettsteder må kjøre på samme tjener, vil de vanligvis bli differensiert enten ved å kjøre på en annen port eller på en annen IP-adresse (IPv6 kan hjelpe til der).
			</div><div
            class="para">
				Standardkonfigurasjonen for Apache 2 gir navn-baserte virtuelle verter. I tillegg er en standard virtuell vert definert i <code
              class="literal">/etc/apache2/sites-enabled/000-default.conf</code>-filen; Denne virtuelle verten vil bli brukt hvis det ikke finnes en vert som matcher anmodningen fra klienten.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>CAUTION</em></span> Første virtuelle vert</strong></p></div></div></div><div
              class="para">
				Forespørsler om ukjente virtuelle verter vil alltid bli betjent med den først definerte virtuelle verten. Det er derfor vi her har definert <code
                class="literal">www.falcot.com</code> først.
			</div></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>QUICK LOOK</em></span> Apache støtter SNI</strong></p></div></div></div><a
              id="id-1.14.5.10.8.2"
              class="indexterm"></a><div
              class="para">
				Apache-tjeneren støtter en SSL-protokoll-forlengelse kalt <span
                class="emphasis"><em>Server Name Indication</em></span> (SNI). Denne utvidelsen lar nettleseren sende vertsnavnet til nettjeneren, ved etableringen av SSL-tilkoblingen, mye tidligere enn HTTP-forespørselen selv, som tidligere ble brukt til å identifisere den forespurte virtuelle verten blant dem som ligger på samme tjener (med samme IP-adresse og port). Dette gjør Apache ved å velge det mest passende SSL-sertifikatet slik at transaksjonen kan fortsette.
			</div><div
              class="para">
				Før SNI, ville Apache alltid bruke sertifikatet i den virtuelle standard-verten. Klienter som prøver å få tilgang til en annen virtuell vert vil da vise advarsler, siden sertifikatet de mottok ikke samsvarte med nettstedet de prøvde å få tilgang til. Heldigvis jobber de fleste nettlesere sammen med SNI. Dette inkluderer Microsoft Internet Explorer fra og med versjon 7.0 (som starter med Vista), Mozilla Firefox fra og med versjon 2.0, Apple Safari fra versjon 3.2.1, og alle versjoner av Google Chrome.
			</div><div
              class="para">
				Apache pakken, levert med Debian, er bygget med støtte for SNI. Ingen spesiell konfigurasjon er derfor nødvendig.
			</div><div
              class="para">
				En bør også utvise forsiktighet for å sikre at konfigurasjonen for den første virtuelle verten (den som brukes som standard) aktiverer TLSv1, ettersom Apache bruker parametrene fra denne første virtuelle verten til å etablere sikre forbindelser, og de hadde bare å tillate dem!
			</div></div><div
            class="para">
				Hver ekstra virtuelle vert er deretter beskrevet av en fil lagret i <code
              class="filename">/etc/apache2/sites-available/</code>. Å sette opp et nettsted for <code
              class="literal">falcot.org</code>-domenet blir derfor en enkel sak ved å lage den følgende filen, og så aktivere den virtuelle verten med <code
              class="command">a2ensite www.falcot.org</code>.
			</div><div
            class="example"><a
              id="id-1.14.5.10.10"></a><p
              class="title"><strong>Eksempel 11.16. <code
                  class="filename">/etc/apache2/sites-available/www.falcot.org.conf</code>-filen</strong></p><div
              class="example-contents"><pre
                class="programlisting">
&lt;VirtualHost *:80&gt;
ServerName www.falcot.org
ServerAlias falcot.org
DocumentRoot /srv/www/www.falcot.org
&lt;/VirtualHost&gt;
</pre></div></div><div
            class="para">
				Apache-tjeneren, konfigurert så langt, bruker de samme loggfiler for alle virtuelle verter (selv om dette kan endres ved å legge til <code
              class="literal">CustomLog</code>-direktiver i definisjonene til de virtuelle vertene). Det er derfor klokt å tilpasse formatet på denne loggfilen slik at den inneholder navnet på den virtuelle verten. Dette kan gjøres ved å opprette en <code
              class="filename">/etc/apache2/conf-available/customlog.conf</code>-fil som fastsetter et nytt format for alle loggfiler (med <code
              class="literal">LogFormat</code>-direktivet) og ved å aktivere den med <code
              class="command">a2enconf customlog</code>. <code
              class="literal">CustomLog</code>-linjen må også fjernes (eller kommenteres ut) fra <code
              class="filename">/etc/apache2/sites-available/000-default.conf</code>-filen.
			</div><div
            class="example"><a
              id="id-1.14.5.10.12"></a><p
              class="title"><strong>Eksempel 11.17. <code
                  class="filename">/etc/apache2/conf.d/customlog.conf</code>-filen</strong></p><div
              class="example-contents"><pre
                class="programlisting scale">
# New log format including (virtual) host name
LogFormat "%v %h %l %u %t \"%r\" %&gt;s %b \"%{Referer}i\" \"%{User-Agent}i\"" vhost

# Now let's use this "vhost" format by default
CustomLog /var/log/apache2/access.log vhost
</pre></div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="id-1.14.5.11"></a>11.2.3. Vanlige direktiver</h3></div></div></div><div
            class="para">
				Dette avsnittet gir en kort gjennomgang av noen av de oftest brukte Apache-konfigurasjonsdirektivene.
			</div><a
            id="id-1.14.5.11.3"
            class="indexterm"></a><a
            id="id-1.14.5.11.4"
            class="indexterm"></a><div
            class="para">
				Den viktigste konfigurasjonsfilen inneholder vanligvis flere <code
              class="literal">Directory</code>-blokker. De åpner for å spesifisere ulike virkemåter for tjeneren, avhengig av plasseringen av filen som blir betjent. En slik blokk omfatter vanligvis <code
              class="literal">Options</code> og <code
              class="literal">AllowOverride</code>-direktiver.
			</div><a
            id="id-1.14.5.11.6"
            class="indexterm"></a><a
            id="id-1.14.5.11.7"
            class="indexterm"></a><div
            class="example"><a
              id="id-1.14.5.11.8"></a><p
              class="title"><strong>Eksempel 11.18. Katalogblokk</strong></p><div
              class="example-contents"><pre
                class="programlisting">
&lt;Directory /var/www&gt;
Options Includes FollowSymlinks
AllowOverride All
DirectoryIndex index.php index.html index.htm
&lt;/Directory&gt;
</pre></div></div><div
            class="para">
				<code
              class="literal">DirectoryIndex</code>-direktivet inneholder en liste over filer som kan prøves når klientens forespørsel matcher en katalog. Den første filen som forekommer i listen brukes og er sendt som en respons.
			</div><a
            id="id-1.14.5.11.10"
            class="indexterm"></a><div
            class="para">
				<code
              class="literal">Options</code>-direktivet er etterfulgt av en liste av alternativer som kan aktiveres. <code
              class="literal">None</code>-verdien slår av alle valg; tilsvarende, aktiverer <code
              class="literal">All</code> alle sammen for uten <code
              class="literal">MultiViews</code>. Tilgjengelige valg inkluderer:
			</div><div
            xmlns:d="http://docbook.org/ns/docbook"
            class="itemizedlist"><ul><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">ExecCGI</code> indikerer at CGI-skript kan utføres. <a
                    id="id-1.14.5.11.12.1.1.2"
                    class="indexterm"></a>
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">FollowSymlinks</code> forteller tjeneren at symbolske lenker kan bli fulgt, og at responsen skal inneholde mål-innholdet for slike koblinger. <a
                    id="id-1.14.5.11.12.2.1.2"
                    class="indexterm"></a>
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">SymlinksIfOwnerMatch</code> forteller også at tjeneren skal følge symbolske lenker, men bare når koblingen og målet har samme eier.<a
                    id="id-1.14.5.11.12.3.1.2"
                    class="indexterm"></a>
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">Includes</code> aktiverer <span
                    class="emphasis"><em>Server Side Includes</em></span> (<span
                    class="emphasis"><em>SSI</em></span> i korthet). Dette er direktiver som er innebygd i HTML-sider og utført underveis for hver forespørsel. <a
                    id="id-1.14.5.11.12.4.1.4"
                    class="indexterm"></a>
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">Indexes</code> forteller at tjeneren skal vise innholdet i en katalog hvis HTTP-forespørselen sendt av klienten peker på en katalog uten en indeksfil (dvs. når ingen filer nevnt av <code
                    class="literal">DirectoryIndex</code>-direktivet finnes i denne mappen). <a
                    id="id-1.14.5.11.12.5.1.3"
                    class="indexterm"></a>
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">MultiViews</code> muliggjør forhandlinger om innholdet. Denne kan brukes av tjeneren for å returnere en nettside som matcher det foretrukne språket som er konfigurert i nettleseren. <a
                    id="id-1.14.5.11.12.6.1.2"
                    class="indexterm"></a>
					</div></li></ul></div><div
            class="para">
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>BACK TO BASICS</em></span> <code
                        class="filename">.htaccess</code> file</strong></p></div></div></div><div
              class="para">
				<code
                class="filename">.htaccess</code>-filen inneholder konfigurasjonsdirektiver for Apache som utføres hver gang en forespørsel om et element i katalogen der den er lagret. Definisisjonsområdet for disse direktivene gjentas også for alle underkatalogene.
			</div><a
              id="id-1.14.5.11.14.3"
              class="indexterm"></a><div
              class="para">
				De fleste direktiver som kan forekomme i en <code
                class="literal">Directory</code>-blokk gjelder også for en <code
                class="filename">.htaccess</code>-file.
			</div></div><div
            class="para">
				<code
              class="literal">AllowOverride</code>-direktivet lister opp alle alternativer som kan aktiveres eller deaktiveres ved hjelp av en <code
              class="filename">.htaccess</code>-fil. En vanlig bruk av dette valget er til å begrense <code
              class="literal">ExecCGI</code>, slik at administratoren velger hvilke brukere som har lov til å kjøre programmer under nettjenerens identitet (<code
              class="literal">www-data</code>-brukeren).
			</div><a
            id="id-1.14.5.11.16"
            class="indexterm"></a><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      id="id-1.14.5.11.17"></a>11.2.3.1. Å rekvirere autentisering</h4></div></div></div><a
              id="id-1.14.5.11.17.2"
              class="indexterm"></a><div
              class="para">
					I noen tilfeller trenges det begrenset tilgang til en del av et nettsted, slik at bare legitime brukere som gir et brukernavn og et passord får tilgang til innholdet.
				</div><div
              class="example"><a
                id="id-1.14.5.11.17.4"></a><p
                class="title"><strong>Eksempel 11.19. <code
                    class="filename">.htaccess</code>-fil som krever autentisering</strong></p><div
                class="example-contents"><pre
                  class="programlisting">
Require valid-user
AuthName "Private directory"
AuthType Basic
AuthUserFile /etc/apache2/authfiles/htpasswd-private
</pre></div></div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>SECURITY</em></span> Ingen sikkerhet</strong></p></div></div></div><div
                class="para">
					Autentiseringssystemet som brukes i eksempelet ovenfor (<code
                  class="literal">Basic</code>) har minimal sikkerhet når passordet sendes i klartekst (det er bare kodet som <span
                  class="emphasis"><em>base64</em></span>, som er en enkel innkoding snarere enn en krypteringsmetode). Det bør også bemerkes at de dokumenter som "beskyttet" av denne mekanismen også går over nettverket i klartekst. Hvis sikkerhet er viktig, bør hele HTTP-tilkobling krypteres med SSL.
				</div></div><div
              class="para">
					The <code
                class="filename">/etc/apache2/authfiles/htpasswd-private</code>-filen inneholder en liste over brukere og passord. Den er ofte håndtert med <code
                class="command">htpasswd</code>-kommandoen. For eksempel brukes følgende kommando til å legge til en bruker eller endre passordet deres: <a
                id="id-1.14.5.11.17.6.3"
                class="indexterm"></a>
				</div><pre
              class="screen">
<code
                class="computeroutput"># </code><strong
                class="userinput"><code>htpasswd /etc/apache2/authfiles/htpasswd-private <em
                    class="replaceable">user</em>
</code></strong><code
                class="computeroutput">New password:
Re-type new password:
Adding password for user <em
                  class="replaceable">user</em>
</code></pre></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      id="id-1.14.5.11.18"></a>11.2.3.2. Adgangsbegrensning</h4></div></div></div><a
              id="id-1.14.5.11.18.2"
              class="indexterm"></a><div
              class="para">
					<code
                class="literal">Require</code>-direktivet regulerer adgangsbegrensninger for en katalog (og gjentatt for katalogens undermapper).
				</div><a
              id="id-1.14.5.11.18.4"
              class="indexterm"></a><a
              id="id-1.14.5.11.18.5"
              class="indexterm"></a><a
              id="id-1.14.5.11.18.6"
              class="indexterm"></a><div
              class="para">
					Den kan brukes til å begrense adgangen basert på flere kriterier: Vi vil stoppe med å beskrive adgangsbegrensning basert på klientens IP-adresse, men det kan gjøres mye kraftigere enn det, særlig når flere <code
                class="literal">Require</code>-direktiver kombineres i en <code
                class="literal">RequireAll</code>-blokk.
				</div><div
              class="example"><a
                id="id-1.14.5.11.18.8"></a><p
                class="title"><strong>Eksempel 11.20. Tillat bare fra det lokale nettverket</strong></p><div
                class="example-contents"><pre
                  class="programlisting">Require ip 192.168.0.0/16
</pre></div></div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>ALTERNATIVE</em></span> Gammel syntaks</strong></p></div></div></div><div
                class="para">
					<code
                  class="literal">Require</code>-syntaksen er bare tilgjengelig i Apache 2.4 (versjonen i <span
                  class="distribution distribution">Jessie</span>). For brukere av <span
                  class="distribution distribution">Wheezy</span> er Apache 2,2-syntaksen forskjellig, og her beskriver vi den hovedsakelig som referanse, selv om den også kan gjøres tilgjengelig i Apache 2,4 ved hjelp av <code
                  class="literal">mod_access_compat</code>-modulen.
				</div><div
                class="para">
					<code
                  class="literal">Allow from</code> og <code
                  class="literal">Deny from</code>-direktivene kontrollerer adgangsbegrensninger for en katalog (og gjentatt for katalogens undermapper).
				</div><a
                id="id-1.14.5.11.18.9.4"
                class="indexterm"></a><a
                id="id-1.14.5.11.18.9.5"
                class="indexterm"></a><a
                id="id-1.14.5.11.18.9.6"
                class="indexterm"></a><div
                class="para">
					<code
                  class="literal">Order</code>-direktivet forteller tjeneren om rekkefølgen på <code
                  class="literal">Allow from</code> og <code
                  class="literal">Deny from</code>-direktivene: den siste som matcher har forrang. Konkret tillater <code
                  class="literal">Order deny,allow</code> adgang hvis ingen <code
                  class="literal">Deny from</code> passer, eller hvis et <code
                  class="literal">Allow from</code>-direktiv gjør det. Omvendt, stanser <code
                  class="literal">Order allow,deny</code> adgang hvis intet <code
                  class="literal">Allow from</code>-direktiv matcher (eller hvis et <code
                  class="literal">Deny from</code>-direktiv tillater).
				</div><div
                class="para">
					<code
                  class="literal">Allow from</code> og <code
                  class="literal">Deny from</code>-direktivene kan etterfølges av en IP-adresse, et nettverk (slik som <code
                  class="literal">192.168.0.0/255.255.255.0</code>, <code
                  class="literal">192.168.0.0/24</code> eller til og med <code
                  class="literal">192.168.0</code>), et vertsnavn eller domenenavn, eller <code
                  class="literal">all</code>-nøkkelen som peker ut alle.
				</div><div
                class="para">
					For eksempel, for å avvise forbindelser som standard, men tillate dem fra det lokale nettverket, kan du bruke denne:
				</div><pre
                class="programlisting">
Order deny,allow
Allow from 192.168.0.0/16
Deny from all
</pre></div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="id-1.14.5.12"></a>11.2.4. Logg-analysatorer</h3></div></div></div><div
            class="para">
				En logg-analysator er ofte installert på en nettjener; siden det første gir administratorer en presis idé om bruksmønstre på sistnevnte.
			</div><div
            class="para">
				Falcot Corp-administratorene valgte <span
              class="emphasis"><em>AWStats</em></span> (<span
              class="emphasis"><em>Advanced Web Statistics</em></span>) til å analysere sine Apache loggfiler.
			</div><a
            id="id-1.14.5.12.4"
            class="indexterm"></a><a
            id="id-1.14.5.12.5"
            class="indexterm"></a><a
            id="id-1.14.5.12.6"
            class="indexterm"></a><a
            id="id-1.14.5.12.7"
            class="indexterm"></a><div
            class="para">
				Det første konfigurasjonstrinnet er å tilpasse <code
              class="filename">/etc/awstats/awstats.conf</code>-filen. Falcot-administratorene holdt den uendret, bortsett fra følgende parametre:
			</div><pre
            class="programlisting">
LogFile="/var/log/apache2/access.log"
LogFormat = "%virtualname %host %other %logname %time1 %methodurl %code %bytesd %refererquot %uaquot"
SiteDomain="www.falcot.com"
HostAliases="falcot.com REGEX[^.*\.falcot\.com$]"
DNSLookup=1
LoadPlugin="tooltips"
</pre><div
            class="para">
				Alle disse parametrene er dokumentert av kommentarer i male-filen. Spesielt beskriver <code
              class="varname">LogFile</code> og <code
              class="varname">LogFormat</code>-parameterene plasseringen og formatet på loggfilen og informasjonen den inneholder;<code
              class="varname">SiteDomain</code> og <code
              class="varname">HostAliases</code> lister de ulike navnene som hoved-nettstedet er kjent under.
			</div><div
            class="para">
				For områder med stor trafikk, skal <code
              class="varname">DNSLookup</code> vanligvis ikke settes til <code
              class="literal">1</code>. For mindre nettsteder, som for eksempel Falcot-eksemplet beskrevet ovenfor, tillater denne innstillingen mer lesbare rapporter med komplette maskinnavn i stedet for rå IP-adresser.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>SECURITY</em></span> Access to statistics</strong></p></div></div></div><div
              class="para">
				AWStats gjør statistikk tilgjengelig på nettstedet uten restriksjoner som standard. Men restriksjoner kan settes opp slik at bare noen få (sannsynligvis interne) IP-adresser kan få tilgang til dem. Listen over tillatte IP-adresser må være definert i <code
                class="varname">AllowAccessFromWebToFollowingIPAddresses</code> parameteret
			</div></div><div
            class="para">
				AWStats er også aktivert for andre virtuelle verter; hver virtuell vert må ha en egen konfigurasjonsfil, som for eksempel <code
              class="filename">/etc/awstats/awstats.www.falcot.org.conf</code>.
			</div><div
            class="example"><a
              id="id-1.14.5.12.14"></a><p
              class="title"><strong>Eksempel 11.21. AWStats konfigurasjonsfil for en virtuell vert</strong></p><div
              class="example-contents"><pre
                class="programlisting">
Include "/etc/awstats/awstats.conf"
SiteDomain="www.falcot.org"
HostAliases="falcot.org"
</pre></div></div><div
            class="para">
				AWStats bruker mange ikoner lagret i <code
              class="filename">/usr/share/awstats/icon/</code>-mappen. For at disse ikonene skal være tilgjengelige på nettsiden, må Apache-konfigurasjonen tilpasses ved å inkludere følgende direktiv:
			</div><pre
            class="programlisting">
Alias /awstats-icon/ /usr/share/awstats/icon/
</pre><div
            class="para">
				Etter noen minutter (og så snart skriptet er kjørt et par ganger), er resultatene tilgjengelig på nettet: <div
              class="url">→ <a
                href="http://www.falcot.com/cgi-bin/awstats.pl">http://www.falcot.com/cgi-bin/awstats.pl</a></div><div
              class="url">→ <a
                href="http://www.falcot.org/cgi-bin/awstats.pl">http://www.falcot.org/cgi-bin/awstats.pl</a></div>
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>CAUTION</em></span> Loggfil-rotasjon</strong></p></div></div></div><div
              class="para">
				For at statistikken skal ta alle loggene med i betraktningen, trenger <span
                class="emphasis"><em>AWStats</em></span> å kjøres rett før Apache loggfilene blir rotert. Se på <code
                class="literal">prerotate</code>-direktivet til <code
                class="filename">/etc/logrotate.d/apache2</code>-filen. Dette kan løses ved å sette en symlink til <code
                class="filename">/usr/share/awstats/tools/update.sh</code> i <code
                class="filename">/etc/logrotate.d/httpd-prerotate</code>:
			</div><pre
              class="screen"><code
                class="computeroutput">$ </code><strong
                class="userinput"><code>cat /etc/logrotate.d/apache2
</code></strong><code
                class="computeroutput">/var/log/apache2/*.log {
  daily
  missingok
  rotate 14
  compress
  delaycompress
  notifempty
  create 644 root adm
  sharedscripts
  postrotate
    if /etc/init.d/apache2 status &gt; /dev/null ; then \
      /etc/init.d/apache2 reload &gt; /dev/null; \
    fi;
  endscript
  prerotate
    if [ -d /etc/logrotate.d/httpd-prerotate ]; then \
      run-parts /etc/logrotate.d/httpd-prerotate; \
    fi; \
  endscript
}
$ </code><strong
                class="userinput"><code>sudo mkdir -p /etc/logrotate.d/httpd-prerotate
</code></strong><code
                class="computeroutput">$ </code><strong
                class="userinput"><code>sudo ln -sf /usr/share/awstats/tools/update.sh \
  /etc/logrotate.d/httpd-prerotate/awstats
</code></strong></pre><div
              class="para">
				Merk også at loggfilene som ble opprettet av <code
                class="command">logrotate</code> må kunne leses av alle, spesielt AWStats. I eksempelet ovenfor, er dette sikret av <code
                class="literal">create 644 root adm</code>-linjen (i stedet for de standard <code
                class="literal">640</code>- tillatelsene).
			</div></div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="network-services.html"><strong>Forrige</strong>Kapittel 11. Nettverkstjenester: Postfix, Apache,...</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>Opp</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>Hjem</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.ftp-file-server.html"><strong>Neste</strong>11.3. FTP Filtjener</a></li></ul><div
        id="translated_pages"><ul><li><a
              href="../ar-MA/sect.http-web-server.html">ar-MA</a></li><li><a
              href="../da-DK/sect.http-web-server.html">da-DK</a></li><li><a
              href="../de-DE/sect.http-web-server.html">de-DE</a></li><li><a
              href="../el-GR/sect.http-web-server.html">el-GR</a></li><li><a
              href="../en-US/sect.http-web-server.html">en-US</a></li><li><a
              href="../es-ES/sect.http-web-server.html">es-ES</a></li><li><a
              href="../fa-IR/sect.http-web-server.html">fa-IR</a></li><li><a
              href="../fr-FR/sect.http-web-server.html">fr-FR</a></li><li><a
              href="../hr-HR/sect.http-web-server.html">hr-HR</a></li><li><a
              href="../id-ID/sect.http-web-server.html">id-ID</a></li><li><a
              href="../it-IT/sect.http-web-server.html">it-IT</a></li><li><a
              href="../ja-JP/sect.http-web-server.html">ja-JP</a></li><li><a
              href="../ko-KR/sect.http-web-server.html">ko-KR</a></li><li><a
              href="../nb-NO/sect.http-web-server.html">nb-NO</a></li><li><a
              href="../pl-PL/sect.http-web-server.html">pl-PL</a></li><li><a
              href="../pt-BR/sect.http-web-server.html">pt-BR</a></li><li><a
              href="../ro-RO/sect.http-web-server.html">ro-RO</a></li><li><a
              href="../ru-RU/sect.http-web-server.html">ru-RU</a></li><li><a
              href="../tr-TR/sect.http-web-server.html">tr-TR</a></li><li><a
              href="../vi-VN/sect.http-web-server.html">vi-VN</a></li><li><a
              href="../zh-CN/sect.http-web-server.html">zh-CN</a></li><li><a
              href="../zh-TW/sect.http-web-server.html">zh-TW</a></li></ul></div></body></html>
