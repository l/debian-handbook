<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">6.2. aptitude、apt-get和 apt 命令</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-9-zh-CN-1.0-1" /><meta
        name="keywords"
        content="高级包管理工具(Advanced Packaging Tool), apt-get, apt-cache, aptitude 更安全的apt, 新立得包管理器, sources.list, apt-cdrom" /><link
        rel="home"
        href="index.html"
        title="Debian 管理员手册" /><link
        rel="up"
        href="apt.html"
        title="第 6 章 维护和更新：APT 工具" /><link
        rel="prev"
        href="apt.html"
        title="第 6 章 维护和更新：APT 工具" /><link
        rel="next"
        href="sect.apt-cache.html"
        title="6.3. The apt-cache Command" /><meta
        name="viewport"
        content="width=device-width, initial-scale=1" /><meta
        name="flattr:id"
        content="4pz9jq" /><link
        rel="canonical"
        href="http://l.github.io/debian-handbook/html/zh-CN/sect.apt-get.html" /></head><body><noscript><iframe
          src="//www.googletagmanager.com/ns.html?id=GTM-5H35QX"
          height="0"
          width="0"
          style="display:none;visibility:hidden"></iframe></noscript><script
        type="text/javascript">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&amp;l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5H35QX');</script><div
        id="banner"><a
          href="../../"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="index.html"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="apt.html"><strong>上一页</strong></a></li><li
          class="home">Debian 管理员手册</li><li
          class="next"><a
            accesskey="n"
            href="sect.apt-cache.html"><strong>下一页</strong></a></li></ul><div
        class="section"><div
          class="titlepage"><div><div><h2
                class="title"><a
                  id="sect.apt-get"></a>6.2. <code
                  class="command">aptitude</code>、<code
                  class="command">apt-get</code>和 <code
                  class="command">apt</code> 命令</h2></div></div></div><a
          id="id-1.9.11.2"
          class="indexterm"></a><a
          id="id-1.9.11.3"
          class="indexterm"></a><a
          id="id-1.9.11.4"
          class="indexterm"></a><div
          class="para">
			APT is a vast project, whose original plans included a graphical interface. It is based on a library which contains the core application, and <code
            class="command">apt-get</code> is the first front end — command-line based — which was developed within the project. <code
            class="command">apt</code> is a second command-line based front end provided by APT which overcomes some design mistakes of <code
            class="command">apt-get</code>.
		</div><div
          class="para">
			其他众多的图形界面以外部项目形式出现：<code
            class="command">synaptic</code>，<code
            class="command">aptitude</code>（它同时包含文本模式界面和图形界面 — 即使尚未完成），<code
            class="command">wajig</code>，等等。最为推荐的界面，<code
            class="command">apt</code>，会在本节案例中使用。注意，尽管如此，<code
            class="command">apt-get</code>与 <code
            class="command">aptitude</code>的命令行语法也仍与之非常类似。在<code
            class="command">apt</code>、<code
            class="command">apt-get</code>、<code
            class="command">aptitude</code>存在较大差异时，将会详述差异。
		</div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="id-1.9.11.7"></a>6.2.1. 开端</h3></div></div></div><div
            class="para">
				对于 APT 的任何操作，需要更新可用包的列表；这可以简单地通过<code
              class="command">apt update</code>来完成。取决于您连接的速度，该操作需要花费一定时间，因为这包括下载一定数量的<code
              class="filename">软件包</code>/<code
              class="filename">源代码</code>/<code
              class="filename">翻译-<em
                class="replaceable">语言代码</em></code>文件，这些文件随着 Debian 的开发而逐渐变大（对于<code
              class="literal">main</code>部分，至少有 10MB 数据）。当然，从光盘中安装无需任何下载 — 此情况下，操作是十分迅速的。
			</div><a
            id="id-1.9.11.7.3"
            class="indexterm"></a><a
            id="id-1.9.11.7.4"
            class="indexterm"></a><a
            id="id-1.9.11.7.5"
            class="indexterm"></a></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="id-1.9.11.8"></a>6.2.2. 安装和卸载</h3></div></div></div><a
            id="id-1.9.11.8.2"
            class="indexterm"></a><a
            id="id-1.9.11.8.3"
            class="indexterm"></a><a
            id="id-1.9.11.8.4"
            class="indexterm"></a><a
            id="id-1.9.11.8.5"
            class="indexterm"></a><div
            class="para">
				通过APT，软件包可以从系统中添加或移除，命令分别为<code
              class="command">apt install<em
                class="replaceable">软件包</em></code>、<code
              class="command">apt remove<em
                class="replaceable">软件包</em></code>。在以上两种情况中，APT 将会自动安装必要的依赖包或者删除依赖于删除包的软件包。<code
              class="command">apt purge<em
                class="replaceable">软件包</em></code>命令包含一个彻底删除 — 相关的配置文件也会被删除。
			</div><a
            id="id-1.9.11.8.7"
            class="indexterm"></a><a
            id="id-1.9.11.8.8"
            class="indexterm"></a><a
            id="id-1.9.11.8.9"
            class="indexterm"></a><a
            id="id-1.9.11.8.10"
            class="indexterm"></a><a
            id="id-1.9.11.8.11"
            class="indexterm"></a><a
            id="id-1.9.11.8.12"
            class="indexterm"></a><a
            id="id-1.9.11.8.13"
            class="indexterm"></a><a
            id="id-1.9.11.8.14"
            class="indexterm"></a><a
            id="id-1.9.11.8.15"
            class="indexterm"></a><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>TIP</em></span> 多次安装同一批软件包</strong></p></div></div></div><div
              class="para">
				在几台电脑上安装同一批软件包会很实用。这很容易做到。
			</div><div
              class="para">
				首先，从电脑中取得所安装软件包的列表作为用于复制的“模板”。
			</div><pre
              class="screen"><code
                class="computeroutput">$ </code><strong
                class="userinput"><code>dpkg --get-selections &gt;pkg-list</code></strong>↵</pre><div
              class="para">
				The <code
                class="filename">pkg-list</code> file then contains the list of installed packages. Next, transfer the <code
                class="filename">pkg-list</code> file onto the computers you want to update and use the following commands:
			</div><pre
              class="screen">## Update dpkg's database of known packages↵
# <strong
                class="userinput"><code>avail=`mktemp`</code></strong>↵
# <strong
                class="userinput"><code>apt-cache dumpavail &gt; "$avail"</code></strong>↵
# <strong
                class="userinput"><code>dpkg --merge-avail "$avail"</code></strong>↵
# <strong
                class="userinput"><code>rm -f "$avail"</code></strong>↵
## Update dpkg's selections↵
# <strong
                class="userinput"><code>dpkg --set-selections &lt; pkg-list</code></strong>↵
## Ask apt-get to install the selected packages↵
# <strong
                class="userinput"><code>apt-get dselect-upgrade</code></strong>↵</pre><div
              class="para">
				第一个命令记录在 dpkg 库中可用的软件包列表，然后 <code
                class="command">dpkg --set-selections</code> 恢复选中你想要安装的包，<code
                class="command">apt-get</code> 的激活执行所需要的操作！<code
                class="command">aptitude</code> 没有这样的命令。
			</div></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>TIP</em></span> 同时进行卸载和安装</strong></p></div></div></div><div
              class="para">
				It is possible to ask <code
                class="command">apt</code> (or <code
                class="command">apt-get</code>, or <code
                class="command">aptitude</code>) to install certain packages and remove others on the same command line by adding a suffix. With an <code
                class="command">apt install</code> command, add “<code
                class="literal">-</code>” to the names of the packages you wish to remove. With an <code
                class="command">apt remove</code> command, add “<code
                class="literal">+</code>” to the names of the packages you wish to install.
			</div><div
              class="para">
				下面的例子展示两种不同方法来安装<em
                class="replaceable">package1</em> 和卸载<em
                class="replaceable">package2</em>。
			</div><pre
              class="screen"># <strong
                class="userinput"><code>apt install <em
                    class="replaceable">package1</em> <em
                    class="replaceable">package2-</em></code></strong>
[...]
# <strong
                class="userinput"><code>apt remove <em
                    class="replaceable">package1+</em> <em
                    class="replaceable">package2</em></code></strong>
[...]
</pre><div
              class="para">
				此方法也可用于把不同的软件包排除在外，比如由于<code
                class="literal">Recommends</code>造成的。一般，依赖解决者会用此作为寻找其他办法的线索。
			</div></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>TIP</em></span> <code
                        class="command">apt --reinstall</code> and <code
                        class="command">aptitude reinstall</code></strong></p></div></div></div><a
              id="id-1.9.11.8.18.2"
              class="indexterm"></a><div
              class="para">
				在软件包中的文件发生移除或更改时，系统有时候可能会受损。恢复这些文件最简单的方法是重装受影响的软件包。不幸的是，包系统会认为后者已安装而拒绝重新安装；为了避免此情况，使用<code
                class="command">apt</code>和<code
                class="command">apt-get</code>命令的<code
                class="literal"> --reinstall</code>选项。如下命令会重新安装<span
                class="pkg pkg">postfix</span>，即使它已存在：
			</div><pre
              class="screen"><code
                class="computeroutput"># </code><strong
                class="userinput"><code>apt --reinstall install postfix</code></strong></pre><div
              class="para">
				<code
                class="command">aptitude</code>命令行略微不同，但可通过<code
                class="command">aptitude reinstall postfix</code>获得同样的结果。
			</div><div
              class="para">
				该问题不与<code
                class="command">dpkg</code>同时出现，但管理员极少直接使用它。
			</div><div
              class="para">
				注意！使用<code
                class="command">apt --reinstall</code>命令恢复受到攻击时变更的软件包，不会当然地恢复系统原本的样子。<a
                class="xref"
                href="sect.dealing-with-compromised-machine.html">第 14.7 节 “处理被攻陷的机器”</a>详述了受损系统要采取的必要步骤。
			</div></div><div
            class="para">
				如果文件 <code
              class="filename">sources.list</code> 提及了数个发布版本，可以指定要安装软件包的版本。要求特定版本号可以通过 <code
              class="command">apt install <em
                class="replaceable">package</em>=<em
                class="replaceable">version</em></code>，但以标明其初始发行版本 (<span
              class="distribution distribution">Stable</span>, <span
              class="distribution distribution">Testing</span> 或者 <span
              class="distribution distribution">Unstable</span>）的方式— 通过 <code
              class="command">apt install <em
                class="replaceable">package</em>/<em
                class="replaceable">distribution</em></code> — 更为推荐。倘若 <code
              class="filename">sources.list</code>文件所述软件源之一仍可用的情况下，通过此命令可以回溯一个软件包的旧版本 (比如您知晓其情况良好的情况)。否则，<code
              class="literal">snapshot.debian.org</code> 归档可以补救(参阅侧边栏r <a
              class="xref"
              href="apt.html#sidebar.snapshot.debian.org"><span
                class="emphasis"><em>进阶</em></span>旧包版本： <code
                class="literal">snapshot.debian.org</code></a>)。
			</div><div
            class="example"><a
              id="id-1.9.11.8.20"></a><p
              class="title"><strong>例 6.3. 安装 <span
                  class="pkg pkg">spamassassin（垃圾邮件过滤）</span> 的 <span
                  class="distribution distribution">unstable</span> 版本</strong></p><div
              class="example-contents"><pre
                class="screen"><code
                  class="computeroutput"># </code> <strong
                  class="userinput"><code>apt install spamassassin/unstable</code></strong></pre></div></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>更进一步</em></span> <code
                        class="filename">.deb</code> 文件的缓存</strong></p></div></div></div><div
              class="para">
				APT 在<code
                class="filename"> /var/cache/apt/archives/</code> 目录中保存每个下载的<code
                class="filename"> .deb</code>文件的副本。在频繁更新的情况下，该目录下每个软件包的数个版本可能会占用大量磁盘空间；您应当经常整理它们。可以使用如下两个命令：<code
                class="command">apt-get clean</code>完全清空整个目录；<code
                class="command">apt-get autoclean</code>仅移除不会再下载的软件包（因为它们已从 Debian 镜像中消失）和明显无用的软件包（配置参数<code
                class="literal">APT::Clean-Installed</code>可以阻止移除安装中的<code
                class="filename">.deb</code>文件）。注意<code
                class="command">apt</code>不支持上述命令。
			</div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="sect.apt-upgrade"></a>6.2.3. 系统升级</h3></div></div></div><a
            id="id-1.9.11.9.2"
            class="indexterm"></a><a
            id="id-1.9.11.9.3"
            class="indexterm"></a><a
            id="id-1.9.11.9.4"
            class="indexterm"></a><a
            id="id-1.9.11.9.5"
            class="indexterm"></a><div
            class="para">
				常规升级是推荐的，因为它们包含最新的安全更新。要升级，可使用<code
              class="command">apt upgrade</code>、<code
              class="command">apt-get upgrade</code>、<code
              class="command">aptitude safe-upgrade</code>（当然需在<code
              class="command">apt update</code>之后）。该命令会查找要升级的已安装包，同时不移除任何包。也就是说，目标是确保可能的侵入式升级最小化。<code
              class="command">apt-get</code>命令略苛刻于 <code
              class="command">aptitude</code> 或 <code
              class="command">apt</code>命令，因为它会拒绝安装未预先安装的软件包。
			</div><div
            class="sidebar"><a
              id="sidebar.apt-pdiff"></a><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>TIP</em></span> 增量更新</strong></p></div></div></div><div
              class="para">
				As we explained earlier, the aim of the <code
                class="command">apt update</code> command is to download for each package source the corresponding <code
                class="filename">Packages</code> (or <code
                class="filename">Sources</code>) file. However, even after a <code
                class="command">bzip2</code> compression, these files can remain rather large (the <code
                class="filename">Packages.xz</code> for the <span
                class="foreignphrase"><em
                  class="foreignphrase">main</em></span> section of <span
                class="distribution distribution">Jessie</span> takes more than 6 MB). If you wish to upgrade regularly, these downloads can take up a lot of time.
			</div><div
              class="para">
				To speed up the process APT can download “diff” files containing the changes since the previous update, as opposed to the entire file. To achieve this, official Debian mirrors distribute different files which list the differences between one version of the <code
                class="filename">Packages</code> file and the following version. They are generated at each update of the archives and a history of one week is kept. Each of these “diff” files only takes a few dozen kilobytes for <span
                class="distribution distribution">Unstable</span>, so that the amount of data downloaded by a weekly <code
                class="command">apt update</code> is often divided by 10. For distributions like <span
                class="distribution distribution">Stable</span> and <span
                class="distribution distribution">Testing</span>, which change less, the gain is even more noticeable.
			</div><div
              class="para">
				However, it can sometimes be of interest to force the download of the entire <code
                class="filename">Packages</code> file, especially when the last upgrade is very old and when the mechanism of incremental differences would not contribute much. This can also be interesting when network access is very fast but when the processor of the machine to upgrade is rather slow, since the time saved on the download is more than lost when the computer calculates the new versions of these files (starting with the older versions and applying the downloaded differences). To do that, you can use the configuration parameter <code
                class="literal">Acquire::Pdiffs</code> and set it to <code
                class="literal">false</code>.
			</div></div><div
            class="para">
				<code
              class="command">apt</code> will generally select the most recent version number (except for packages from <span
              class="distribution distribution">Experimental</span> and <span
              class="distribution distribution">stable-backports</span>, which are ignored by default whatever their version number). If you specified <span
              class="distribution distribution">Testing</span> or <span
              class="distribution distribution">Unstable</span> in your <code
              class="filename">sources.list</code>, <code
              class="command">apt upgrade</code> will switch most of your <span
              class="distribution distribution">Stable</span> system to <span
              class="distribution distribution">Testing</span> or <span
              class="distribution distribution">Unstable</span>, which might not be what you intended.
			</div><div
            class="para">
				To tell <code
              class="command">apt</code> to use a specific distribution when searching for upgraded packages, you need to use the <code
              class="literal">-t</code> or <code
              class="literal">--target-release</code> option, followed by the name of the distribution you want (for example: <code
              class="command">apt -t stable upgrade</code>). To avoid specifying this option every time you use <code
              class="command">apt</code>, you can add <code
              class="literal">APT::Default-Release "stable";</code> in the file <code
              class="filename">/etc/apt/apt.conf.d/local</code>.
			</div><a
            id="id-1.9.11.9.10"
            class="indexterm"></a><a
            id="id-1.9.11.9.11"
            class="indexterm"></a><a
            id="id-1.9.11.9.12"
            class="indexterm"></a><a
            id="id-1.9.11.9.13"
            class="indexterm"></a><a
            id="id-1.9.11.9.14"
            class="indexterm"></a><div
            class="para">
				对于非常重要的升级，如从一个 Debian 主版本变更为下一版本，你需要使用<code
              class="command">apt full-upgrade</code>。使用此命令，<code
              class="command">apt</code>将会完全升级，即使必须移除一些废弃包或者安装新的依赖包。这也适用于日常使用 Debian <span
              class="distribution distribution"> Unstable</span>并每天跟随其演化的用户。它是如此简便以至于几乎无需解释：APT的声誉基于此项强大的功能。
			</div><div
            class="para">
				Unlike <code
              class="command">apt</code> and <code
              class="command">aptitude</code>, <code
              class="command">apt-get</code> doesn't know the <code
              class="command">full-upgrade</code> command. Instead, you should use <code
              class="command">apt-get dist-upgrade</code> (”distribution upgrade”), the historical and well-known command that <code
              class="command">apt</code> and <code
              class="command">aptitude</code> also accept for the convenience of users who got used to it.
			</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="sect.apt-config"></a>6.2.4. 配置选项</h3></div></div></div><a
            id="id-1.9.11.10.2"
            class="indexterm"></a><a
            id="id-1.9.11.10.3"
            class="indexterm"></a><a
            id="id-1.9.11.10.4"
            class="indexterm"></a><div
            class="para">
				Besides the configuration elements already mentioned, it is possible to configure certain aspects of APT by adding directives in a file of the <code
              class="filename">/etc/apt/apt.conf.d/</code> directory. Remember for instance that it is possible for APT to tell <code
              class="command">dpkg</code> to ignore file conflict errors by specifying <code
              class="literal">DPkg::options { "--force-overwrite"; }</code>.
			</div><div
            class="para">
				If the Web can only be accessed through a proxy, add a line like <code
              class="literal">Acquire::http::proxy "http://<em
                class="replaceable">yourproxy</em>:3128"</code>. For an FTP proxy, write <code
              class="literal">Acquire::ftp::proxy "ftp://<em
                class="replaceable">yourproxy</em>"</code>. To discover more configuration options, read the <span
              class="citerefentry"><span
                class="refentrytitle">apt.conf</span>(5)</span> manual page with the <code
              class="command">man apt.conf</code> command (for details on manual pages, see <a
              class="xref"
              href="solving-problems.html#sect.manual-pages">第 7.1.1 节 “手册页面”</a>).
			</div><div
            class="sidebar"><a
              id="sidebar.directory.d"></a><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>BACK TO BASICS</em></span> Directories ending in <code
                        class="filename">.d</code></strong></p></div></div></div><a
              id="id-1.9.11.10.7.2"
              class="indexterm"></a><div
              class="para">
				Directories with a <code
                class="filename">.d</code> suffix are used more and more often. Each directory represents a configuration file which is split over multiple files. In this sense, all of the files in <code
                class="filename">/etc/apt/apt.conf.d/</code> are instructions for the configuration of APT. APT includes them in alphabetical order, so that the last ones can modify a configuration element defined in one of the first ones.
			</div><div
              class="para">
				This structure brings some flexibility to the machine administrator and to the package maintainers. Indeed, the administrator can easily modify the configuration of the software by adding a ready-made file in the directory in question without having to change an existing file. Package maintainers use the same approach when they need to adapt the configuration of another software to ensure that it perfectly co-exists with theirs. The Debian policy explicitly forbids modifying configuration files of other packages — only users are allowed to do this. Remember that during a package upgrade, the user gets to choose the version of the configuration file that should be kept when a modification has been detected. Any external modification of the file would trigger that request, which would disturb the administrator, who is sure not to have changed anything.
			</div><div
              class="para">
				Without a <code
                class="filename">.d</code> directory, it is impossible for an external package to change the settings of a program without modifying its configuration file. Instead it must invite the user to do it themselves and lists the operations to be done in the file <code
                class="filename">/usr/share/doc/<em
                  class="replaceable">package</em>/README.Debian</code>.
			</div><div
              class="para">
				Depending on the application, the <code
                class="filename">.d</code> directory is used directly or managed by an external script which will concatenate all the files to create the configuration file itself. It is important to execute the script after any change in that directory so that the most recent modifications are taken into account. In the same way, it is important not to work directly in the configuration file created automatically, since everything would be lost at the next execution of the script. The chosen method (<code
                class="filename">.d</code> directory used directly or a file generated from that directory) is usually dictated by implementation constraints, but in both cases the gains in terms of configuration flexibility more than make up for the small complications that they entail. The Exim 4 mail server is an example of the generated file method: it can be configured through several files (<code
                class="filename">/etc/exim4/conf.d/*</code>) which are concatenated into <code
                class="filename">/var/lib/exim4/config.autogenerated</code> by the <code
                class="command">update-exim4.conf</code> command.
			</div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="sect.apt.priorities"></a>6.2.5. 包的优先级管理</h3></div></div></div><div
            class="para">
				One of the most important aspects in the configuration of APT is the management of the priorities associated with each package source. For instance, you might want to extend one distribution with one or two newer packages from <span
              class="distribution distribution">Testing</span>, <span
              class="distribution distribution">Unstable</span> or <span
              class="distribution distribution">Experimental</span>. It is possible to assign a priority to each available package (the same package can have several priorities depending on its version or the distribution providing it). These priorities will influence APT's behavior: for each package, it will always select the version with the highest priority (except if this version is older than the installed one and if its priority is less than 1000).
			</div><a
            id="id-1.9.11.11.3"
            class="indexterm"></a><a
            id="id-1.9.11.11.4"
            class="indexterm"></a><a
            id="id-1.9.11.11.5"
            class="indexterm"></a><a
            id="id-1.9.11.11.6"
            class="indexterm"></a><a
            id="id-1.9.11.11.7"
            class="indexterm"></a><a
            id="id-1.9.11.11.8"
            class="indexterm"></a><a
            id="id-1.9.11.11.9"
            class="indexterm"></a><div
            class="para">
				APT defines several default priorities. Each installed package version has a priority of 100. A non-installed version has a priority of 500 by default, but it can jump to 990 if it is part of the target release (defined with the <code
              class="literal">-t</code> command-line option or the <code
              class="literal">APT::Default-Release</code> configuration directive).
			</div><div
            class="para">
				You can modify the priorities by adding entries in the <code
              class="filename">/etc/apt/preferences</code> file with the names of the affected packages, their version, their origin and their new priority.
			</div><div
            class="para">
				APT will never install an older version of a package (that is, a package whose version number is lower than the one of the currently installed package) except if its priority is higher than 1000. APT will always install the highest priority package which follows this constraint. If two packages have the same priority, APT installs the newest one (whose version number is the highest). If two packages of same version have the same priority but differ in their content, APT installs the version that is not installed (this rule has been created to cover the case of a package update without the increment of the revision number, which is usually required).
			</div><div
            class="para">
				In more concrete terms, a package whose priority is less than 0 will never be installed. A package with a priority ranging between 0 and 100 will only be installed if no other version of the package is already installed. With a priority between 100 and 500, the package will only be installed if there is no other newer version installed or available in another distribution. A package of priority between 501 and 990 will only be installed if there is no newer version installed or available in the target distribution. With a priority between 990 and 1000, the package will be installed except if the installed version is newer. A priority greater than 1000 will always lead to the installation of the package even if it forces APT to downgrade to an older version.
			</div><div
            class="para">
				When APT checks <code
              class="filename">/etc/apt/preferences</code>, it first takes into account the most specific entries (often those specifying the concerned package), then the more generic ones (including for example all the packages of a distribution). If several generic entries exist, the first match is used. The available selection criteria include the package's name and the source providing it. Every package source is identified by the information contained in a <code
              class="filename">Release</code> file that APT downloads together with the <code
              class="filename">Packages</code> files. It specifies the origin (usually “Debian” for the packages of official mirrors, but it can also be a person's or an organization's name for third-party repositories). It also gives the name of the distribution (usually <span
              class="distribution distribution">Stable</span>, <span
              class="distribution distribution">Testing</span>, <span
              class="distribution distribution">Unstable</span> or <span
              class="distribution distribution">Experimental</span> for the standard distributions provided by Debian) together with its version (for example 8 for Debian <span
              class="distribution distribution">Jessie</span>). Let's have a look at its syntax through some realistic case studies of this mechanism.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>SPECIFIC CASE</em></span> Priority of <span
                        class="distribution distribution">experimental</span></strong></p></div></div></div><a
              id="id-1.9.11.11.15.2"
              class="indexterm"></a><div
              class="para">
				If you listed <span
                class="distribution distribution">Experimental</span> in your <code
                class="filename">sources.list</code> file, the corresponding packages will almost never be installed because their default APT priority is 1. This is of course a specific case, designed to keep users from installing <span
                class="distribution distribution">Experimental</span> packages by mistake. The packages can only be installed by typing <code
                class="command">aptitude install <em
                  class="replaceable">package</em>/experimental</code> — users typing this command can only be aware of the risks that they take. It is still possible (though <span
                class="emphasis"><em>not</em></span> recommended) to treat packages of <span
                class="distribution distribution">Experimental</span> like those of other distributions by giving them a priority of 500. This is done with a specific entry in <code
                class="filename">/etc/apt/preferences</code>:
			</div><div
              class="informalexample"><pre
                class="programlisting">Package: *
Pin: release a=experimental
Pin-Priority: 500
</pre></div></div><div
            class="para">
				Let's suppose that you only want to use packages from the stable version of Debian. Those provided in other versions should not be installed except if explicitly requested. You could write the following entries in the <code
              class="filename">/etc/apt/preferences</code> file:
			</div><div
            class="informalexample"><pre
              class="programlisting">Package: *
Pin: release a=stable
Pin-Priority: 900

Package: *
Pin: release o=Debian
Pin-Priority: -10
</pre></div><div
            class="para">
				<code
              class="literal">a=stable</code> defines the name of the selected distribution. <code
              class="literal">o=Debian</code> limits the scope to packages whose origin is “Debian”.
			</div><div
            class="para">
				Let's now assume that you have a server with several local programs depending on the version 5.14 of Perl and that you want to ensure that upgrades will not install another version of it. You could use this entry:
			</div><div
            class="informalexample"><pre
              class="programlisting">Package: perl
Pin: version 5.14*
Pin-Priority: 1001
</pre></div><div
            class="para">
				The reference documentation for this configuration file is available in the manual page <span
              class="citerefentry"><span
                class="refentrytitle">apt_preferences</span>(5)</span>, which you can display with <code
              class="command">man apt_preferences</code>.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>TIP</em></span> Comments in <code
                        class="filename">/etc/apt/preferences</code></strong></p></div></div></div><a
              id="id-1.9.11.11.22.2"
              class="indexterm"></a><a
              id="id-1.9.11.11.22.3"
              class="indexterm"></a><a
              id="id-1.9.11.11.22.4"
              class="indexterm"></a><div
              class="para">
				There is no official syntax to put comments in the <code
                class="filename">/etc/apt/preferences</code> file, but some textual descriptions can be provided by putting one or more “<code
                class="literal">Explanation</code>” fields at the start of each entry:
			</div><div
              class="informalexample"><pre
                class="programlisting">Explanation: The package xserver-xorg-video-intel provided
Explanation: in experimental can be used safely
Package: xserver-xorg-video-intel
Pin: release a=experimental
Pin-Priority: 500
</pre></div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="sect.apt-mix-distros"></a>6.2.6. Working with Several Distributions</h3></div></div></div><div
            class="para">
				<code
              class="command">apt</code> being such a marvelous tool, it is tempting to pick packages coming from other distributions. For example, after having installed a <span
              class="distribution distribution">Stable</span> system, you might want to try out a software package available in <span
              class="distribution distribution">Testing</span> or <span
              class="distribution distribution">Unstable</span> without diverging too much from the system's initial state.
			</div><div
            class="para">
				Even if you will occasionally encounter problems while mixing packages from different distributions, <code
              class="command">apt</code> manages such coexistence very well and limits risks very effectively. The best way to proceed is to list all distributions used in <code
              class="filename">/etc/apt/sources.list</code> (some people always put the three distributions, but remember that <span
              class="distribution distribution">Unstable</span> is reserved for experienced users) and to define your reference distribution with the <code
              class="literal">APT::Default-Release</code> parameter (see <a
              class="xref"
              href="sect.apt-get.html#sect.apt-upgrade">第 6.2.3 节 “系统升级”</a>).
			</div><div
            class="para">
				Let's suppose that <span
              class="distribution distribution">Stable</span> is your reference distribution but that <span
              class="distribution distribution">Testing</span> and <span
              class="distribution distribution">Unstable</span> are also listed in your <code
              class="filename">sources.list</code> file. In this case, you can use <code
              class="command">apt install <em
                class="replaceable">package</em>/testing</code> to install a package from <span
              class="distribution distribution">Testing</span>. If the installation fails due to some unsatisfiable dependencies, let it solve those dependencies within <span
              class="distribution distribution">Testing</span> by adding the <code
              class="literal">-t testing</code> parameter. The same obviously applies to <span
              class="distribution distribution">Unstable</span>.
			</div><div
            class="para">
				In this situation, upgrades (<code
              class="command">upgrade</code> and <code
              class="command">full-upgrade</code>) are done within <span
              class="distribution distribution">Stable</span> except for packages already upgraded to another distribution: those will follow updates available in the other distributions. We will explain this behavior with the help of the default priorities set by APT below. Do not hesitate to use <code
              class="command">apt-cache policy</code> (see sidebar <a
              class="xref"
              href="sect.apt-get.html#sidebar.apt-cache-policy"><span
                class="emphasis"><em>TIP</em></span> <code
                class="command">apt-cache policy</code></a>) to verify the given priorities.
			</div><div
            class="para">
				Everything centers around the fact that APT only considers packages of higher or equal version than the installed one (assuming that <code
              class="filename">/etc/apt/preferences</code> has not been used to force priorities higher than 1000 for some packages).
			</div><div
            class="sidebar"><a
              id="sidebar.apt-cache-policy"></a><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>TIP</em></span> <code
                        class="command">apt-cache policy</code></strong></p></div></div></div><div
              class="para">
				To gain a better understanding of the mechanism of priority, do not hesitate to execute <code
                class="command">apt-cache policy</code> to display the default priority associated with each package source. You can also use <code
                class="command">apt-cache policy <em
                  class="replaceable">package</em></code> to display the priorities of all available versions of a given package.
			</div></div><div
            class="para">
				Let's assume that you have installed version 1 of a first package from <span
              class="distribution distribution">Stable</span> and that version 2 and 3 are available respectively in <span
              class="distribution distribution">Testing</span> and <span
              class="distribution distribution">Unstable</span>. The installed version has a priority of 100 but the version available in <span
              class="distribution distribution">Stable</span> (the very same) has a priority of 990 (because it is part of the target release). Packages in <span
              class="distribution distribution">Testing</span> and <span
              class="distribution distribution">Unstable</span> have a priority of 500 (the default priority of a non-installed version). The winner is thus version 1 with a priority of 990. The package “stays in <span
              class="distribution distribution">Stable</span>”.
			</div><div
            class="para">
				Let's take the example of another package whose version 2 has been installed from <span
              class="distribution distribution">Testing</span>. Version 1 is available in <span
              class="distribution distribution">Stable</span> and version 3 in <span
              class="distribution distribution">Unstable</span>. Version 1 (of priority 990 — thus lower than 1000) is discarded because it is lower than the installed version. This only leaves version 2 and 3, both of priority 500. Faced with this alternative, APT selects the newest version, the one from <span
              class="distribution distribution">Unstable</span>.If you don't want a package installed from <span
              class="distribution distribution">Testing</span> to migrate to <span
              class="distribution distribution">Unstable</span>, you have to assign a priority lower than 500 (490 for example) to packages coming from <span
              class="distribution distribution">Unstable</span>. You can modify <code
              class="filename">/etc/apt/preferences</code> to this effect:
			</div><pre
            class="programlisting">Package: *
Pin: release a=unstable
Pin-Priority: 490
</pre></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="sect.automatic-tracking"></a>6.2.7. Tracking Automatically Installed Packages</h3></div></div></div><div
            class="para">
				One of the essential functionalities of <code
              class="command">apt</code> is the tracking of packages installed only through dependencies. These packages are called “automatic”, and often include libraries for instance.
			</div><div
            class="para">
				With this information, when packages are removed, the package managers can compute a list of automatic packages that are no longer needed (because there is no “manually installed” packages depending on them). <code
              class="command">apt-get autoremove</code> will get rid of those packages. <code
              class="command">aptitude</code> and <code
              class="command">apt</code> do not have this command: the former because it removes them automatically as soon as they are identified, and the latter probably because the user should not have to manually run such a command. In all cases, the tools display a clear message listing the affected packages.
			</div><a
            id="id-1.9.11.13.4"
            class="indexterm"></a><a
            id="id-1.9.11.13.5"
            class="indexterm"></a><a
            id="id-1.9.11.13.6"
            class="indexterm"></a><a
            id="id-1.9.11.13.7"
            class="indexterm"></a><div
            class="para">
				It is a good habit to mark as automatic any package that you don't need directly so that they are automatically removed when they aren't necessary anymore. <code
              class="command">apt-mark auto <em
                class="replaceable">package</em></code> will mark the given package as automatic whereas <code
              class="command">apt-mark manual <em
                class="replaceable">package</em></code> does the opposite. <code
              class="command">aptitude markauto</code> and <code
              class="command">aptitude unmarkauto</code> work in the same way although they offer more features for marking many packages at once (see <a
              class="xref"
              href="sect.apt-frontends.html#sect.aptitude">第 6.4.1 节 “<code
                class="command">aptitude</code>”</a>). The console-based interactive interface of <code
              class="command">aptitude</code> also makes it easy to review the “automatic flag” on many packages.
			</div><a
            id="id-1.9.11.13.9"
            class="indexterm"></a><div
            class="para">
				People might want to know why an automatically installed package is present on the system. To get this information from the command line, you can use <code
              class="command">aptitude why <em
                class="replaceable">package</em></code> (<code
              class="command">apt</code> and <code
              class="command">apt-get</code> have no similar feature):
			</div><pre
            class="screen"><code
              class="computeroutput">$ </code><strong
              class="userinput"><code>aptitude why python-debian
</code></strong><code
              class="computeroutput">i   aptitude         Recommends apt-xapian-index         
i A apt-xapian-index Depends    python-debian (&gt;= 0.1.15)
</code></pre><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>ALTERNATIVE</em></span> <code
                        class="command">deborphan</code> and <code
                        class="command">debfoster</code></strong></p></div></div></div><a
              id="id-1.9.11.13.12.2"
              class="indexterm"></a><a
              id="id-1.9.11.13.12.3"
              class="indexterm"></a><div
              class="para">
				In days where <code
                class="command">apt</code>, <code
                class="command">apt-get</code> and <code
                class="command">aptitude</code> were not able to track automatic packages, there were two utilities producing lists of unnecessary packages: <code
                class="command">deborphan</code> and <code
                class="command">debfoster</code>.
			</div><div
              class="para">
				<code
                class="command">deborphan</code> is the most rudimentary of both. It simply scans the <code
                class="literal">libs</code> and <code
                class="literal">oldlibs</code> sections (in the absence of supplementary instructions) looking for the packages that are currently installed and that no other package depends on. The resulting list can then serve as a basis to remove unneeded packages.
			</div><div
              class="para">
				<code
                class="command">debfoster</code> has a more elaborate approach, very similar to APT's one: it maintains a list of packages that have been explicitly installed, and remembers what packages are really required between each invocation. If new packages appear on the system and if <code
                class="command">debfoster</code> doesn't know them as required packages, they will be shown on the screen together with a list of their dependencies. The program then offers a choice: remove the package (possibly together with those that depend on it), mark it as explicitly required, or ignore it temporarily.
			</div></div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="apt.html"><strong>上一页</strong>第 6 章 维护和更新：APT 工具</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>上一级</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>起始页</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.apt-cache.html"><strong>下一页</strong>6.3. The apt-cache Command</a></li></ul><div
        id="translated_pages"><ul><li><a
              href="../ar-MA/sect.apt-get.html">ar-MA</a></li><li><a
              href="../da-DK/sect.apt-get.html">da-DK</a></li><li><a
              href="../de-DE/sect.apt-get.html">de-DE</a></li><li><a
              href="../el-GR/sect.apt-get.html">el-GR</a></li><li><a
              href="../en-US/sect.apt-get.html">en-US</a></li><li><a
              href="../es-ES/sect.apt-get.html">es-ES</a></li><li><a
              href="../fa-IR/sect.apt-get.html">fa-IR</a></li><li><a
              href="../fr-FR/sect.apt-get.html">fr-FR</a></li><li><a
              href="../hr-HR/sect.apt-get.html">hr-HR</a></li><li><a
              href="../id-ID/sect.apt-get.html">id-ID</a></li><li><a
              href="../it-IT/sect.apt-get.html">it-IT</a></li><li><a
              href="../ja-JP/sect.apt-get.html">ja-JP</a></li><li><a
              href="../ko-KR/sect.apt-get.html">ko-KR</a></li><li><a
              href="../nb-NO/sect.apt-get.html">nb-NO</a></li><li><a
              href="../pl-PL/sect.apt-get.html">pl-PL</a></li><li><a
              href="../pt-BR/sect.apt-get.html">pt-BR</a></li><li><a
              href="../ro-RO/sect.apt-get.html">ro-RO</a></li><li><a
              href="../ru-RU/sect.apt-get.html">ru-RU</a></li><li><a
              href="../tr-TR/sect.apt-get.html">tr-TR</a></li><li><a
              href="../vi-VN/sect.apt-get.html">vi-VN</a></li><li><a
              href="../zh-CN/sect.apt-get.html">zh-CN</a></li><li><a
              href="../zh-TW/sect.apt-get.html">zh-TW</a></li></ul></div></body></html>
