<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">6.2. aptitude、apt-get和 apt 命令</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-9-zh-CN-1.0-1" /><meta
        name="keywords"
        content="高级包管理工具(Advanced Packaging Tool), apt-get, apt-cache, aptitude 更安全的apt, 新立得包管理器, sources.list, apt-cdrom" /><link
        rel="home"
        href="index.html"
        title="Debian 管理员手册" /><link
        rel="up"
        href="apt.html"
        title="第 6 章 维护和更新：APT 工具" /><link
        rel="prev"
        href="apt.html"
        title="第 6 章 维护和更新：APT 工具" /><link
        rel="next"
        href="sect.apt-cache.html"
        title="6.3. apt-cache 命令" /><meta
        name="viewport"
        content="width=device-width, initial-scale=1" /><meta
        name="flattr:id"
        content="4pz9jq" /><link
        rel="canonical"
        href="http://l.github.io/debian-handbook/html/zh-CN/sect.apt-get.html" /></head><body><noscript><iframe
          src="//www.googletagmanager.com/ns.html?id=GTM-5H35QX"
          height="0"
          width="0"
          style="display:none;visibility:hidden"></iframe></noscript><script
        type="text/javascript">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&amp;l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5H35QX');</script><div
        id="banner"><a
          href="../../"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="index.html"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="apt.html"><strong>上一页</strong></a></li><li
          class="home">Debian 管理员手册</li><li
          class="next"><a
            accesskey="n"
            href="sect.apt-cache.html"><strong>下一页</strong></a></li></ul><div
        class="section"><div
          class="titlepage"><div><div><h2
                class="title"><a
                  id="sect.apt-get"></a>6.2. <code
                  class="command">aptitude</code>、<code
                  class="command">apt-get</code>和 <code
                  class="command">apt</code> 命令</h2></div></div></div><a
          id="id-1.9.11.2"
          class="indexterm"></a><a
          id="id-1.9.11.3"
          class="indexterm"></a><a
          id="id-1.9.11.4"
          class="indexterm"></a><div
          class="para">
			APT 是个原先有图形接口的大计划。以包括核心应用程序的程序库为基础，且包括第一个前端 — 命令行指令 — <code
            class="command">apt-get</code>。<code
            class="command">apt</code> 是 APT 的第二个命令行指令包括若干处理错误的 <code
            class="command">apt-get</code>。
		</div><div
          class="para">
			Both tools are built on top of the same library and are thus very close but the default behaviour of <code
            class="command">apt</code> has been improved for interactive use and to actually do what most users expect. APT's developers reserve the right to change the public interface of this tool to further improve it. On the opposite, the public interface of <code
            class="command">apt-get</code> is well defined and will not change in any backwards incompatible way. It is thus the tool that you want to use when you need to script package installation requests.
		</div><div
          class="para">
			其他众多的图形界面以外部项目形式出现：<code
            class="command">synaptic</code>，<code
            class="command">aptitude</code>（它同时包含文本模式界面和图形界面 — 即使尚未完成），<code
            class="command">wajig</code>，等等。最为推荐的界面，<code
            class="command">apt</code>，会在本节案例中使用。注意，尽管如此，<code
            class="command">apt-get</code>与 <code
            class="command">aptitude</code>的命令行语法也仍与之非常类似。在<code
            class="command">apt</code>、<code
            class="command">apt-get</code>、<code
            class="command">aptitude</code>存在较大差异时，将会详述差异。
		</div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="id-1.9.11.8"></a>6.2.1. 开端</h3></div></div></div><div
            class="para">
				对于 APT 的任何操作，需要更新可用包的列表；这可以简单地通过<code
              class="command">apt update</code>来完成。取决于您连接的速度，该操作需要花费一定时间，因为这包括下载一定数量的<code
              class="filename">软件包</code>/<code
              class="filename">源代码</code>/<code
              class="filename">翻译-<em
                class="replaceable">语言代码</em></code>文件，这些文件随着 Debian 的开发而逐渐变大（对于<code
              class="literal">main</code>部分，至少有 10MB 数据）。当然，从光盘中安装无需任何下载 — 此情况下，操作是十分迅速的。
			</div><a
            id="id-1.9.11.8.3"
            class="indexterm"></a><a
            id="id-1.9.11.8.4"
            class="indexterm"></a><a
            id="id-1.9.11.8.5"
            class="indexterm"></a></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="id-1.9.11.9"></a>6.2.2. 安装和卸载</h3></div></div></div><a
            id="id-1.9.11.9.2"
            class="indexterm"></a><a
            id="id-1.9.11.9.3"
            class="indexterm"></a><a
            id="id-1.9.11.9.4"
            class="indexterm"></a><a
            id="id-1.9.11.9.5"
            class="indexterm"></a><div
            class="para">
				通过APT，软件包可以从系统中添加或移除，命令分别为<code
              class="command">apt install<em
                class="replaceable">软件包</em></code>、<code
              class="command">apt remove<em
                class="replaceable">软件包</em></code>。在以上两种情况中，APT 将会自动安装必要的依赖包或者删除依赖于删除包的软件包。<code
              class="command">apt purge<em
                class="replaceable">软件包</em></code>命令包含一个彻底删除 — 相关的配置文件也会被删除。
			</div><a
            id="id-1.9.11.9.7"
            class="indexterm"></a><a
            id="id-1.9.11.9.8"
            class="indexterm"></a><a
            id="id-1.9.11.9.9"
            class="indexterm"></a><a
            id="id-1.9.11.9.10"
            class="indexterm"></a><a
            id="id-1.9.11.9.11"
            class="indexterm"></a><a
            id="id-1.9.11.9.12"
            class="indexterm"></a><a
            id="id-1.9.11.9.13"
            class="indexterm"></a><a
            id="id-1.9.11.9.14"
            class="indexterm"></a><a
            id="id-1.9.11.9.15"
            class="indexterm"></a><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>TIP</em></span> 多次安装同一批软件包</strong></p></div></div></div><div
              class="para">
				在几台电脑上安装同一批软件包会很实用。这很容易做到。
			</div><div
              class="para">
				首先，从电脑中取得所安装软件包的列表作为用于复制的“模板”。
			</div><pre
              class="screen"><code
                class="computeroutput">$ </code><strong
                class="userinput"><code>dpkg --get-selections &gt;pkg-list</code></strong>↵</pre><div
              class="para">
				<code
                class="filename">pkg-list</code> 文件内容是已安装软件包的清单。然后，用以下的指令把 <code
                class="filename">pkg-list</code> 文件复制在欲更新的电脑：
			</div><pre
              class="screen">## Update dpkg's database of known packages↵
# <strong
                class="userinput"><code>avail=`mktemp`</code></strong>↵
# <strong
                class="userinput"><code>apt-cache dumpavail &gt; "$avail"</code></strong>↵
# <strong
                class="userinput"><code>dpkg --merge-avail "$avail"</code></strong>↵
# <strong
                class="userinput"><code>rm -f "$avail"</code></strong>↵
## Update dpkg's selections↵
# <strong
                class="userinput"><code>dpkg --set-selections &lt; pkg-list</code></strong>↵
## Ask apt-get to install the selected packages↵
# <strong
                class="userinput"><code>apt-get dselect-upgrade</code></strong>↵</pre><div
              class="para">
				第一个命令记录在 dpkg 库中可用的软件包列表，然后 <code
                class="command">dpkg --set-selections</code> 恢复选中你想要安装的包，<code
                class="command">apt-get</code> 的激活执行所需要的操作！<code
                class="command">aptitude</code> 没有这样的命令。
			</div></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>TIP</em></span> 同时进行卸载和安装</strong></p></div></div></div><div
              class="para">
				在命令 <code
                class="command">apt</code> (或 <code
                class="command">apt-get</code>、或 <code
                class="command">aptitude</code>) 加入后缀就可以同时安装指定的软件包与移除其他软件包。在 <code
                class="command">apt install</code> 命令加入 “<code
                class="literal">-</code>” 及希望移除的软件包名称。在 <code
                class="command">apt remove</code> 命令加入 “<code
                class="literal">+</code>” 及希望安装的软件包名称。
			</div><div
              class="para">
				下面的例子展示两种不同方法来安装<em
                class="replaceable">package1</em> 和卸载<em
                class="replaceable">package2</em>。
			</div><pre
              class="screen"># <strong
                class="userinput"><code>apt install <em
                    class="replaceable">package1</em> <em
                    class="replaceable">package2-</em></code></strong>↵
[...]↵
# <strong
                class="userinput"><code>apt remove <em
                    class="replaceable">package1+</em> <em
                    class="replaceable">package2</em></code></strong>↵
[...]↵</pre><div
              class="para">
				此方法也可用于把不同的软件包排除在外，比如由于<code
                class="literal">Recommends</code>造成的。一般，依赖解决者会用此作为寻找其他办法的线索。
			</div></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>技巧</em></span> <code
                        class="command">apt --reinstall</code> 和 <code
                        class="command">aptitude reinstall</code></strong></p></div></div></div><a
              id="id-1.9.11.9.18.2"
              class="indexterm"></a><div
              class="para">
				在软件包中的文件发生移除或更改时，系统有时候可能会受损。恢复这些文件最简单的方法是重装受影响的软件包。不幸的是，包系统会认为后者已安装而拒绝重新安装；为了避免此情况，使用<code
                class="command">apt</code>和<code
                class="command">apt-get</code>命令的<code
                class="literal"> --reinstall</code>选项。如下命令会重新安装<span
                class="pkg pkg">postfix</span>，即使它已存在：
			</div><pre
              class="screen"><code
                class="computeroutput"># </code><strong
                class="userinput"><code>apt --reinstall install postfix</code></strong></pre><div
              class="para">
				<code
                class="command">aptitude</code>命令行略微不同，但可通过<code
                class="command">aptitude reinstall postfix</code>获得同样的结果。
			</div><div
              class="para">
				该问题不与<code
                class="command">dpkg</code>同时出现，但管理员极少直接使用它。
			</div><div
              class="para">
				注意！使用<code
                class="command">apt --reinstall</code>命令恢复受到攻击时变更的软件包，不会当然地恢复系统原本的样子。<a
                class="xref"
                href="sect.dealing-with-compromised-machine.html">第 14.7 节 “处理被攻陷的机器”</a>详述了受损系统要采取的必要步骤。
			</div></div><div
            class="para">
				如果文件 <code
              class="filename">sources.list</code> 提及了数个发布版本，可以指定要安装软件包的版本。要求特定版本号可以通过 <code
              class="command">apt install <em
                class="replaceable">package</em>=<em
                class="replaceable">version</em></code>，但以标明其初始发行版本 (<span
              class="distribution distribution">Stable</span>, <span
              class="distribution distribution">Testing</span> 或者 <span
              class="distribution distribution">Unstable</span>）的方式— 通过 <code
              class="command">apt install <em
                class="replaceable">package</em>/<em
                class="replaceable">distribution</em></code> — 更为推荐。倘若 <code
              class="filename">sources.list</code>文件所述软件源之一仍可用的情况下，通过此命令可以回溯一个软件包的旧版本 (比如您知晓其情况良好的情况)。否则，<code
              class="literal">snapshot.debian.org</code> 归档可以补救(参阅侧边栏r <a
              class="xref"
              href="apt.html#sidebar.snapshot.debian.org"><span
                class="emphasis"><em>进阶</em></span>旧包版本： <code
                class="literal">snapshot.debian.org</code></a>)。
			</div><div
            class="example"><a
              id="id-1.9.11.9.20"></a><p
              class="title"><strong>例 6.3. 安装 <span
                  class="pkg pkg">spamassassin（垃圾邮件过滤）</span> 的 <span
                  class="distribution distribution">unstable</span> 版本</strong></p><div
              class="example-contents"><pre
                class="screen"><code
                  class="computeroutput"># </code> <strong
                  class="userinput"><code>apt install spamassassin/unstable</code></strong></pre></div></div><div
            class="para">
				If the package to install has been made available to you under the form of a simple <code
              class="filename">.deb</code> file without any associated package repository, it is still possible to use APT to install it together with its dependencies (provided that the dependencies are available in the configured repositories) with a simple command: <code
              class="command">apt install ./<em
                class="replaceable">path-to-the-package.deb</em></code>. The leading <code
              class="literal">./</code> is important to make it clear that we are referring to a filename and not to the name of a package available in one of the repositories.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>更进一步</em></span> <code
                        class="filename">.deb</code> 文件的缓存</strong></p></div></div></div><div
              class="para">
				APT keeps a copy of each downloaded <code
                class="filename">.deb</code> file in the directory <code
                class="filename">/var/cache/apt/archives/</code>. In case of frequent updates, this directory can quickly take a lot of disk space with several versions of each package; you should regularly sort through them. Two commands can be used: <code
                class="command">apt-get clean</code> entirely empties the directory; <code
                class="command">apt-get autoclean</code> only removes packages which can no longer be downloaded (because they have disappeared from the Debian mirror) and are therefore clearly useless (the configuration parameter <code
                class="literal">APT::Clean-Installed</code> can prevent the removal of <code
                class="filename">.deb</code> files that are currently installed).
			</div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="sect.apt-upgrade"></a>6.2.3. 系统升级</h3></div></div></div><a
            id="id-1.9.11.10.2"
            class="indexterm"></a><a
            id="id-1.9.11.10.3"
            class="indexterm"></a><a
            id="id-1.9.11.10.4"
            class="indexterm"></a><a
            id="id-1.9.11.10.5"
            class="indexterm"></a><div
            class="para">
				常规升级是推荐的，因为它们包含最新的安全更新。要升级，可使用<code
              class="command">apt upgrade</code>、<code
              class="command">apt-get upgrade</code>、<code
              class="command">aptitude safe-upgrade</code>（当然需在<code
              class="command">apt update</code>之后）。该命令会查找要升级的已安装包，同时不移除任何包。也就是说，目标是确保可能的侵入式升级最小化。<code
              class="command">apt-get</code>命令略苛刻于 <code
              class="command">aptitude</code> 或 <code
              class="command">apt</code>命令，因为它会拒绝安装未预先安装的软件包。
			</div><div
            class="sidebar"><a
              id="sidebar.apt-pdiff"></a><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>TIP</em></span> 增量更新</strong></p></div></div></div><div
              class="para">
				As we explained earlier, the aim of the <code
                class="command">apt update</code> command is to download for each package source the corresponding <code
                class="filename">Packages</code> (or <code
                class="filename">Sources</code>) file. However, even after a <code
                class="command">xz</code> compression, these files can remain rather large (the <code
                class="filename">Packages.xz</code> for the <span
                class="foreignphrase"><em
                  class="foreignphrase">main</em></span> section of <span
                class="distribution distribution">Stretch</span> takes more than 6 MB). If you wish to upgrade regularly, these downloads can take up a lot of time.
			</div><div
              class="para">
				为了加快处理速度，APT 可以下载只有变动内容的 “diff” 文件，而不是整个文件。官方的 Debian 镜射网站发行此等文件列出 <code
                class="filename">Packages</code> 文件及其后续版本的不同处。每次升级与每周升级分别都有对应的文件。每个供 <span
                class="distribution distribution">不稳定版</span> 的 “diff” 文件只有几十 KB 大小，所以每周使用 <code
                class="command">apt update</code> 命令需要下载的数据不会太大。<span
                class="distribution distribution">稳定版</span> 与 <span
                class="distribution distribution">测试版</span> 的分行版，只有极小的改变。
			</div><div
              class="para">
				然而，有的时候仍需要下载整个 <code
                class="filename">软件包</code> 文件，尤其是上回升级是很久以前的事且不适合增量式升级。若网络速度极快但机器的处理器性能不足以应付升级，下载省下的时间还不足以弥补电脑计算新版版的时间 (从旧版开始逐一地升级)。在这种情况下，可以使用配置参数 <code
                class="literal">Acquire::Pdiffs</code> 并设置为 <code
                class="literal">false</code>。
			</div></div><div
            class="para">
				<code
              class="command">apt</code> 会选择最新的版本号 (除了来自 <span
              class="distribution distribution">实验版</span> 与 <span
              class="distribution distribution">稳定反向植入版</span>，其缺省忽略版本号)。若指定 <span
              class="distribution distribution">测试版</span> 或 <span
              class="distribution distribution">不稳定版</span> 于 <code
              class="filename">sources.list</code> 内，则 <code
              class="command">apt upgrade</code> 会把 <span
              class="distribution distribution">稳定版</span> 系统切换至 <span
              class="distribution distribution">测试版</span> 或 <span
              class="distribution distribution">不稳定版</span>，这些都不是您要的。
			</div><div
            class="para">
				搜索升级的软件包时需把特定的发行版告知 <code
              class="command">apt</code>，采用 <code
              class="literal">-t</code> 或 <code
              class="literal">--target-release</code> 选项，然后是发行版的名称 (如：<code
              class="command">apt -t stable upgrade</code>)。为了避免每次使用 <code
              class="command">apt</code> 都需指定版本，可以把, you can add <code
              class="literal">APT::Default-Release "stable";</code> 加在 <code
              class="filename">/etc/apt/apt.conf.d/local</code> 之内。
			</div><a
            id="id-1.9.11.10.10"
            class="indexterm"></a><a
            id="id-1.9.11.10.11"
            class="indexterm"></a><a
            id="id-1.9.11.10.12"
            class="indexterm"></a><a
            id="id-1.9.11.10.13"
            class="indexterm"></a><a
            id="id-1.9.11.10.14"
            class="indexterm"></a><div
            class="para">
				对于非常重要的升级，如从一个 Debian 主版本变更为下一版本，你需要使用<code
              class="command">apt full-upgrade</code>。使用此命令，<code
              class="command">apt</code>将会完全升级，即使必须移除一些废弃包或者安装新的依赖包。这也适用于日常使用 Debian <span
              class="distribution distribution"> Unstable</span>并每天跟随其演化的用户。它是如此简便以至于几乎无需解释：APT的声誉基于此项强大的功能。
			</div><div
            class="para">
				不同于 <code
              class="command">apt</code> 与 <code
              class="command">aptitude</code>，<code
              class="command">apt-get</code> 不知道 <code
              class="command">full-upgrade</code> 命令。反而，您应使用 <code
              class="command">apt-get dist-upgrade</code> (”升级发行版”)，此古老且知名的命令也被 <code
              class="command">apt</code> 与 <code
              class="command">aptitude</code> 接受给读者相当的便利。
			</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="sect.apt-config"></a>6.2.4. 配置选项</h3></div></div></div><a
            id="id-1.9.11.11.2"
            class="indexterm"></a><a
            id="id-1.9.11.11.3"
            class="indexterm"></a><a
            id="id-1.9.11.11.4"
            class="indexterm"></a><div
            class="para">
				除了已提及的配置细目，还可在 <code
              class="filename">/etc/apt/apt.conf.d/</code> 文件夹内增加 APT 的其他配置。让 APT 告知 <code
              class="command">dpkg</code> 忽略由 <code
              class="literal">DPkg::options { "--force-overwrite"; }</code> 引发的错误。
			</div><div
            class="para">
				若只能经由代理服务器近用网页，添加像这样的一列 <code
              class="literal">Acquire::http::proxy "http://<em
                class="replaceable">yourproxy</em>:3128"</code>。对 FTP 代理服务器，用 <code
              class="literal">Acquire::ftp::proxy "ftp://<em
                class="replaceable">yourproxy</em>"</code>。更多的配置选项，参考 <span
              class="citerefentry"><span
                class="refentrytitle">apt.conf</span>(5)</span> 手册页以 <code
              class="command">man apt.conf</code> 命令 (手删的详情，见 <a
              class="xref"
              href="solving-problems.html#sect.manual-pages">第 7.1.1 节 “手册页面”</a>) 查看。
			</div><div
            class="sidebar"><a
              id="sidebar.directory.d"></a><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>基本</em></span> 结尾是 <code
                        class="filename">.d</code> 的文件夹名称</strong></p></div></div></div><a
              id="id-1.9.11.11.7.2"
              class="indexterm"></a><div
              class="para">
				结尾是 <code
                class="filename">.d</code> 数据使用机会愈来愈多。每个文件夹内的配置档系供多个文件使用。所以，在 <code
                class="filename">/etc/apt/apt.conf.d/</code> 内的文件都是供 APT 配置之用。APT 以字顺方式纳入他们，最后一个文件可以修正在前的配置。
			</div><div
              class="para">
				此结构对机器的管理者与软件包维护带来若干弹性。确实，管理者容易修改软件的配置，只需在有问题的文件夹添加文件而不必变动既有的文件。需要调整另个软件的配置，以确保与既有软件相依，软件包维护者以同样的方法就能达成。Debian 的政策禁止修改其他软件包的配置档 — 只有被授权者才能修改。软件包升级时，用户应保留选择配置档版本的权力。外部修改此文件时将启动该选项，管理者就知道是外来的修改。
			</div><div
              class="para">
				没有 <code
                class="filename">.d</code> 文件夹时，外部软件包就不能在没有修改配置档的前提下修改程序设置。所以，必须邀请用户选择修改方式，并列出在文件 <code
                class="filename">/usr/share/doc/<em
                  class="replaceable">package</em>/README.Debian</code> 内的选项。
			</div><div
              class="para">
				视应用程序的需要，可直接使用或由外部脚本管理 <code
                class="filename">.d</code> 文件夹，将所有文件串联成一个配置档。更动文件夹内容后，必须再运行脚本，才能纳入该等变动。还有一件重要的事，千万不要直接运行自动生成的配置档，因为下次运行脚本后将失去所有的东西。受到环境的限制才被迫选择指定的方法 (直接使用 <code
                class="filename">.d</code> 文件夹或由该文件夹产生的文件)，不论何种方法，配置的弹性收益远大于其带来的复杂性。Exim 4 邮件服务器是产生文件方法的范例之一：可用多个文件 (<code
                class="filename">/etc/exim4/conf.d/*</code>) 配置串联成 <code
                class="filename">/var/lib/exim4/config.autogenerated</code> 再由 <code
                class="command">update-exim4.conf</code> 命令运行。
			</div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="sect.apt.priorities"></a>6.2.5. 包的优先级管理</h3></div></div></div><div
            class="para">
				配置 APT 最重要的层面之一是管理每个软件包来源的优先性。例如，从 <span
              class="distribution distribution">测试版</span>、<span
              class="distribution distribution">不稳定</span> 或 <span
              class="distribution distribution">实验版</span> 中选取一个或多个软件包。可以指令每个软件包的优先性 (视其版本或发行版，同个软件包可以有多个优先性)。这些优先性将影响 APT 的行为：每个软件包总是选择最优先的版本 (除非旧于已安装的版本或优先性小于 1000)。
			</div><a
            id="id-1.9.11.12.3"
            class="indexterm"></a><a
            id="id-1.9.11.12.4"
            class="indexterm"></a><a
            id="id-1.9.11.12.5"
            class="indexterm"></a><a
            id="id-1.9.11.12.6"
            class="indexterm"></a><a
            id="id-1.9.11.12.7"
            class="indexterm"></a><a
            id="id-1.9.11.12.8"
            class="indexterm"></a><a
            id="id-1.9.11.12.9"
            class="indexterm"></a><div
            class="para">
				APT 设置若干缺省的优先性。已安装软件包版本的优先性是 100。未安装版本缺省优先性为 500，若是另个发布的目标则可跳至 990 (以 <code
              class="literal">-t</code> 命令行选项或 <code
              class="literal">APT::Default-Release</code> 配置指令调整)。
			</div><div
            class="para">
				于 <code
              class="filename">/etc/apt/preferences</code> 文件内添加条目的方式，指名受影响软件包名称、版本、出处及其新的优先性。
			</div><div
            class="para">
				APT 永远不会安装旧版的软件包 (就是软件包的版本编号小于已安装的软件包)，除非其优先性高于 1000。APT 总是安装优先性最高的软件包。若两个软件包的优先性相同，APT 安装最新的 (其版本编号较高)。若同版本的两个软件包优先性相同但内容不同，APT 安装还没有安装的版本 (包括没有递增修订编号的软件包，通常是需要的)。
			</div><div
            class="para">
				更具体地说，永远不会安装优先性小于 0 的软件包。没有安装其他版本时，将安装优先性在 0 与 100 之间的软件包。其他发行版没有更新版本或可用的版本时，安装优先性在 100 与 500 之间的软件包。在目标发行版内没有更新的版本时，安装优先性在 501 与 990 之间的软件包。已安装的版本不是更新时，安装优先性在 990 与 1000 之间的软件包。即使使强迫 APT 降级也要安装优先性高于greater than 1000 的软件包。
			</div><div
            class="para">
				When APT checks <code
              class="filename">/etc/apt/preferences</code>, it first takes into account the most specific entries (often those specifying the concerned package), then the more generic ones (including for example all the packages of a distribution). If several generic entries exist, the first match is used. The available selection criteria include the package's name and the source providing it. Every package source is identified by the information contained in a <code
              class="filename">Release</code> file that APT downloads together with the <code
              class="filename">Packages</code> files. It specifies the origin (usually “Debian” for the packages of official mirrors, but it can also be a person's or an organization's name for third-party repositories). It also gives the name of the distribution (usually <span
              class="distribution distribution">Stable</span>, <span
              class="distribution distribution">Testing</span>, <span
              class="distribution distribution">Unstable</span> or <span
              class="distribution distribution">Experimental</span> for the standard distributions provided by Debian) together with its version (for example 9 for Debian <span
              class="distribution distribution">Stretch</span>). Let's have a look at its syntax through some realistic case studies of this mechanism.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>特例</em></span><span
                        class="distribution distribution">实验性</span>的优先性</strong></p></div></div></div><a
              id="id-1.9.11.12.15.2"
              class="indexterm"></a><div
              class="para">
				若把 <span
                class="distribution distribution">Experimental</span> 列在 <code
                class="filename">sources.list</code> 文件内，几乎不会安装对应软件包因为其 APT 优先性为1。当然这是特例，避免用户意外安装 <span
                class="distribution distribution">Experimental</span> 软件包。这些软件包只能以指令 <code
                class="command">aptitude install <em
                  class="replaceable">软件包名称</em>/experimental</code> 安装 — 用户键入此指令时自然知道其风险。还是有可能 (虽然 <span
                class="emphasis"><em>不</em></span> 建议) 把 <span
                class="distribution distribution">Experimental</span> 内的软件包视为其他发行版而给予优先性 100。在 <code
                class="filename">/etc/apt/preferences</code> 文件内给予特定的条目就行了：
			</div><div
              class="informalexample"><pre
                class="programlisting">Package: *
Pin: release a=experimental
Pin-Priority: 500</pre></div></div><div
            class="para">
				暂时假设您只需用到 Debian 稳定版的软件包。除非特别指明，不会安装其他版本的软件包。可以在 <code
              class="filename">/etc/apt/preferences</code> 文件内写入以上的条目：
			</div><div
            class="informalexample"><pre
              class="programlisting">Package: *
Pin: release a=stable
Pin-Priority: 900

Package: *
Pin: release o=Debian
Pin-Priority: -10</pre></div><div
            class="para">
				<code
              class="literal">a=stable</code> 设置发行版的名称。<code
              class="literal">o=Debian</code> 限制来自 “Debian” 的软件包。
			</div><div
            class="para">
				Let's now assume that you have a server with several local programs depending on the version 5.24 of Perl and that you want to ensure that upgrades will not install another version of it. You could use this entry:
			</div><div
            class="informalexample"><pre
              class="programlisting">Package: perl
Pin: version 5.24*
Pin-Priority: 1001
</pre></div><div
            class="para">
				此配置档的参考文档在手册的 <span
              class="citerefentry"><span
                class="refentrytitle">apt_preferences</span>(5)</span>，以 <code
              class="command">man apt_preferences</code> 命令就可看到。
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>秘诀</em></span> 在 <code
                        class="filename">/etc/apt/preferences</code> 内的评论</strong></p></div></div></div><a
              id="id-1.9.11.12.22.2"
              class="indexterm"></a><a
              id="id-1.9.11.12.22.3"
              class="indexterm"></a><a
              id="id-1.9.11.12.22.4"
              class="indexterm"></a><div
              class="para">
				<code
                class="filename">/etc/apt/preferences</code> 文件没有放置评论的官方语法，但可以在每个条目的 “<code
                class="literal">Explanation</code>” 字段置入若干说明：
			</div><div
              class="informalexample"><pre
                class="programlisting">Explanation: The package xserver-xorg-video-intel provided
Explanation: in experimental can be used safely
Package: xserver-xorg-video-intel
Pin: release a=experimental
Pin-Priority: 500</pre></div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="sect.apt-mix-distros"></a>6.2.6. 在多个发行版工作</h3></div></div></div><div
            class="para">
				<code
              class="command">apt</code> 是很奇妙的工具，可从其他发行版提取软件包。例如，安装 <span
              class="distribution distribution">稳定版</span> 系统之后，或许想要在不偏离系统原来状态下，试试 <span
              class="distribution distribution">测试版</span> 或 <span
              class="distribution distribution">不稳定版</span> 的软件包。
			</div><div
            class="para">
				混用不同版本软件包出问题时，Even if you will occasionally encounter problems while mixing packages from different distributions, <code
              class="command">apt</code> 可以处理得极为恰当把风险降到最低。最好的方法是把所有的发行版置于 <code
              class="filename">/etc/apt/sources.list</code> 文件内 (某些人总是置入三个发行版，不过还是要记得 <span
              class="distribution distribution">不稳定版</span> 是有经验用户的专属。) 且在 <code
              class="literal">APT::Default-Release</code> 参数中设置偏好的发行版 (见 <a
              class="xref"
              href="sect.apt-get.html#sect.apt-upgrade">第 6.2.3 节 “系统升级”</a>) 。
			</div><div
            class="para">
				假设 <span
              class="distribution distribution">稳定版</span> 是您的参考版本，但是 <span
              class="distribution distribution">测试版</span> 与 <span
              class="distribution distribution">不稳定版</span> 也列在 <code
              class="filename">sources.list</code> 文件内。在这个情况下，您可使用 <code
              class="command">apt install <em
                class="replaceable">软件包名称</em>/testing</code> 安装来自 <span
              class="distribution distribution">测试版</span> 的软件包。若因相依性未满足而安装失败，可以在 <span
              class="distribution distribution">测试版</span> 内加入 <code
              class="literal">-t testing</code> 参数。同样的方式也适用于 <span
              class="distribution distribution">不稳定版</span>。
			</div><div
            class="para">
				在此情况下，除了已经被其他发行版升级之外，升级 (<code
              class="command">upgrade</code> 与 <code
              class="command">full-upgrade</code>) 只在 <span
              class="distribution distribution">稳定版</span> 内完成：其他的升级在各自的发行版内处理。稍后以 APT 缺省的优先性说明此行为。请使用 <code
              class="command">apt-cache policy</code> (见专栏 <a
              class="xref"
              href="sect.apt-get.html#sidebar.apt-cache-policy"><span
                class="emphasis"><em>秘诀</em></span> <code
                class="command">apt-cache policy</code></a>) 查看指定的优先性。
			</div><div
            class="para">
				每件事都围绕在 APT 只处理高于或等于已安装版本号软件包的前提下 (假设 <code
              class="filename">/etc/apt/preferences</code> 还未强迫优先性高于 1000 的某些软件包)。
			</div><div
            class="sidebar"><a
              id="sidebar.apt-cache-policy"></a><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>秘诀</em></span> <code
                        class="command">apt-cache policy</code></strong></p></div></div></div><div
              class="para">
				运行 <code
                class="command">apt-cache policy</code> 显示每个软件包来源缺省的优先性，就能了解优先性的机制。也可使用 <code
                class="command">apt-cache policy <em
                  class="replaceable">软件包名称</em></code> 命令显示指定软件包所有可用版本的优先性。
			</div></div><div
            class="para">
				假设从Let's assume that you have installed version 1 of a first package from <span
              class="distribution distribution">稳定版</span> 安装第一个软件包的第一版且从and that version 2 and 3 are available respectively in <span
              class="distribution distribution">测试版</span> 与 <span
              class="distribution distribution">不稳定版</span> 安装同软件包的第二版与第三版水。已安装的版本优先性为 100 但在but the version available in <span
              class="distribution distribution">稳定版</span> (相同的) 优先性为 990 (因为它是目标发布版的一部分)。在 <span
              class="distribution distribution">测试版</span> 与 <span
              class="distribution distribution">不稳定版</span> 的软件包其优先性为 500 (缺省不安装版本的优先性)。获选者为优先性 990 的版本1。软件包 “留在 <span
              class="distribution distribution">稳定版</span> 内”。
			</div><div
            class="para">
				另个软件包的例子，已从 <span
              class="distribution distribution">测试版</span> 安装版本 2。版本 1 在 <span
              class="distribution distribution">稳定版</span> 且版本 3 在 <span
              class="distribution distribution">不稳定版</span>。因为优先性小于已安装的版本，所以版本 1 (优先性为 990 — 小于 1000) 已作废。只剩下优先性为 500 的版本 2 与版本 3。在此情况下，APT 选择较新的版本，即使用 <span
              class="distribution distribution">不稳定版</span>。若不要已安装自 <span
              class="distribution distribution">测试版</span> 的软件包，可以迁移至 <span
              class="distribution distribution">不稳定版</span>，必须指定来自于 <span
              class="distribution distribution">不稳定版</span> 优先性小于 500 (例如 490) 的软件包。修改 <code
              class="filename">/etc/apt/preferences</code> 文件即可：
			</div><pre
            class="programlisting">Package: *
Pin: release a=unstable
Pin-Priority: 490</pre></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="sect.automatic-tracking"></a>6.2.7. 自动追踪已安装的软件包</h3></div></div></div><div
            class="para">
				<code
              class="command">apt</code> 的必要功能之一是经由相依性追踪已安装的软件包。这些软件包称为 “自动”，且通常包括其程序库。
			</div><div
            class="para">
				With this information, when packages are removed, the package managers can compute a list of automatic packages that are no longer needed (because there is no “manually installed” packages depending on them). <code
              class="command">apt-get autoremove</code> or <code
              class="command">apt autoremove</code> will get rid of those packages. <code
              class="command">aptitude</code> does not have this command because it removes them automatically as soon as they are identified. In all cases, the tools display a clear message listing the affected packages.
			</div><a
            id="id-1.9.11.14.4"
            class="indexterm"></a><a
            id="id-1.9.11.14.5"
            class="indexterm"></a><a
            id="id-1.9.11.14.6"
            class="indexterm"></a><a
            id="id-1.9.11.14.7"
            class="indexterm"></a><div
            class="para">
				把软件包标记为自动是个好习惯，不需要时就被自动移除。<code
              class="command">apt-mark auto <em
                class="replaceable">软件包名称</em></code> 会标记该软件包为自动而 <code
              class="command">apt-mark manual <em
                class="replaceable">软件包名称</em></code> 则不标记。<code
              class="command">aptitude markauto</code> 与 <code
              class="command">aptitude unmarkauto</code> 作用相同只是功能较多 (见 <a
              class="xref"
              href="sect.apt-frontends.html#sect.aptitude">第 6.4.1 节 “<code
                class="command">aptitude</code>”</a>)。命令交互接口的 <code
              class="command">aptitude</code> 也可查看多个软件包的 “自动旗标”。
			</div><a
            id="id-1.9.11.14.9"
            class="indexterm"></a><div
            class="para">
				自动安装软件包出现在系统内。系由于从命令行取得该等信息，可使用 <code
              class="command">aptitude why <em
                class="replaceable">软件包名称</em></code> (<code
              class="command">apt</code> 与 <code
              class="command">apt-get</code> 没有类似的功能)：
			</div><pre
            class="screen"><code
              class="computeroutput">$ </code><strong
              class="userinput"><code>aptitude why python-debian
</code></strong><code
              class="computeroutput">i   aptitude         Recommends apt-xapian-index         
i A apt-xapian-index Depends    python-debian (&gt;= 0.1.15)
</code></pre><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>其他</em></span> <code
                        class="command">deborphan</code> 与 <code
                        class="command">debfoster</code></strong></p></div></div></div><a
              id="id-1.9.11.14.12.2"
              class="indexterm"></a><a
              id="id-1.9.11.14.12.3"
              class="indexterm"></a><div
              class="para">
				早年 <code
                class="command">apt</code>、<code
                class="command">apt-get</code> 与 <code
                class="command">aptitude</code> 还不能追踪自动软件包时，以另外两个指令产不必要软件包清单：<code
                class="command">deborphan</code> 与 <code
                class="command">debfoster</code>。
			</div><div
              class="para">
				<code
                class="command">deborphan</code> 是两者中最基础的。扫瞄 <code
                class="literal">libs</code> 与 <code
                class="literal">oldlibs</code> 区块 (没有补充命令) 在已安装软件包中，寻找不再相依于其他软件包者。其结果做为移除非必要软件包的依据。
			</div><div
              class="para">
				<code
                class="command">debfoster</code> 还有其他用法，极类似 APT：维护一个已安装的软件包以及需要互调用的软件包清单。系统内出现新的软件包且 <code
                class="command">debfoster</code> 不知道它需要那些软件包，则在屏幕显示其相依的软件包清单。此程序提供新的选择：移除软件包 (或许连同相依者)，标记为必要，或暂时忽略它。
			</div></div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="apt.html"><strong>上一页</strong>第 6 章 维护和更新：APT 工具</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>上一级</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>起始页</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.apt-cache.html"><strong>下一页</strong>6.3. apt-cache 命令</a></li></ul><div
        id="translated_pages"><ul><li><a
              href="../ar-MA/sect.apt-get.html">ar-MA</a></li><li><a
              href="../da-DK/sect.apt-get.html">da-DK</a></li><li><a
              href="../de-DE/sect.apt-get.html">de-DE</a></li><li><a
              href="../el-GR/sect.apt-get.html">el-GR</a></li><li><a
              href="../en-US/sect.apt-get.html">en-US</a></li><li><a
              href="../es-ES/sect.apt-get.html">es-ES</a></li><li><a
              href="../fa-IR/sect.apt-get.html">fa-IR</a></li><li><a
              href="../fr-FR/sect.apt-get.html">fr-FR</a></li><li><a
              href="../hr-HR/sect.apt-get.html">hr-HR</a></li><li><a
              href="../id-ID/sect.apt-get.html">id-ID</a></li><li><a
              href="../it-IT/sect.apt-get.html">it-IT</a></li><li><a
              href="../ja-JP/sect.apt-get.html">ja-JP</a></li><li><a
              href="../ko-KR/sect.apt-get.html">ko-KR</a></li><li><a
              href="../nb-NO/sect.apt-get.html">nb-NO</a></li><li><a
              href="../pl-PL/sect.apt-get.html">pl-PL</a></li><li><a
              href="../pt-BR/sect.apt-get.html">pt-BR</a></li><li><a
              href="../ro-RO/sect.apt-get.html">ro-RO</a></li><li><a
              href="../ru-RU/sect.apt-get.html">ru-RU</a></li><li><a
              href="../tr-TR/sect.apt-get.html">tr-TR</a></li><li><a
              href="../vi-VN/sect.apt-get.html">vi-VN</a></li><li><a
              href="../zh-CN/sect.apt-get.html">zh-CN</a></li><li><a
              href="../zh-TW/sect.apt-get.html">zh-TW</a></li></ul></div></body></html>
