<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">14.2. 防火墙或者包过滤</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.1" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-8-zh-CN-1.0-1" /><meta
        name="keywords"
        content="防火墙, 网络过滤, IDS/NIDS" /><link
        rel="home"
        href="index.html"
        title="Debian 管理员手册" /><link
        rel="up"
        href="security.html"
        title="第 14 章 安全" /><link
        rel="prev"
        href="security.html"
        title="第 14 章 安全" /><link
        rel="next"
        href="sect.supervision.html"
        title="14.3. 监督：预防，检测，威慑" /><link
        rel="canonical"
        href="http://l.github.io/debian-handbook/html/zh-CN/sect.firewall-packet-filtering.html" /></head><body
      class="draft "><noscript><iframe
          src="//www.googletagmanager.com/ns.html?id=GTM-5H35QX"
          height="0"
          width="0"
          style="display:none;visibility:hidden"></iframe></noscript><script
        type="text/javascript">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&amp;l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5H35QX');</script><div
        id="banner"><a
          href="http://debian-handbook.info/get/"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="http://debian-handbook.info"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="security.html"><strong>上一页</strong></a></li><li
          class="home">Debian 管理员手册</li><li
          class="next"><a
            accesskey="n"
            href="sect.supervision.html"><strong>下一页</strong></a></li></ul><div
        class="section"><div
          class="titlepage"><div><div><h2
                class="title"><a
                  id="sect.firewall-packet-filtering"></a>14.2. 防火墙或者包过滤</h2></div></div></div><a
          id="idm140476765944016"
          class="indexterm"></a><a
          id="idm140476765943056"
          class="indexterm"></a><a
          id="idm140476765942096"
          class="indexterm"></a><div
          class="sidebar"><div
            class="titlepage"><div><div><p
                  class="title"><strong><span
                      class="emphasis"><em>回到基础</em></span> 防火墙</strong></p></div></div></div><a
            id="idm140476765940016"
            class="indexterm"></a><div
            class="para">
			<span
              class="emphasis"><em>防火墙</em></span>是计算机设备的一部分，该设备使用硬件和（或者）软件分拣流入和流出的网络数据包（源自或者源于局域网），并且只允许符合预定义条件的包通过。
		</div></div><div
          class="para">
			防火墙是一个过滤网关，并且只对要通过它的数据包有作用。因此，只有在防火墙是这些数据包的唯一路由器的时候才有效。
		</div><div
          class="para">
			缺乏标准配置（之前“过程，而非产品”的格言）就缺少交钥匙解决方案。然而，有些工具使配置 <span
            class="emphasis"><em>netfilter</em></span> 防火墙更加简单，使用图形显示过滤规则。<code
            class="command">fwbuilder</code> 无疑是其中的佼佼者。
		</div><a
          id="idm140476764682112"
          class="indexterm"></a><div
          class="sidebar"><div
            class="titlepage"><div><div><p
                  class="title"><strong><span
                      class="emphasis"><em>特例</em></span> 局部防火墙</strong></p></div></div></div><div
            class="para">
			防火墙可以应用在个别机器上（相对于整个网络而言），在这些情况中其角色是过滤或限制对一些服务的访问，或阻止用户有意或无意安装的流氓软件对外部的连接。
		</div></div><div
          class="para">
			Linux 内核嵌入了 <span
            class="emphasis"><em>netfilter</em></span> 防火墙。可以使用用户空间的 <code
            class="command">iptables</code> 和 <code
            class="command">ip6tables</code> 命令控制。这两个命令直接的区别在于前者作用在 IPv4 网络，而后者作用在 IPv6。由于两种网络协议可能在多年内共存，这就需要同时使用两个工具。
		</div><a
          id="idm140476764590064"
          class="indexterm"></a><a
          id="idm140476764588944"
          class="indexterm"></a><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="sect.netfilter"></a>14.2.1. Netfilter 行为</h3></div></div></div><div
            class="para">
				<span
              class="emphasis"><em>netfilter</em></span> 使用四个截然不同的表存储规则，来规定对数据包的三种操作：
			</div><div
            xmlns:d="http://docbook.org/ns/docbook"
            class="itemizedlist"><ul><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">filter</code> 关注过滤规则（接受，拒绝或者忽略数据包）；
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">nat</code> 关注转化源地址或者目的地址和数据包端口；注意该表只在 IPv4 中存在；
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">mangle</code> 关注对 IP 数据包的其他变化（包含 ToS － <span
                    class="emphasis"><em>服务类型</em></span> －区段和选项）；
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">raw</code> 允许在到达追踪系统之前手动更改数据包。
					</div></li></ul></div><div
            class="para">
				每个表都包含称为<span
              class="emphasis"><em>链（chains）</em></span>的规则列表。防火墙使用标准链处理预定义环境下的数据包。管理员可以创建其他链，该链只有在被标准链引用（直接或间接）时才会起作用。
			</div><a
            id="idm140476750574272"
            class="indexterm"></a><a
            id="idm140476750573312"
            class="indexterm"></a><div
            class="para">
				<code
              class="literal">过滤</code> 表有三个标准链：
			</div><div
            xmlns:d="http://docbook.org/ns/docbook"
            class="itemizedlist"><ul><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">输入</code>：关注目的地是防火墙自身的数据包；
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">输出</code>：关注防火墙发出的数据包；
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">转发</code>：关注通过防火墙的数据包（既不是源头也不是目的地）。
					</div></li></ul></div><div
            class="para">
				<code
              class="literal">nat</code> 表也有三个标准链：
			</div><div
            xmlns:d="http://docbook.org/ns/docbook"
            class="itemizedlist"><ul><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">预先路由</code>：一旦数据包到达就修改；
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">后路由</code>：在准备继续上路时修改数据包；
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">输出</code>：修改防火墙自身产生的数据包。
					</div></li></ul></div><div
            class="figure"><a
              id="figure.chaines-netfilter"></a><div
              class="figure-contents"><div
                class="mediaobject"><img
                  src="images/netfilter.png"
                  alt="netfilter 中的链是如何被调用的" /></div></div><p
              class="title"><strong>图 14.1. <span
                  class="emphasis"><em>netfilter</em></span> 中的链是如何被调用的</strong></p></div><div
            class="para">
				每个链是一个规则列表；每个规则是条件集合以及符合条件时要采取的行动。当处理数据包时，防火墙逐一扫描链；当碰到规则条件时，“跳（jumps）”到（因此在命令中使用 <code
              class="literal">-j</code> 选项）规定的行为并继续处理。大多数常用的行为都已经标准化，并有专门操作。使用标准操作会中断对链的处理过程，此时数据包的去向未知（除了下面提到的例外）：
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>回到基础</em></span> ICMP</strong></p></div></div></div><div
              class="para">
				ICMP （<span
                class="emphasis"><em>互联网控制信息Internet Control Message </em></span> 协议）是用来在通信中传递补充信息的协议。支持使用 <code
                class="command">ping</code> 命令来测试网络的连通性（发送 ICMP <span
                class="emphasis"><em>回应请求</em></span>信息，接收者要用 ICMP<span
                class="emphasis"><em>回应应答</em></span>信息应答）。它会产生防火墙拒绝数据包，显示接收缓冲区溢出，为连接中后续数据包提供更好的路由，等等。该协议有几个 RFC 文档定义；起先 RFC777 和 RFC792 很快就完成了，并被扩展。 <div
                class="url">→ <a
                  href="http://www.faqs.org/rfcs/rfc777.html">http://www.faqs.org/rfcs/rfc777.html</a></div><div
                class="url">→ <a
                  href="http://www.faqs.org/rfcs/rfc792.html">http://www.faqs.org/rfcs/rfc792.html</a></div>
			</div><div
              class="para">
				接收缓冲区是一个小内存区域，用来存储已经从网络到达而内核还未来得及处理的数据。如果该区域满了，新的数据就不能被接收，ICMP 会发出错误信号，这样发送者会减缓传输速率（理想情况下，过段时间就会达到平衡）。
			</div><a
              id="idm140476753902880"
              class="indexterm"></a><a
              id="idm140476753901920"
              class="indexterm"></a><a
              id="idm140476753900992"
              class="indexterm"></a><a
              id="idm140476753900032"
              class="indexterm"></a><a
              id="idm140476754823968"
              class="indexterm"></a><div
              class="para">
				注意，虽然 IPv4 在没有 ICMP 的情况下，仍然能工作；但是，ICMPv6 对于 IPv6 来说是必须的。因为它结合了一些，在 IPv4 的世界中，遍布 ICMPv4 功能，IGMP（<span
                class="emphasis"><em>Internet Group Membership Protocol</em></span>）和 ARP（<span
                class="emphasis"><em>Address Resolution Protocol</em></span>）。 ICMPv6 在 RFC4443 中定义。<div
                class="url">→ <a
                  href="http://www.faqs.org/rfcs/rfc4443.html">http://www.faqs.org/rfcs/rfc4443.html</a></div>
			</div></div><div
            class="para">
			</div><div
            xmlns:d="http://docbook.org/ns/docbook"
            class="itemizedlist"><ul><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">接受（ACCEPT）</code>：允许数据包继续往下走；
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">拒绝（REJECT）</code>：通过 ICMP 错误数据包拒绝（命令 <code
                    class="command">iptables</code> 的<code
                    class="literal">--reject-with <em
                      class="replaceable">type</em></code> 选项可以设定错误类型）；
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">丢弃（DROP）</code>：删除（忽略）数据包；
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">记录（LOG）</code>：记录（通过 <code
                    class="command">syslogd</code>）描述数据包的信息；注意该行为不会中断处理，并且会继续执行链中断的下一条规则，这就为什么记录拒绝数据包既需要记录规则，也需要拒绝／丢弃规则；
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">ULOG</code>：通过 <code
                    class="command">ulogd</code> 记录信息，在处理大量信息时，它比 <code
                    class="command">syslogd</code> 更合适有效；注意该规则，类似 LOG，也会返回到调用链的下一条规则；
					</div></li><li
                class="listitem"><div
                  class="para">
						<em
                    class="replaceable">链名（chain_name）</em>：跳转到指定链并处理其规则；
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">返回</code>：中断当前链的处理过程，并返回调用链；如果当前链是一个标准链，并且没有调用链，默认（有<code
                    class="command">iptables</code>中 <code
                    class="literal">-P</code> 定义）就会执行该链；
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">SNAT</code> (only in the <code
                    class="literal">nat</code> table, therefore only in IPv4 on <span
                    class="distribution distribution">Wheezy</span> — NAT support for IPv6 appeared in the Linux 3.7 kernel): apply <span
                    class="emphasis"><em>Source NAT</em></span> (extra options describe the exact changes to apply);
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">DNAT</code> (only in the <code
                    class="literal">nat</code> table, therefore only in IPv4 on <span
                    class="distribution distribution">Wheezy</span>): apply <span
                    class="emphasis"><em>Destination NAT</em></span> (extra options describe the exact changes to apply);
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">MASQUERADE</code> (only in the <code
                    class="literal">nat</code> table, therefore only in IPv4 on <span
                    class="distribution distribution">Wheezy</span>): apply <span
                    class="emphasis"><em>masquerading</em></span> (a special case of <span
                    class="emphasis"><em>Source NAT</em></span>);
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">REDIRECT</code> (only in the <code
                    class="literal">nat</code> table, therefore only in IPv4 on <span
                    class="distribution distribution">Wheezy</span>): redirect a packet to a given port of the firewall itself; this can be used to set up a transparent web proxy that works with no configuration on the client side, since the client thinks it connects to the recipient whereas the communications actually go through the proxy.
					</div></li></ul></div><div
            class="para">
				其他规则，特别是和 <code
              class="literal">mangle</code> 表相关的，不在本章的范围。 <span
              class="citerefentry"><span
                class="refentrytitle">iptables</span>(8)</span> 和 <span
              class="citerefentry"><span
                class="refentrytitle">ip6tables</span>(8)</span> 有全面的清单介绍。
			</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="sect.iptables"></a>14.2.2. <code
                    class="command">iptables</code> 和 <code
                    class="command">ip6tables</code>语法</h3></div></div></div><div
            class="para">
				<code
              class="command">iptables</code> 和 <code
              class="command">ip6tables</code> 命令允许操作表格，链和规则。<code
              class="literal">-t <em
                class="replaceable">table</em></code> 选项指明要操作哪个表（默认，<code
              class="literal">filter</code>）。
			</div><a
            id="idm140476754785584"
            class="indexterm"></a><a
            id="idm140476754784464"
            class="indexterm"></a><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      id="sect.iptables-command"></a>14.2.2.1. 命令</h4></div></div></div><div
              class="para">
					The <code
                class="literal">-N <em
                  class="replaceable">chain</em></code> option creates a new chain. The <code
                class="literal">-X <em
                  class="replaceable">chain</em></code> deletes an empty and unused chain. The <code
                class="literal">-A <em
                  class="replaceable">chain</em> <em
                  class="replaceable">rule</em></code> adds a rule at the end of the given chain. The <code
                class="literal">-I <em
                  class="replaceable">chain</em> <em
                  class="replaceable">rule_num</em> <em
                  class="replaceable">rule</em></code> option inserts a rule before the rule number <em
                class="replaceable">rule_num</em>. The <code
                class="literal">-D <em
                  class="replaceable">chain</em> <em
                  class="replaceable">rule_num</em></code> (or <code
                class="literal">-D <em
                  class="replaceable">chain</em> <em
                  class="replaceable">rule</em></code>) option deletes a rule in a chain; the first syntax identifies the rule to be deleted by its number, while the latter identifies it by its contents. The <code
                class="literal">-F <em
                  class="replaceable">chain</em></code> option flushes a chain (deletes all its rules); if no chain is mentioned, all the rules in the table are deleted. The <code
                class="literal">-L <em
                  class="replaceable">chain</em></code> option lists the rules in the chain. Finally, the <code
                class="literal">-P <em
                  class="replaceable">chain</em> <em
                  class="replaceable">action</em></code> option defines the default action, or “policy”, for a given chain; note that only standard chains can have such a policy.
				</div></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      id="sect.iptables-rules"></a>14.2.2.2. 规则</h4></div></div></div><a
              id="idm140476754769840"
              class="indexterm"></a><div
              class="para">
					Each rule is expressed as <code
                class="literal"><em
                  class="replaceable">conditions</em> -j <em
                  class="replaceable">action</em> <em
                  class="replaceable">action_options</em></code>. If several conditions are described in the same rule, then the criterion is the conjunction (logical <span
                class="emphasis"><em>and</em></span>) of the conditions, which is at least as restrictive as each individual condition.
				</div><div
              class="para">
					<code
                class="literal">-p <em
                  class="replaceable">protocol</em></code> 条件匹配 IP 数据包的协议区段。最常见的是 <code
                class="literal">tcp</code>，<code
                class="literal">udp</code>，<code
                class="literal">icmp</code>，和 <code
                class="literal">icmpv6</code>。条件之前加上感叹号表示求反，就变成了“除了指定协议之外的任何数据包”。这种求反机制不仅仅适用于 <code
                class="literal">-p</code> 选项，也可用于其它所有条件。
				</div><div
              class="para">
					<code
                class="literal">-s <em
                  class="replaceable">address</em></code> 或 <code
                class="literal">-s <em
                  class="replaceable">network/mask</em></code> 条件匹配数据包的源地址。相应地，<code
                class="literal">-d <em
                  class="replaceable">address</em></code> 或 <code
                class="literal">-d <em
                  class="replaceable">network/mask</em></code> 匹配目的地地址。
				</div><div
              class="para">
					<code
                class="literal">-i <em
                  class="replaceable">interface</em></code> 条件选择源自指定网络接口的数据包。<code
                class="literal">-o <em
                  class="replaceable">interface</em></code> 条件选择从指定接口出去的数据包。
				</div><div
              class="para">
					根据上述的通用条件，可以定义更具体的条件。例如，<code
                class="literal">-p tcp</code> 条件可以和 TCP 端口条件互为补充，就形成例如<code
                class="literal">--source-port <em
                  class="replaceable">port</em></code> 和 <code
                class="literal">--destination-port <em
                  class="replaceable">port</em></code>。
				</div><div
              class="para">
					<code
                class="literal">--state <em
                  class="replaceable">state</em></code> 条件匹配连接中某个状态的数据包（这需要 <code
                class="command">ipt_conntrack</code> 内核模块，用于连接追踪）。<code
                class="literal">新（NEW）</code> 状态指明开启新连接的数据包；<code
                class="literal">建立（ESTABLISHED）</code> 匹配属于已存在连接的数据包；<code
                class="literal">相关（RELATED）</code> 匹配发起与已存在连接相关的数据包（这对处于“活动”模式的 <code
                class="literal">ftp-data</code> 连接是很有用的）。
				</div><div
              class="para">
					前面的段落列出了可用的操作，但是没有相应的选项。例如：<code
                class="literal">记录 LOG</code> 操作，有如下的选项：
				</div><div
              xmlns:d="http://docbook.org/ns/docbook"
              class="itemizedlist"><ul><li
                  class="listitem"><div
                    class="para">
							<code
                      class="literal">--log-priority</code>，默认值 <code
                      class="literal">warning</code>，指明 <code
                      class="command">syslog</code> 消息的优先级；
						</div></li><li
                  class="listitem"><div
                    class="para">
							<code
                      class="literal">--log-prefix</code> 可用来指定不同文字前缀来区分消息；
						</div></li><li
                  class="listitem"><div
                    class="para">
							<code
                      class="literal">--log-tcp-sequence</code>，<code
                      class="literal">--log-tcp-options</code> 和 <code
                      class="literal">--log-ip-options</code> 指定需附加的消息数据：相对应的 TCP 序列号码，TCP 选项，和 IP 选项。
						</div></li></ul></div><div
              class="para">
					The <code
                class="literal">DNAT</code> action provides the <code
                class="literal">--to-destination <em
                  class="replaceable">address</em>:<em
                  class="replaceable">port</em></code> option to indicate the new destination IP address and/or port. Similarly, <code
                class="literal">SNAT</code> provides <code
                class="literal">--to-source <em
                  class="replaceable">address</em>:<em
                  class="replaceable">port</em></code> to indicate the new source IP address and/or port.
				</div><div
              class="para">
					The <code
                class="literal">REDIRECT</code> action (only available if NAT is available — on <span
                class="distribution distribution">Wheezy</span>, this means IPv4 only) provides the <code
                class="literal">--to-ports <em
                  class="replaceable">port(s)</em></code> option to indicate the port, or port range, where the packets should be redirected.
				</div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="sect.creating-rules"></a>14.2.3. 创建规则</h3></div></div></div><div
            class="para">
				每次创建规则需要使用 <code
              class="command">iptables</code>/<code
              class="command">ip6tables</code>命令。手工输入这些命令是繁琐的，可以将调用存储在脚本中，这样机器每次启动后就可以进行同样的自动配置。脚本可以手工输入，但是也可以使用很有趣的高级工具（例如，<code
              class="command">fwbuilder</code>）来准备。
			</div><div
            class="para">
				规则很简单。第一步，列出所有要调用的规则元素：
			</div><div
            xmlns:d="http://docbook.org/ns/docbook"
            class="itemizedlist"><ul><li
                class="listitem"><div
                  class="para">
						防火墙自身以及网络接口；
					</div></li><li
                class="listitem"><div
                  class="para">
						网络，及其相应的 IP 范围；
					</div></li><li
                class="listitem"><div
                  class="para">
						服务器；
					</div></li><li
                class="listitem"><div
                  class="para">
						宿主服务器上服务所使用的端口号。
					</div></li></ul></div><div
            class="para">
				然后可以使用对象拖拽（drag-and-drop）来创建规则。一些上下文菜单可以改变条件（例如，求反）。然后选择操作和配置。
			</div><div
            class="para">
				至于 IPv6，可以为 IPv4 和 IPv6 分别创建规则集，或者只创建一个并使用 <code
              class="command">fwbuilder</code> 来根据赋给对象的地址来转化规则。
			</div><div
            class="figure"><a
              id="figure.fwbuilder"></a><div
              class="figure-contents"><div
                class="mediaobject"><img
                  src="images/fwbuilder.png"
                  alt="Fwbuilder 主窗口" /></div></div><p
              class="title"><strong>图 14.2. Fwbuilder 主窗口</strong></p></div><a
            id="idm140476744373184"
            class="indexterm"></a><div
            class="para">
				<code
              class="command">fwbuilder</code> can then generate a script configuring the firewall according to the rules that have been defined. Its modular architecture gives it the ability to generate scripts targeting different systems (<code
              class="command">iptables</code> for Linux, <code
              class="command">ipf</code> for FreeBSD and <code
              class="command">pf</code> for OpenBSD).
			</div><div
            class="para">
				自从 <span
              class="distribution distribution">Squeeze</span> 之后的版本 <span
              class="pkg pkg">fwbuilder</span> 软件包中都包含了图形界面和每种防火墙系统的模块（之前这些模块被分割成多个软件包，每种目标系统一个）：
			</div><pre
            class="screen">
<code
              class="computeroutput"># </code><strong
              class="userinput"><code>aptitude install fwbuilder</code></strong></pre></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="sect.install-rules-at-boot"></a>14.2.4. 每次启动时加载规则</h3></div></div></div><div
            class="para">
				如果防火墙准备用于间歇性的 PPP 网络连接，最简单的方法就是将脚本作为 <code
              class="filename">/etc/ppp/ip-up.d/0iptables</code> 安装（注意文件名中不包含点的文件才会起作用）。这样每次 PPP 连接之后防火墙就会被从新加载。
			</div><div
            class="para">
				其他情况下，推荐的方法是将配置脚本在 <code
              class="literal">up</code> 目录下作为 <code
              class="filename">/etc/network/interfaces</code> 文件。在后面的例子中，脚本存储在 <code
              class="filename">/usr/local/etc/arrakis.fw</code>。
			</div><div
            class="example"><a
              id="example.network-interfaces-firewall"></a><p
              class="title"><strong>例 14.1. <code
                  class="filename">接口（interfaces）</code> 文件调用防火墙脚本</strong></p><div
              class="example-contents"><pre
                class="programlisting">auto eth0
iface eth0 inet static
    address 192.168.0.1
    network 192.168.0.0
    netmask 255.255.255.0
    broadcast 192.168.0.255
    up /usr/local/etc/arrakis.fw
</pre></div></div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="security.html"><strong>上一页</strong>第 14 章 安全</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>上一级</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>起始页</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.supervision.html"><strong>下一页</strong>14.3. 监督：预防，检测，威慑</a></li></ul><div
        id="translated_pages"><ul><li><a
              href="../ar-MA/sect.firewall-packet-filtering.html">ar-MA</a></li><li><a
              href="../da-DK/sect.firewall-packet-filtering.html">da-DK</a></li><li><a
              href="../de-DE/sect.firewall-packet-filtering.html">de-DE</a></li><li><a
              href="../el-GR/sect.firewall-packet-filtering.html">el-GR</a></li><li><a
              href="../en-US/sect.firewall-packet-filtering.html">en-US</a></li><li><a
              href="../es-ES/sect.firewall-packet-filtering.html">es-ES</a></li><li><a
              href="../fa-IR/sect.firewall-packet-filtering.html">fa-IR</a></li><li><a
              href="../fr-FR/sect.firewall-packet-filtering.html">fr-FR</a></li><li><a
              href="../hr-HR/sect.firewall-packet-filtering.html">hr-HR</a></li><li><a
              href="../id-ID/sect.firewall-packet-filtering.html">id-ID</a></li><li><a
              href="../it-IT/sect.firewall-packet-filtering.html">it-IT</a></li><li><a
              href="../ja-JP/sect.firewall-packet-filtering.html">ja-JP</a></li><li><a
              href="../pl-PL/sect.firewall-packet-filtering.html">pl-PL</a></li><li><a
              href="../pt-BR/sect.firewall-packet-filtering.html">pt-BR</a></li><li><a
              href="../ro-RO/sect.firewall-packet-filtering.html">ro-RO</a></li><li><a
              href="../ru-RU/sect.firewall-packet-filtering.html">ru-RU</a></li><li><a
              href="../tr-TR/sect.firewall-packet-filtering.html">tr-TR</a></li><li><a
              href="../zh-CN/sect.firewall-packet-filtering.html">zh-CN</a></li></ul></div></body></html>
