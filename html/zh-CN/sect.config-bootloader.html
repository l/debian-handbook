<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">8.8. 配置 Bootloader</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-9-zh-CN-1.0-1" /><meta
        name="keywords"
        content="配置, 本地化, 地区设置, 网络, 名称解析, 用户, 用户组, 账户, 命令行解释器, Shell, 打印, Bootloader, 内核编译" /><link
        rel="home"
        href="index.html"
        title="Debian 管理员手册" /><link
        rel="up"
        href="basic-configuration.html"
        title="第 8 章 基础配置：网络，账户，打印……" /><link
        rel="prev"
        href="sect.config-printing.html"
        title="8.7. 打印机配置" /><link
        rel="next"
        href="sect.config-misc.html"
        title="8.9. 其他配置：时间同步、记录、共享近用…" /><meta
        name="viewport"
        content="width=device-width, initial-scale=1" /><meta
        name="flattr:id"
        content="4pz9jq" /><link
        rel="canonical"
        href="http://l.github.io/debian-handbook/html/zh-CN/sect.config-bootloader.html" /></head><body><noscript><iframe
          src="//www.googletagmanager.com/ns.html?id=GTM-5H35QX"
          height="0"
          width="0"
          style="display:none;visibility:hidden"></iframe></noscript><script
        type="text/javascript">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&amp;l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5H35QX');</script><div
        id="banner"><a
          href="../../"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="index.html"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="sect.config-printing.html"><strong>上一页</strong></a></li><li
          class="home">Debian 管理员手册</li><li
          class="next"><a
            accesskey="n"
            href="sect.config-misc.html"><strong>下一页</strong></a></li></ul><div
        class="section"><div
          class="titlepage"><div><div><h2
                class="title"><a
                  id="sect.config-bootloader"></a>8.8. 配置 Bootloader</h2></div></div></div><a
          id="id-1.11.12.2"
          class="indexterm"></a><a
          id="id-1.11.12.3"
          class="indexterm"></a><div
          class="para">
			或许已经运作了，但最好知道如何配置与安装加载启动器，万一它不在 Master Boot Record 中。安装 Windows 等其他操作系统后，很可能出现这种情况。以下的信息在必要时可协助修改加载启动器配置。
		</div><div
          class="sidebar"><div
            class="titlepage"><div><div><p
                  class="title"><strong><span
                      class="emphasis"><em>基本</em></span> Master boot record</strong></p></div></div></div><a
            id="id-1.11.12.5.2"
            class="indexterm"></a><a
            id="id-1.11.12.5.3"
            class="indexterm"></a><div
            class="para">
			主引导记录 (Master Boot Record, MBR) 位于第一颗磁盘的最前方 512 字节，首先被 BIOS 加载，再启动操作系统。一般来说，由主引导记录安装启动程序，移除稍早的内容。
		</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="sect.identify-disks"></a>8.8.1. 辨识磁盘</h3></div></div></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>文化</em></span> <span
                        class="emphasis"><em>udev</em></span> 与 <code
                        class="filename">/dev/</code></strong></p></div></div></div><div
              class="para">
				<code
                class="filename">/dev/</code> 文件夹习惯保存被称为 “特殊的” 文件，用于代表系统的周边设备 (见专栏 <a
                class="xref"
                href="sect.creating-accounts.html#sidebar.special-files"><span
                  class="emphasis"><em>基本</em></span> 设备访问权限</a>)。曾经纳入所有可能用到的特殊文件。这种处理方式有若干缺点，限制设备数量是其中之一，每种设备只能有一个 (因为清单名称被限制)，且不可能知道实际上该用那个特殊文件。
			</div><div
              class="para">
				如今，以动态方式管理特殊的文件，并且更适合热切换的电脑设备。核心与 <span
                class="emphasis"><em>udev</em></span> 合作在需要的时候添加与删除文件以映射出现或消失的设备。所以，<code
                class="filename">/dev/</code> 不需要维持不变，反而采用 RAM 保存的文件系统清除或纳入相关的条目。
			</div><div
              class="para">
				核心与添加的设备沟通，并发给主要/次要号码以供辨识。以 <code
                class="command">udevd</code> 命令可以添加特殊的文件并授权使用它。也可添加别名运行其他的工作 (诸如初始化或登录工作)。<code
                class="command">udevd</code> 命令的行为由一组 (可客制化) 的规则驱动。
			</div><div
              class="para">
				动态给予名称，就能够让同名称永远指向特定设备，不必在意链接的设备或顺序，尤其在使用 USB 周边时更为便利。第一个磁盘的第一个区块称为 <code
                class="filename">/dev/sda1</code> 可供向后兼容，喜欢的话也可称为 <code
                class="filename">/dev/root-partition</code>，或两者共用，因为 <code
                class="command">udevd</code> 可以配置成自动添加符号链接。
			</div><div
              class="para">
				过去在需要进入特定设备文件时，部分的核心模块无法自动加载。现在情况已变了，周边设备的特殊文件于加载模块时才会存在；所以问题不大，受惠于自动侦测硬件，大部分模块都可于启动时加载。但对于侦测不到的周边 (诸如极旧的磁盘机或 PS/2 鼠标)，则无效。在此情况下，就需添加 <code
                class="literal">floppy</code>、<code
                class="literal">psmouse</code> 与 <code
                class="literal">mousedev</code> 等模块至 <code
                class="filename">/etc/modules</code> 才能于启动时强迫加载。
			</div></div><a
            id="id-1.11.12.6.3"
            class="indexterm"></a><a
            id="id-1.11.12.6.4"
            class="indexterm"></a><div
            class="para">
				配置启动程序必须辨认硬盘及其分区。Linux 使用 “block” 特殊文件保存在 <code
              class="filename">/dev/</code> 文件夹内。因为 Debian <span
              class="distribution distribution">Squeeze</span> 版本使用源自 Linux 核心的硬盘命名架构，所有的硬盘 (IDE/PATA、SATA、SCSI、USB、IEEE 1394) 都以 <code
              class="filename">/dev/sd*</code> 表示。
			</div><div
            class="para">
				每个分区由其磁盘代号表示：如，<code
              class="filename">/dev/sda1</code> 是第一个磁盘的第一个分区，而 <code
              class="filename">/dev/sdb3</code> 是第二个磁盘的第三个分区。
			</div><a
            id="id-1.11.12.6.7"
            class="indexterm"></a><a
            id="id-1.11.12.6.8"
            class="indexterm"></a><a
            id="id-1.11.12.6.9"
            class="indexterm"></a><a
            id="id-1.11.12.6.10"
            class="indexterm"></a><div
            class="para">
				PC 架构 (或 “i386”，包括新出现的 “amd64”) 不再受限于使用 “MS-DOS” 分区表格式，每个磁盘可以拥有超过 4 个 “主要” 分区。在此架构下要超过此限制，必须添加 “延伸” 分区，然后就能使用添加的 “次要” 分区。这些次要分区由 5 开始编号。所以，第一个磁盘的次要分区可以是 <code
              class="filename">/dev/sda5</code>，然后是 <code
              class="filename">/dev/sda6</code>，余此类推。
			</div><div
            class="para">
				MS-DOS 分区表格式的另个限制是磁盘的容量不能超过 2 TiB，成为当代磁盘的真正问题。
			</div><a
            id="id-1.11.12.6.13"
            class="indexterm"></a><a
            id="id-1.11.12.6.14"
            class="indexterm"></a><div
            class="para">
				GPT 是新的分区表格式，解放对区分数的限制 (标准方式最多可以设置 128 个区分) 以及磁盘容量的限制 (最多达 8 ZiB，超过 8 百万兆字节)。若想在一个磁盘切出多个实体区分，必须以 GPT 格式添加分区表。
			</div><div
            class="para">
				不容易记得磁盘挂在 SATA 控制卡的位置，或在 SCSI 链的第三个位置，尤其是热插拔硬式磁盘机 (包括 SATA 磁盘与插件磁盘) 可改变开机的位置。还好，<code
              class="command">udev</code> 以固定的名称，添加 <code
              class="filename">/dev/sd*</code> 以外的符号链接，就能够轻易的辨识硬式磁盘机。这种符号链接保存在 <code
              class="filename">/dev/disk/by-id</code> 之内。例如，在两个实体磁盘的机器，可以找到如下的消息：
			</div><pre
            class="screen"><code
              class="computeroutput">mirexpress:/dev/disk/by-id# </code><strong
              class="userinput"><code>ls -l
</code></strong><code
              class="computeroutput">total 0
lrwxrwxrwx 1 root root  9 23 jul. 08:58 ata-STM3500418AS_9VM3L3KP -&gt; ../../sda
lrwxrwxrwx 1 root root 10 23 jul. 08:58 ata-STM3500418AS_9VM3L3KP-part1 -&gt; ../../sda1
lrwxrwxrwx 1 root root 10 23 jul. 08:58 ata-STM3500418AS_9VM3L3KP-part2 -&gt; ../../sda2
[...]
lrwxrwxrwx 1 root root  9 23 jul. 08:58 ata-WDC_WD5001AALS-00L3B2_WD-WCAT00241697 -&gt; ../../sdb
lrwxrwxrwx 1 root root 10 23 jul. 08:58 ata-WDC_WD5001AALS-00L3B2_WD-WCAT00241697-part1 -&gt; ../../sdb1
lrwxrwxrwx 1 root root 10 23 jul. 08:58 ata-WDC_WD5001AALS-00L3B2_WD-WCAT00241697-part2 -&gt; ../../sdb2
[...]
lrwxrwxrwx 1 root root  9 23 jul. 08:58 scsi-SATA_STM3500418AS_9VM3L3KP -&gt; ../../sda
lrwxrwxrwx 1 root root 10 23 jul. 08:58 scsi-SATA_STM3500418AS_9VM3L3KP-part1 -&gt; ../../sda1
lrwxrwxrwx 1 root root 10 23 jul. 08:58 scsi-SATA_STM3500418AS_9VM3L3KP-part2 -&gt; ../../sda2
[...]
lrwxrwxrwx 1 root root  9 23 jul. 08:58 scsi-SATA_WDC_WD5001AALS-_WD-WCAT00241697 -&gt; ../../sdb
lrwxrwxrwx 1 root root 10 23 jul. 08:58 scsi-SATA_WDC_WD5001AALS-_WD-WCAT00241697-part1 -&gt; ../../sdb1
lrwxrwxrwx 1 root root 10 23 jul. 08:58 scsi-SATA_WDC_WD5001AALS-_WD-WCAT00241697-part2 -&gt; ../../sdb2
[...]
lrwxrwxrwx 1 root root  9 23 jul. 16:48 usb-LaCie_iamaKey_3ed00e26ccc11a-0:0 -&gt; ../../sdc
lrwxrwxrwx 1 root root 10 23 jul. 16:48 usb-LaCie_iamaKey_3ed00e26ccc11a-0:0-part1 -&gt; ../../sdc1
lrwxrwxrwx 1 root root 10 23 jul. 16:48 usb-LaCie_iamaKey_3ed00e26ccc11a-0:0-part2 -&gt; ../../sdc2
[...]
lrwxrwxrwx 1 root root  9 23 jul. 08:58 wwn-0x5000c50015c4842f -&gt; ../../sda
lrwxrwxrwx 1 root root 10 23 jul. 08:58 wwn-0x5000c50015c4842f-part1 -&gt; ../../sda1
[...]
mirexpress:/dev/disk/by-id# </code></pre><div
            class="para">
				同颗磁盘出现多次 (因为它们同时做为 ATA 磁盘与 SCSI 磁盘)，但是根据磁盘的型号与序号等相关信息，就可找到对应的周边设备文件。
			</div><div
            class="para">
				下节的配置档根据同样的设置而来：一个 SATA 磁盘，第一个区分是安装旧型的窗口、第二个分区安装 Debian GNU/Linux。
			</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="sect.config-lilo"></a>8.8.2. 配置 LILO</h3></div></div></div><a
            id="id-1.11.12.7.2"
            class="indexterm"></a><a
            id="id-1.11.12.7.3"
            class="indexterm"></a><div
            class="para">
				<span
              class="emphasis"><em>LILO</em></span> (Linux 启动程序, LInux LOader) 是最旧的启动程序 — 稳定但粗糙。把核心的实体地址写入 MBR 的启动，所以每次更新至 LILO (或其配置文件) 都必须再运行命令 <code
              class="command">lilo</code>。忘记的话，移除或更新核心后，新的核心就不会在磁盘的原来位置，以致系统无法启动。
			</div><div
            class="para">
				LILO 的配置档是 <code
              class="filename">/etc/lilo.conf</code>；一个简单的文件供标准配置之用，如下例。
			</div><div
            class="example"><a
              id="example.lilo.conf"></a><p
              class="title"><strong>例 8.4. LILO 配置文件</strong></p><div
              class="example-contents"><pre
                class="programlisting">
# The disk on which LILO should be installed.
# By indicating the disk and not a partition.
# you order LILO to be installed on the MBR.
boot=/dev/sda
# the partition that contains Debian
root=/dev/sda2
# the item to be loaded by default
default=Linux

# the most recent kernel image
image=/vmlinuz
  label=Linux
  initrd=/initrd.img
  read-only

# Old kernel (if the newly installed kernel doesn't boot)
image=/vmlinuz.old
  label=LinuxOLD
  initrd=/initrd.img.old
  read-only
  optional

# only for Linux/Windows dual boot
other=/dev/sda1
  label=Windows</pre></div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="sect.config-grub"></a>8.8.3. GRUB 2 配置</h3></div></div></div><a
            id="id-1.11.12.8.2"
            class="indexterm"></a><a
            id="id-1.11.12.8.3"
            class="indexterm"></a><div
            class="para">
				<span
              class="emphasis"><em>GRUB</em></span> (GRand Unified Bootloader) 是最近的事。更新核心后不必再启动它；<span
              class="emphasis"><em>GRUB</em></span> 知道如何读取文件系统并找到核心在磁盘的位置。键入 <code
              class="command">grub-install /dev/sda</code> 命令就能够把它安装在第一个磁盘的 MBR。<a
              id="id-1.11.12.8.4.4"
              class="indexterm"></a>
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>说明</em></span> GRUB 的磁盘名称</strong></p></div></div></div><div
              class="para">
				GRUB 只能根据 BIOS 提供的信息辨识硬式磁盘机。<code
                class="literal">(hd0)</code> 对应侦测到的第一个磁盘、<code
                class="literal">(hd1)</code> 第二个磁盘等。大部分的情况下，此顺序刚好是 Linux 的磁盘顺序，同时使用 SCSI 与 IDE 磁盘时就出问题。GRUB 把侦测到的信息保存在 <code
                class="filename">/boot/grub/device.map</code> 文件内。若在此发现错误 (因为已知 BIOS 以不同的顺序侦测到磁盘)，再次运行 <code
                class="command">grub-install</code> 命令。<code
                class="command">grub-mkdevicemap</code> 命令可添加 <code
                class="filename">device.map</code> 文件。
			</div><div
              class="para">
				区分表在 GRUB 内也有特定的名称。通常使用 MS-DOS 格式的 “经典” 区分，第一个磁盘的第一个分区标记为 <code
                class="literal">(hd0,msdos1)</code>、第二个分区标记为 <code
                class="literal">(hd0,msdos2)</code>，余此类推。
			</div></div><div
            class="para">
				GRUB 2 configuration is stored in <code
              class="filename">/boot/grub/grub.cfg</code>, but this file (in Debian) is generated from others. Be careful not to modify it by hand, since such local modifications will be lost the next time <code
              class="command">update-grub</code> is run (which may occur upon update of various packages). The most common modifications of the <code
              class="filename">/boot/grub/grub.cfg</code> file (to add command line parameters to the kernel or change the duration that the menu is displayed, for example) are made through the variables in <code
              class="filename">/etc/default/grub</code>. To add entries to the menu, you can either create a <code
              class="filename">/boot/grub/custom.cfg</code> file or modify the <code
              class="filename">/etc/grub.d/40_custom</code> file. For more complex configurations, you can modify other files in <code
              class="filename">/etc/grub.d</code>, or add to them; these scripts should return configuration snippets, possibly by making use of external programs. These scripts are the ones that will update the list of kernels to boot: <code
              class="filename">10_linux</code> takes into consideration the installed Linux kernels; <code
              class="filename">20_linux_xen</code> takes into account Xen virtual systems, and <code
              class="filename">30_os-prober</code> lists other operating systems (Windows, OS X, Hurd).
			</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="sect.config-yaboot"></a>8.8.4. Macintosh 电脑 (PowerPC)：配置 Yaboot</h3></div></div></div><a
            id="id-1.11.12.9.2"
            class="indexterm"></a><div
            class="para">
				Yaboot 是使用 PowerPC 芯片的旧型 Macintosh 电脑用到的启动程序。它的启动方式不同于 PC，采用 “引导” 分区法，从 BIOS (或 OpenFirmware) 运行启动程序，然后由 <code
              class="command">ybin</code> 程序安装 <code
              class="command">yaboot</code> 及其配置档。修改 <code
              class="filename">/etc/yaboot.conf</code> 文件后 (在启动程序分区复制，且 <code
              class="command">yaboot</code> 知道如何到磁盘找寻核心的位置)，需再次运行此命令。
			</div><div
            class="para">
				运行 <code
              class="command">ybin</code> 之前，应有合法的 <code
              class="filename">/etc/yaboot.conf</code> 程序。以下的最小配置的范例。<a
              id="id-1.11.12.9.4.3"
              class="indexterm"></a>
			</div><div
            class="example"><a
              id="example.yaboot.conf"></a><p
              class="title"><strong>例 8.5. Yaboot 配置文件</strong></p><div
              class="example-contents"><pre
                class="programlisting">
# bootstrap partition
boot=/dev/sda2
# the disk
device=hd:
# the Linux partition
partition=3
root=/dev/sda3
# boot after 3 seconds of inactivity
# (timeout is in tenths of seconds)
timeout=30

install=/usr/lib/yaboot/yaboot
magicboot=/usr/lib/yaboot/ofboot
enablecdboot

# last kernel installed
image=/vmlinux
        label=linux
        initrd=/initrd.img
        read-only

# old kernel
image=/vmlinux.old
        label=old
        initrd=/initrd.img.old
        read-only

# only for Linux/Mac OSX dual-boot
macosx=/dev/sda5

# bsd=/dev/sdaX and macos=/dev/sdaX
# are also possible</pre></div></div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="sect.config-printing.html"><strong>上一页</strong>8.7. 打印机配置</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>上一级</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>起始页</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.config-misc.html"><strong>下一页</strong>8.9. 其他配置：时间同步、记录、共享近用…</a></li></ul><div
        id="translated_pages"><ul><li><a
              href="../ar-MA/sect.config-bootloader.html">ar-MA</a></li><li><a
              href="../da-DK/sect.config-bootloader.html">da-DK</a></li><li><a
              href="../de-DE/sect.config-bootloader.html">de-DE</a></li><li><a
              href="../el-GR/sect.config-bootloader.html">el-GR</a></li><li><a
              href="../en-US/sect.config-bootloader.html">en-US</a></li><li><a
              href="../es-ES/sect.config-bootloader.html">es-ES</a></li><li><a
              href="../fa-IR/sect.config-bootloader.html">fa-IR</a></li><li><a
              href="../fr-FR/sect.config-bootloader.html">fr-FR</a></li><li><a
              href="../hr-HR/sect.config-bootloader.html">hr-HR</a></li><li><a
              href="../id-ID/sect.config-bootloader.html">id-ID</a></li><li><a
              href="../it-IT/sect.config-bootloader.html">it-IT</a></li><li><a
              href="../ja-JP/sect.config-bootloader.html">ja-JP</a></li><li><a
              href="../ko-KR/sect.config-bootloader.html">ko-KR</a></li><li><a
              href="../nb-NO/sect.config-bootloader.html">nb-NO</a></li><li><a
              href="../pl-PL/sect.config-bootloader.html">pl-PL</a></li><li><a
              href="../pt-BR/sect.config-bootloader.html">pt-BR</a></li><li><a
              href="../ro-RO/sect.config-bootloader.html">ro-RO</a></li><li><a
              href="../ru-RU/sect.config-bootloader.html">ru-RU</a></li><li><a
              href="../tr-TR/sect.config-bootloader.html">tr-TR</a></li><li><a
              href="../vi-VN/sect.config-bootloader.html">vi-VN</a></li><li><a
              href="../zh-CN/sect.config-bootloader.html">zh-CN</a></li><li><a
              href="../zh-TW/sect.config-bootloader.html">zh-TW</a></li></ul></div></body></html>
