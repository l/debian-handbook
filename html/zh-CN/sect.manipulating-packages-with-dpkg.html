<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">5.4. 通过dpkg来操作软件包</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-9-zh-CN-1.0-1" /><meta
        name="keywords"
        content="二进制包, 源码包, dpkg, 依赖, 冲突" /><link
        rel="home"
        href="index.html"
        title="Debian 管理员手册" /><link
        rel="up"
        href="packaging-system.html"
        title="第 5 章 包管理系统：工具和基本原则" /><link
        rel="prev"
        href="sect.source-package-structure.html"
        title="5.3. 源软件包的结构" /><link
        rel="next"
        href="sect.coexistence-with-other-packaging-systems.html"
        title="5.5. 与其它软件包共存" /><meta
        name="viewport"
        content="width=device-width, initial-scale=1" /><meta
        name="flattr:id"
        content="4pz9jq" /><link
        rel="canonical"
        href="http://l.github.io/debian-handbook/html/zh-CN/sect.manipulating-packages-with-dpkg.html" /></head><body><noscript><iframe
          src="//www.googletagmanager.com/ns.html?id=GTM-5H35QX"
          height="0"
          width="0"
          style="display:none;visibility:hidden"></iframe></noscript><script
        type="text/javascript">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&amp;l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5H35QX');</script><div
        id="banner"><a
          href="../../"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="index.html"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="sect.source-package-structure.html"><strong>上一页</strong></a></li><li
          class="home">Debian 管理员手册</li><li
          class="next"><a
            accesskey="n"
            href="sect.coexistence-with-other-packaging-systems.html"><strong>下一页</strong></a></li></ul><div
        class="section"><div
          class="titlepage"><div><div><h2
                class="title"><a
                  id="sect.manipulating-packages-with-dpkg"></a>5.4. 通过<code
                  class="command">dpkg</code>来操作软件包</h2></div></div></div><a
          id="id-1.8.8.2"
          class="indexterm"></a><div
          class="para">
			<code
            class="command">dpkg</code> 是系统层面处理 Debian 软件包的基础指令。若您有 <code
            class="filename">.deb</code> 软件包，可以用 <code
            class="command">dpkg</code> 安装及分析其内容。但此指令只能看到 Debian 世界的部分内容：它知道系统安装那些软件包、指令列给了那些参数，但不知道还有那些可用的软件包。因此，没有相依性就完了。<code
            class="command">apt</code> 之类的工具，则可产生相依性清单，尽量自动安装软件包。
		</div><div
          class="sidebar"><div
            class="titlepage"><div><div><p
                  class="title"><strong><span
                      class="emphasis"><em>说明</em></span> <code
                      class="command">dpkg</code> 或 <code
                      class="command">apt</code>?</strong></p></div></div></div><div
            class="para">
			<code
              class="command">dpkg</code> 应视为系统工具 (背景) 之一，而 <code
              class="command">apt</code> 则是较倾向用户的工具，可克服前者的限制。这些工具各有其限制，共同解决特定的作业。
		</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="id-1.8.8.5"></a>5.4.1. 安装软件包</h3></div></div></div><a
            id="id-1.8.8.5.2"
            class="indexterm"></a><a
            id="id-1.8.8.5.3"
            class="indexterm"></a><div
            class="para">
				首先，<code
              class="command">dpkg</code> 是安装 Debian 已经可用软件包的工具 (因为不需下载任何东西)。我们使用它的 <code
              class="literal">-i</code> 或 <code
              class="literal">--install</code> 选项。
			</div><div
            class="example"><a
              id="id-1.8.8.5.5"></a><p
              class="title"><strong>例 5.2. 通过<code
                  class="command">dpkg</code>来安装一个软件包</strong></p><div
              class="example-contents"><pre
                class="screen scale">
<code
                  class="computeroutput"># </code><strong
                  class="userinput"><code>dpkg -i man-db_2.7.6.1-2_amd64.deb</code></strong>
<code
                  class="computeroutput">(Reading database ... 110431 files and directories currently installed.)
Preparing to unpack man-db_2.7.6.1-2_amd64.deb ...
Unpacking man-db (2.7.6.1-2) over (2.7.6.1-1) ...
Setting up man-db (2.7.6.1-2) ...
Updating database of manual pages ...
Processing triggers for mime-support (3.60) ...</code></pre></div></div><div
            class="para">
				通过<code
              class="command">dpkg</code>我们可以看到安装时的不同步骤；因此我们会知道在什么时候可能会发生错误。安装也被分为两个阶段：首先解压包，然后配置它。<code
              class="command">apt-get</code>会利用这一点，然后有限的调用<code
              class="command">dpkg</code>（因为每次调用都要把数据加载到内存中，特别是那些在名单中已经被安装的文件）。
			</div><div
            class="example"><a
              id="id-1.8.8.5.7"></a><p
              class="title"><strong>例 5.3. 分开解压和配置</strong></p><div
              class="example-contents"><pre
                class="screen scale">
<code
                  class="computeroutput"># </code><strong
                  class="userinput"><code>dpkg --unpack man-db_2.7.6.1-2_amd64.deb</code></strong>
<code
                  class="computeroutput">(Reading database ... 110431 files and directories currently installed.)
Preparing to unpack man-db_2.7.6.1-2_amd64.deb ...
Unpacking man-db (2.7.6.1-2) over (2.7.6.1-2) ...
Processing triggers for mime-support (3.60) ...
# </code><strong
                  class="userinput"><code>dpkg --configure man-db</code></strong>
<code
                  class="computeroutput">Setting up man-db (2.7.6.1-2) ...
Updating database of manual pages ...
</code></pre></div></div><a
            id="id-1.8.8.5.8"
            class="indexterm"></a><a
            id="id-1.8.8.5.9"
            class="indexterm"></a><div
            class="para">
				有时<code
              class="command">dpkg</code>在安装软件包的时候会失败并且返回一个错误；如果用户命令dpkg忽略掉这个错误，那么它仅仅会提示一个警告；这也就是我们有一个不同的<code
              class="literal">--force--*</code>选项。<code
              class="command">dpkg --force-help</code>，或者是dpkg的帮助文档，有一个这些选项的详细清单。最常见的错误是，你迟到会遇到这样一个文件冲突，当一个软件包包含的文件中已经安装了另外一个软件包。:
			</div><pre
            class="screen">
<code
              class="computeroutput">Unpacking libgdm (from .../libgdm_3.8.3-2_amd64.deb) ...
dpkg: 处理 /var/cache/apt/archives/libgdm_3.8.3-2_amd64.deb (--unpack) 时发生错误:
 试图覆写 '/usr/bin/gdmflexiserver'，也同时在软件包 gdm3 3.4.1-9 内</code></pre><div
            class="para">
				在这种情况下，如果你认为文件替换该文件可能不会对系统的稳定性造成重大的风险（通常情况下），你可以使用<code
              class="literal">--force-overwrite</code>选项来告诉<code
              class="command">dpkg</code>去忽略这个错误并且覆盖该文件。
			</div><div
            class="para">
				当然这里有非常多的<code
              class="literal">--force-*</code>选项，只是<code
              class="literal">--force-overwrite</code>使用的非常频繁。这些选项仅存在特殊的情况下，所以最好是不去使用它们以便遵守软件包的管理机制。不要忘了，这些管理规则可以确保你的系统的稳定性和一致性。
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>注意</em></span> 使用<code
                        class="literal">--force-*</code>的影响</strong></p></div></div></div><a
              id="id-1.8.8.5.14.2"
              class="indexterm"></a><div
              class="para">
				若不小心使用 <code
                class="literal">--force-*</code> 的选项，可能造成 APT 命令家族拒绝运作的困境。在相依性不足或冲突的情况下，使用部分选项后，仍可安装该等软件包。结果就是相依性不足的不一致系统，APT 命令将拒绝运行任何工作，直到系统恢复一致 (通常包括安装遗失的相依软件包或移除问题软件包)。通常出现以下的消息，安装新版 <span
                class="pkg pkg">rdesktop</span> 时忽略其对新版 <span
                class="pkg pkg">libc6</span> 的相依性：
			</div><pre
              class="screen"><code
                class="computeroutput"># </code><strong
                class="userinput"><code>apt full-upgrade
</code></strong><code
                class="computeroutput">[...]
You might want to run 'apt-get -f install' to correct these.
The following packages have unmet dependencies:
  rdesktop: Depends: libc6 (&gt;= 2.5) but 2.3.6.ds1-13etch7 is installed
E: Unmet dependencies. Try using -f.</code></pre><div
              class="para">
				确信其分析结果的勇敢管理者，可能选择忽略使用 <code
                class="literal">--force-*</code> 选项时发生的相依性问题与冲突。结果是，想要继续使用 <code
                class="command">apt</code> 或 <code
                class="command">aptitude</code> 的话，他们必须先编辑 <code
                class="filename">/var/lib/dpkg/status</code> 以删除/修改相依性问题或冲突。
			</div><div
              class="para">
				这是一种丑陋的黑客行为，除了极为必要的情况，否则不该发生。比较常见的手法是，重新编译有问题的软件包 (见 <a
                class="xref"
                href="debian-packaging.html#sect.rebuilding-package">第 15.1 节 “从源码重建安装包”</a>) 或从 <code
                class="literal">stable-backports</code> 里 (see <a
                class="xref"
                href="apt.html#sect.backports">第 6.1.2.4 节 “向后移植到稳定版(Stable Backports)”</a>)，使用新版本 (可能已修复该问题) 的软件包。
			</div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="id-1.8.8.6"></a>5.4.2. 软件包移除</h3></div></div></div><a
            id="id-1.8.8.6.2"
            class="indexterm"></a><a
            id="id-1.8.8.6.3"
            class="indexterm"></a><a
            id="id-1.8.8.6.4"
            class="indexterm"></a><a
            id="id-1.8.8.6.5"
            class="indexterm"></a><div
            class="para">
				使用 <code
              class="command">dpkg</code> 加上 <code
              class="literal">-r</code> 或 <code
              class="literal">--remove</code> 选项，再加上软件包名称，就可移除该软件包。然而，这种方式的移除并不完整：仍保留所有的配置文件、维护脚本、记录文件 (系统记录档) 及该软件包的其他用户数据。这种方式是停用程序，仍可以相同的配置快速地再安装回来。完全移除该软件包的所有相关文件，应使用 <code
              class="literal">-P</code> 或 <code
              class="literal">--purge</code> 选项，再加上软件包名称。
			</div><div
            class="example"><a
              id="id-1.8.8.6.7"></a><p
              class="title"><strong>例 5.4. 移除与清除 <span
                  class="pkg pkg">debian-cd</span> 软件包</strong></p><div
              class="example-contents"><pre
                class="screen"><code
                  class="computeroutput"># </code><strong
                  class="userinput"><code>dpkg -r debian-cd</code></strong>
<code
                  class="computeroutput">(Reading database ... 112188 files and directories currently installed.)
Removing debian-cd (3.1.20) ...
# </code><strong
                  class="userinput"><code>dpkg -P debian-cd</code></strong>
<code
                  class="computeroutput">(Reading database ... 111613 files and directories currently installed.)
Purging configuration files for debian-cd (3.1.20) ...
</code></pre></div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="id-1.8.8.7"></a>5.4.3. 查询 <code
                    class="command">dpkg</code> 的数据库，并检查 <code
                    class="filename">.deb</code> 文件</h3></div></div></div><a
            id="id-1.8.8.7.2"
            class="indexterm"></a><a
            id="id-1.8.8.7.3"
            class="indexterm"></a><a
            id="id-1.8.8.7.4"
            class="indexterm"></a><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>回到基础</em></span> 选项的语法</strong></p></div></div></div><div
              class="para">
				“长” 版 (一个或多个字，前置两个链接号) 与 “短” 版 (一个字母，通常是长版字的第一个字母，前置一个链接号) 软件包都有该等选项。这是 POSIX 标准常见的用法。
			</div></div><div
            class="para">
				做结论前，我们将学习查找内部数据库以获取信息的 <code
              class="command">dpkg</code> 选项。先给长版的选项再给对应的短版选项 (其参数是一样的) 以 <code
              class="literal">--listfiles <em
                class="replaceable">软件包</em></code> (或 <code
              class="literal">-L</code>) 为例，列出该软件包安装的文件清单；<code
              class="literal">--search <em
                class="replaceable">文件</em></code> (或 <code
              class="literal">-S</code>)，寻找包括该文件的套性；<code
              class="literal">--status <em
                class="replaceable">软件包</em></code> (或 <code
              class="literal">-s</code>)，显示该软件包的标头；<code
              class="literal">--list</code> (或 <code
              class="literal">-l</code>)，显示该系统内软件包清单与安装状态；<code
              class="literal">--contents <em
                class="replaceable">file.deb</em></code> (或 <code
              class="literal">-c</code>)，列出 Debian 指定软件包清单；<code
              class="literal">--info<em
                class="replaceable"> file.deb </em></code> (或 <code
              class="literal">-I</code>)，列出该软件包的标头。
			</div><div
            class="example"><a
              id="id-1.8.8.7.7"></a><p
              class="title"><strong>例 5.5. <code
                  class="command">dpkg</code>的各种查询</strong></p><div
              class="example-contents"><pre
                class="screen scale"
                width="80">
<code
                  class="computeroutput">$ </code><strong
                  class="userinput"><code>dpkg -L base-passwd</code></strong>
<code
                  class="computeroutput">/.
/usr
/usr/sbin
/usr/sbin/update-passwd
/usr/share
/usr/share/base-passwd
/usr/share/base-passwd/group.master
/usr/share/base-passwd/passwd.master
/usr/share/doc
/usr/share/doc/base-passwd
/usr/share/doc/base-passwd/README
/usr/share/doc/base-passwd/changelog.gz
/usr/share/doc/base-passwd/copyright
/usr/share/doc/base-passwd/users-and-groups.html
/usr/share/doc/base-passwd/users-and-groups.txt.gz
/usr/share/doc-base
/usr/share/doc-base/users-and-groups
/usr/share/lintian
/usr/share/lintian/overrides
/usr/share/lintian/overrides/base-passwd
/usr/share/man
/usr/share/man/de
/usr/share/man/de/man8
/usr/share/man/de/man8/update-passwd.8.gz
/usr/share/man/es
/usr/share/man/es/man8
/usr/share/man/es/man8/update-passwd.8.gz
/usr/share/man/fr
/usr/share/man/fr/man8
/usr/share/man/fr/man8/update-passwd.8.gz
/usr/share/man/ja
/usr/share/man/ja/man8
/usr/share/man/ja/man8/update-passwd.8.gz
/usr/share/man/man8
/usr/share/man/man8/update-passwd.8.gz
/usr/share/man/pl
/usr/share/man/pl/man8
/usr/share/man/pl/man8/update-passwd.8.gz
/usr/share/man/ru
/usr/share/man/ru/man8
/usr/share/man/ru/man8/update-passwd.8.gz
$ </code><strong
                  class="userinput"><code>dpkg -S /bin/date</code></strong>
<code
                  class="computeroutput">coreutils: /bin/date
$ </code><strong
                  class="userinput"><code>dpkg -s coreutils</code></strong>
<code
                  class="computeroutput">Package: coreutils
Essential: yes
Status: install ok installed
Priority: required
Section: utils
Installed-Size: 15103
Maintainer: Michael Stone &lt;mstone@debian.org&gt;
Architecture: amd64
Multi-Arch: foreign
Version: 8.26-3
Replaces: mktemp, realpath, timeout
Pre-Depends: libacl1 (&gt;= 2.2.51-8), libattr1 (&gt;= 1:2.4.46-8), libc6 (&gt;= 2.17), libselinux1 (&gt;= 2.1.13)
Conflicts: timeout
Description: GNU core utilities
 This package contains the basic file, shell and text manipulation
 utilities which are expected to exist on every operating system.
 .
 Specifically, this package includes:
 arch base64 basename cat chcon chgrp chmod chown chroot cksum comm cp
 csplit cut date dd df dir dircolors dirname du echo env expand expr
 factor false flock fmt fold groups head hostid id install join link ln
 logname ls md5sum mkdir mkfifo mknod mktemp mv nice nl nohup nproc numfmt
 od paste pathchk pinky pr printenv printf ptx pwd readlink realpath rm
 rmdir runcon sha*sum seq shred sleep sort split stat stty sum sync tac
 tail tee test timeout touch tr true truncate tsort tty uname unexpand
 uniq unlink users vdir wc who whoami yes
Homepage: http://gnu.org/software/coreutils
$ </code><strong
                  class="userinput"><code>dpkg -l 'b*'</code></strong>
<code
                  class="computeroutput">Desired=Unknown/Install/Remove/Purge/Hold
| Status=Not/Inst/Conf-files/Unpacked/halF-conf/Half-inst/trig-aWait/Trig-pend
|/ Err?=(none)/Reinst-required (Status,Err: uppercase=bad)
||/ Name                 Version         Architecture    Description
+++-====================-===============-===============-=============================================
un  backupninja          &lt;none&gt;          &lt;none&gt;          (no description available)
un  backuppc             &lt;none&gt;          &lt;none&gt;          (no description available)
un  baekmuk-ttf          &lt;none&gt;          &lt;none&gt;          (no description available)
un  base                 &lt;none&gt;          &lt;none&gt;          (no description available)
un  base-config          &lt;none&gt;          &lt;none&gt;          (no description available)
ii  base-files           9.9+deb9u1      amd64           Debian base system miscellaneous files
ii  base-passwd          3.5.43          amd64           Debian base system master password and group 
ii  bash                 4.4-5           amd64           GNU Bourne Again SHell
[...]
$ </code><strong
                  class="userinput"><code>dpkg -c /var/cache/apt/archives/gnupg_2.1.18-8~deb9u1_amd64.deb</code></strong>
<code
                  class="computeroutput">drwxr-xr-x root/root         0 2017-09-18 20:41 ./
drwxr-xr-x root/root         0 2017-09-18 20:41 ./usr/
drwxr-xr-x root/root         0 2017-09-18 20:41 ./usr/bin/
-rwxr-xr-x root/root    996648 2017-09-18 20:41 ./usr/bin/gpg
-rwxr-xr-x root/root      3444 2017-09-18 20:41 ./usr/bin/gpg-zip
-rwxr-xr-x root/root    161192 2017-09-18 20:41 ./usr/bin/gpgconf
-rwxr-xr-x root/root     26696 2017-09-18 20:41 ./usr/bin/gpgparsemail
-rwxr-xr-x root/root     76112 2017-09-18 20:41 ./usr/bin/gpgsplit
-rwxr-xr-x root/root    158344 2017-09-18 20:41 ./usr/bin/kbxutil
-rwxr-xr-x root/root      1081 2014-06-25 16:17 ./usr/bin/lspgpot
-rwxr-xr-x root/root      2194 2017-09-18 20:41 ./usr/bin/migrate-pubring-from-classic-gpg
-rwxr-xr-x root/root     14328 2017-09-18 20:41 ./usr/bin/watchgnupg
drwxr-xr-x root/root         0 2017-09-18 20:41 ./usr/sbin/
-rwxr-xr-x root/root      3078 2017-09-18 20:41 ./usr/sbin/addgnupghome
-rwxr-xr-x root/root      2219 2017-09-18 20:41 ./usr/sbin/applygnupgdefaults
drwxr-xr-x root/root         0 2017-09-18 20:41 ./usr/share/
drwxr-xr-x root/root         0 2017-09-18 20:41 ./usr/share/doc/
drwxr-xr-x root/root         0 2017-09-18 20:41 ./usr/share/doc/gnupg/
-rw-r--r-- root/root     18964 2017-01-23 18:39 ./usr/share/doc/gnupg/DETAILS.gz
[...]
$ </code><strong
                  class="userinput"><code>dpkg -I /var/cache/apt/archives/gnupg_2.1.18-8~deb9u1_amd64.deb</code></strong>
<code
                  class="computeroutput"> new debian package, version 2.0.
 size 1124042 bytes: control archive=2221 bytes.
    1388 bytes,    24 lines      control              
    2764 bytes,    43 lines      md5sums              
 Package: gnupg
 Source: gnupg2
 Version: 2.1.18-8~deb9u1
 Architecture: amd64
 Maintainer: Debian GnuPG Maintainers &lt;pkg-gnupg-maint@lists.alioth.debian.org&gt;
 Installed-Size: 2088
 Depends: gnupg-agent (= 2.1.18-8~deb9u1), libassuan0 (&gt;= 2.0.1), libbz2-1.0, libc6 (&gt;= 2.15), libgcrypt20 (&gt;= 1.7.0), libgpg-error0 (&gt;= 1.14), libksba8 (&gt;= 1.3.4), libreadline7 (&gt;= 6.0), libsqlite3-0 (&gt;= 3.7.15), zlib1g (&gt;= 1:1.1.4)
 Recommends: dirmngr (= 2.1.18-8~deb9u1), gnupg-l10n (= 2.1.18-8~deb9u1)
 Suggests: parcimonie, xloadimage
 Breaks: debsig-verify (&lt;&lt; 0.15), dirmngr (&lt;&lt; 2.1.18-8~deb9u1), gnupg2 (&lt;&lt; 2.1.11-7+exp1), libgnupg-interface-perl (&lt;&lt; 0.52-3), libgnupg-perl (&lt;= 0.19-1), libmail-gnupg-perl (&lt;= 0.22-1), monkeysphere (&lt;&lt; 0.38~), php-crypt-gpg (&lt;= 1.4.1-1), python-apt (&lt;= 1.1.0~beta4), python-gnupg (&lt;&lt; 0.3.8-3), python3-apt (&lt;= 1.1.0~beta4)
 Replaces: gnupg2 (&lt;&lt; 2.1.11-7+exp1)
 Provides: gpg
 Section: utils
 Priority: optional
 Multi-Arch: foreign
 Homepage: https://www.gnupg.org/
 Description: GNU privacy guard - a free PGP replacement
  GnuPG is GNU's tool for secure communication and data storage.
  It can be used to encrypt data and to create digital signatures.
  It includes an advanced key management facility and is compliant
  with the proposed OpenPGP Internet standard as described in RFC4880.
[...]</code></pre></div></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>更进一步</em></span> 版本的对比</strong></p></div></div></div><a
              id="id-1.8.8.7.8.2"
              class="indexterm"></a><a
              id="id-1.8.8.7.8.3"
              class="indexterm"></a><div
              class="para">
				因为 <code
                class="command">dpkg</code> 是处理 Debian 软件包的程序，它也能够逻辑地比较版本编号。所以有 <code
                class="literal">--compare-versions</code> 选项，以外部程序使用它 (尤其是被 <code
                class="command">dpkg</code> 本身运行的配置脚本)。这个选项需要三个参数：版本编号、比较操作数、以及第二个版本编号。可能的操作数为 <code
                class="literal">lt</code> (小于)、<code
                class="literal">le</code> (大于或等于)、<code
                class="literal">eq</code> (等于)、<code
                class="literal">ne</code> (不等于)、<code
                class="literal">ge</code> (大于或等于)、以及 <code
                class="literal">gt</code> (大于)。若比较结果正确，<code
                class="command">dpkg</code> 送回 0 (成功)；若不正确，则送回 0 以外的数值 (表示失败)。
			</div><pre
              class="screen">
<code
                class="computeroutput">$ </code><strong
                class="userinput"><code>dpkg --compare-versions 1.2-3 gt 1.1-4</code></strong>
<code
                class="computeroutput">$ </code><strong
                class="userinput"><code>echo $?</code></strong>
<code
                class="computeroutput">0
$ </code><strong
                class="userinput"><code>dpkg --compare-versions 1.2-3 lt 1.1-4</code></strong>
<code
                class="computeroutput">$ </code><strong
                class="userinput"><code>echo $?</code></strong>
<code
                class="computeroutput">1
$ </code><strong
                class="userinput"><code>dpkg --compare-versions 2.6.0pre3-1 lt 2.6.0-1</code></strong>
<code
                class="computeroutput">$ </code><strong
                class="userinput"><code>echo $?</code></strong>
<code
                class="computeroutput">1</code></pre><div
              class="para">
				注意前例最后一个比较的失败：<code
                class="command">dpkg</code>、<code
                class="literal">pre</code>，表示为预发布版，没有特别的意义，此程序以比较数字版本 (a &lt; b &lt; c ...) 相同的方式比较字顺版本。所以，“<code
                class="literal">0pre3</code>” 大于 “<code
                class="literal">0</code>”。我们以毛毛虫 “<code
                class="literal">~</code>” 表示该软件包的预发布版：
			</div><pre
              class="screen">
<code
                class="computeroutput">$ </code><strong
                class="userinput"><code>dpkg --compare-versions 2.6.0~pre3-1 lt 2.6.0-1</code></strong>
<code
                class="computeroutput">$ </code><strong
                class="userinput"><code>echo $?</code></strong>
<code
                class="computeroutput">0</code></pre></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="id-1.8.8.8"></a>5.4.4. <code
                    class="command">dpkg</code>的日志文件</h3></div></div></div><div
            class="para">
				<code
              class="command">dpkg</code> 把所有的交易记录存在名为 <code
              class="filename">/var/log/dpkg.log</code> 的日志档。这个日志档的内容颇为详尽且啰唆，记录软件包被 <code
              class="command">dpkg</code> 处理的每个进程。追踪 dpkg 的每个作为之外，日志档还保留系统发展的记录：可以覆查每个软件包的安装与移除步骤，对于了解最近的变动极有帮助。此外，还记录所有的版本，可以交互检查 <code
              class="filename">changelog.Debian.gz</code> 的内容，查看有问题的软件包或在线的错误报告。
			</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="sect.multi-arch"></a>5.4.5. 多架构支持</h3></div></div></div><a
            id="id-1.8.8.9.2"
            class="indexterm"></a><a
            id="id-1.8.8.9.3"
            class="indexterm"></a><div
            class="para">
				所有的 Debian 包在它们的管控信息中都有一个<code
              class="literal">架构</code> 字段。该字段可包含：“<code
              class="literal">全部</code>“（对与架构无关的包），或者它的目标架构名称（如“amd64”， “armhf”，…）。对于后者，默认情况下，<code
              class="command">dpkg</code>将只能接受安装与主机架构匹配的软件包，主机架构可通过<code
              class="command">dpkg --print-architecture</code>来获得。
			</div><div
            class="para">
				该限制确保用户不会因为错误架构编译的二进制文件而挂掉。一切都很完美，除了（某些）计算机可以运行多架构的二进制文件，或者以本地方式（“amd64“系统可运行”i386“二进制文件）运行，或者以模拟器运行。
			</div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      id="id-1.8.8.9.6"></a>5.4.5.1. 启用多架构</h4></div></div></div><div
              class="para">
					<code
                class="command">dpkg</code>的多架构支持允许用户定义可安装于当前系统的“异质架构” 。这可以方便的通过 <code
                class="command">dpkg --add-architecture</code>完成，如下例。有一相应的 <code
                class="command">dpkg --remove-architecture</code> 以放弃对异质架构的支持，但仅可用于未余留该架构软件包的情况。
				</div><pre
              class="screen">
<code
                class="computeroutput"># </code><strong
                class="userinput"><code>dpkg --print-architecture</code></strong>
<code
                class="computeroutput">amd64
# </code><strong
                class="userinput"><code>dpkg --print-foreign-architectures</code></strong>
<code
                class="computeroutput"># </code><strong
                class="userinput"><code>dpkg -i gcc-6-base_6.3.0-18_armhf.deb</code></strong>
<code
                class="computeroutput">dpkg: error processing archive gcc-6-base_6.3.0-18_armhf.deb (--install):
 package architecture (armhf) does not match system (amd64)
Errors were encountered while processing:
 gcc-6-base_6.3.0-18_armhf.deb
# </code><strong
                class="userinput"><code>dpkg --add-architecture armhf</code></strong>
<code
                class="computeroutput"># </code><strong
                class="userinput"><code>dpkg --add-architecture armel</code></strong>
<code
                class="computeroutput"># </code><strong
                class="userinput"><code>dpkg --print-foreign-architectures</code></strong>
<code
                class="computeroutput">armhf
armel
# </code><strong
                class="userinput"><code>dpkg -i gcc-6-base_6.3.0-18_armhf.deb</code></strong>
<code
                class="computeroutput">Selecting previously unselected package gcc-6-base:armhf.
(Reading database ... 112000 files and directories currently installed.)
Preparing to unpack gcc-6-base_6.3.0-18_armhf.deb ...
Unpacking gcc-6-base:armhf (6.3.0-18) ...
Setting up gcc-6-base:armhf (6.3.0-18) ...
# </code><strong
                class="userinput"><code>dpkg --remove-architecture armhf</code></strong>
<code
                class="computeroutput">dpkg: error: cannot remove architecture 'armhf' currently in use by the database
# </code><strong
                class="userinput"><code>dpkg --remove-architecture armel</code></strong>
<code
                class="computeroutput"># </code><strong
                class="userinput"><code>dpkg --print-foreign-architectures</code></strong>
<code
                class="computeroutput">armhf</code></pre><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>备注</em></span> APT 的多架构支持</strong></p></div></div></div><div
                class="para">
					当 dpkg 已配置为支持异质架构时，APT将会自动检测，并在更新过程中开始下载相应的<code
                  class="filename">软件包</code>文件。
				</div><div
                class="para">
					异质软件包可通过 <code
                  class="command">apt install <em
                    class="replaceable">软件包</em>: <em
                    class="replaceable">架构</em></code>安装。
				</div></div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>实例</em></span> 在 amd64 架构上使用专有 i386 二进制文件</strong></p></div></div></div><div
                class="para">
					There are multiple use cases for multi-arch, but the most popular one is the possibility to execute 32 bit binaries (i386) on 64 bit systems (amd64).
				</div></div></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      id="id-1.8.8.9.7"></a>5.4.5.2. 多架构相关的变更</h4></div></div></div><div
              class="para">
					To make multi-arch actually useful and usable, libraries had to be repackaged and moved to an architecture-specific directory so that multiple copies (targeting different architectures) can be installed alongside. Such updated packages contain the “<code
                class="literal">Multi-Arch: same</code>” header field to tell the packaging system that the various architectures of the package can be safely co-installed (and that those packages can only satisfy dependencies of packages of the same architecture). The most important libraries have been converted since the introduction of multi-arch in Debian <span
                class="distribution distribution">Wheezy</span>, but there are many libraries that will likely never be converted unless someone specifically requests it (through a bug report for example).
				</div><pre
              class="screen"><code
                class="computeroutput">$ </code><strong
                class="userinput"><code>dpkg -s gcc-6-base
</code></strong><code
                class="computeroutput">dpkg-query: error: --status needs a valid package name but 'gcc-6-base' is not: ambiguous package name 'gcc-6-base' with more than one installed instance

Use --help for help about querying packages.
$ </code><strong
                class="userinput"><code>dpkg -s gcc-6-base:amd64 gcc-6-base:armhf | grep ^Multi
</code></strong><code
                class="computeroutput">Multi-Arch: same
Multi-Arch: same
$ </code><strong
                class="userinput"><code>dpkg -L libgcc1:amd64 |grep .so
</code></strong><code
                class="computeroutput">/lib/x86_64-linux-gnu/libgcc_s.so.1
$ </code><strong
                class="userinput"><code>dpkg -S /usr/share/doc/gcc-6-base/copyright
</code></strong><code
                class="computeroutput">gcc-6-base:amd64, gcc-6-base:armhf: /usr/share/doc/gcc-6-base/copyright
</code></pre><div
              class="para">
					值得注意的是，<code
                class="literal">Multi-Arch: same</code>软件包需具备能够明晰识别架构的名称。它们也能够与相同包的其他实例共享文件；<code
                class="command">dpkg</code>确保所有的包在共享时具有逐位对应识别的文件。最后但并非最不重要的，一个包的所有实例必须为相同版本。它们必须同时升级。
				</div><div
              class="para">
					多架构支持也带来了在依赖处理方式上的一些有趣的挑战。要满足依赖，需要：或者有<code
                class="literal">Multi-Arch: foreign</code>标识的软件包，或者架构上能匹配已声明依赖的软件包（在该依赖方案处理中，架构无关包假定为同样架构，而非主机架构）。通过<code
                class="literal"><em
                  class="replaceable"> 软件包</em> :any</code>语法，依赖可以被弱化，以便允许任意架构能够满足依赖，但异质软件包仅能满足如下依赖：有“<code
                class="literal"> Multi-Arch: allowed</code> ”标识的依赖。
				</div></div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="sect.source-package-structure.html"><strong>上一页</strong>5.3. 源软件包的结构</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>上一级</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>起始页</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.coexistence-with-other-packaging-systems.html"><strong>下一页</strong>5.5. 与其它软件包共存</a></li></ul><div
        id="translated_pages"><ul><li><a
              href="../ar-MA/sect.manipulating-packages-with-dpkg.html">ar-MA</a></li><li><a
              href="../da-DK/sect.manipulating-packages-with-dpkg.html">da-DK</a></li><li><a
              href="../de-DE/sect.manipulating-packages-with-dpkg.html">de-DE</a></li><li><a
              href="../el-GR/sect.manipulating-packages-with-dpkg.html">el-GR</a></li><li><a
              href="../en-US/sect.manipulating-packages-with-dpkg.html">en-US</a></li><li><a
              href="../es-ES/sect.manipulating-packages-with-dpkg.html">es-ES</a></li><li><a
              href="../fa-IR/sect.manipulating-packages-with-dpkg.html">fa-IR</a></li><li><a
              href="../fr-FR/sect.manipulating-packages-with-dpkg.html">fr-FR</a></li><li><a
              href="../hr-HR/sect.manipulating-packages-with-dpkg.html">hr-HR</a></li><li><a
              href="../id-ID/sect.manipulating-packages-with-dpkg.html">id-ID</a></li><li><a
              href="../it-IT/sect.manipulating-packages-with-dpkg.html">it-IT</a></li><li><a
              href="../ja-JP/sect.manipulating-packages-with-dpkg.html">ja-JP</a></li><li><a
              href="../ko-KR/sect.manipulating-packages-with-dpkg.html">ko-KR</a></li><li><a
              href="../nb-NO/sect.manipulating-packages-with-dpkg.html">nb-NO</a></li><li><a
              href="../pl-PL/sect.manipulating-packages-with-dpkg.html">pl-PL</a></li><li><a
              href="../pt-BR/sect.manipulating-packages-with-dpkg.html">pt-BR</a></li><li><a
              href="../ro-RO/sect.manipulating-packages-with-dpkg.html">ro-RO</a></li><li><a
              href="../ru-RU/sect.manipulating-packages-with-dpkg.html">ru-RU</a></li><li><a
              href="../tr-TR/sect.manipulating-packages-with-dpkg.html">tr-TR</a></li><li><a
              href="../vi-VN/sect.manipulating-packages-with-dpkg.html">vi-VN</a></li><li><a
              href="../zh-CN/sect.manipulating-packages-with-dpkg.html">zh-CN</a></li><li><a
              href="../zh-TW/sect.manipulating-packages-with-dpkg.html">zh-TW</a></li></ul></div></body></html>
