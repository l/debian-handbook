<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">5.4. 通过dpkg来操作软件包</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.1" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-8-zh-CN-1.0-1" /><meta
        name="keywords"
        content="二进制包, 源码包, dpkg, 依赖, 冲突" /><link
        rel="home"
        href="index.html"
        title="Debian 管理员手册" /><link
        rel="up"
        href="packaging-system.html"
        title="第 5 章 包管理系统：工具和基本原则" /><link
        rel="prev"
        href="sect.source-package-structure.html"
        title="5.3. 源软件包的结构" /><link
        rel="next"
        href="sect.coexistence-with-other-packaging-systems.html"
        title="5.5. 与其它软件包共存" /><link
        rel="canonical"
        href="http://l.github.io/debian-handbook/html/zh-CN/sect.manipulating-packages-with-dpkg.html" /></head><body
      class="draft "><noscript><iframe
          src="//www.googletagmanager.com/ns.html?id=GTM-5H35QX"
          height="0"
          width="0"
          style="display:none;visibility:hidden"></iframe></noscript><script
        type="text/javascript">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&amp;l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5H35QX');</script><div
        id="banner"><a
          href="http://debian-handbook.info/get/"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="http://debian-handbook.info"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="sect.source-package-structure.html"><strong>上一页</strong></a></li><li
          class="home">Debian 管理员手册</li><li
          class="next"><a
            accesskey="n"
            href="sect.coexistence-with-other-packaging-systems.html"><strong>下一页</strong></a></li></ul><div
        class="section"><div
          class="titlepage"><div><div><h2
                class="title"><a
                  id="sect.manipulating-packages-with-dpkg"></a>5.4. 通过<code
                  class="command">dpkg</code>来操作软件包</h2></div></div></div><a
          id="idm140492731333952"
          class="indexterm"></a><div
          class="para">
			<code
            class="command">dpkg</code> is the base command for handling Debian packages on the system. If you have <code
            class="filename">.deb</code> packages, it is <code
            class="command">dpkg</code> that allows installation or analysis of their contents. But this program only has a partial view of the Debian universe: it knows what is installed on the system, and whatever it is given on the command line, but knows nothing of the other available packages. As such, it will fail if a dependency is not met. Tools such as <code
            class="command">apt-get</code>, on the contrary, will create a list of dependencies to install everything as automatically as possible.
		</div><div
          class="sidebar"><div
            class="titlepage"><div><div><p
                  class="title"><strong><span
                      class="emphasis"><em>简述</em></span> <code
                      class="command">dpkg</code> 或 <code
                      class="command">apt-get</code>?</strong></p></div></div></div><div
            class="para">
			<code
              class="command">dpkg</code> should be seen as a system tool (backend), and <code
              class="command">apt-get</code> as a tool closer to the user, which overcomes the limitations of the former. These tools work together, each one with its particularities, suited to specific tasks.
		</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="idm140492731326256"></a>5.4.1. 安装软件包</h3></div></div></div><a
            id="idm140492731325456"
            class="indexterm"></a><a
            id="idm140492731324016"
            class="indexterm"></a><div
            class="para">
				<code
              class="command">dpkg</code> is, above all, the tool for installing an already available Debian package (because it does not download anything). To do this, we use its <code
              class="literal">-i</code> or <code
              class="literal">--install</code> option.
			</div><div
            class="example"><a
              id="idm140492731320528"></a><p
              class="title"><strong>例 5.2. 通过<code
                  class="command">dpkg</code>来安装一个软件包</strong></p><div
              class="example-contents"><pre
                class="screen scale">
<code
                  class="computeroutput"># </code><strong
                  class="userinput"><code>dpkg -i man-db_2.7.0.2-5_amd64.deb</code></strong>
<code
                  class="computeroutput">(Reading database ... 86425 files and directories currently installed.)
Preparing to unpack man-db_2.7.0.2-5_amd64.deb ...
Unpacking man-db (2.7.0.2-5) over (2.7.0.2-4) ...
Setting up man-db (2.7.0.2-5) ...
Updating database of manual pages ...
Processing triggers for mime-support (3.58) ...</code></pre></div></div><div
            class="para">
				通过<code
              class="command">dpkg</code>我们可以看到安装时的不同步骤；因此我们会知道在什么时候可能会发生错误。安装也被分为两个阶段：首先解压包，然后配置它。<code
              class="command">apt-get</code>会利用这一点，然后有限的调用<code
              class="command">dpkg</code>（因为每次调用都要把数据加载到内存中，特别是那些在名单中已经被安装的文件）。
			</div><div
            class="example"><a
              id="idm140492731314832"></a><p
              class="title"><strong>例 5.3. 分开解压和配置</strong></p><div
              class="example-contents"><pre
                class="screen scale">
<code
                  class="computeroutput"># </code><strong
                  class="userinput"><code>dpkg --unpack man-db_2.7.0.2-5_amd64.deb</code></strong>
<code
                  class="computeroutput">(Reading database ... 86425 files and directories currently installed.)
Preparing to unpack man-db_2.7.0.2-5_amd64.deb ...
Unpacking man-db (2.7.0.2-5) over (2.7.0.2-5) ...
Processing triggers for mime-support (3.58) ...
# </code><strong
                  class="userinput"><code>dpkg --configure man-db</code></strong>
<code
                  class="computeroutput">Setting up man-db (2.7.0.2-5) ...
Updating database of manual pages ...
</code></pre></div></div><a
            id="idm140492731311024"
            class="indexterm"></a><a
            id="idm140492731309584"
            class="indexterm"></a><div
            class="para">
				有时<code
              class="command">dpkg</code>在安装软件包的时候会失败并且返回一个错误；如果用户命令dpkg忽略掉这个错误，那么它仅仅会提示一个警告；这也就是我们有一个不同的<code
              class="literal">--force--*</code>选项。<code
              class="command">dpkg --force-help</code>，或者是dpkg的帮助文档，有一个这些选项的详细清单。最常见的错误是，你迟到会遇到这样一个文件冲突，当一个软件包包含的文件中已经安装了另外一个软件包。
			</div><pre
            class="screen">
<code
              class="computeroutput">Unpacking libgdm (from .../libgdm_3.8.3-2_amd64.deb) ...
dpkg: error processing /var/cache/apt/archives/libgdm_3.8.3-2_amd64.deb (--unpack):
 trying to overwrite '/usr/bin/gdmflexiserver', which is also in package gdm3 3.4.1-9</code></pre><div
            class="para">
				在这种情况下，如果你认为文件替换该文件可能不会对系统的稳定性造成重大的风险（通常情况下），你可以使用<code
              class="literal">--force-overwrite</code>选项来告诉<code
              class="command">dpkg</code>去忽略这个错误并且覆盖该文件。
			</div><div
            class="para">
				当然这里有非常多的<code
              class="literal">--force-*</code>选项，只是<code
              class="literal">--force-overwrite</code>使用的非常频繁。这些选项仅存在特殊的情况下，所以最好是不去使用它们以便遵守软件包的管理机制。不要忘了，这些管理规则可以确保你的系统的稳定性和一致性。
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>注意</em></span> 使用<code
                        class="literal">--force-*</code>的影响</strong></p></div></div></div><a
              id="idm140492731300064"
              class="indexterm"></a><div
              class="para">
				If you are not careful, the use of an option <code
                class="literal">--force-*</code> can lead to a system where the APT family of commands will refuse to function. In effect, some of these options allow installation of a package when a dependency is not met, or when there is a conflict. The result is an inconsistent system from the point of view of dependencies, and the APT commands will refuse to execute any action except those that will bring the system back to a consistent state (this often consists of installing the missing dependency or removing a problematic package). This often results in a message like this one, obtained after installing a new version of <span
                class="pkg pkg">rdesktop</span> while ignoring its dependency on a newer version of the <span
                class="pkg pkg">libc6</span>:
			</div><pre
              class="programlisting"># apt-get dist-upgrade
[...]
You can run "apt-get -f install" to correct these problems.
The following packages contain unmet dependencies:
  rdesktop: Depends on: libc6 (&gt;= 2.5) but 2.3.6.ds1-13etch7 is installed
E: missing dependencies. Try to use the option -f.
</pre><div
              class="para">
				一个勇敢的系统管理员会确定他们分析的正确性，然后选择忽略依赖或者冲突，并且使用对应的<code
                class="literal">--force-*</code>选项。在这种情况下，如果他们希望能够继续使用<code
                class="command">apt-get</code>或者是<code
                class="command">aptitude</code>，他们必须编辑<code
                class="filename">/var/lib/dpkg/status</code>去删除/修改对应的依赖关系，或者是冲突。他们也可以选择覆盖。
			</div><div
              class="para">
				This manipulation is an ugly hack, and should never be used, except in the most extreme case of necessity. Quite frequently, a more fitting solution is to recompile the package that's causing the problem (see <a
                class="xref"
                href="debian-packaging.html#sect.rebuilding-package">第 15.1 节 “Rebuilding a Package from its Sources”</a>) or use a new version (potentially corrected) from a repository such as the <code
                class="literal">stable-backports</code> one (see <a
                class="xref"
                href="apt.html#sect.backports">第 6.1.2.4 节 “Stable Backports”</a>).
			</div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="idm140492731289920"></a>5.4.2. 软件包移除</h3></div></div></div><a
            id="idm140492731289120"
            class="indexterm"></a><a
            id="idm140492731288192"
            class="indexterm"></a><a
            id="idm140492731287232"
            class="indexterm"></a><a
            id="idm140492731285792"
            class="indexterm"></a><div
            class="para">
				Invoking <code
              class="command">dpkg</code> with the <code
              class="literal">-r</code> or <code
              class="literal">--remove</code> option, followed by the name of a package, removes that package. This removal is, however, not complete: all of the configuration files, maintainer scripts, log files (system logs) and other user data handled by the package remain. That way disabling the program is easily done by uninstalling it, and it's still possible to quickly reinstall it with the same configuration. To completely remove everything associated with a package, use the <code
              class="literal">-P</code> or <code
              class="literal">--purge</code> option, followed by the package name.
			</div><div
            class="example"><a
              id="idm140492731281072"></a><p
              class="title"><strong>例 5.4. Removal and purge of the <span
                  class="pkg pkg">debian-cd</span> package</strong></p><div
              class="example-contents"><pre
                class="screen"><code
                  class="computeroutput"># </code><strong
                  class="userinput"><code>dpkg -r debian-cd</code></strong>
<code
                  class="computeroutput">(Reading database ... 97747 files and directories currently installed.)
Removing debian-cd ...
# </code><strong
                  class="userinput"><code>dpkg -P debian-cd</code></strong>
<code
                  class="computeroutput">(Reading database ... 97401 files and directories currently installed.)
Removing debian-cd ...
Purging configuration files for debian-cd ...</code></pre></div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="idm140492731276752"></a>5.4.3. Querying <code
                    class="command">dpkg</code>'s Database and Inspecting <code
                    class="filename">.deb</code> Files</h3></div></div></div><a
            id="idm140492731275024"
            class="indexterm"></a><a
            id="idm140492731273584"
            class="indexterm"></a><a
            id="idm140492731272144"
            class="indexterm"></a><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>回到基础</em></span> 选项的语法</strong></p></div></div></div><div
              class="para">
				Most options are available in a “long” version (one or more relevant words, preceded by a double dash) and a “short” version (a single letter, often the initial of one word from the long version, and preceded by a single dash). This convention is so common that it is a POSIX standard.
			</div></div><div
            class="para">
				Before concluding this section, we will study <code
              class="command">dpkg</code> options that query the internal database in order to obtain information. Giving first the long options and then corresponding short options (that will evidently take the same possible arguments) we cite <code
              class="literal">--listfiles <em
                class="replaceable">package</em></code> (or <code
              class="literal">-L</code>), which lists the files installed by this package; <code
              class="literal">--search <em
                class="replaceable">file</em></code> (or <code
              class="literal">-S</code>), which finds the package(s) containing the file; <code
              class="literal">--status <em
                class="replaceable">package</em></code> (or <code
              class="literal">-s</code>), which displays the headers of an installed package; <code
              class="literal">--list</code> (or <code
              class="literal">-l</code>), which displays the list of packages known to the system and their installation status; <code
              class="literal">--contents <em
                class="replaceable">file.deb</em></code> (or <code
              class="literal">-c</code>), which lists the files in the Debian package specified; <code
              class="literal">--info<em
                class="replaceable"> file.deb </em></code> (or <code
              class="literal">-I</code>), which displays the headers of this Debian package.
			</div><div
            class="example"><a
              id="idm140492731260096"></a><p
              class="title"><strong>例 5.5. <code
                  class="command">dpkg</code>的各种查询</strong></p><div
              class="example-contents"><pre
                class="screen scale"
                width="80">
<code
                  class="computeroutput">$ </code><strong
                  class="userinput"><code>dpkg -L base-passwd</code></strong>
<code
                  class="computeroutput">/.
/usr
/usr/sbin
/usr/sbin/update-passwd
/usr/share
/usr/share/lintian
/usr/share/lintian/overrides
/usr/share/lintian/overrides/base-passwd
/usr/share/doc-base
/usr/share/doc-base/users-and-groups
/usr/share/base-passwd
/usr/share/base-passwd/group.master
/usr/share/base-passwd/passwd.master
/usr/share/man
/usr/share/man/pl
/usr/share/man/pl/man8
/usr/share/man/pl/man8/update-passwd.8.gz
/usr/share/man/ru
/usr/share/man/ru/man8
/usr/share/man/ru/man8/update-passwd.8.gz
/usr/share/man/ja
/usr/share/man/ja/man8
/usr/share/man/ja/man8/update-passwd.8.gz
/usr/share/man/fr
/usr/share/man/fr/man8
/usr/share/man/fr/man8/update-passwd.8.gz
/usr/share/man/es
/usr/share/man/es/man8
/usr/share/man/es/man8/update-passwd.8.gz
/usr/share/man/de
/usr/share/man/de/man8
/usr/share/man/de/man8/update-passwd.8.gz
/usr/share/man/man8
/usr/share/man/man8/update-passwd.8.gz
/usr/share/doc
/usr/share/doc/base-passwd
/usr/share/doc/base-passwd/users-and-groups.txt.gz
/usr/share/doc/base-passwd/changelog.gz
/usr/share/doc/base-passwd/copyright
/usr/share/doc/base-passwd/README
/usr/share/doc/base-passwd/users-and-groups.html
$ </code><strong
                  class="userinput"><code>dpkg -S /bin/date</code></strong>
<code
                  class="computeroutput">coreutils: /bin/date
$ </code><strong
                  class="userinput"><code>dpkg -s coreutils</code></strong>
<code
                  class="computeroutput">Package: coreutils
Essential: yes
Status: install ok installed
Priority: required
Section: utils
Installed-Size: 13855
Maintainer: Michael Stone &lt;mstone@debian.org&gt;
Architecture: amd64
Multi-Arch: foreign
Version: 8.23-3
Replaces: mktemp, realpath, timeout
Pre-Depends: libacl1 (&gt;= 2.2.51-8), libattr1 (&gt;= 1:2.4.46-8), libc6 (&gt;= 2.17), libselinux1 (&gt;= 2.1.13)
Conflicts: timeout
Description: GNU core utilities
 This package contains the basic file, shell and text manipulation
 utilities which are expected to exist on every operating system.
 .
 Specifically, this package includes:
 arch base64 basename cat chcon chgrp chmod chown chroot cksum comm cp
 csplit cut date dd df dir dircolors dirname du echo env expand expr
 factor false flock fmt fold groups head hostid id install join link ln
 logname ls md5sum mkdir mkfifo mknod mktemp mv nice nl nohup nproc numfmt
 od paste pathchk pinky pr printenv printf ptx pwd readlink realpath rm
 rmdir runcon sha*sum seq shred sleep sort split stat stty sum sync tac
 tail tee test timeout touch tr true truncate tsort tty uname unexpand
 uniq unlink users vdir wc who whoami yes
Homepage: http://gnu.org/software/coreutils
$ </code><strong
                  class="userinput"><code>dpkg -l 'b*'</code></strong>
<code
                  class="computeroutput">Desired=Unknown/Install/Remove/Purge/Hold
| Status=Not/Inst/Conf-files/Unpacked/halF-conf/Half-inst/trig-aWait/Trig-pend
|/ Err?=(none)/Reinst-required (Status,Err: uppercase=bad)
||/ Name                    Version          Architecture     Description
+++-=======================-================-================-====================================================
un  backupninja             &lt;none&gt;           &lt;none&gt;           (no description available)
ii  backuppc                3.3.0-2          amd64            high-performance, enterprise-grade system for backin
un  base                    &lt;none&gt;           &lt;none&gt;           (no description available)
un  base-config             &lt;none&gt;           &lt;none&gt;           (no description available)
ii  base-files              8                amd64            Debian base system miscellaneous files
ii  base-passwd             3.5.37           amd64            Debian base system master password and group files
[...]
$ </code><strong
                  class="userinput"><code>dpkg -c /var/cache/apt/archives/gnupg_1.4.18-6_amd64.deb</code></strong>
<code
                  class="computeroutput">drwxr-xr-x root/root         0 2014-12-04 23:03 ./
drwxr-xr-x root/root         0 2014-12-04 23:03 ./lib/
drwxr-xr-x root/root         0 2014-12-04 23:03 ./lib/udev/
drwxr-xr-x root/root         0 2014-12-04 23:03 ./lib/udev/rules.d/
-rw-r--r-- root/root      2711 2014-12-04 23:03 ./lib/udev/rules.d/60-gnupg.rules
drwxr-xr-x root/root         0 2014-12-04 23:03 ./usr/
drwxr-xr-x root/root         0 2014-12-04 23:03 ./usr/lib/
drwxr-xr-x root/root         0 2014-12-04 23:03 ./usr/lib/gnupg/
-rwxr-xr-x root/root     39328 2014-12-04 23:03 ./usr/lib/gnupg/gpgkeys_ldap
-rwxr-xr-x root/root     92872 2014-12-04 23:03 ./usr/lib/gnupg/gpgkeys_hkp
-rwxr-xr-x root/root     47576 2014-12-04 23:03 ./usr/lib/gnupg/gpgkeys_finger
-rwxr-xr-x root/root     84648 2014-12-04 23:03 ./usr/lib/gnupg/gpgkeys_curl
-rwxr-xr-x root/root      3499 2014-12-04 23:03 ./usr/lib/gnupg/gpgkeys_mailto
drwxr-xr-x root/root         0 2014-12-04 23:03 ./usr/bin/
-rwxr-xr-x root/root     60128 2014-12-04 23:03 ./usr/bin/gpgsplit
-rwxr-xr-x root/root   1012688 2014-12-04 23:03 ./usr/bin/gpg
[...]
$ </code><strong
                  class="userinput"><code>dpkg -I /var/cache/apt/archives/gnupg_1.4.18-6_amd64.deb</code></strong>
<code
                  class="computeroutput"> new debian package, version 2.0.
 size 1148362 bytes: control archive=3422 bytes.
    1264 bytes,    26 lines      control              
    4521 bytes,    65 lines      md5sums              
     479 bytes,    13 lines   *  postinst             #!/bin/sh
     473 bytes,    13 lines   *  preinst              #!/bin/sh
 Package: gnupg
 Version: 1.4.18-6
 Architecture: amd64
 Maintainer: Debian GnuPG-Maintainers &lt;pkg-gnupg-maint@lists.alioth.debian.org&gt;
 Installed-Size: 4888
 Depends: gpgv, libbz2-1.0, libc6 (&gt;= 2.15), libreadline6 (&gt;= 6.0), libusb-0.1-4 (&gt;= 2:0.1.12), zlib1g (&gt;= 1:1.1.4)
 Recommends: gnupg-curl, libldap-2.4-2 (&gt;= 2.4.7)
 Suggests: gnupg-doc, libpcsclite1, parcimonie, xloadimage | imagemagick | eog
 Section: utils
 Priority: important
 Multi-Arch: foreign
 Homepage: http://www.gnupg.org
 Description: GNU privacy guard - a free PGP replacement
  GnuPG is GNU's tool for secure communication and data storage.
  It can be used to encrypt data and to create digital signatures.
  It includes an advanced key management facility and is compliant
  with the proposed OpenPGP Internet standard as described in RFC 4880.
[...]</code></pre></div></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>更进一步</em></span> 版本的对比</strong></p></div></div></div><a
              id="idm140492731245984"
              class="indexterm"></a><a
              id="idm140492731245024"
              class="indexterm"></a><div
              class="para">
				Since <code
                class="command">dpkg</code> is the program for handling Debian packages, it also provides the reference implementation of the logic of comparing version numbers. This is why it has a <code
                class="literal">--compare-versions</code> option, usable by external programs (especially configuration scripts executed by <code
                class="command">dpkg</code> itself). This option requires three parameters: a version number, a comparison operator, and a second version number. The different possible operators are <code
                class="literal">lt</code> (strictly less than), <code
                class="literal">le</code> (less than or equal to), <code
                class="literal">eq</code> (equal), <code
                class="literal">ne</code> (not equal), <code
                class="literal">ge</code> (greater than or equal to), and <code
                class="literal">gt</code> (strictly greater than). If the comparison is correct, <code
                class="command">dpkg</code> returns 0 (success); if not, it gives a non-zero return value (indicating failure).
			</div><pre
              class="screen">
<code
                class="computeroutput">$ </code><strong
                class="userinput"><code>dpkg --compare-versions 1.2-3 gt 1.1-4</code></strong>
<code
                class="computeroutput">$ </code><strong
                class="userinput"><code>echo $?</code></strong>
<code
                class="computeroutput">0
$ </code><strong
                class="userinput"><code>dpkg --compare-versions 1.2-3 lt 1.1-4</code></strong>
<code
                class="computeroutput">$ </code><strong
                class="userinput"><code>echo $?</code></strong>
<code
                class="computeroutput">1
$ </code><strong
                class="userinput"><code>dpkg --compare-versions 2.6.0pre3-1 lt 2.6.0-1</code></strong>
<code
                class="computeroutput">$ </code><strong
                class="userinput"><code>echo $?</code></strong>
<code
                class="computeroutput">1</code></pre><div
              class="para">
				Note the unexpected failure of the last comparison: for <code
                class="command">dpkg</code>, <code
                class="literal">pre</code>, usually denoting a pre-release, has no particular meaning, and this program compares the alphabetic characters in the same way as the numbers (a &lt; b &lt; c ...), in alphabetical order. This is why it considers “<code
                class="literal">0pre3</code>” to be greater than “<code
                class="literal">0</code>”. When we want a package's version number to indicate that it is a pre-release, we use the tilde character, “<code
                class="literal">~</code>”:
			</div><pre
              class="screen">
<code
                class="computeroutput">$ </code><strong
                class="userinput"><code>dpkg --compare-versions 2.6.0~pre3-1 lt 2.6.0-1</code></strong>
<code
                class="computeroutput">$ </code><strong
                class="userinput"><code>echo $?</code></strong>
<code
                class="computeroutput">0</code></pre></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="idm140492731227088"></a>5.4.4. <code
                    class="command">dpkg</code>的日志文件</h3></div></div></div><div
            class="para">
				<code
              class="command">dpkg</code> keeps a log of all of its actions in <code
              class="filename">/var/log/dpkg.log</code>. This log is extremely verbose, since it details every one of the stages through which packages handled by <code
              class="command">dpkg</code> go. In addition to offering a way to track dpkg's behavior, it helps, above all, to keep a history of the development of the system: one can find the exact moment when each package has been installed or updated, and this information can be extremely useful in understanding a recent change in behavior. Additionally, all versions being recorded, it is easy to cross-check the information with the <code
              class="filename">changelog.Debian.gz</code> for packages in question, or even with online bug reports.
			</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="sect.multi-arch"></a>5.4.5. Multi-Arch Support</h3></div></div></div><a
            id="idm140492731221744"
            class="indexterm"></a><a
            id="idm140492731220784"
            class="indexterm"></a><div
            class="para">
				All Debian packages have an <code
              class="literal">Architecture</code> field in their control information. This field can contain either “<code
              class="literal">all</code>” (for packages that are architecture independent) or the name of the architecture that it targets (like “amd64”, “armhf”, …). In the latter case, by default, <code
              class="command">dpkg</code> will only accept to install the package if its architecture matches the host's architecture as returned by <code
              class="command">dpkg --print-architecture</code>.
			</div><div
            class="para">
				This restriction ensures that users do not end up with binaries compiled for an incorrect architecture. Everything would be perfect except that (some) computers can run binaries for multiple architectures, either natively (an “amd64“ system can run “i386” binaries) or through emulators.
			</div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      id="idm140492731215936"></a>5.4.5.1. Enabling Multi-Arch</h4></div></div></div><div
              class="para">
					<code
                class="command">dpkg</code>'s multi-arch support allows users to define “foreign architectures” that can be installed on the current system. This is simply done with <code
                class="command">dpkg --add-architecture</code> like in the example below. There's a corresponding <code
                class="command">dpkg --remove-architecture</code> to drop support of a foreign architecture, but it can only be used when no packages of this architecture remain.
				</div><pre
              class="screen">
<code
                class="computeroutput"># </code><strong
                class="userinput"><code>dpkg --print-architecture</code></strong>
<code
                class="computeroutput">amd64
# </code><strong
                class="userinput"><code>dpkg --print-foreign-architectures</code></strong>
<code
                class="computeroutput"># </code><strong
                class="userinput"><code>dpkg -i gcc-4.9-base_4.9.1-19_armhf.deb</code></strong>
<code
                class="computeroutput">dpkg: error processing archive gcc-4.9-base_4.9.1-19_armhf.deb (--install):
 package architecture (armhf) does not match system (amd64)
Errors were encountered while processing:
 gcc-4.9-base_4.9.1-19_armhf.deb
# </code><strong
                class="userinput"><code>dpkg --add-architecture armhf</code></strong>
<code
                class="computeroutput"># </code><strong
                class="userinput"><code>dpkg --add-architecture armel</code></strong>
<code
                class="computeroutput"># </code><strong
                class="userinput"><code>dpkg --print-foreign-architectures</code></strong>
<code
                class="computeroutput">armhf
armel
# </code><strong
                class="userinput"><code>dpkg -i gcc-4.9-base_4.9.1-19_armhf.deb</code></strong>
<code
                class="computeroutput">Selecting previously unselected package gcc-4.9-base:armhf.
(Reading database ... 86425 files and directories currently installed.)
Preparing to unpack gcc-4.9-base_4.9.1-19_armhf.deb ...
Unpacking gcc-4.9-base:armhf (4.9.1-19) ...
Setting up gcc-4.9-base:armhf (4.9.1-19) ...
# </code><strong
                class="userinput"><code>dpkg --remove-architecture armhf</code></strong>
<code
                class="computeroutput">dpkg: error: cannot remove architecture 'armhf' currently in use by the database
# </code><strong
                class="userinput"><code>dpkg --remove-architecture armel</code></strong>
<code
                class="computeroutput"># </code><strong
                class="userinput"><code>dpkg --print-foreign-architectures</code></strong>
<code
                class="computeroutput">armhf</code></pre><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>NOTE</em></span> APT's multi-arch support</strong></p></div></div></div><div
                class="para">
					APT will automatically detect when dpkg has been configured to support foreign architectures and will start downloading the corresponding <code
                  class="filename">Packages</code> files durings its update process.
				</div><div
                class="para">
					Foreign packages can then be installed with <code
                  class="command">apt-get install <em
                    class="replaceable">package</em>:<em
                    class="replaceable">architecture</em></code>.
				</div></div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>IN PRACTICE</em></span> Using proprietary i386 binaries on amd64</strong></p></div></div></div><div
                class="para">
					There are multiple use cases for multi-arch, but the most popular one is the possibility to execute 32 bit binaries (i386) on 64 bit systems (amd64), in particular since several popular proprietary applications (like Skype) are only provided in 32 bit versions.
				</div><div
                class="para">
					Before multi-arch, when you wanted to uses a 32 bit appliction on a 64 bit system, you had to install <span
                  class="pkg pkg">ia32-libs</span> to have 32 bit versions of the most popular libraries. That package was a huge hack that repackaged 32 bit libraries in an “amd64” package.
				</div><a
                id="idm140492731196816"
                class="indexterm"></a></div></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      id="idm140492731195072"></a>5.4.5.2. Multi-Arch Related Changes</h4></div></div></div><div
              class="para">
					To make multi-arch actually useful and usable, libraries had to be repackaged and moved to an architecture-specific directory so that multiple copies (targeting different architectures) can be installed alongside. Such updated packages contain the “<code
                class="literal">Multi-Arch: same</code>” header field to tell the packaging system that the various architectures of the package can be safely co-installed (and that those packages can only satisfy dependencies of packages of the same architecture). Since multi-arch made its debut in Debian <span
                class="distribution distribution">Wheezy</span>, not all libraries have been converted yet (but all libraries which were embedded in <span
                class="pkg pkg">ia32-libs</span> do!).
				</div><pre
              class="screen">
$ <strong
                class="userinput"><code>dpkg -s gcc-4.9-base</code></strong>
dpkg-query: error: --status needs a valid package name but 'gcc-4.9-base' is not: ambiguous package name 'gcc-4.9-base' with more than one installed instance

Use --help for help about querying packages.
$ <strong
                class="userinput"><code>dpkg -s gcc-4.9-base:amd64 gcc-4.9-base:armhf | grep ^Multi</code></strong>
Multi-Arch: same
Multi-Arch: same
$ <strong
                class="userinput"><code>dpkg -L libgcc1:amd64 |grep .so</code></strong>
/lib/x86_64-linux-gnu/libgcc_s.so.1
$ <strong
                class="userinput"><code>dpkg -S /usr/share/doc/gcc-4.9-base/copyright</code></strong>
gcc-4.9-base:amd64, gcc-4.9-base:armhf: /usr/share/doc/gcc-4.9-base/copyright
</pre><div
              class="para">
					It is worth noting that <code
                class="literal">Multi-Arch: same</code> packages must have their names qualified with their architecture to be unambiguously identifiable. They also have the possibility to share files with other instances of the same package; <code
                class="command">dpkg</code> ensures that all packages have bit-for-bit identical files when they are shared. Last but not least, all instances of a package must have the same version. They must thus be upgraded together.
				</div><div
              class="para">
					Multi-Arch support also brings some interesting challenges in the way dependencies are handled. Satisfying a dependency requires either a package marked “<code
                class="literal">Multi-Arch: foreign</code>” or a package whose architecture matches the one of the package declaring the dependency (in this dependency resolution process, architecture-independent packages are assumed to be of the same architecture than the host). A dependency can also be weakened to allow any architecture to fulfill it, with the <code
                class="literal"><em
                  class="replaceable">package</em>:any</code> syntax, but foreign packages can only satisfy such a dependency if they are marked “<code
                class="literal">Multi-Arch: allowed</code>”.
				</div></div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="sect.source-package-structure.html"><strong>上一页</strong>5.3. 源软件包的结构</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>上一级</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>起始页</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.coexistence-with-other-packaging-systems.html"><strong>下一页</strong>5.5. 与其它软件包共存</a></li></ul><div
        id="translated_pages"><ul><li><a
              href="../ar-MA/sect.manipulating-packages-with-dpkg.html">ar-MA</a></li><li><a
              href="../da-DK/sect.manipulating-packages-with-dpkg.html">da-DK</a></li><li><a
              href="../de-DE/sect.manipulating-packages-with-dpkg.html">de-DE</a></li><li><a
              href="../el-GR/sect.manipulating-packages-with-dpkg.html">el-GR</a></li><li><a
              href="../en-US/sect.manipulating-packages-with-dpkg.html">en-US</a></li><li><a
              href="../es-ES/sect.manipulating-packages-with-dpkg.html">es-ES</a></li><li><a
              href="../fa-IR/sect.manipulating-packages-with-dpkg.html">fa-IR</a></li><li><a
              href="../fr-FR/sect.manipulating-packages-with-dpkg.html">fr-FR</a></li><li><a
              href="../hr-HR/sect.manipulating-packages-with-dpkg.html">hr-HR</a></li><li><a
              href="../id-ID/sect.manipulating-packages-with-dpkg.html">id-ID</a></li><li><a
              href="../it-IT/sect.manipulating-packages-with-dpkg.html">it-IT</a></li><li><a
              href="../ja-JP/sect.manipulating-packages-with-dpkg.html">ja-JP</a></li><li><a
              href="../pl-PL/sect.manipulating-packages-with-dpkg.html">pl-PL</a></li><li><a
              href="../pt-BR/sect.manipulating-packages-with-dpkg.html">pt-BR</a></li><li><a
              href="../ro-RO/sect.manipulating-packages-with-dpkg.html">ro-RO</a></li><li><a
              href="../ru-RU/sect.manipulating-packages-with-dpkg.html">ru-RU</a></li><li><a
              href="../tr-TR/sect.manipulating-packages-with-dpkg.html">tr-TR</a></li><li><a
              href="../zh-CN/sect.manipulating-packages-with-dpkg.html">zh-CN</a></li></ul></div></body></html>
