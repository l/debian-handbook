<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">5.2. 软件包元信息</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-9-zh-CN-1.0-1" /><meta
        name="keywords"
        content="二进制包, 源码包, dpkg, 依赖, 冲突" /><link
        rel="home"
        href="index.html"
        title="Debian 管理员手册" /><link
        rel="up"
        href="packaging-system.html"
        title="第 5 章 包管理系统：工具和基本原则" /><link
        rel="prev"
        href="packaging-system.html"
        title="第 5 章 包管理系统：工具和基本原则" /><link
        rel="next"
        href="sect.source-package-structure.html"
        title="5.3. 源软件包的结构" /><meta
        name="viewport"
        content="width=device-width, initial-scale=1" /><meta
        name="flattr:id"
        content="4pz9jq" /><link
        rel="canonical"
        href="http://l.github.io/debian-handbook/html/zh-CN/sect.package-meta-information.html" /></head><body><noscript><iframe
          src="//www.googletagmanager.com/ns.html?id=GTM-5H35QX"
          height="0"
          width="0"
          style="display:none;visibility:hidden"></iframe></noscript><script
        type="text/javascript">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&amp;l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5H35QX');</script><div
        id="banner"><a
          href="../../"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="index.html"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="packaging-system.html"><strong>上一页</strong></a></li><li
          class="home">Debian 管理员手册</li><li
          class="next"><a
            accesskey="n"
            href="sect.source-package-structure.html"><strong>下一页</strong></a></li></ul><div
        class="section"><div
          class="titlepage"><div><div><h2
                class="title"><a
                  id="sect.package-meta-information"></a>5.2. 软件包元信息</h2></div></div></div><a
          id="id-1.8.6.2"
          class="indexterm"></a><a
          id="id-1.8.6.3"
          class="indexterm"></a><div
          class="para">
			Debian 软件包不仅是一个待安装文件的归档。它是一个更大结构的一部分，它描述与其它 Debian 软件包的关系（依赖、冲突、建议）。在软件包生命周期的不同阶段（安装、删除、升级），它还提供执行命令的脚本。软件包中的这些数据供包管理工具使用，但不是打包软件的一部分，称为“元信息”（关于其它信息的信息）。
		</div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="sect.control"></a>5.2.1. 描述：<code
                    class="filename">control</code> 文件</h3></div></div></div><a
            id="id-1.8.6.5.2"
            class="indexterm"></a><a
            id="id-1.8.6.5.3"
            class="indexterm"></a><a
            id="id-1.8.6.5.4"
            class="indexterm"></a><div
            class="para">
				该文件使用一个类似电子邮件头（由 RFC_2822 定义）的结构。例如，<span
              class="pkg pkg">apt</span> 包的 <code
              class="filename">control</code> 文件看起来是这样的：
			</div><pre
            class="screen">
<code
              class="computeroutput">$ </code><strong
              class="userinput"><code>apt-cache show apt</code></strong>
<code
              class="computeroutput">Package: apt
Version: 1.4.8
Installed-Size: 3539
Maintainer: APT Development Team &lt;deity@lists.debian.org&gt;
Architecture: amd64
Replaces: apt-utils (&lt;&lt; 1.3~exp2~)
Depends: adduser, gpgv | gpgv2 | gpgv1, debian-archive-keyring, init-system-helpers (&gt;= 1.18~), libapt-pkg5.0 (&gt;= 1.3~rc2), libc6 (&gt;= 2.15), libgcc1 (&gt;= 1:3.0), libstdc++6 (&gt;= 5.2)
Recommends: gnupg | gnupg2 | gnupg1
Suggests: apt-doc, aptitude | synaptic | wajig, dpkg-dev (&gt;= 1.17.2), powermgmt-base, python-apt
Breaks: apt-utils (&lt;&lt; 1.3~exp2~)
Description-en: commandline package manager
 This package provides commandline tools for searching and
 managing as well as querying information about packages
 as a low-level access to all features of the libapt-pkg library.
 .
 These include:
  * apt-get for retrieval of packages and information about them
    from authenticated sources and for installation, upgrade and
    removal of packages together with their dependencies
  * apt-cache for querying available information about installed
    as well as installable packages
  * apt-cdrom to use removable media as a source for packages
  * apt-config as an interface to the configuration settings
  * apt-key as an interface to manage authentication keys
Description-md5: 9fb97a88cb7383934ef963352b53b4a7
Tag: admin::package-management, devel::lang:ruby, hardware::storage,
 hardware::storage:cd, implemented-in::c++, implemented-in::perl,
 implemented-in::ruby, interface::commandline, network::client,
 protocol::ftp, protocol::http, protocol::ipv6, role::program,
 scope::application, scope::utility, sound::player, suite::debian,
 use::downloading, use::organizing, use::searching, works-with::audio,
 works-with::software:package, works-with::text
Section: admin
Priority: important
Filename: pool/main/a/apt/apt_1.4.8_amd64.deb
Size: 1231676
MD5sum: 4963240f23156b2dda3affc9c0d416a3
SHA256: bc319a3abaf98d76e7e13ac97ab0ee7c238a48e2d4ab85524be8b10cfd23d50d</code></pre><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>基础知识</em></span> RFC －－ 互联网标准</strong></p></div></div></div><a
              id="id-1.8.6.5.7.2"
              class="indexterm"></a><a
              id="id-1.8.6.5.7.3"
              class="indexterm"></a><div
              class="para">
				RFC 是 “征求建议”的缩写。RFC通常是一份描述将要成为互联网的标准的技术文档。在成为标准并被冻结之前，这些标准被提交给大众评估（这就是名字的由来）。 IETF（互联网工程专家组）决定这些文档的演进更新（建议标准、草案或标准）。
			</div><div
              class="para">
				RFC 2026 定义了互联网协议标准化的程序。<div
                class="url">→ <a
                  href="http://www.faqs.org/rfcs/rfc2026.html">http://www.faqs.org/rfcs/rfc2026.html</a></div>
			</div></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      id="id-1.8.6.5.8"></a>5.2.1.1. 依赖：<code
                      class="literal">Depends</code> 域</h4></div></div></div><a
              id="id-1.8.6.5.8.2"
              class="indexterm"></a><a
              id="id-1.8.6.5.8.3"
              class="indexterm"></a><a
              id="id-1.8.6.5.8.4"
              class="indexterm"></a><div
              class="para">
					依赖关系是在软件包头部的 <code
                class="literal">Depends</code> 域中定义的，它是软件包能够正常运行所需要满足的一系列条件。包管理工具诸如 <code
                class="command">apt</code> 依靠这个信息来安装该软件所依赖的恰当版本的库。对于每一项依赖，可以限定依赖的版本范围来满足条件。换句话说，可以这样表达：我们需要版本号等于或者大于“2.15”的 <span
                class="pkg pkg">libc6</span> 软件包（写作 “<code
                class="command">libc6 (&gt;= 2.15)</code>”）。版本比较操作符使用如下：
				</div><div
              xmlns:d="http://docbook.org/ns/docbook"
              class="itemizedlist"><ul><li
                  class="listitem"><div
                    class="para">
							<code
                      class="command">&lt;&lt;</code>：小于；
						</div></li><li
                  class="listitem"><div
                    class="para">
							<code
                      class="command">&lt;=</code>：小于或等于；
						</div></li><li
                  class="listitem"><div
                    class="para">
							<code
                      class="command">=</code>：等于（注意， “<code
                      class="literal">2.6.1</code>” 不等于 “<code
                      class="literal">2.6.1-1</code>”）;
						</div></li><li
                  class="listitem"><div
                    class="para">
							<code
                      class="command">&gt;=</code>：大于或等于；
						</div></li><li
                  class="listitem"><div
                    class="para">
							<code
                      class="command">&gt;&gt;</code>：大于。
						</div></li></ul></div><div
              class="para">
					In a list of conditions to be met, the comma serves as a separator. It must be interpreted as a logical “and”. In conditions, the vertical bar (“|”) expresses a logical “or” (it is an inclusive “or”, not an exclusive “either/or”). Carrying greater priority than “and”, it can be used as many times as necessary. Thus, the dependency “(A or B) and C” is written <code
                class="command">A | B, C</code>. In contrast, the expression “A or (B and C)” should be written as “(A or B) and (A or C)”, since the <code
                class="literal">Depends</code> field does not tolerate parentheses that change the order of priorities between the logical operators “or” and “and”. It would thus be written <code
                class="command">A | B, A | C</code>. <div
                class="url">→ <a
                  href="https://www.debian.org/doc/debian-policy/#document-ch-relationships">https://www.debian.org/doc/debian-policy/#document-ch-relationships</a></div>
				</div><a
              id="id-1.8.6.5.8.8"
              class="indexterm"></a><div
              class="para">
					相依性系统是保证程序顺利运作的良好机制，但它也有另个用法 「元软件包」。这些空的软件软件包内容只有相依性的说明。由元软件包维护者把一群程序的相依性描述在其中；例如，<code
                class="command">apt install <em
                  class="replaceable">meta-package</em></code> 将自动安装所有用到元软件包相依的文件。<span
                class="pkg pkg">gnome</span>、<span
                class="pkg pkg">kde-full</span> 与 <span
                class="pkg pkg">linux-image-amd64</span> 软件包就是元软件包之一。
				</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>DEBIAN 政策</em></span> <code
                          class="literal">预依赖</code>, 一个更苛刻的 <code
                          class="literal">取决于</code></strong></p></div></div></div><a
                id="id-1.8.6.5.8.10.2"
                class="indexterm"></a><a
                id="id-1.8.6.5.8.10.3"
                class="indexterm"></a><div
                class="para">
					“预相依性”，列在软件包标头的 “<code
                  class="literal">Pre-Depends</code>” 字段，满足完整的正常相依性；它的语法是相同的。正常相依性系指必须在声明相依性前先解开并配置的问题软件包。预相依性规定在运行软件包的预安装脚本前，必须先解开并配置软件包，就是在安装之前。
				</div><div
                class="para">
					<code
                  class="command">apt</code>对预依赖的要求非常严格，因为它在安装软件包的时候增加了严格约束。因此，预依赖关系的安装软件的时候不鼓励,除非绝对需要。它甚至建议在加入预依赖前直接咨询开发人员<code
                  class="email"><a
                    class="email"
                    href="mailto:debian-devel@lists.dibian.org">debian-devel@lists.dibian.org</a></code>。这也是一个通用的解决办法。
				</div></div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>DEBIAN 政策</em></span> <code
                          class="literal">推荐</code>，<code
                          class="literal">建议</code>，<code
                          class="literal">增强</code></strong></p></div></div></div><a
                id="id-1.8.6.5.8.11.2"
                class="indexterm"></a><a
                id="id-1.8.6.5.8.11.3"
                class="indexterm"></a><div
                class="para">
					<code
                  class="literal">推荐</code>和<code
                  class="literal">建议</code>字段描述的依赖关系不是强制性的。“推荐”的依赖,是最重要的，能显著改善由软件包提供的功能，但这并非是必不可少的操作。“建议”的依赖，是次要的，表明某些软件包可以补充或者增加其各自的效果，有充分的理由去单独安装它而不是其它的软件包。
				</div><div
                class="para">
					你应该总是安装“推荐”的软件包，除非你知道究竟为什么你不需要它们。相反，“建议”的软件包是不必要安装的，除非你知道为什么你需要它们。
				</div><a
                id="id-1.8.6.5.8.11.6"
                class="indexterm"></a><div
                class="para">
					<code
                  class="literal">Enhances 增强</code> 字段也描述建议，但是位于不同的内文。实际上位于建议软件包内，而不是受益于建议的软件包内。有可能在不修改软件包的前提下添加建议。因此所有插件、插件与其他的程序延伸可以显示在与软件相关的建议清单内。虽然已存在多年，但是 <code
                  class="command">apt</code> 或 <code
                  class="command">synaptic</code> 等程序依然忽略此字段的存在。<code
                  class="literal">Enhances</code> 字段提出的建议系在传统建议 — <code
                  class="literal">Suggests</code> 字段供用户参考。.
				</div></div></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      id="id-1.8.6.5.9"></a>5.2.1.2. 冲突：<code
                      class="literal">冲突</code>字段</h4></div></div></div><a
              id="id-1.8.6.5.9.2"
              class="indexterm"></a><a
              id="id-1.8.6.5.9.3"
              class="indexterm"></a><a
              id="id-1.8.6.5.9.4"
              class="indexterm"></a><div
              class="para">
					<code
                class="literal">Conflicts 冲突</code> 字段指示不能与其共存的其它软件包。最常见的理由是两个软件包使用相同的名称，或在同个 TCP 端口提供相同的服务，或会隐藏彼此的运作。
				</div><div
              class="para">
					<code
                class="command">dpkg</code> 不会安装冲突的软件包，除非新软件包指明 “取代” 被冲突的软件包，<code
                class="command">dpkg</code> 才会以新的软件包取代旧的软件包。<code
                class="command">apt</code> 总是遵循您的指示：若选择安装新软件包，则自动移除造成问题的旧软件包。
				</div></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      id="id-1.8.6.5.10"></a>5.2.1.3. 不相容性:<code
                      class="literal">中断</code>字段</h4></div></div></div><a
              id="id-1.8.6.5.10.2"
              class="indexterm"></a><a
              id="id-1.8.6.5.10.3"
              class="indexterm"></a><a
              id="id-1.8.6.5.10.4"
              class="indexterm"></a><div
              class="para">
					<code
                class="literal">中断 Breaks </code>字段有一个影响和<code
                class="literal">冲突</code>字段类似，但它具有特殊的意义。它标志着一个包的安装会将另外一个包（或者是特定版本）中断掉。通常而言，两个包之间的不兼容是短暂的，<code
                class="literal">中断</code>关系会特别指出那些不兼容的版本。
				</div><div
              class="para">
					已经中断现有软件包时，<code
                class="command">dpkg</code> 将拒绝安装并且 <code
                class="command">apt</code> 将更新软件包至新的版本试图解决此问题 (通常可解决此问题，并再度兼容)。
				</div><div
              class="para">
					不向后兼容的更新可能会发生这种情况：如果新版本与旧版本的功能不在另一个程序中做特别规定，这将导致故障。<code
                class="literal">中断</code>字段会防止用户继续运行从而遇到这些问题。
				</div></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      id="id-1.8.6.5.11"></a>5.2.1.4. 预备好的条目：<code
                      class="literal">预备</code>字段</h4></div></div></div><a
              id="id-1.8.6.5.11.2"
              class="indexterm"></a><div
              class="para">
					这个字段引入了一个很有意思的“虚拟包”的概念。它有很多的角色，但有两个特别重要。第一个是由使用虚拟包关联到的一个通用的服务（包“预备”了这些服务）。第二个表示一个包完全取代了另外一个，所以它也能满足依赖性要求。因此，可以创建一个替换而不必使用相同的包名称的包。
				</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>VOCABULARY</em></span>元软件包和虚拟包</strong></p></div></div></div><a
                id="id-1.8.6.5.11.4.2"
                class="indexterm"></a><a
                id="id-1.8.6.5.11.4.3"
                class="indexterm"></a><a
                id="id-1.8.6.5.11.4.4"
                class="indexterm"></a><div
                class="para">
					这里必须明确的从虚拟软件包里面区分出元软件包。元软件包是真实的元件包（包含真实的<code
                  class="filename">.deb</code>文件），其唯一目的是用来表示依赖性关系。
				</div><div
                class="para">
					然而，虚拟软件包并未真实的存在；只是依照通用、逻辑范围 (提供的服务、兼容于标准程序或已存在的软件包等) 辨认真实软件包的手段。
				</div></div><div
              class="section"><div
                class="titlepage"><div><div><h5
                      class="title"><a
                        id="id-1.8.6.5.11.5"></a>5.2.1.4.1. 提供一个“服务”</h5></div></div></div><div
                class="para">
						让我们以范例详述第一个案子：<span
                  class="pkg pkg">postfix</span> 或 <span
                  class="pkg pkg">sendmail</span> 之类的邮件服务器都 “提供” <span
                  class="pkg pkg">mail-transport-agent</span> 虚拟软件包。因此需要启用该等服务的软件包 (如：<span
                  class="pkg pkg">smartlist</span> 或 <span
                  class="pkg pkg">sympa</span> 之类的邮件列表管理器) 只要在其相依性里叙明需要 <span
                  class="pkg pkg">mail-transport-agent</span> 而不是指明还不兼容的可能解决方案清单 (如 <code
                  class="command">postfix | sendmail | exim4 | …</code>)。更进一步来说，在同个机器安装两个邮件服务器是没有用的，因此每个软件包都声明与 <span
                  class="pkg pkg">mail-transport-agent</span> 虚拟软件包冲突。系统忽略冲突的两个软件包，但技术上可以禁止同时安装两个邮件服务器。
					</div><div
                class="sidebar"><div
                  class="titlepage"><div><div><p
                        class="title"><strong><span
                            class="emphasis"><em>DEBIAN 政策</em></span> 虚拟软件包列表</strong></p></div></div></div><a
                  id="id-1.8.6.5.11.5.3.2"
                  class="indexterm"></a><div
                  class="para">
						使用虚拟软件包时，每个人都必须同意其名称。这就是在 Debian 政策内把他们标准化的原因。此清单包括邮件服务器 <span
                    class="pkg pkg">mail-transport-agent</span>、C 语言编译器 <span
                    class="pkg pkg">c-compiler</span>、网页浏览器 <span
                    class="pkg pkg">www-browser</span>、网页服务器 <span
                    class="pkg pkg">httpd</span>、FTP 服务器 <span
                    class="pkg pkg">ftp-server</span>、图形模式终端机仿真器 <span
                    class="pkg pkg">x-terminal-emulator</span> (<code
                    class="command">xterm</code>)、以及窗口管理器 <span
                    class="pkg pkg">x-window-manager</span>。
					</div><div
                  class="para">
						完整清单参见网站。<div
                    class="url">→ <a
                      href="http://www.debian.org/doc/packaging-manuals/virtual-package-names-list.txt">http://www.debian.org/doc/packaging-manuals/virtual-package-names-list.txt</a></div>
					</div></div></div><div
              class="section"><div
                class="titlepage"><div><div><h5
                      class="title"><a
                        id="id-1.8.6.5.11.6"></a>5.2.1.4.2. 和另一个软件包的可交互性</h5></div></div></div><div
                class="para">
						The <code
                  class="literal">Provides</code> field is also interesting when the content of a package is included in a larger package. For example, the <span
                  class="pkg pkg">libdigest-md5-perl</span> Perl module was an optional module in Perl 5.6, and has been integrated as standard in Perl 5.8 (and later versions, such as 5.24 present in <span
                  class="distribution distribution">Stretch</span>). As such, the package <span
                  class="pkg pkg">perl</span> has since version 5.8 declared <code
                  class="literal">Provides: libdigest-md5-perl</code> so that the dependencies on this package are met if the user has Perl 5.8 (or newer). The <span
                  class="pkg pkg">libdigest-md5-perl</span> package itself has eventually been deleted, since it no longer had any purpose when old Perl versions were removed.
					</div><div
                class="figure"><a
                  id="id-1.8.6.5.11.6.3"></a><div
                  class="figure-contents"><div
                    class="mediaobject"><img
                      src="images/virtual-package.png"
                      alt="使用了预备字段来避免中断依赖性关系" /></div></div><p
                  class="title"><strong>图 5.1. 使用了<code
                      class="literal">预备</code>字段来避免中断依赖性关系</strong></p></div><div
                class="para">
						这个功能非常有用，因为它是永远不可能预料到变化莫测的发展，它不能够调整重命名，或者其他自动替换过的软件，所以它是必要的。
					</div><div
                class="sidebar"><div
                  class="titlepage"><div><div><p
                        class="title"><strong><span
                            class="emphasis"><em>回到基本</em></span>Perl，一种编程语言</strong></p></div></div></div><a
                  id="id-1.8.6.5.11.6.5.2"
                  class="indexterm"></a><a
                  id="id-1.8.6.5.11.6.5.3"
                  class="indexterm"></a><div
                  class="para">
						Perl（实用报表提取语言）是非常受欢迎的编程语言。它有许多现成的模块，涵盖了广阔的应用，这些都是由 CPAN（Comprehensive Perl Archive Network，Perl 综合架构网络）提供服务的，CPAN 是一个全面的提供 Perl 软件包的网络。<div
                    class="url">→ <a
                      href="http://www.perl.org/">http://www.perl.org/</a></div> <div
                    class="url">→ <a
                      href="http://www.cpan.org/">http://www.cpan.org/</a></div>
					</div><div
                  class="para">
						由于它是一种解释型语言，Perl 语言编写的程序并不需要在执行之前进行编译。这就是大家称其为“Perl 脚本”的原因。
					</div></div></div><div
              class="section"><div
                class="titlepage"><div><div><h5
                      class="title"><a
                        id="id-1.8.6.5.11.7"></a>5.2.1.4.3. 过去的限制</h5></div></div></div><div
                class="para">
						虚拟软件包曾有很多限制，最麻烦的是没有版本编号。从上例可知，这种 <code
                  class="literal">Depends: libdigest-md5-perl (&gt;= 1.6)</code> 相依性，尽管在 Perl 5.10 里存在，但包管理系统仍认为不满足其相依性 — 虽然实际上已满足了。但是包管理系统不知道相依性没问题，只好选择风险最小的做法，假设其版本是不匹配的。
					</div><div
                class="para">
						This limitation has been lifted in <span
                  class="pkg pkg">dpkg</span> 1.17.11, and is no longer relevant in Stretch. Packages can assign a version to the virtual packages they provide with a dependency such as <code
                  class="literal">Provides: libdigest-md5-perl (= 1.8)</code>.
					</div></div></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      id="id-1.8.6.5.12"></a>5.2.1.5. 替换文件：<code
                      class="literal">替换</code>字段</h4></div></div></div><a
              id="id-1.8.6.5.12.2"
              class="indexterm"></a><a
              id="id-1.8.6.5.12.3"
              class="indexterm"></a><a
              id="id-1.8.6.5.12.4"
              class="indexterm"></a><div
              class="para">
					<code
                class="literal">Replaces</code> 字段指出在其他软件包的文件，但该软件包也合理地取代他们。如果没有指明，<code
                class="command">dpkg</code> 失败，说明它不能覆写另个软件包的文件 (技术上来说，虽可以强迫使用 <code
                class="literal">--force-overwrite</code> 选项，但这不是标准选项)。因此在加入该字段之前，先允许维护者确认潜在可能的问题，并要求维护者先研究它。
				</div><div
              class="para">
					当软件包名称变更时，或者当一个软件包包含在另外一个的时候，此字段的使用是合理的。这也发生在维护者决定从来自相同的源码包的大量二进制包里分发出文件：一个替换的文件不再属于旧的软件包，只有新的才属于。
				</div><div
              class="para">
					如果已安装软件包的所有文件都被替换了，那么该软件包将认为将被删除掉。最后，这个字段会鼓励<code
                class="command">dpkg</code>命令去删除替换掉有冲突的包。
				</div><div
              class="sidebar"><a
                id="sidebar.debtags"></a><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>更进一步</em></span><code
                          class="literal">标签</code>字段</strong></p></div></div></div><div
                class="para">
					In the <span
                  class="pkg pkg">apt</span> example above, we can see the presence of a field that we have not yet described, the <code
                  class="literal">Tag</code> field. This field does not describe a relationship between packages, but is simply a way of categorizing a package in a thematic taxonomy. This classification of packages according to several criteria (type of interface, programming language, domain of application, etc.) has been available for a long time. Despite this, not all packages have accurate tags and it is not yet integrated in all Debian tools; <code
                  class="command">aptitude</code> displays these tags, and allows them to be used as search criteria. For those who are repelled by <code
                  class="command">aptitude</code>'s search criteria, the following website allows navigation of the tag database: <div
                  class="url">→ <a
                    href="https://wiki.debian.org/Debtags">https://wiki.debian.org/Debtags</a></div>
				</div></div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="sect.configuration-scripts"></a>5.2.2. 配置脚本</h3></div></div></div><a
            id="id-1.8.6.6.2"
            class="indexterm"></a><a
            id="id-1.8.6.6.3"
            class="indexterm"></a><a
            id="id-1.8.6.6.4"
            class="indexterm"></a><a
            id="id-1.8.6.6.5"
            class="indexterm"></a><a
            id="id-1.8.6.6.6"
            class="indexterm"></a><div
            class="para">
				除了<code
              class="filename">控制</code>文件之外，每个Debian软件包可能在<code
              class="filename">control.tar.gz</code>的存档中包含了一些脚本，这些脚本在软件包处理的不同的阶段被<code
              class="command">dpkg</code>调用。Debian政策描述了一些可能的细节，在可能的情况下，指定脚本调用它们所收到的参数。这些顺序可能比较复杂，因为如果脚本中任何一步出现问题的时候，<code
              class="command">dpkg</code>进程会通过取消安装或者卸载来尝试恢复到一个令人满意的状态（只要是可能的）。
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>进一步</em></span> <code
                        class="command">dpkg</code> 的数据库</strong></p></div></div></div><a
              id="id-1.8.6.6.8.2"
              class="indexterm"></a><a
              id="id-1.8.6.6.8.3"
              class="indexterm"></a><div
              class="para">
				所有已安装的软件包的配置脚本都存在<code
                class="filename">/var/lib/dpkg/info/</code>目录，在软件包的名字前会有一个文件名的前缀。此目录的每个软件包还包括一个叫<code
                class="filename">.list</code>的文件扩展，包括列表的文件字段属于哪些包。
			</div><div
              class="para">
				<code
                class="filename">/var/lib/dpkg/status</code>文件包含了一些数据块（著名的邮件标题的格式，RFC2822）描述了每个软件包的状态。已经安装的软件包的 <code
                class="filename">control</code> 文件中的信息也会被复制到这里。
			</div></div><div
            class="para">
				在一般情况下，<code
              class="filename">preinst</code>脚本会在安装软件包前执行，而<code
              class="filename">postinst</code>会稍候执行。同样，<code
              class="filename">prerm</code>会在移除一个软件包的之前被调用，<code
              class="filename">postrm</code> 则随后执行。更新软件包相当于是清除掉以前的旧版本并且安装新的软件包。所以在这里我们不可能来详细描述所有的可能的方案，但我们将讨论最常见的两种：安装/更新和移除。
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>小心</em></span> 脚本的符号名称</strong></p></div></div></div><div
              class="para">
				本节中使用特定的名称序列命名配置脚本，例如 <code
                class="command">old-prerm</code> 或 <code
                class="command">new-postinst</code>。它们分别是旧版本软件包（ 在更新前已安装）中包含的 <code
                class="command">prerm</code>脚本和新版本软件包（由本次更新所安装）中包含的 <code
                class="command">postinst</code> 脚本。
			</div></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>提示</em></span>状态图</strong></p></div></div></div><div
              class="para">
				Manoj Srivastava made these diagrams explaining how the configuration scripts are called by <code
                class="command">dpkg</code>. Similar diagrams have also been developed by the Debian Women project; they are a bit simpler to understand, but less complete. <div
                class="url">→ <a
                  href="https://people.debian.org/~srivasta/MaintainerScripts.html">https://people.debian.org/~srivasta/MaintainerScripts.html</a></div> <div
                class="url">→ <a
                  href="https://www.debian.org/doc/debian-policy/#maintainer-script-flowcharts">https://www.debian.org/doc/debian-policy/#maintainer-script-flowcharts</a></div>
			</div></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      id="id-1.8.6.6.12"></a>5.2.2.1. 安装和升级</h4></div></div></div><a
              id="id-1.8.6.6.12.2"
              class="indexterm"></a><div
              class="para">
					这里告诉你，安装的时候发生了什么（或者是更新）
				</div><div
              xmlns:d="http://docbook.org/ns/docbook"
              class="orderedlist"><ol><li
                  class="listitem"><div
                    class="para">
							对于升级，<code
                      class="command">dpkg</code>会调用<code
                      class="command">old-prerm 升级 <em
                        class="replaceable">新版本</em></code>.
						</div></li><li
                  class="listitem"><div
                    class="para">
							还是对于升级，<code
                      class="command">dpkg</code>执行<code
                      class="command">new-preinst 升级 <em
                        class="replaceable">旧版本</em></code>；对于第一个安装，它会执行 <code
                      class="command">new-preinst 安装</code>。它可能会增加旧版本的最后一个参数，如果软件包已经被安装或者是删除了（但没有清除合并掉旧版本，那么这个配置文件会被保留）。
						</div></li><li
                  class="listitem"><div
                    class="para">
							新的软件包文件被解压。如果文件已经存在，就被会替换，同时会产生一个临时的备份副本。
						</div></li><li
                  class="listitem"><div
                    class="para">
							对于更新，<code
                      class="command">dpkg</code>执行<code
                      class="command">old-postrm 升级 <em
                        class="replaceable">新版本</em></code>。
						</div></li><li
                  class="listitem"><div
                    class="para">
							<code
                      class="command">dpkg</code>更新所有的内部数据（文件列表，配置脚本等），并删除被替换文件的备份。这是一条不归路： ） <code
                      class="command">dpkg</code>将不能够再访问回退到之前状态所需要的所有元素。
						</div></li><li
                  class="listitem"><div
                    class="para">
							<code
                      class="command">dpkg</code> 将更新配置文件，无法自动管理此工作时，要求用户做决定。详情在此 <a
                      class="xref"
                      href="sect.package-meta-information.html#sect.conffiles">第 5.2.3 节 “校验，配置文件列表”</a>。
						</div></li><li
                  class="listitem"><div
                    class="para">
							最后，<code
                      class="command">dpkg</code> 通过执行 <code
                      class="command">new-postinst configure <em
                        class="replaceable">最近一次配置的版本号</em></code> 对软件包进行配置。
						</div></li></ol></div></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      id="id-1.8.6.6.13"></a>5.2.2.2. 软件包移除</h4></div></div></div><div
              class="para">
					这里是当移除一个软件包的时候发生了什么：
				</div><div
              xmlns:d="http://docbook.org/ns/docbook"
              class="orderedlist"><ol><li
                  class="listitem"><div
                    class="para">
							<code
                      class="command">dpkg</code> 调用<code
                      class="command">prerm 移除</code>。
						</div></li><li
                  class="listitem"><div
                    class="para">
							<code
                      class="command">dpkg</code> 移除了所有的软件包文件，只剩下了配置文件和配置的脚本。
						</div></li><li
                  class="listitem"><div
                    class="para">
							<code
                      class="command">dpkg</code> 运行 <code
                      class="command">postrm remove</code>。移除所有配置脚本，保留 <code
                      class="filename">postrm</code>。若用户未选择 “清除” 选项，则工作完成。
						</div></li><li
                  class="listitem"><div
                    class="para">
							对于一个完整的清除包（由<code
                      class="command">dpkg --purge</code>或<code
                      class="command">dpkg -P</code>发出的），配置文件也将会被删除，同时一些副本（<code
                      class="filename">*.dpkg-tmp</code>,<code
                      class="filename">*.dpkg-old</code>,<code
                      class="filename">*.dpkg-new</code>）和缓存文件也会被删除掉；<code
                      class="command">dpkg</code>这时会执行<code
                      class="command">postrm purge</code>。
						</div></li></ol></div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>术语</em></span> Purge，完全移除</strong></p></div></div></div><a
                id="id-1.8.6.6.13.4.2"
                class="indexterm"></a><div
                class="para">
					当Debian的软件包被移除掉的时候，该软件包的配置文件会被保留下来以便重新安装。同样，守护程序产生的数据（比如LDAP的服务器目录内容，或者是SQL服务器的数据库内容）也常常会被保留。
				</div><div
                class="para">
					移除掉软件包所关联的所有数据，必须使用“purge”命令，<code
                  class="command">dpkg -P<em
                    class="replaceable">软件包</em></code>，<code
                  class="command">apt-get remove --purge <em
                    class="replaceable">软件包</em></code> 或者是<code
                  class="command">aptitude purge <em
                    class="replaceable">软件包</em></code>。
				</div><div
                class="para">
					移除该等数据，不能掉以轻心去清除。
				</div></div><a
              id="id-1.8.6.6.13.5"
              class="indexterm"></a><div
              class="para">
					<code
                class="filename">config</code> 脚本补充前述的 4 个脚本，软件包以 <code
                class="command">debconf</code> 取得配置用的信息。安装过程中，此脚本以 <code
                class="command">debconf</code> 指令询问用户详细的问题。把回应记录在 <code
                class="command">debconf</code> 数据库供未来的参考。在安装之前先由 <code
                class="command">apt</code> 逐一运行该等脚本，归纳问题与回答。事前与事后安装脚本可使用该等信息回应用户的期望。
				</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>工具</em></span> <code
                          class="command">debconf</code></strong></p></div></div></div><a
                id="id-1.8.6.6.13.7.2"
                class="indexterm"></a><div
                class="para">
					<code
                  class="command">debconf</code> 用于解决在 Debian 安装过程中不断出现的问题询问。如果没有一个最小的配置，所有 Debian 软件包都不具备功能，这个最小配置需要通过调用 <code
                  class="filename">postinst</code> shell 脚本 (和其它类似脚本) 里的 <code
                  class="command">echo</code> 与 <code
                  class="command">read</code> 命令来询问。也就是说在大型安装或升级过程里，用户必须在电脑旁回应这些随时出现的问题。感谢 <code
                  class="command">debconf</code> 工具的出现，这些人工交互几乎全部免除了。
				</div><div
                class="para">
					<code
                  class="command">debconf</code> 包括很多有趣的功能：要求开发者指明用户的交互；允许本地化显示给用户的字符串 (描述交互的所有翻译保存在 <code
                  class="filename">templates</code> 文件)；显示给用户的前端问题 (文本模式、图形模式、非交互式)；把回应集中在数据库供其他电脑使用 ... 但最重要的已可把所有问题，在安装或升级之前，以一列的模式显示给用户。用户可以放任系统自行安装，不必待在电脑旁，紧盯屏幕等待问题。
				</div></div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="sect.conffiles"></a>5.2.3. 校验，配置文件列表</h3></div></div></div><a
            id="id-1.8.6.7.2"
            class="indexterm"></a><a
            id="id-1.8.6.7.3"
            class="indexterm"></a><a
            id="id-1.8.6.7.4"
            class="indexterm"></a><a
            id="id-1.8.6.7.5"
            class="indexterm"></a><a
            id="id-1.8.6.7.6"
            class="indexterm"></a><div
            class="para">
				除了稍早提过的维护者脚本与控制数据外，在 Debian 软件包内的 <code
              class="filename">control.tar.gz</code> 可能包括若干有趣的文件。首先，<code
              class="filename">md5sums</code>，包括软件包内所有文件的 MD5 校验。它的优点是允许 <code
              class="command">dpkg --verify</code> (详情见 <a
              class="xref"
              href="sect.supervision.html#sect.dpkg-verify">第 14.3.3.1 节 “Auditing Packages with <code
                class="command">dpkg --verify</code>”</a>) 检查该等文件在安装后是否被修改。若此文件不存在，<code
              class="command">dpkg</code> 将在安装时动态产生一个 (并且如同其他控制文件般保存在 dpkg 数据库)。
			</div><div
            class="para">
				<code
              class="filename">conffiles</code> 列出必须当配置文件处理的软件包文件。管理员可修改配置文件，升级软件包时 <code
              class="command">dpkg</code> 将保留这些变动。
			</div><div
            class="para">
				实际上，在这种情况下，<code
              class="command">dpkg</code>的行为会尽可能地智能：如果两个版本之间并没有改变标准的配置文件，那么<code
              class="command">dpkg</code>就什么也不会作。但是，如果文件已经被修改，它会尝试更新此文件。这会产生两种可能的情况：一是管理员没有碰配置文件，在这种情况下<code
              class="command">dpkg</code>会自动安装新版本；二是文件已经被修改了，在这种情况下<code
              class="command">dpkg</code>会询问管理员希望使用哪个版本（旧版本或者新的）。为了帮助用户作出选择，<code
              class="command">dpkg</code>会提供“<code
              class="command">差异</code>”，这会显示两个版本之间的差异。如果用户选择保留旧的版本，新的将被存储在文件夹的同一个位置并以<code
              class="filename">.dpkg-dist</code>为后缀名的文件中。另外一个可能的操作是由暂时中断的<code
              class="command">dpkg</code>来编辑该文件，并试图重新恢复相关的修改（之前被验证的<code
              class="command">差异</code>）。
			</div><div
            class="sidebar"><a
              id="sidebar.questions-conffiles"></a><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>更进一步</em></span> 避免配置文件问题</strong></p></div></div></div><div
              class="para">
				<code
                class="command">dpkg</code> 处理配置文件升级，但经常中断作业，要求管理者键入数据。如此一来，就不能以无中断方式一气呵成升级作业。此指令提供选项让系统依同样的逻辑自动回应：<code
                class="command">--force-confold</code> 保留该文件的旧版本；<code
                class="command">--force-confnew</code> 使用该文件的新版本 (即使该文件未被管理者修改，仍使用指定的选择，极少发生问题)。加入 <code
                class="command">--force-confdef</code> 选项告诉 <code
                class="command">dpkg</code> 在可能情况下自行决定 (换句话说，不改变原配置文件)，只在其他的情况下，才使用 <code
                class="command">--force-confnew</code> 或 <code
                class="command">--force-confold</code>。
			</div><div
              class="para">
				这些选项使用 <code
                class="command">dpkg</code>，但是大多数时间管理员会直接用 <code
                class="command">aptitude</code> 或<code
                class="command">apt-get</code>。实际上，有必要知道 dpkg 的语法参数来使用<code
                class="command">dpkg</code>命令（命令行的界面是非常相似的）。
			</div><pre
              class="screen">
<code
                class="computeroutput"># </code><strong
                class="userinput"><code>apt -o DPkg::options::="--force-confdef" -o DPkg::options::="--force-confold" full-upgrade</code></strong></pre><div
              class="para">
				此选项可直接保存在 <code
                class="command">apt</code> 的配置内。只需把下列这行字写入 <code
                class="filename">/etc/apt/apt.conf.d/local</code> 文件内：
			</div><div
              class="informalexample"><pre
                class="programlisting">
DPkg::options { "--force-confdef"; "--force-confold"; }</pre></div><div
              class="para">
				把此选项纳入配置文件，意味着 <code
                class="command">aptitude</code> 之类的图形接口程序也会使用这些选项。
			</div></div><div
            class="sidebar"><a
              id="sidebar.questions-conffiles-bis"></a><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>更进一步</em></span> 强制 dpkg 询问配置文件问题</strong></p></div></div></div><div
              class="para">
				<code
                class="command">--force-confask</code> 选项要求 <code
                class="command">dpkg</code> 显示有关配置文件的问题，即使不是必要的问题也需显示。因此，以此选项重新安装软件包时，<code
                class="command">dpkg</code> 将再询管理者修改过的配置文件问题。这种方式极为便利，尤其是重新安装已经被删除且无可用复本的原始配置文件：普通的重新安装无效，因为 <code
                class="command">dpkg</code> 认为移除是合法的修改，因此不会安装预期的配置文件。
			</div></div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="packaging-system.html"><strong>上一页</strong>第 5 章 包管理系统：工具和基本原则</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>上一级</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>起始页</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.source-package-structure.html"><strong>下一页</strong>5.3. 源软件包的结构</a></li></ul><div
        id="translated_pages"><ul><li><a
              href="../ar-MA/sect.package-meta-information.html">ar-MA</a></li><li><a
              href="../da-DK/sect.package-meta-information.html">da-DK</a></li><li><a
              href="../de-DE/sect.package-meta-information.html">de-DE</a></li><li><a
              href="../el-GR/sect.package-meta-information.html">el-GR</a></li><li><a
              href="../en-US/sect.package-meta-information.html">en-US</a></li><li><a
              href="../es-ES/sect.package-meta-information.html">es-ES</a></li><li><a
              href="../fa-IR/sect.package-meta-information.html">fa-IR</a></li><li><a
              href="../fr-FR/sect.package-meta-information.html">fr-FR</a></li><li><a
              href="../hr-HR/sect.package-meta-information.html">hr-HR</a></li><li><a
              href="../id-ID/sect.package-meta-information.html">id-ID</a></li><li><a
              href="../it-IT/sect.package-meta-information.html">it-IT</a></li><li><a
              href="../ja-JP/sect.package-meta-information.html">ja-JP</a></li><li><a
              href="../ko-KR/sect.package-meta-information.html">ko-KR</a></li><li><a
              href="../nb-NO/sect.package-meta-information.html">nb-NO</a></li><li><a
              href="../pl-PL/sect.package-meta-information.html">pl-PL</a></li><li><a
              href="../pt-BR/sect.package-meta-information.html">pt-BR</a></li><li><a
              href="../ro-RO/sect.package-meta-information.html">ro-RO</a></li><li><a
              href="../ru-RU/sect.package-meta-information.html">ru-RU</a></li><li><a
              href="../tr-TR/sect.package-meta-information.html">tr-TR</a></li><li><a
              href="../vi-VN/sect.package-meta-information.html">vi-VN</a></li><li><a
              href="../zh-CN/sect.package-meta-information.html">zh-CN</a></li><li><a
              href="../zh-TW/sect.package-meta-information.html">zh-TW</a></li></ul></div></body></html>
