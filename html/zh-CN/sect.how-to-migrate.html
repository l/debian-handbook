<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">3.2. 如何迁移</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-9-zh-CN-1.0-1" /><meta
        name="keywords"
        content="当前设置, 重用, 迁移" /><link
        rel="home"
        href="index.html"
        title="Debian 管理员手册" /><link
        rel="up"
        href="existing-setup.html"
        title="第 3 章 分析当前设置与迁移" /><link
        rel="prev"
        href="existing-setup.html"
        title="第 3 章 分析当前设置与迁移" /><link
        rel="next"
        href="installation.html"
        title="第 4 章 安装" /><meta
        name="viewport"
        content="width=device-width, initial-scale=1" /><meta
        name="flattr:id"
        content="4pz9jq" /><link
        rel="canonical"
        href="http://l.github.io/debian-handbook/html/zh-CN/sect.how-to-migrate.html" /></head><body><noscript><iframe
          src="//www.googletagmanager.com/ns.html?id=GTM-5H35QX"
          height="0"
          width="0"
          style="display:none;visibility:hidden"></iframe></noscript><script
        type="text/javascript">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&amp;l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5H35QX');</script><div
        id="banner"><a
          href="../../"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="index.html"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="existing-setup.html"><strong>上一页</strong></a></li><li
          class="home">Debian 管理员手册</li><li
          class="next"><a
            accesskey="n"
            href="installation.html"><strong>下一页</strong></a></li></ul><div
        class="section"><div
          class="titlepage"><div><div><h2
                class="title"><a
                  id="sect.how-to-migrate"></a>3.2. 如何迁移</h2></div></div></div><a
          id="id-1.6.5.2"
          class="indexterm"></a><div
          class="para">
			为了确保后续的服务，必须依照计划运行迁移的作业。每种操作系统都需遵守这个原则。
		</div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="id-1.6.5.4"></a>3.2.1. 流行度调查和身份识别服务</h3></div></div></div><div
            class="para">
				如你看到的，该步骤是必要的。一个严谨的管理员应当确切的知道每部服务器的确切角色，但是角色可以被改变，有时候有经验的用户会安装一些服务。了解这些服务的功能让你知道如何处理它，而不是粗暴的删除它们。
			</div><div
            class="para">
				基于这个目的，迁移服务器前先告知用户是明智之举。把用户拉入计划里，于迁移之前先安装常用的自由软件于其桌面电脑中，迁移之后自然碰到 Debian、Libre Office 与 Mozilla 等软件。
			</div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      id="id-1.6.5.4.4"></a>3.2.1.1. 网络与程序</h4></div></div></div><a
              id="id-1.6.5.4.4.2"
              class="indexterm"></a><div
              class="para">
					<code
                class="command">nmap</code> 工具 (在同名软件包中) 可以在未登录的前提下，快速地经由网络链接机器辨识互联网服务。在另部机器键入命令链接至同个网络：
				</div><pre
              class="screen">
<code
                class="computeroutput">$ </code><strong
                class="userinput"><code>nmap mirwiz</code></strong>
<code
                class="computeroutput">Starting Nmap 7.40 ( https://nmap.org ) at 2017-06-06 14:41 CEST
Nmap scan report for mirwiz (192.168.1.104)
Host is up (0.00062s latency).
Not shown: 992 closed ports
PORT     STATE SERVICE
22/tcp   open  ssh
25/tcp   open  smtp
80/tcp   open  http
111/tcp  open  rpcbind
139/tcp  open  netbios-ssn
445/tcp  open  microsoft-ds
5666/tcp open  nrpe
9999/tcp open  abyss

Nmap done: 1 IP address (1 host up) scanned in 0.06 seconds</code></pre><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>替代</em></span> 使用 <code
                          class="command">netstat</code> 以查找可用服务列表</strong></p></div></div></div><div
                class="para">
					在 Linux 机器里，<code
                  class="command">netstat -tupan</code> 指令可显示使用中或待决的 TCP 数，以及运行程序的 UDP 端口。辨识网络提供的服务量。
				</div></div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>更进一步</em></span> IPv6</strong></p></div></div></div><div
                class="para">
					有些网络指令可在 IPv4 (通常是缺省的) 或 IPv6 运行。包括 <code
                  class="command">nmap</code> 与 <code
                  class="command">netstat</code> 指令，以及其他，如 <code
                  class="command">route</code> 或 <code
                  class="command">ip</code>。可用 <em
                  class="parameter"><code>-6</code></em> 命令行选项启动它们。
				</div></div><div
              class="para">
					Unix 机器的服务器提供 shell 帐号给用户，在拥有者缺席的情况下可以决定该进程是否在背景运行。指令 <code
                class="command">ps auxw</code> 显示所有进程的用户辨识码。将此等信息与 <code
                class="command">who</code> 指令的输出互相比较，就能辨识出在背景运行的暧昧或不明服务与程序。以 <code
                class="filename">crontabs</code> (依用户自动排串行出所有的作业) 可查看服务器提供的服务信息 (<code
                class="command">cron</code> 的完整说明在 <a
                class="xref"
                href="sect.task-scheduling-cron-atd.html">第 9.7 节 “使用 <code
                  class="command">cron</code> 和 <code
                  class="command">atd</code>运行计划任务”</a>)。
				</div><div
              class="para">
					任何状况下，都该先备份您的服务器：用户报告问题时，就能复原它。
				</div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="id-1.6.5.5"></a>3.2.2. 备份配置</h3></div></div></div><div
            class="para">
				保留所有设备的备份供升级后服务器的参考。至少应备份配置档。
			</div><div
            class="para">
				Unix 机器的配置档，通常在 <code
              class="filename">/etc/</code> 文件夹内，有时放在 <code
              class="filename">/usr/local/</code> 的次文件夹里。若从源代码开始安装程序而不是由软件包安装，配置档就会放在前述的次文件夹内。偶而，还可在 <code
              class="filename">/opt/</code> 找到配置档。
			</div><div
            class="para">
				在数据管理服务 (如数据库) 时，强烈建议以标准格式导出的数据容易被新软件接受。通常是文本格式，也可能是从数据库以 SQL 下载，或从 LDAP 服务器下载 LDIF 文件。
			</div><div
            class="figure"><a
              id="id-1.6.5.5.5"></a><div
              class="figure-contents"><div
                class="mediaobject"><img
                  src="images/existing-setup-2.png"
                  alt="备份数据库" /></div></div><p
              class="title"><strong>图 3.2. 备份数据库</strong></p></div><div
            class="para">
				每个服务器都不一样，不能详述所有个案。比较各软件的文档辨认导出 (即，再导入) 的方式以及需要人工处理的部分。此书处理 Linux 服务器程序的主要配置。
			</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="id-1.6.5.6"></a>3.2.3. 接手现有的 Debian 服务器</h3></div></div></div><a
            id="id-1.6.5.6.2"
            class="indexterm"></a><a
            id="id-1.6.5.6.3"
            class="indexterm"></a><a
            id="id-1.6.5.6.4"
            class="indexterm"></a><div
            class="para">
				先分析正在运行 Debian 的机器，才能有效地接管维护工作。
			</div><div
            class="para">
				第一个查看的文件是 <code
              class="filename">/etc/debian_version</code>，通常包括 Debian 系统的版本编号 (它是 <span
              class="emphasis"><em>base-files</em></span> 软件包的一部分)。若以 <code
              class="literal"><em
                class="replaceable">代码</em>/sid</code> 方式呈现，表示此系统从该代码版本取得的最新版软件包 (测试版或不稳定版)。
			</div><div
            class="para">
				<code
              class="command">apt-show-versions</code> 程序 (来自 Debian 同名软件包) 检查安装的软件包并辨识可用的版本。<code
              class="command">aptitude</code> 以表单的方式，做同样的工作。
			</div><div
            class="para">
				查看 <code
              class="filename">/etc/apt/sources.list</code> 文件 (以及 <code
              class="filename">/etc/apt/sources.list.d/</code> 文件夹) 可看到已安装 Debian 软件包的来源。若出现不明来源，管理员可能选择重新安装电脑系统确保其软件与 Debian 兼容。
			</div><div
            class="para">
				<code
              class="filename">sources.list</code> 文件是个重要的指针：大部分的管理者保留一份使用中的 APT 来源清单。但不能忘记曾使用的来源可能被删除，有可能以人工方式安装 (以 <code
              class="command">dpkg</code> 指令) 从互联网随机抓来的软件包。在此情况下，可能表面上是 “标准” Debian。碰到这种情况应放弃外来的软件包 (在不寻常的文件夹出现 <code
              class="filename">deb</code> 文件、软件包版本编号出现 Debian 未使用的特殊前置字符，诸 <code
              class="literal">ubuntu</code> 或 <code
              class="literal">lmde</code>，等字样。)
			</div><div
            class="para">
				同样的，分析 <code
              class="filename">/usr/local/</code> 文件夹的内容，其目的是收录编译后与手动安装后的程序。列出以此方式安装的软件清单，指出一个问题，为什么不使用 Debian 对应的软件包。
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>速看</em></span> <span
                        class="pkg pkg">cruft</span></strong></p></div></div></div><div
              class="para">
				<span
                class="pkg pkg">cruft</span> 软件包列出未被其他软件包拥有的文件。它有一些筛选器 (差不多有效，但或多或少过时) 以避免报告合法的文件 (Debian 软件包产生的文件，或未被<code
                class="command">dpkg</code> 管理的配置文件等)。
			</div><div
              class="para">
				小心不要盲目地删除可能被 <code
                class="command">cruft</code> 列出的文件！
			</div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="id-1.6.5.7"></a>3.2.4. 安装 Debian</h3></div></div></div><div
            class="para">
				知道当前服务器的必要信息后，就可以关闭它并开始安装 Debian。
			</div><a
            id="id-1.6.5.7.3"
            class="indexterm"></a><div
            class="para">
				依照电脑的架构，选择适当的版本。近几年的 PC，很可能是 amd64 (稍旧的是 i386)。其他的情况，则依照安装的旧系统来判断。
			</div><div
            class="para">
				<a
              class="xref"
              href="sect.how-to-migrate.html#tab-corresp">表 3.1</a> 不是完整的，但相当有用。任何情况下，电脑的原始文档是最有用的数据源。
			</div><div
            class="table"><a
              id="tab-corresp"></a><p
              class="title"><strong>表 3.1. 操作系统与架构对照表</strong></p><div
              class="table-contents"><table
                xmlns:d="http://docbook.org/ns/docbook"
                class="lt-4-cols gt-7-rows"
                summary="操作系统与架构对照表"><colgroup><col /><col /></colgroup><thead><tr><th>操作系统</th><th>架构</th></tr></thead><tbody><tr><td>DEC Unix (OSF/1)</td><td>alpha, mipsel</td></tr><tr><td>HP Unix</td><td>ia64、hppa</td></tr><tr><td>IBM AIX</td><td>powerpc</td></tr><tr><td>Irix</td><td>mips</td></tr><tr><td>OS X</td><td>amd64、powerpc、 i386</td></tr><tr><td>z/OS、MVS</td><td>s390x、s390</td></tr><tr><td>Solaris, SunOS</td><td>sparc, i386, m68k</td></tr><tr><td>Ultrix</td><td>mips</td></tr><tr><td>VMS</td><td>alpha</td></tr><tr><td>Windows 95/98/ME</td><td>i386</td></tr><tr><td>Windows NT/2000</td><td>i386, alpha, ia64, mipsel</td></tr><tr><td>Windows XP / Windows Server 2008</td><td>i386, amd64, ia64</td></tr><tr><td>Windows RT</td><td>armel, armhf, arm64</td></tr><tr><td>Windows Vista / Windows 7-8-10</td><td>i386, amd64</td></tr></tbody></table></div></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>硬件</em></span> 64 位电脑 vs 32 位电脑</strong></p></div></div></div><a
              id="id-1.6.5.7.7.2"
              class="indexterm"></a><a
              id="id-1.6.5.7.7.3"
              class="indexterm"></a><div
              class="para">
				近年的电脑使用 64 位 Intel 或 AMD 处理器，兼容于稍旧的 32 位处理器；为 “i386” 架构编绎的软件也适用。从另个角度来看，此兼容的软件无法充份发挥新处理器的性能。所以 Debian 提供 “amd64” 架构的版本，针对最新的 AMD 芯片以及 Intel “em64t” 处理器 (包括大多数的 Core 系列)，它们极度类似 AMD64。
			</div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="id-1.6.5.8"></a>3.2.5. 安装与配置选定的服务</h3></div></div></div><div
            class="para">
				Debian 安装之后，必须逐一安装与设置该电脑的所有服务。新的配置必须考量过去的配置才能确保转换的顺利。前述两个步骤的信息对于完成此部分极为重要。
			</div><div
            class="figure"><a
              id="id-1.6.5.8.3"></a><div
              class="figure-contents"><div
                class="mediaobject"><img
                  src="images/existing-setup-4.png"
                  alt="安装指定的服务" /></div></div><p
              class="title"><strong>图 3.3. 安装指定的服务</strong></p></div><div
            class="para">
				全面进入此练习前，强烈建议您阅读本书其他部分。才能够较精细地了解对预期服务的配置方式。
			</div><div
            class="para">
			</div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="existing-setup.html"><strong>上一页</strong>第 3 章 分析当前设置与迁移</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>上一级</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>起始页</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="installation.html"><strong>下一页</strong>第 4 章 安装</a></li></ul><div
        id="translated_pages"><ul><li><a
              href="../ar-MA/sect.how-to-migrate.html">ar-MA</a></li><li><a
              href="../da-DK/sect.how-to-migrate.html">da-DK</a></li><li><a
              href="../de-DE/sect.how-to-migrate.html">de-DE</a></li><li><a
              href="../el-GR/sect.how-to-migrate.html">el-GR</a></li><li><a
              href="../en-US/sect.how-to-migrate.html">en-US</a></li><li><a
              href="../es-ES/sect.how-to-migrate.html">es-ES</a></li><li><a
              href="../fa-IR/sect.how-to-migrate.html">fa-IR</a></li><li><a
              href="../fr-FR/sect.how-to-migrate.html">fr-FR</a></li><li><a
              href="../hr-HR/sect.how-to-migrate.html">hr-HR</a></li><li><a
              href="../id-ID/sect.how-to-migrate.html">id-ID</a></li><li><a
              href="../it-IT/sect.how-to-migrate.html">it-IT</a></li><li><a
              href="../ja-JP/sect.how-to-migrate.html">ja-JP</a></li><li><a
              href="../ko-KR/sect.how-to-migrate.html">ko-KR</a></li><li><a
              href="../nb-NO/sect.how-to-migrate.html">nb-NO</a></li><li><a
              href="../pl-PL/sect.how-to-migrate.html">pl-PL</a></li><li><a
              href="../pt-BR/sect.how-to-migrate.html">pt-BR</a></li><li><a
              href="../ro-RO/sect.how-to-migrate.html">ro-RO</a></li><li><a
              href="../ru-RU/sect.how-to-migrate.html">ru-RU</a></li><li><a
              href="../tr-TR/sect.how-to-migrate.html">tr-TR</a></li><li><a
              href="../vi-VN/sect.how-to-migrate.html">vi-VN</a></li><li><a
              href="../zh-CN/sect.how-to-migrate.html">zh-CN</a></li><li><a
              href="../zh-TW/sect.how-to-migrate.html">zh-TW</a></li></ul></div></body></html>
