<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">Capítulo 10. Infraestrutura de Rede</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.1" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-8-pt-BR-1.0-1" /><meta
        name="keywords"
        content="Rede, Gateway, TCP/IP, IPv6, DNS, Bind, DHCP, QoS" /><link
        rel="home"
        href="index.html"
        title="O Manual do Administrador Debian" /><link
        rel="up"
        href="index.html"
        title="O Manual do Administrador Debian" /><link
        rel="prev"
        href="sect.power-management.html"
        title="9.12. Gerenciamento de Energia: Advanced Configuration and Power Interface (ACPI)" /><link
        rel="next"
        href="sect.virtual-private-network.html"
        title="10.2. Rede Privada Virtual" /><link
        rel="canonical"
        href="http://l.github.io/debian-handbook/html/pt-BR/network-infrastructure.html" /></head><body
      class="draft "><noscript><iframe
          src="//www.googletagmanager.com/ns.html?id=GTM-5H35QX"
          height="0"
          width="0"
          style="display:none;visibility:hidden"></iframe></noscript><script
        type="text/javascript">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&amp;l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5H35QX');</script><div
        id="banner"><a
          href="http://debian-handbook.info/get/"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="http://debian-handbook.info"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="sect.power-management.html"><strong>Anterior</strong></a></li><li
          class="home">O Manual do Administrador Debian</li><li
          class="next"><a
            accesskey="n"
            href="sect.virtual-private-network.html"><strong>Próxima</strong></a></li></ul><div
        xml:lang="pt-BR"
        class="chapter"
        lang="pt-BR"><div
          class="titlepage"><div><div><h1
                class="title"><a
                  id="network-infrastructure"></a>Capítulo 10. Infraestrutura de Rede</h1></div></div></div><div
          class="toc"><dl
            class="toc"><dt><span
                class="section"><a
                  href="network-infrastructure.html#sect.gateway">10.1. Gateway</a></span></dt><dt><span
                class="section"><a
                  href="sect.virtual-private-network.html">10.2. Rede Privada Virtual</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="sect.virtual-private-network.html#sect.openvpn">10.2.1. OpenVPN</a></span></dt><dt><span
                    class="section"><a
                      href="sect.virtual-private-network.html#sect.ssh-vpn">10.2.2. Rede Privada Virtual com SSH</a></span></dt><dt><span
                    class="section"><a
                      href="sect.virtual-private-network.html#sect.ipsec">10.2.3. IPsec</a></span></dt><dt><span
                    class="section"><a
                      href="sect.virtual-private-network.html#sect.pptp">10.2.4. PPTP</a></span></dt></dl></dd><dt><span
                class="section"><a
                  href="sect.quality-of-service.html">10.3. Qualidade do Serviço</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="sect.quality-of-service.html#sect.qos-principe">10.3.1. Princípio e Mecanismo</a></span></dt><dt><span
                    class="section"><a
                      href="sect.quality-of-service.html#sect.qos-config">10.3.2. Configurando e implementando</a></span></dt></dl></dd><dt><span
                class="section"><a
                  href="sect.dynamic-routing.html">10.4. Roteamento Dinâmico</a></span></dt><dt><span
                class="section"><a
                  href="sect.ipv6.html">10.5. IPv6</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="sect.ipv6.html#sect.ipv6-tunneling">10.5.1. Túneis</a></span></dt></dl></dd><dt><span
                class="section"><a
                  href="sect.domain-name-servers.html">10.6. Servidores de Nomes de Domínio (DNS)</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="sect.domain-name-servers.html#sect.dns-principe">10.6.1. Princípio e Mecanismo</a></span></dt><dt><span
                    class="section"><a
                      href="sect.domain-name-servers.html#sect.dns-config">10.6.2. Configurando</a></span></dt></dl></dd><dt><span
                class="section"><a
                  href="sect.dhcp.html">10.7. DHCP</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="sect.dhcp.html#sect.dhcp-config">10.7.1. Configurando</a></span></dt><dt><span
                    class="section"><a
                      href="sect.dhcp.html#sect.dhcp-dns">10.7.2. DHCP e DNS</a></span></dt></dl></dd><dt><span
                class="section"><a
                  href="sect.network-diagnosis-tools.html">10.8. Ferramentas de Diagnóstico de Rede</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="sect.network-diagnosis-tools.html#sect.netstat">10.8.1. Diagnóstico Local: <code
                        class="command">netstat</code></a></span></dt><dt><span
                    class="section"><a
                      href="sect.network-diagnosis-tools.html#sect.nmap">10.8.2. Diagnóstico Remoto: <code
                        class="command">nmap</code></a></span></dt><dt><span
                    class="section"><a
                      href="sect.network-diagnosis-tools.html#sect.sniffers">10.8.3. Sniffers: <code
                        class="command">tcpdump</code> e <code
                        class="command">wireshark</code></a></span></dt></dl></dd></dl></div><div
          class="highlights"><div
            class="para">
		O Linux dispõe de toda a tradição do Unix na área de redes, e o Debian fornece um conjunto completo de ferramentas para criar e gerenciar tais redes. Este capítulo apresenta estas ferramentas.
	</div></div><div
          class="section"><div
            class="titlepage"><div><div><h2
                  class="title"><a
                    id="sect.gateway"></a>10.1. Gateway</h2></div></div></div><div
            class="para">
			Um gateway é um sistema de ligação de várias redes. Este termo frequentemente se refere ao "ponto de saída" de uma rede local no caminho obrigatório para endereços IP externos. O gateway está ligado a cada uma das redes que une e atua como um roteador para transmitir pacotes IP entre suas várias interfaces.
		</div><a
            id="idm140035057401632"
            class="indexterm"></a><a
            id="idm140035053280672"
            class="indexterm"></a><a
            id="idm140035058195376"
            class="indexterm"></a><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>DE VOLTA AO BÁSICO</em></span> pacote IP</strong></p></div></div></div><a
              id="idm140035073595408"
              class="indexterm"></a><div
              class="para">
			A maioria das redes atualmente utiliza o protocolo IP (<span
                class="emphasis"><em>Internet Protocol</em></span>). Este protocolo segmenta a transmissão dos dados em pacotes de tamanho limitado. Cada pacote contém, em adição aos seus dados úteis, uma quantidade de detalhes necessários para seu próprio roteamento.
		</div></div><div
            class="sidebar"><a
              id="sidebar.tcp-udp"></a><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>DE VOLTA AO BÁSICO</em></span> TCP/UDP</strong></p></div></div></div><a
              id="idm140035060698352"
              class="indexterm"></a><a
              id="idm140035066087168"
              class="indexterm"></a><a
              id="idm140035066085728"
              class="indexterm"></a><a
              id="idm140035066084768"
              class="indexterm"></a><div
              class="para">
			Muitos programas não manipulam os pacotes individuais por si sós, mesmo que os dados que eles transmitam trafegem sobre IP; Eles geralmente usam TCP (<span
                class="emphasis"><em>Transmission Control Protocol</em></span>). TCP é uma camada acima do IP que permite o estabelecimento de conexões dedicadas a fluxos de dados entre dois pontos. Os programas então vêem apenas um ponto de entrada no qual os dados podem ser enviados com a garantia que os mesmos dados vão sair sem perdas (e na mesma sequência) no ponto de saída na outra extremidade da conexão. Embora muitos tipos de erros possam acontecer em camadas mais baixas, eles são compensados pelo TCP: pacotes perdidos são retransmitidos, e pacotes chegando fora de ordem (por exemplo, se pegaram caminhos diferentes) são reordenados corretamente.
		</div><div
              class="para">
			Outro protocolo que se baseia no IP é o UDP (<span
                class="emphasis"><em>User Datagram Protocol</em></span>). Ao contrário do TCP, ele é orientado a pacote. Seus objetivos são diferentes: O objetivo do UDP é apenas transmitir um pacote de uma aplicação para outra. O protocolo não tenta compensar possíveis perdas de pacotes no caminho, nem garante que pacotes são recebidos na ordem em que foram enviados. A principal vantagem deste protocolo é que a latência fica muito melhor, uma vez que a perda de um pacote único não atrasa o recebimento de todos os pacotes seguintes até que o que se perdeu seja retransmitido.
		</div><div
              class="para">
			TCP e UDP ambos envolvem portas, que são "números de ramal" para estabelecer a comunicação com um determinado aplicativo em uma máquina. Este conceito permite manter várias comunicações diferentes em paralelo com o mesmo correspondente, já que estas comunicações podem ser diferenciadas pelo número da porta.
		</div><div
              class="para">
			Alguns destes números de portas — pedronizados pela IANA (<span
                class="emphasis"><em>Internet Assigned Numbers Authority</em></span>) — são "famosos" por estarem associados a certos serviços de rede. Por exemplo, a porta TCP 25 é geralmente usada pelo servidor de email. <div
                class="url">→ <a
                  href="http://www.iana.org/assignments/port-numbers">http://www.iana.org/assignments/port-numbers</a></div>
		</div></div><div
            class="para">
			Quando uma rede local usa um intervalo de endereços privado (não roteável na Internet), o gateway precisa implementar <span
              class="emphasis"><em>mascaramento de endereço</em></span> para que as máquinas na rede possam se comunicar com o mundo exterior. A operação de mascaramento é um tipo de operação de proxy no nível de rede: cada conexão saindo de uma máquina interna é substituída com uma conexão do próprio gateway (já que o gateway tem um endereço externo e roteável), os dados passando pela conexão mascarada são enviados para a nova, e os dados voltando como resposta são enviados através da conexão mascarada para a máquina interna. O gateway usa um intervalo de portas TCP dedicadas para este objetivo, normalmente com números bastante altos (acima de 60000). Cada conexão vindo de uma máquina interna aparece então para o mundo exterior como uma conexão vindo de uma destas portas reservadas.
		</div><a
            id="idm140035060194048"
            class="indexterm"></a><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>CULTURA</em></span> Série de Endereços Privados</strong></p></div></div></div><a
              id="idm140035060192000"
              class="indexterm"></a><a
              id="idm140035060190560"
              class="indexterm"></a><div
              class="para">
			A RFC 1918 define três intervalos de endereços IPv4 que não devem ser roteados na Internet mas apenas usados em redes locais. O primeiro, <code
                class="literal">10.0.0.0/8</code> (veja na barra lateral <a
                class="xref"
                href="sect.network-config.html#sidebar.networking-basics"><span
                  class="emphasis"><em>DE VOLTA AO BÁSICO</em></span> Conceitos essenciais de rede (Ethernet, endereço IP, sub-rede, broadcast).</a>), é um intervalo de classe A (com 2<sup>24</sup> endereços IP). O segundo, <code
                class="literal">172.16.0.0/12</code>, trás 16 intervalos de classe B (<code
                class="literal">172.16.0.0/16</code> a <code
                class="literal">172.31.0.0/16</code>), cada um contendo 2<sup>16</sup> endereços IP. Finalmente, <code
                class="literal">192.168.0.0/16</code> é um intervalo de classe B (agrupando 256 intervalos de classe C, <code
                class="literal">192.168.0.0/24</code> a <code
                class="literal">192.168.255.0/24</code>, com 256 endereços IP cada). <div
                class="url">→ <a
                  href="http://www.faqs.org/rfcs/rfc1918.html">http://www.faqs.org/rfcs/rfc1918.html</a></div>
		</div></div><div
            class="para">
			O gateway também pode realizar dois tipos de NAT (<span
              class="emphasis"><em>network address translation</em></span> ou tradução de endereço de rede). O primeiro tipo, DNAT (<span
              class="emphasis"><em>Destination NAT</em></span> ou NAT no destino) é uma técnica para alterar o endereço IP de destino (e/ou a porta TCP ou UDP) para uma conexão (geralmente) entrando. O mecanismo de rastreio de conexão também altera os seguintes pacotes na mesma conexão para garantir a continuidade na comunicação. O segundo tipo de NAT é o SNAT (<span
              class="emphasis"><em>Source NAT</em></span> ou NAT na origem), do qual <span
              class="emphasis"><em>masquerading</em></span> (ou mascaramento) é um caso particular; SNAT altera o endereço IP de origem (e/ou a porta TCP ou UDP) de uma conexão (geramente) saindo. Assim como no DNAT, todos os pacotes na conexão são apropriadamente manipulados pelo mecanismo de rastreio de conexão. Observe que o NAT só é relevante para o IPv4 e seu espaço de endereços limitado; no IPv6, a ampla disponibilidade de endereços reduz grandemente a utilidade de NAT permitindo que todo endereço "interno" possa ser diretamente roteável na Internet (isto não implica que as máquinas internas serão acessíveis, uma vez que firewalls intermediários possam filtrar o tráfego).
		</div><a
            id="idm140035069087376"
            class="indexterm"></a><a
            id="idm140035069086416"
            class="indexterm"></a><a
            id="idm140035069085008"
            class="indexterm"></a><a
            id="idm140035069084048"
            class="indexterm"></a><a
            id="idm140035069083088"
            class="indexterm"></a><a
            id="idm140035069082128"
            class="indexterm"></a><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>DE VOLTA AO BÁSICO</em></span> Encaminhamento de porta</strong></p></div></div></div><a
              id="idm140035069080080"
              class="indexterm"></a><div
              class="para">
			Uma aplicação concreta do DNAT é o <span
                class="emphasis"><em>port forwarding</em></span> (encaminhamento de portas). Conexões chegando numa porta de uma máquina são direcionadas para uma porta de outra máquina. Outras soluções podem existir para se chegar a um efeito similar, entretanto. Especialmente no nível de aplicação com <code
                class="command">ssh</code> (veja em <a
                class="xref"
                href="sect.remote-login.html#sect.ssh-port-forwarding">Seção 9.2.1.3, “Criando Túneis Criptografados com Encaminhamento de Porta”</a>) ou <code
                class="command">redir</code>.
		</div></div><div
            class="para">
			Chega de teoria, vamos para a prática. Fazer do Debian um gateway é simplesmente habilitar a opção apropriada no núcleo Linux, através do sistema de arquivos virtual <code
              class="filename">/proc/</code>:
		</div><pre
            class="screen">
<code
              class="computeroutput"># </code><strong
              class="userinput"><code>echo 1 &gt; /proc/sys/net/ipv4/conf/default/forwarding</code></strong></pre><div
            class="para">
			Esta opção também pode ser automaticamente habilitada no boot se em <code
              class="filename">/etc/sysctl.conf</code> a opção <code
              class="literal">net.ipv4.conf.default.forwarding</code> estiver com valor <code
              class="literal">1</code>.
		</div><div
            class="example"><a
              id="example.sysctl.conf"></a><p
              class="title"><strong>Exemplo 10.1. O arquivo <code
                  class="filename">/etc/sysctl.conf</code></strong></p><div
              class="example-contents"><pre
                class="programlisting">
net.ipv4.conf.default.forwarding = 1
net.ipv4.conf.default.rp_filter = 1
net.ipv4.tcp_syncookies = 1
</pre></div></div><div
            class="para">
			O mesmo efeito pode ser obtido para o IPv6 simplesmente substituindo o <code
              class="literal">ipv4</code> por <code
              class="literal">ipv6</code> no comando manual e usando a linha <code
              class="literal">net.ipv6.conf.all.forwarding</code> em <code
              class="filename">/etc/sysctl.conf</code>.
		</div><div
            class="para">
			Habilitando mascaramento IPv4 é uma operação um pouco mais complexa que envolve configurar o firewall <span
              class="emphasis"><em>netfilter</em></span>.
		</div><div
            class="para">
			Similarmente, o uso do NAT (para IPv4) requer a configuração do <span
              class="emphasis"><em>netfilter</em></span>. Uma vez que o objetivo primário deste componente é filtragem de pacotes, os detalhes são listados em <a
              class="xref"
              href="security.html">Capítulo 14: “<em>Segurança</em>”</a> (veja em <a
              class="xref"
              href="sect.firewall-packet-filtering.html">Seção 14.2, “Firewall ou Filtragem de pacotes”</a>).
		</div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="sect.power-management.html"><strong>Anterior</strong>9.12. Gerenciamento de Energia: Advanced Configur...</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>Acima</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>Principal</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.virtual-private-network.html"><strong>Próxima</strong>10.2. Rede Privada Virtual</a></li></ul><div
        id="translated_pages"><ul><li><a
              href="../ar-MA/network-infrastructure.html">ar-MA</a></li><li><a
              href="../da-DK/network-infrastructure.html">da-DK</a></li><li><a
              href="../de-DE/network-infrastructure.html">de-DE</a></li><li><a
              href="../el-GR/network-infrastructure.html">el-GR</a></li><li><a
              href="../en-US/network-infrastructure.html">en-US</a></li><li><a
              href="../es-ES/network-infrastructure.html">es-ES</a></li><li><a
              href="../fa-IR/network-infrastructure.html">fa-IR</a></li><li><a
              href="../fr-FR/network-infrastructure.html">fr-FR</a></li><li><a
              href="../hr-HR/network-infrastructure.html">hr-HR</a></li><li><a
              href="../id-ID/network-infrastructure.html">id-ID</a></li><li><a
              href="../it-IT/network-infrastructure.html">it-IT</a></li><li><a
              href="../ja-JP/network-infrastructure.html">ja-JP</a></li><li><a
              href="../pl-PL/network-infrastructure.html">pl-PL</a></li><li><a
              href="../pt-BR/network-infrastructure.html">pt-BR</a></li><li><a
              href="../ro-RO/network-infrastructure.html">ro-RO</a></li><li><a
              href="../ru-RU/network-infrastructure.html">ru-RU</a></li><li><a
              href="../tr-TR/network-infrastructure.html">tr-TR</a></li><li><a
              href="../zh-CN/network-infrastructure.html">zh-CN</a></li></ul></div></body></html>
