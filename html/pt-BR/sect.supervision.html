<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">14.3. Supervisão: Prevenção, Detecção, Desencorajamento</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-8-pt-BR-1.0-1" /><meta
        name="keywords"
        content="Firewall, Netfilter, IDS/NIDS" /><link
        rel="home"
        href="index.html"
        title="O Manual do Administrador Debian" /><link
        rel="up"
        href="security.html"
        title="Capítulo 14. Segurança" /><link
        rel="prev"
        href="sect.firewall-packet-filtering.html"
        title="14.2. Firewall ou Filtragem de pacotes" /><link
        rel="next"
        href="sect.apparmor.html"
        title="14.4. Introdução ao AppArmor" /><meta
        name="viewport"
        content="width=device-width, initial-scale=1" /><link
        rel="canonical"
        href="http://l.github.io/debian-handbook/html/pt-BR/sect.supervision.html" /></head><body><noscript><iframe
          src="//www.googletagmanager.com/ns.html?id=GTM-5H35QX"
          height="0"
          width="0"
          style="display:none;visibility:hidden"></iframe></noscript><script
        type="text/javascript">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&amp;l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5H35QX');</script><div
        id="banner"><a
          href="../../"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="index.html"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="sect.firewall-packet-filtering.html"><strong>Anterior</strong></a></li><li
          class="home">O Manual do Administrador Debian</li><li
          class="next"><a
            accesskey="n"
            href="sect.apparmor.html"><strong>Próxima</strong></a></li></ul><div
        class="section"><div
          class="titlepage"><div><div><h2
                class="title"><a
                  id="sect.supervision"></a>14.3. Supervisão: Prevenção, Detecção, Desencorajamento</h2></div></div></div><a
          id="id-1.17.6.2"
          class="indexterm"></a><div
          class="para">
			O monitoramento é uma parte integrante de qualquer política de segurança por várias razões. Entre elas, que o objetivo da segurança não é normalmente restrito a garantir a confidencialidade dos dados, mas também inclui a disponibilidade assegurada dos serviços. Portanto, é imperativo verificar se tudo funciona como esperado, e para detectar em tempo hábil qualquer desvio no comportamento ou mudança na qualidade do(s) serviço(s) processado(s). Atividade de monitoramento pode ajudar a detectar tentativas de intrusão e permitir uma reação rápida antes que causem consequências graves. Esta seção analisa algumas ferramentas que podem ser usadas para monitorar vários aspectos de um sistema Debian. Como tal, completa <a
            class="xref"
            href="sect.monitoring.html">Seção 12.4, “Monitoramento”</a>.
		</div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="sect.logcheck"></a>14.3.1. Monitoramento de Logs com <code
                    class="command">logcheck</code></h3></div></div></div><a
            id="id-1.17.6.4.2"
            class="indexterm"></a><a
            id="id-1.17.6.4.3"
            class="indexterm"></a><a
            id="id-1.17.6.4.4"
            class="indexterm"></a><div
            class="para">
				O programa <code
              class="command">logcheck</code> monitora arquivos de log a cada hora por padrão. Ele envia mensagens de log incomuns em e-mails para o administrador, para posterior análise.
			</div><div
            class="para">
				A lista de arquivos monitorados é armazenada em <code
              class="filename">/etc/logcheck/logcheck.logfiles</code>, os valores padrão funcionam bem se o arquivo <code
              class="filename">/etc/rsyslog.conf</code> não foi completamente refeito.
			</div><div
            class="para">
				<code
              class="command">logcheck</code> pode trabalhar em um dos três modos mais ou menos detalhados: <span
              class="emphasis"><em>paranoid</em></span>, <span
              class="emphasis"><em>server</em></span> e <span
              class="emphasis"><em>workstation</em></span>. O primeiro é <span
              class="emphasis"><em>muito</em></span> verboso, e provavelmente deve ser restrito a servidores específicos, tais como firewalls. O segundo modo (e padrão) é recomendado para a maioria dos servidores. O último é projetado para estações de trabalho, e é ainda suscinto (que filtra mais mensagens).
			</div><div
            class="para">
				Nos três casos, <code
              class="command">logcheck</code> provavelmente deve ser personalizado para excluir algumas mensagens extras (dependendo dos serviços instalados), a menos que o administrador realmente deseje receber lotes por hora de longos e-mails desinteressantes. Uma vez que o mecanismo de seleção de mensagem é bastante complexo, <code
              class="filename">/usr/share/doc/logcheck-database/README.logcheck-database.gz</code> é uma necessidade - se desafiador - leia.
			</div><div
            class="para">
				As regras aplicadas podem ser divididas em vários tipos:
			</div><div
            xmlns:d="http://docbook.org/ns/docbook"
            class="itemizedlist"><ul><li
                class="listitem"><div
                  class="para">
						aqueles que qualificam uma mensagem como uma tentativa de invasao (armazenado em um arquivo no diretorio <code
                    class="filename">/etc/logcheck/cracking.d/</code>);
					</div></li><li
                class="listitem"><div
                  class="para">
						aqueles cancelando essas qualificaçoes (<code
                    class="filename">/etc/logcheck/cracking.ignore.d/</code>);
					</div></li><li
                class="listitem"><div
                  class="para">
						aqueles classificando uma mensagem como um alerta de segurança (<code
                    class="filename">/etc/logcheck/violations.d/</code>);
					</div></li><li
                class="listitem"><div
                  class="para">
						aqueles cancelando esta classificacao (<code
                    class="filename">/etc/logcheck/violations.ignore.d/</code>);
					</div></li><li
                class="listitem"><div
                  class="para">
						finalmente, as que se aplicam às mensagens restantes (consideradas como <span
                    class="emphasis"><em>eventos de sistema</em></span>).
					</div></li></ul></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>ATENÇÃO</em></span> Ignorando uma mensagem</strong></p></div></div></div><div
              class="para">
				Qualquer mensagem marcada como uma tentativa de invasao ou um alerta de segurança (seguindo uma regra armazenada num arquivo <code
                class="filename">/etc/logcheck/violations.d/myfile</code>) só pode ser ignorada por uma regra em <code
                class="filename">/etc/logcheck/violations.ignore.d/myfile</code> ou no arquivo <code
                class="filename">/etc/logcheck/violations.ignore.d/myfile-<em
                  class="replaceable">extensão</em></code>.
			</div></div><div
            class="para">
				Um evento de sistema é sempre sinalizado a menos que uma regra em um dos diretorios <code
              class="filename">/etc/logcheck/ignore.d. {paranoid,server,workstation}/</code> indica que o evento deve ser ignorado. Naturalmente, apenas os directórios levados em consideração são aqueles que correspondem aos níveis de verbosidade iguais ou maiores que o modo de funcionamento seleccionado.
			</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="sect.monitoring-activity"></a>14.3.2. Monitorando Atividades</h3></div></div></div><a
            id="id-1.17.6.5.2"
            class="indexterm"></a><a
            id="id-1.17.6.5.3"
            class="indexterm"></a><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      id="sect.real-time-monitoring"></a>14.3.2.1. Em Tempo Real</h4></div></div></div><div
              class="para">
					<code
                class="command">top</code> é uma ferramenta interativa que exibe uma lista de processos em execução. A triagem padrão baseia se na quantidade atual de utilização do processador e pode ser obtida com a tecla <span
                class="keycap"><strong>P</strong></span>. Outras ordens de classificação incluem uma espécie de memória ocupada (tecla <span
                class="keycap"><strong>M</strong></span>), pelo tempo total do processador (tecla <span
                class="keycap"><strong>T</strong></span>) e pelo identificador de processo (tecla <span
                class="keycap"><strong>N</strong></span>). A tecla <span
                class="keycap"><strong>k</strong></span> permite matar um processo, digitando seu identificador de processo. O tecla <span
                class="keycap"><strong>r</strong></span> permite <span
                class="emphasis"><em>renicing</em></span> um processo, ou seja, mudar sua prioridade.
				</div><a
              id="id-1.17.6.5.4.3"
              class="indexterm"></a><div
              class="para">
					Quando o sistema parece estar sobrecarregado, <code
                class="command">top</code> é uma ótima ferramenta para ver quais processos estão competindo por tempo de processador ou consumindo muita memória. Em particular, muitas vezes é interessante verificar se os recursos do processos que consomem coincidem com os serviços reais conhecidos que a máquina hospeda. Um processo desconhecido rodando como o usuário www-data deve realmente se destacar e ser investigado, já que é provavelmente uma instância do software instalado e executado no sistema através de uma vulnerabilidade em uma aplicação web.
				</div><div
              class="para">
					<code
                class="command">top</code> é uma ferramenta muito flexível e sua página de manual dá detalhes sobre como personalizar a sua exibição e adaptá la às nossas necessidades pessoais e hábitos.
				</div><div
              class="para">
					As ferramentas gráficas <code
                class="command">gnome-system-monitor</code> é semelhante ao <code
                class="command">top</code> e proporciona mais ou menos os mesmos recursos.
				</div><a
              id="id-1.17.6.5.4.7"
              class="indexterm"></a></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      id="sect.monitoring-history"></a>14.3.2.2. Historia</h4></div></div></div><a
              id="id-1.17.6.5.5.2"
              class="indexterm"></a><div
              class="para">
					Carga do processador, o tráfego de rede e o espaço livre no disco são informações que variam constantemente. Manter um histórico de sua evolução é muitas vezes útil para determinar exatamente como o computador é usado.
				</div><a
              id="id-1.17.6.5.5.4"
              class="indexterm"></a><a
              id="id-1.17.6.5.5.5"
              class="indexterm"></a><div
              class="para">
					Existem muitas ferramentas dedicadas a esta tarefa. A maioria pode buscar dados via SNMP (<span
                class="emphasis"><em>Simple Network Management Protocol</em></span>, a fim de centralizar esta informação. Um benefício adicional é que este permite buscar dados de elementos de rede que podem não ser de computadores de uso geral, tais como roteadores de rede dedicadas ou switches.
				</div><div
              class="para">
					Este livro trata do Munin com algum detalhe (ver <a
                class="xref"
                href="sect.monitoring.html#sect.munin">Seção 12.4.1, “Configurando o Munin”</a>) como parte do <a
                class="xref"
                href="advanced-administration.html">Capítulo 12: “<em>Administração Avançada</em>”</a>. O Debian também fornece uma ferramenta similar, <span
                class="pkg pkg">cacti</span>. Sua implantação é um pouco mais complexa, pois se baseia apenas em SNMP. Apesar de ter uma interface web, compreender os conceitos envolvidos na configuração ainda requer algum esforço. Lendo a documentação HTML (<code
                class="filename">/usr/share/doc/cacti/html/index.html</code>) deve ser considerado um pré-requisito.
				</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>ALTERNATIVO</em></span> <code
                          class="command">mrtg</code></strong></p></div></div></div><a
                id="id-1.17.6.5.5.8.2"
                class="indexterm"></a><div
                class="para">
					<code
                  class="command">mrtg</code> (do pacote com mesmo nome) é uma antiga ferramenta. Apesar de algumas arestas, ela pode agregar dados históricos e exibi-los na forma de gráficos. Ela inclui uma série de scripts dedicados à coleta de dados mais comumente monitorados, tais como a carga do processador, o tráfego de rede, acessos à página da web, e assim por diante.
				</div><div
                class="para">
					Os pacotes <span
                  class="pkg pkg">mrtg-contrib</span> e <span
                  class="pkg pkg">mrtgutils</span> contem exemplos de scripts que podem ser utilizados diretamente.
				</div></div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="id-1.17.6.6"></a>14.3.3. Detectando Modificações</h3></div></div></div><div
            class="para">
				Uma vez que o sistema esteja instalado e configurado, e impedindo atualizações de segurança, geralmente não há razão para a maioria dos arquivos e diretórios para evoluirem, exceeto os dados. É interessante, portanto, certificar se que os arquivos realmente não alteram: qualquer mudança seria, portanto, inesperada, valendo a pena investigar. Esta seção apresenta algumas ferramentas capazes de monitorar os arquivos e para avisar o administrador quando ocorrer uma mudança inesperada (ou simplesmente para listar tais mudanças).
			</div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      id="sect.dpkg-verify"></a>14.3.3.1. Auditando Pacotes com o <code
                      class="command">dpkg --verify</code></h4></div></div></div><a
              id="id-1.17.6.6.3.2"
              class="indexterm"></a><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>INDO ALEM</em></span> Protegendo se contra mudanças mais significativas</strong></p></div></div></div><div
                class="para">
					<code
                  class="command">dpkg --verify</code> é útil na detecção de alterações em arquivos provenientes de um pacote Debian, mas será inútil se o pacote em si está comprometidO, por exemplo, se o espelho Debian está comprometida. Protegendo-se contra este tipo de ataques envolve a utilização de sistema APT de verificação de assinatura digital (veja <a
                  class="xref"
                  href="sect.package-authentication.html">Seção 6.5, “Verificando Autenticidade do Pacote”</a>), e tomando cuidado para só instalar pacotes a partir de uma origem certificada.
				</div></div><div
              class="para">
					O <code
                class="command">dpkg --verify</code> (ou <code
                class="command">dpkg -V</code>) é uma ferramenta interessante já que permite encontrar quais arquivos instalados foram modificados (potencialmente por um invasor), mas isso é apenas um pequeno passo. Para fazer seu trabalho ele confia nos checksums armazenados no próprio banco de dados do dpkg, que é armazenado no disco rígido (eles podem ser encontrados em <code
                class="filename">/var/lib/dpkg/info/<em
                  class="replaceable">pacote</em>.md5sums</code>); Um atacante que faz o serviço bem feito irá atualizar esses arquivos para que eles contenham os novos checksums dos arquivos subvertidos.
				</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>DE VOLTA AO BASICO</em></span> Impressão digital de arquivo</strong></p></div></div></div><a
                id="id-1.17.6.6.3.5.2"
                class="indexterm"></a><a
                id="id-1.17.6.6.3.5.3"
                class="indexterm"></a><a
                id="id-1.17.6.6.3.5.4"
                class="indexterm"></a><a
                id="id-1.17.6.6.3.5.5"
                class="indexterm"></a><div
                class="para">
					Como um lembrete: a impressão digital é um valor, muitas vezes um número (mesmo que em notação hexadecimal), que contém uma espécie de assinatura para o conteúdo de um arquivo. Esta assinatura é calculada com um algoritmo (MD5 ou SHA1 sendo exemplos bem conhecidos) que garanta mais ou menos que, mesmo a mais ínfima mudança no conteúdo do arquivo implica uma mudança na impressão digital, o que é conhecido como o "efeito avalanche". Isto permite uma impressão digital numérica simples para servir como um teste para verificar se o conteúdo de um arquivo foram alterado. Estes algoritmos não são reversíveis, em outras palavras, para a maioria deles, sabendo a impressão digital não permite encontrar o conteúdo correspondente. Os recentes avanços matemáticos parecem enfraquecer o poder absoluto destes princípios, mas seu uso não é posto em causa, até agora, produzir a mesma impressão digital apartir de conteúdos diferentes ainda parece ser uma tarefa bastante difícil.
				</div></div><div
              class="para">
					Ao rodar <code
                class="command">dpkg -V</code> todos os pacotes instalados serão verificados e será impressa uma linha para cada arquivo que falhar em algum teste. O formato de saída é o mesmo que o do <code
                class="command">rpm -V</code> onde cada caractere denota um teste em algum metadado específico. Infelizmente o <code
                class="command">dpkg</code> não armazena o metadado necessário para a maioria dos testes e irá, assim, exibir uma interrogação para estes. Atualmente apenas o teste de checksum pode render um "5" no terceiro caractere (quando ele falha).
				</div><pre
              class="screen">
<code
                class="computeroutput"># </code><strong
                class="userinput"><code>dpkg -V</code></strong>
<code
                class="computeroutput">??5??????   /lib/systemd/system/ssh.service
??5?????? c /etc/libvirt/qemu/networks/default.xml
??5?????? c /etc/lvm/lvm.conf
??5?????? c /etc/salt/roster</code></pre><div
              class="para">
					No exemplo acima, o dpkg reporta uma alteração no arquivo service do SSH que o administrador fez no arquivo empacotado ao invéz de usar uma sobrescrita apropriada no <code
                class="filename">/etc/systemd/system/ssh.service</code> (que seria armazenada abaixo de <code
                class="filename">/etc</code> como qualquer mudança de configuração deveria ser). Ele também lista múltiplos arquivos de configuração (identificados pela letra "c" no segundo campo) que foram legitimamente modificados.
				</div></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      id="sect.debsums"></a>14.3.3.2. Auditando Pacotes: <code
                      class="command">debsums</code> e seus limites</h4></div></div></div><a
              id="id-1.17.6.6.4.2"
              class="indexterm"></a><div
              class="para">
					O <code
                class="command">debsums</code> é o ancestral do <code
                class="command">dpkg -V</code> e sendo assim é praticamente obsoleto. Ele sofre das mesmas limitações que o dpkg. Felizmente, algumas das limitações podem ser superadas (enqunato que o dpkg não oferece tais ações).
				</div><div
              class="para">
					Já que dados no disco não são confiáveis, o <code
                class="command">debsums</code> oferece fazer sua checagem com base nos arquivos <code
                class="filename">.deb</code> ao invéz de confiar no banco de dados do dpkg. Para baixar arquivos <code
                class="filename">.deb</code> confiáveis de todos os pacotes instalados, nós podemos confiar nos downloads autênticados pelo APT. Essa operação pode ser lenta e tediosa, e deve assim, não ser considerada uma técnica proativa a ser usada no cotidiano.
				</div><pre
              class="screen">
<code
                class="computeroutput"># </code><strong
                class="userinput"><code>apt-get --reinstall -d install `grep-status -e 'Status: install ok installed' -n -s Package`</code></strong>
<code
                class="computeroutput">[ ... ]
# </code><strong
                class="userinput"><code>debsums -p /var/cache/apt/archives --generate=all</code></strong></pre><div
              class="para">
					Note que este exemplo usa o comando <code
                class="command">grep status</code> a partir do pacote <span
                class="pkg pkg">dctrl-tools</span>, que não é instalado por padrão.
				</div></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      id="id-1.17.6.6.5"></a>14.3.3.3. Monitorando Arquivos: AIDE</h4></div></div></div><a
              id="id-1.17.6.6.5.2"
              class="indexterm"></a><div
              class="para">
					A ferramenta AIDE (<span
                class="emphasis"><em>Advanced Intrusion Detection Environment - Ambiente Avançado de Deteccao Intrusao</em></span>) permite verificar a integridade de arquivos, e detectar qualquer mudança em relacao a uma imagem gravada anteriormente do sistema válido. Esta imagem é armazenada como um banco de dados (<code
                class="filename"> /var/lib/aide/aide.db</code>) que contém as informações relevantes de todos os arquivos do sistema (impressões digitais, permissões, timestamps e assim por diante). Este banco de dados é inicializado com <code
                class="command">aideinit</code>, que é então usado diariamente (pelo script <code
                class="filename">/etc/cron.daily/</code> ) para verificar que nada de relevante mudou. Quando forem detectadas alterações, AIDE grava os em arquivos de log (<code
                class="filename">/var/log/aide/*.log</code>) e envia os seus resultados ao administrador por e-mail.
				</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>NA PRATICA</em></span> Protegendo o banco de dados</strong></p></div></div></div><div
                class="para">
					Como AIDE usa um banco de dados local para comparar os estados dos arquivos, a validade de seus resultados está diretamente ligada à validade do banco de dados. Se um atacante obtém permissões de root em um sistema comprometido, eles serão capazes de substituir o banco de dados e cobrir seus rastros. Uma possível solução seria armazenar os dados de referência em mídia somente leitura de armazenamento.
				</div></div><div
              class="para">
					Muitas opções em <code
                class="filename">/etc/default/aide</code> pode ser usadas para ajustar o comportamento do pacote <span
                class="pkg pkg">aide</span>. A configuração AIDE adequada é armazenada em <code
                class="filename">/etc/aide/aide.conf</code> e <code
                class="filename">/etc/aide/aide.conf.d/</code> (na verdade, esses arquivos são usados <code
                class="command">update-aide.conf</code> para gerar <code
                class="filename">/var/lib/aide/aide.conf.autogenerated</code>). Configuração indica quais propriedades de arquivos precisam ser verificadas. Por exemplo, o conteúdo de arquivos log muda rotineiramente, e estas modificações podem ser ignoradas, desde que as permissões destes arquivos permaneçam o mesmo, mas ambos os conteúdos e as permissões de programas executáveis devem ser constantes. Embora não seja muito complexo, a sintaxe de configuração não é totalmente intuitiva, e a leitura de <span
                class="citerefentry"><span
                  class="refentrytitle">aide.conf</span>(5)</span> da página do manual é recomendada.
				</div><div
              class="para">
					Uma nova versão do banco de dados é gerada diariamente em <code
                class="filename">/var/lib/aide/aide.db.new</code>, se todas alterações registradas eram legítimas, ele pode ser usado para substituir o banco de dados de referência.
				</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>ALTERNATIVO</em></span> Tripwire and Samhain</strong></p></div></div></div><div
                class="para">
					Tripwire é muito semelhante ao AIDE; mesmo a sintaxe arquivo de configuração é quase a mesma. A adição principal fornecida pelo <span
                  class="pkg pkg">tripwire</span> é um mecanismo para assinar o arquivo de configuração, de modo que um atacante não pode torná lo ponto em uma versão diferente do banco de dados de referência.
				</div><div
                class="para">
					Samhain também oferece características semelhantes, bem como algumas funções ajudar a detectar rootkits (veja a barra lateral <a
                  class="xref"
                  href="sect.supervision.html#sidebar.the-checksecurity-and-chkrootkit-rkhunter-packages"><span
                    class="emphasis"><em>OLHADA RÁPIDA</em></span> os pacotes <span
                    class="pkg pkg">checksecurity</span> e <span
                    class="pkg pkg">chkrootkit</span>/<span
                    class="pkg pkg">rkhunter</span></a>). Também pode ser implementado globalmente em uma rede, e gravar os seus vestigios em um servidor central (com uma assinatura).
				</div></div><div
              class="sidebar"><a
                id="sidebar.the-checksecurity-and-chkrootkit-rkhunter-packages"></a><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>OLHADA RÁPIDA</em></span> os pacotes <span
                          class="pkg pkg">checksecurity</span> e <span
                          class="pkg pkg">chkrootkit</span>/<span
                          class="pkg pkg">rkhunter</span></strong></p></div></div></div><a
                id="id-1.17.6.6.5.8.2"
                class="indexterm"></a><div
                class="para">
					O primeiro destes pacotes contém vários pequenos scripts que executam verificações básicas sobre o sistema (senhas vazias, arquivos setuid novos, e assim por diante) e alerta o administrador, se necessário. Apesar de seu nome expressar, um administrador não deve confiar somente nele para certificar se que um sistema Linux está seguro.
				</div><div
                class="para">
					Os pacotes <span
                  class="pkg pkg">chkrootkit</span> e <span
                  class="pkg pkg">rkhunter</span> permitem buscar por potenciais <span
                  class="emphasis"><em>rootkits</em></span> instalados no sistema. Como um lembrete, existem peças de software desenvolvidas para esconder o comprometimento de um sistema enquanto, discretamente, mantém o controle da máquina. Os testes não são 100% confiáveis, mas eles geralmente chamam a atenção do administrador para potenciais problemas.
				</div></div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="sect.intrusion-detection"></a>14.3.4. Detectando Intrusoes (IDS/NIDS)</h3></div></div></div><a
            id="id-1.17.6.7.2"
            class="indexterm"></a><a
            id="id-1.17.6.7.3"
            class="indexterm"></a><a
            id="id-1.17.6.7.4"
            class="indexterm"></a><a
            id="id-1.17.6.7.5"
            class="indexterm"></a><a
            id="id-1.17.6.7.6"
            class="indexterm"></a><a
            id="id-1.17.6.7.7"
            class="indexterm"></a><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>DE VOLTA AO BASICO</em></span> Negação de serviço</strong></p></div></div></div><a
              id="id-1.17.6.7.8.2"
              class="indexterm"></a><div
              class="para">
				O ataque "negação de serviço" tem apenas um objetivo: tornar um serviço indisponível. Se tal ataque envolve a sobrecarrega do servidor com consultas ou explorar uma falha, o resultado final é o mesmo: o serviço não é mais operacional. Os usuários regulares estão infelizes, e a entidade que hospeda o serviço de rede alvo sofre uma perda de reputação (e, eventualmente, em receita, por exemplo, se o serviço era um site de comércio eletrônico).
			</div><div
              class="para">
				Tal ataque é por vezes "distribuído", o que geralmente envolve sobrecarregar o servidor com um grande número de consultas provenientes de muitas fontes diferentes para que o servidor se torna incapaz de responder às perguntas legítimas. Estes tipos de ataques ganharam siglas bem conhecidas: <acronym
                class="acronym">DDoS</acronym> e <acronym
                class="acronym">DoS</acronym> (dependendo se o ataque de negação de serviço distribuído ou não).
			</div></div><div
            class="para">
				<code
              class="command">suricata</code> (no pacote Debian com o mesmo nome) é um NIDS - um <span
              class="emphasis"><em>Sistema de Detecção de Intrusão de Rede</em></span>. Sua função é ouvir a rede e tentar detectar tentativas de infiltração e/ou atos hostis (incluindo ataques de negação de serviço). Todos esses eventos são registrados em múltiplos arquivos em <code
              class="filename">/var/log/suricata</code>. Existem ferramentas de terceiros (Kibana/logstash) para melhor navegar pelos dados coletados. <div
              class="url">→ <a
                href="http://suricata-ids.org">http://suricata-ids.org</a></div> <div
              class="url">→ <a
                href="https://www.elastic.co/products/kibana">https://www.elastic.co/products/kibana</a></div>
			</div><a
            id="id-1.17.6.7.10"
            class="indexterm"></a><a
            id="id-1.17.6.7.11"
            class="indexterm"></a><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>ATENÇÃO</em></span> Raio de ação</strong></p></div></div></div><div
              class="para">
				A eficácia do <code
                class="command">suricata</code> é limitada pelo tráfego visto na interface de rede monitorada. Obviamente, não será capaz de detectar qualquer coisa se não pode observar o tráfego real. Quando conectado a um switch de rede, ele irá, portanto, apenas monitorar ataques contra a máquina em que ele roda, o que provavelmente não é a intenção. A máquina que hospeda o <code
                class="command">suricata</code> deve estar ligada a porta "espelho" do switch, que normalmente é dedicada aos interruptores (switches) encadeados e, portanto, recebe todo o tráfego.
			</div></div><div
            class="para">
				A configuração do suricata envolve rever e editar o <code
              class="filename">/etc/suricata/suricata-debian.yaml</code>, que é muito grande porque cada parâmetro é abundantemente comentado. Uma configuração minima requer descrever o intervalo de endereços que a rede local cobre (parâmetro <code
              class="literal">HOME_NET</code>). Na prática, isso significa o conjunto de todos os alvos possíveis de ataque. Mas para obter o máximo dele requer uma leitura completa para adaptá-lo para a situação local.
			</div><div
            class="para">
				No topo disso, você deveria também editar o <code
              class="filename">/etc/default/suricata</code> para definir a interface de rede a ser monitorada e para habilitar o script init (setando <code
              class="literal">RUN=yes</code>). Você também deve querer definir <code
              class="literal">LISTENMODE=pcap</code> porquê o padrão <code
              class="literal">LISTENMODE=nfqueue</code> requer configurações adicionais para funcionar de maneira apropriada (o firewall netfilter tem que ser configurado para passar pacotes para alguma fila do espaço de usuário manipulada pelo suricata via o alvo <code
              class="literal">NFQUEUE</code>).
			</div><div
            class="para">
				Para detectar maus comportamentos, o <code
              class="command">suricata</code> precisa de um conjunto de regras de monitoramento: você pode encontrar tais regras no pacote <span
              class="pkg pkg">snort-rules-default</span>. O <code
              class="command">snort</code> é a referência histórica no ecosistema de IDS e o <code
              class="command">suricata</code> é capaz de reusar as regras escritas para ele. Infelizmente, esse pacote não está presente no <span
              class="distribution distribution">Debian Jessie</span> e deve ser obtido a partir de outro lançamento Debian como o <span
              class="distribution distribution">Testing</span> ou <span
              class="distribution distribution">Unstable</span>.
			</div><div
            class="para">
				Alternativamente, o <code
              class="command">oinkmaster</code> (em pacote de mesmo nome) pode ser usado para baixar um conjunto de regras do Snort a partir de fontes externas.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>INDO ALÉM</em></span> Integração com o <code
                        class="command">prelude</code></strong></p></div></div></div><div
              class="para">
				Prelude traz monitoramento centralizado de informações de segurança. Sua arquitetura modular inclui um servidor (o gerente <span
                class="emphasis"><em>manager</em></span> em <span
                class="pkg pkg">prelude-manager</span>) que reúne os alertas gerados por <span
                class="emphasis"><em>sensores</em></span> de vários tipos.
			</div><div
              class="para">
				O Suricata pode ser configurado como um destes sensores. Outras possibilidades incluem <span
                class="emphasis"><em>prelude-lml</em></span> (<span
                class="emphasis"><em>Log Monitor Lackey</em></span>), que monitora os arquivos de registro (de forma semelhante ao <code
                class="command">logcheck</code>, descrito em <a
                class="xref"
                href="sect.supervision.html#sect.logcheck">Seção 14.3.1, “Monitoramento de Logs com <code
                  class="command">logcheck</code>”</a>).
			</div><a
              id="id-1.17.6.7.17.4"
              class="indexterm"></a></div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="sect.firewall-packet-filtering.html"><strong>Anterior</strong>14.2. Firewall ou Filtragem de pacotes</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>Acima</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>Principal</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.apparmor.html"><strong>Próxima</strong>14.4. Introdução ao AppArmor</a></li></ul><div
        id="translated_pages"><ul><li><a
              href="../ar-MA/sect.supervision.html">ar-MA</a></li><li><a
              href="../da-DK/sect.supervision.html">da-DK</a></li><li><a
              href="../de-DE/sect.supervision.html">de-DE</a></li><li><a
              href="../el-GR/sect.supervision.html">el-GR</a></li><li><a
              href="../en-US/sect.supervision.html">en-US</a></li><li><a
              href="../es-ES/sect.supervision.html">es-ES</a></li><li><a
              href="../fa-IR/sect.supervision.html">fa-IR</a></li><li><a
              href="../fr-FR/sect.supervision.html">fr-FR</a></li><li><a
              href="../hr-HR/sect.supervision.html">hr-HR</a></li><li><a
              href="../id-ID/sect.supervision.html">id-ID</a></li><li><a
              href="../it-IT/sect.supervision.html">it-IT</a></li><li><a
              href="../ja-JP/sect.supervision.html">ja-JP</a></li><li><a
              href="../ko-KR/sect.supervision.html">ko-KR</a></li><li><a
              href="../nb-NO/sect.supervision.html">nb-NO</a></li><li><a
              href="../pl-PL/sect.supervision.html">pl-PL</a></li><li><a
              href="../pt-BR/sect.supervision.html">pt-BR</a></li><li><a
              href="../ro-RO/sect.supervision.html">ro-RO</a></li><li><a
              href="../ru-RU/sect.supervision.html">ru-RU</a></li><li><a
              href="../tr-TR/sect.supervision.html">tr-TR</a></li><li><a
              href="../vi-VN/sect.supervision.html">vi-VN</a></li><li><a
              href="../zh-CN/sect.supervision.html">zh-CN</a></li><li><a
              href="../zh-TW/sect.supervision.html">zh-TW</a></li></ul></div></body></html>
