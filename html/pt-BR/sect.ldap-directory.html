<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">11.7. Diretório LDAP</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.1" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-8-pt-BR-1.0-1" /><meta
        name="keywords"
        content="Postfix, Apache, NFS, Samba, Squid, OpenLDAP" /><link
        rel="home"
        href="index.html"
        title="O Manual do Administrador Debian" /><link
        rel="up"
        href="network-services.html"
        title="Capítulo 11. Serviços de Rede: Postfix, Apache, NFS, Samba, Squid, LDAP" /><link
        rel="prev"
        href="sect.http-ftp-proxy.html"
        title="11.6. Proxy HTTP/FTP" /><link
        rel="next"
        href="advanced-administration.html"
        title="Capítulo 12. Administração Avançada" /><link
        rel="canonical"
        href="http://l.github.io/debian-handbook/html/pt-BR/sect.ldap-directory.html" /></head><body
      class="draft "><noscript><iframe
          src="//www.googletagmanager.com/ns.html?id=GTM-5H35QX"
          height="0"
          width="0"
          style="display:none;visibility:hidden"></iframe></noscript><script
        type="text/javascript">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&amp;l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5H35QX');</script><div
        id="banner"><a
          href="http://debian-handbook.info/get/"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="http://debian-handbook.info"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="sect.http-ftp-proxy.html"><strong>Anterior</strong></a></li><li
          class="home">O Manual do Administrador Debian</li><li
          class="next"><a
            accesskey="n"
            href="advanced-administration.html"><strong>Próxima</strong></a></li></ul><div
        class="section"><div
          class="titlepage"><div><div><h2
                class="title"><a
                  id="sect.ldap-directory"></a>11.7. Diretório LDAP</h2></div></div></div><a
          id="idm140035050145952"
          class="indexterm"></a><a
          id="idm140035050145184"
          class="indexterm"></a><a
          id="idm140035050144416"
          class="indexterm"></a><div
          class="para">
			OpenLDAP é uma implementação do protocolo LDAP; em outras palavras, é um banco de dados com propósito especial desenvolvido para armazenar diretórios. No caso mais comum de uso, o uso de um servidor LDAP permite o gerenciamento centralizado de contas de usuários e permissões relacionadas. Além do mais, um banco de dados LDAP é facilmente replicável, o que permite configurar múltiplos servidores LDAP sincronizados. Quando a rede e a base de usuários cresce rapidamente, a carga pode então ser balanceada por entre vários servidores.
		</div><div
          class="para">
			Os dados LDAP são estruturados e hierárquicos. A estrutura é definida por “schemas” que descrevem os tipos de objetos que o banco de dados pode armazenar, com uma lista de todos os seus possíveis atributos. A sintaxe usada para se referir a um objeto em particular no banco de dados é baseada em sua estrutura, o que explica sua complexidade.
		</div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="idm140035050141936"></a>11.7.1. Instalando</h3></div></div></div><div
            class="para">
				O pacote <span
              class="pkg pkg">slapd</span> contém o servidor OpenLDAP. O pacote <span
              class="pkg pkg">ldap-utils</span> inclui ferramentas de linha de comando para interação com os servidores LDAP.
			</div><a
            id="idm140035050139568"
            class="indexterm"></a><div
            class="para">
				Installing <span
              class="pkg pkg">slapd</span> usually asks very few questions, unless you have configured debconf to display questions with lower priorities. Nevertheless, it is debconf-enabled, and thus a simple <code
              class="command">dpkg-reconfigure slapd</code> can reconfigure the LDAP database:
			</div><div
            xmlns:d="http://docbook.org/ns/docbook"
            class="itemizedlist"><ul><li
                class="listitem"><div
                  class="para">
						Omitir a configuração do servidor OpenLDAP? Não, claro que não, nós queremos configurar esse serviço.
					</div></li><li
                class="listitem"><div
                  class="para">
						DNS nome de domínio: “<code
                    class="literal">falcot.com</code>”.
					</div></li><li
                class="listitem"><div
                  class="para">
						Nome da organização: “Falcot Corp”.
					</div></li><li
                class="listitem"><div
                  class="para">
						Senhas administrativas precisam ser digitadas.
					</div></li><li
                class="listitem"><div
                  class="para">
						Banco de dados para utilizar: "HDB".
					</div></li><li
                class="listitem"><div
                  class="para">
						Você quer que o banco de dados seja removido quando o <span
                    class="pkg pkg">slapd</span> é removido (purged)? Não. Não faz sentido arriscar a perda do banco de dados em caso de um engano.
					</div></li><li
                class="listitem"><div
                  class="para">
						Mover banco de dados antigo? Essa pergunta só é feita enquanto a configuração é feita e já existe um banco de dados. Só responda “sim” se você realmente querer iniciar a partir de um banco de dados limpo, por exemplo, se você rodar <code
                    class="command">dpkg-reconfigure slapd</code> logo após a instalação inicial.
					</div></li><li
                class="listitem"><div
                  class="para">
						Permitir protocolo LDAPv2? Não, isso não faz sentido. Todas as ferramentas que nós vamos usar entendem o protocolo LDAPv3.
					</div></li></ul></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>DE VOLTA AO BÁSICO</em></span> Formato LDIF</strong></p></div></div></div><div
              class="para">
				Um arquivo LDIF (<span
                class="emphasis"><em>formato de intercâmbios de dados LDAP</em></span> - LDAP Data Interchange Format) é um arquivo de texto portável que descreve o conteúdo de uma base de dados LDAP (ou uma parte da mesma); pode ser utilizada para injetar dados em outro servidor LDAP.
			</div><a
              id="idm140035050126416"
              class="indexterm"></a></div><div
            class="para">
				Um base de dados miníma está configurada agora, como demonstrado pela seguinte consulta:
			</div><pre
            class="screen">
<code
              class="computeroutput">$ </code><strong
              class="userinput"><code>ldapsearch -x -b dc=falcot,dc=com</code></strong>
<code
              class="computeroutput"># extended LDIF
#
# LDAPv3
# base &lt;dc=falcot,dc=com&gt; with scope sub
# filter: (objectclass=*)
# requesting: ALL
#

# falcot.com
dn: dc=falcot,dc=com
objectClass: top
objectClass: dcObject
objectClass: organization
o: Falcot Corp
dc: falcot

# admin, falcot.com
dn: cn=admin,dc=falcot,dc=com
objectClass: simpleSecurityObject
objectClass: organizationalRole
cn: admin
description: LDAP administrator

# search result
search: 2
result: 0 Success

# numResponses: 3
# numEntries: 2
</code></pre><div
            class="para">
				A consulta retornour dois objetos: a organização em si, e o usuário administrativo.
			</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="idm140035050122624"></a>11.7.2. Preenchendo o Diretório</h3></div></div></div><div
            class="para">
				Como um banco de dados vazio não é particularmente útil, nós vamos injetar nele todos os diretórios existentes; isso inclui os banco de dados de usuários, grupos, serviços e máquinas.
			</div><div
            class="para">
				O pacote <span
              class="pkg pkg">migrationtools</span> provê um conjunto de scripts dedicados a extrair dados a partir dos diretórios padrões do Unix (<code
              class="filename">/etc/passwd</code>, <code
              class="filename">/etc/group</code>, <code
              class="filename">/etc/services</code>, <code
              class="filename">/etc/hosts</code> e mais), converter seus dados, e injetá-los em um banco de dados LDAP.
			</div><a
            id="idm140035050118624"
            class="indexterm"></a><div
            class="para">
				Uma vez que o pacote esteja instalado, o <code
              class="filename">/etc/migrationtools/migrate_common.ph</code> tem que ser editado; as opções <code
              class="varname">IGNORE_UID_BELOW</code> e <code
              class="varname">IGNORE_GID_BELOW</code> precisam ser habilitadas (descomentá-las é suficiente), e <code
              class="varname">DEFAULT_MAIL_DOMAIN</code>/<code
              class="varname">DEFAULT_BASE</code> precisa ser atualizada.
			</div><div
            class="para">
				A real operação de migração é feita pelo comando <code
              class="command">migrate_all_online.sh</code>, como a seguir:
			</div><pre
            class="screen">
<code
              class="computeroutput"># </code><strong
              class="userinput"><code>cd /usr/share/migrationtools</code></strong>
<code
              class="computeroutput"># </code><strong
              class="userinput"><code>LDAPADD="/usr/bin/ldapadd -c" ETC_ALIASES=/dev/null ./migrate_all_online.sh</code></strong></pre><div
            class="para">
				<code
              class="command">migrate_all_online.sh</code> faz algumas perguntas sobre o banco de dados LDAP para o qual os dados serão migrados. <a
              class="xref"
              href="sect.ldap-directory.html#tab-migrate-all">Tabela 11.1</a> resume as respostas dadas no caso da Falcot.
			</div><div
            class="table"><a
              id="tab-migrate-all"></a><p
              class="title"><strong>Tabela 11.1. Responda as perguntas feitas pelo script <code
                  class="command">migrate_all_online.sh</code></strong></p><div
              class="table-contents"><table
                xmlns:d="http://docbook.org/ns/docbook"
                class="lt-4-cols lt-7-rows"
                summary="Responda as perguntas feitas pelo script migrate_all_online.sh"><colgroup><col
                    align="justify" /><col
                    align="justify" /></colgroup><thead><tr><th
                      align="justify">Questão</th><th
                      align="justify">Resposta</th></tr></thead><tbody><tr><td
                      align="justify">Contexto de nome X.500</td><td
                      align="justify"><code
                        class="literal">dc=falcot,dc=com</code></td></tr><tr><td
                      align="justify">Nome do servidor LDAP</td><td
                      align="justify"><code
                        class="literal">localhost</code></td></tr><tr><td
                      align="justify">Gerenciando o DN</td><td
                      align="justify"><code
                        class="literal">cn=admin,dc=falcot,dc=com</code></td></tr><tr><td
                      align="justify">Credenciais Bind</td><td
                      align="justify">a senha administrativa</td></tr><tr><td
                      align="justify">Criar DUAConfigProfile</td><td
                      align="justify">não</td></tr></tbody></table></div></div><div
            class="para">
				Nós ignoramos a migração do arquivo <code
              class="filename">/etc/aliases</code> deliberadamente, já que o schema padrão, como o fornecido pelo Debian não inclui as estruturas que esse script usa para descrever "email aliases". Se quisermos integrar esse dado no diretório, o arquivo <code
              class="filename">/etc/ldap/schema/misc.schema</code> deve ser adicionado ao schema padrão.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>FERRAMENTA</em></span> Navegando em diretório LDAP</strong></p></div></div></div><div
              class="para">
				O comando <code
                class="command">jxplorer</code> (do pacote de mesmo nome) é uma ferramenta gráfica que permite navegar e editar um banco de dados LDAP. Ele é uma ferramenta interessante que provê ao administrador uma boa visualização da estrutura hierárquica dos dados LDAP.
			</div><a
              id="idm140035050096528"
              class="indexterm"></a></div><div
            class="para">
				Note também o uso da opção <code
              class="literal">-c</code> do comando <code
              class="command">ldapadd</code>; essa opção faz com que o processamento não pare em caso de erro. O uso dessa opção é necessário porque a conversão do <code
              class="filename">/etc/services</code> geralmente gera alguns erros que podem ser ignorados com segurança.
			</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="idm140035050093600"></a>11.7.3. Gerenciando Contas com LDAP</h3></div></div></div><div
            class="para">
				Agora o banco de dados LDAP contém algumas informações úteis, chegou a hora de fazer uso desses dados. Essa sessão foca em como configurar um sistema Linux para que os vários sistemas de diretórios usem o banco de dados LDAP.
			</div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      id="sect.config-nss"></a>11.7.3.1. Configurando o NSS</h4></div></div></div><div
              class="para">
					O sistema NSS (Name Service Switch, see sidebar <a
                class="xref"
                href="sect.user-group-databases.html#sidebar.intro-nss"><span
                  class="emphasis"><em>APROFUNDANDO</em></span> NSS e banco de dados do sistema</a>) é um sistema modular desenvolvido para definir ou obter informações para o sistema de diretórios. Para usar o LDAP como fonte de dados para o NSS requer a instalação do pacote <span
                class="pkg pkg">libnss-ldap</span>. Sua instalação faz algumas perguntas; as respostas estão resumidas em <a
                class="xref"
                href="sect.ldap-directory.html#tab-libnss-ldap">Tabela 11.2</a>.
				</div><a
              id="idm140035050088896"
              class="indexterm"></a><div
              class="table"><a
                id="tab-libnss-ldap"></a><p
                class="title"><strong>Tabela 11.2. Configurando o pacote <span
                    class="pkg pkg">libnss-ldap</span></strong></p><div
                class="table-contents"><table
                  xmlns:d="http://docbook.org/ns/docbook"
                  class="lt-4-cols gt-7-rows"
                  summary="Configurando o pacote libnss-ldap"><colgroup><col
                      align="justify" /><col
                      align="justify" /></colgroup><thead><tr><th
                        align="justify">Questão</th><th
                        align="justify">Resposta</th></tr></thead><tbody><tr><td
                        align="justify">Servidor LDAP Uniform Resource Identifier</td><td
                        align="justify"><code
                          class="literal">ldap://ldap.falcot.com</code></td></tr><tr><td
                        align="justify">Nome distinto da base de pesquisa</td><td
                        align="justify"><code
                          class="literal">dc=falcot,dc=com</code></td></tr><tr><td
                        align="justify">Versão LDAP para usar</td><td
                        align="justify"><code
                          class="literal">3</code></td></tr><tr><td
                        align="justify">O banco de dados LDAP precisa de um login?</td><td
                        align="justify">não</td></tr><tr><td
                        align="justify">Privilégios especiais LDAP para o root</td><td
                        align="justify">sim</td></tr><tr><td
                        align="justify">Fazer o arquivo de configuração com permissão de leitura/escrita apenas para seu proprietário</td><td
                        align="justify">não</td></tr><tr><td
                        align="justify">Conta LDAP para root</td><td
                        align="justify"><code
                          class="literal">cn=admin,dc=falcot,dc=com</code></td></tr><tr><td
                        align="justify">A senha da conta de root do LDAP</td><td
                        align="justify">a senha administrativa</td></tr></tbody></table></div></div><div
              class="para">
					O arquivo <code
                class="filename">/etc/nsswitch.conf</code> precisa então ser modificado, para configurar o NSS para usar o recém-instalado módulo <code
                class="command">ldap</code>.
				</div><div
              class="example"><a
                id="idm140035050071616"></a><p
                class="title"><strong>Exemplo 11.31. O arquivo <code
                    class="filename">/etc/nsswitch.conf</code></strong></p><div
                class="example-contents"><pre
                  class="programlisting">
# /etc/nsswitch.conf
#
# Example configuration of GNU Name Service Switch functionality.
# If you have the `glibc-doc' and `info' packages installed, try:
# `info libc "Name Service Switch"' for information about this file.

passwd: ldap compat
group: ldap compat
shadow: ldap compat

hosts: files dns ldap
networks: ldap files

protocols: ldap db files
services: ldap db files
ethers: ldap db files
rpc: ldap db files

netgroup: ldap files
</pre></div></div><div
              class="para">
					O módulo <code
                class="command">ldap</code> usualmente é inserido antes dos outros, e ele irá então ser consultado primeiro. A notável exceção é o serviço <code
                class="literal">hosts</code> já que contactar o servidor LDAP requer consultar o DNS primeiro (para resolver <code
                class="literal">ldap.falcot.com</code>). Sem essa exceção, uma consulta de hostname iria recair ao servidor LDAP; isso iria disparar uma resolução de nome ao servidor LDAP, e cairia em um loop infinito.
				</div><div
              class="para">
					Se o servidor LDAP deve ser considerado autoritário (e os arquivos locais usados pelo módulo <code
                class="command">files</code> desconsiderados), serviços podem ser configurados com a seguinte sintaxe:
				</div><div
              class="para">
					<code
                class="literal"><em
                  class="replaceable">serviço</em>: ldap [NOTFOUND=return] files</code>.
				</div><div
              class="para">
					Se a entrada requisitada não existir no banco de dados LDAP, a consulta irá retornar uma resposta “não existe” mesmo que o recurso exista em um dos arquivos locais; esses arquivos locais irão apenas ser usados quando o serviço LDAP estiver parado.
				</div></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      id="sect.config-pam"></a>11.7.3.2. Configurando o PAM</h4></div></div></div><div
              class="para">
					Essa seção descreve a configuração do PAM (see sidebar <a
                class="xref"
                href="basic-configuration.html#sidebar.intro-pam"><span
                  class="emphasis"><em>ATRÁS DAS CENAS</em></span> <code
                  class="filename">/etc/environment</code> e <code
                  class="filename">/etc/default/locale</code></a>) que irá permitir as aplicações realizarem as autenticações necessárias no banco de dados LDAP.
				</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>ATENÇÃO</em></span> Autenticação quebrada</strong></p></div></div></div><div
                class="para">
					Alterar a configuração padrão do PAM usada por vários programas é uma operação delicada. Um erro pode levar a erros de autenticação, o que pode impedir um início de sessão. Manter um shell root aberto é então uma boa precaução. Se acontecerem erros de configuração, eles podem então ser consertados e os serviços reiniciados com um mínimo de esforço.
				</div></div><div
              class="para">
					O módulo LDAP para PAM é provido pelo pacote <span
                class="pkg pkg">libpam-ldap</span>. A instalação deste pacote realiza umas poucas perguntas muito parecidas "aquelas no pacote <span
                class="pkg pkg">libnss-ldap</span>; alguns parâmetros de configuração (como o URI do servidor LDAP) são inclusive compartilhados com o pacote <span
                class="pkg pkg">libnss-ldap</span>. As respostas são resumidas em<a
                class="xref"
                href="sect.ldap-directory.html#tab-libpam-ldap">Tabela 11.3</a>.
				</div><a
              id="idm140035050057968"
              class="indexterm"></a><div
              class="table"><a
                id="tab-libpam-ldap"></a><p
                class="title"><strong>Tabela 11.3. Configuração do <span
                    class="emphasis"><em>libpam-ldap</em></span></strong></p><div
                class="table-contents"><table
                  xmlns:d="http://docbook.org/ns/docbook"
                  class="lt-4-cols lt-7-rows"
                  summary="Configuração do libpam-ldap"><colgroup><col
                      align="justify" /><col
                      align="justify" /></colgroup><thead><tr><th
                        align="justify">Questão</th><th
                        align="justify">Resposta</th></tr></thead><tbody><tr><td
                        align="justify">Permitir a conta administrativa do LDAP se comportar como o root local?</td><td
                        align="justify">Sim. Isto permite usar o comando usual <code
                          class="command">passwd</code> para modificar as senhas armazenadas no banco de dados LDAP.</td></tr><tr><td
                        align="justify">O banco de dados LDAP necessita estar logado?</td><td
                        align="justify">não</td></tr><tr><td
                        align="justify">Conta LDAP para root</td><td
                        align="justify"><code
                          class="literal">cn=admin,dc=falcot,dc=com</code></td></tr><tr><td
                        align="justify">A senha da conta de root do LDAP</td><td
                        align="justify">A senha do banco de dados administrativo LDAP</td></tr><tr><td
                        align="justify">Algorítimo de criptografia local para ser usado em senhas</td><td
                        align="justify">crypt</td></tr></tbody></table></div></div><div
              class="para">
					A instalação do <span
                class="pkg pkg">libpam-ldap</span> automaticamente adapta a configuração padrão do PAM definida nos arquivos <code
                class="filename">/etc/pam.d/common-auth</code>, <code
                class="filename">/etc/pam.d/common-password</code> e <code
                class="filename">/etc/pam.d/common-account</code>. Esse mecanismo usa a ferramenta dedicada <code
                class="command">pam-auth-update</code> (fornecida pelo pacote <span
                class="pkg pkg">libpam-runtime</span>). Essa ferramenta pode também ser rodada pelo administrador caso ele queira habilitar ou desabilitar módulos PAM.
				</div><a
              id="idm140035050042112"
              class="indexterm"></a><a
              id="idm140035050041216"
              class="indexterm"></a><a
              id="idm140035050040320"
              class="indexterm"></a><a
              id="idm140035050039424"
              class="indexterm"></a><a
              id="idm140035050038528"
              class="indexterm"></a><a
              id="idm140035050037632"
              class="indexterm"></a></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      id="idm140035050036608"></a>11.7.3.3. Protegendo a Troca de Dados do LDAP</h4></div></div></div><a
              id="idm140035050035968"
              class="indexterm"></a><div
              class="para">
					Por padrão, o protocolo LDAP transita pela rede em texto puro; isso inclui as senhas (criptografadas). Como as senhas criptografadas podem ser extraídas da rede, elas pode ficar vulneráveis a ataques do tipo dicionário. Isso pode ser evitado usando um camada de criptografia extra; habilitar essa camada é o tópico desta seção.
				</div><div
              class="section"><div
                class="titlepage"><div><div><h5
                      class="title"><a
                        id="idm140035050034064"></a>11.7.3.3.1. Configurando o Servidor</h5></div></div></div><a
                id="idm140035050033424"
                class="indexterm"></a><a
                id="idm140035050032144"
                class="indexterm"></a><div
                class="para">
						O primeiro passo é criar um par de chaves (contendo uma chave pública e uma chave privada) para o servidor LDAP. Os administradores da Falcot usaram novamente <span
                  class="emphasis"><em>easy-rsa</em></span> para gerá-las (veja <a
                  class="xref"
                  href="sect.virtual-private-network.html#sect.easy-rsa">Seção 10.2.1.1, “Infraestrutura de Chaves Públicas: <span
                    class="emphasis"><em>easy-rsa</em></span>”</a>). Ao executar <code
                  class="command">./build-server-key ldap.falcot.com</code> são feitas algumas perguntas mundanas (localização, nome da organização e assim por diante). A resposta para a pergunta “nome comun” <span
                  class="emphasis"><em>tem</em></span> que ser um nome de máquina completo (fully-qualified) para o servidor LDAP; em nosso caso, <code
                  class="literal">ldap.falcot.com</code>.
					</div><div
                class="para">
						Esse comando cria um certificado no arquivo <code
                  class="filename">keys/ldap.falcot.com.crt</code>; a chave privada correspondente é armazenada em <code
                  class="filename">keys/ldap.falcot.com.key</code>.
					</div><div
                class="para">
						Agora essas chaves tem que ser instaladas em seu local padrão, e nós temos que garantir que o arquivo privado pode ser lido pelo servidor LDAP, o qual roda sob a identidade do usuário <code
                  class="literal">openldap</code>:
					</div><pre
                class="screen">
# <strong
                  class="userinput"><code>adduser openldap ssl-cert</code></strong>
Adding user `openldap' to group `ssl-cert' ...
Adding user openldap to group ssl-cert
Done.
# <strong
                  class="userinput"><code>mv keys/ldap.falcot.com.key /etc/ssl/private/ldap.falcot.com.key</code></strong>
# <strong
                  class="userinput"><code>chown root:ssl-cert /etc/ssl/private/ldap.falcot.com.key</code></strong>
# <strong
                  class="userinput"><code>chmod 0640 /etc/ssl/private/ldap.falcot.com.key</code></strong>
# <strong
                  class="userinput"><code>mv newcert.pem /etc/ssl/certs/ldap.falcot.com.pem</code></strong></pre><div
                class="para">
						O daemon <code
                  class="command">slapd</code> também precisa ser informado para usar essas chaves para criptografia. A configuração do servidor LDAP é gerenciada dinamicamente: a configuração pode ser atualizada através de operações normais do LDAP no objeto hierárquico <code
                  class="literal">cn=config</code>, e o servidor atualiza o <code
                  class="filename">/etc/ldap/slapd.d</code> em tempo real para fazer com que a configuração seja persistente. <code
                  class="command">ldapmodify</code> é, assim, a ferramenta certa para atualizar a configuração:
					</div><div
                class="example"><a
                  id="idm140035050021584"></a><p
                  class="title"><strong>Exemplo 11.32. Configurando <code
                      class="command">slapd</code> para criptografia</strong></p><div
                  class="example-contents"><pre
                    class="screen">
# <strong
                      class="userinput"><code>cat &gt;ssl.ldif &lt;&lt;END
dn: cn=config
changetype: modify
add: olcTLSCertificateFile
olcTLSCertificateFile: /etc/ssl/certs/ldap.falcot.com.pem
-
add: olcTLSCertificateKeyFile
olcTLSCertificateKeyFile: /etc/ssl/private/ldap.falcot.com.key
-
END</code></strong>
# <strong
                      class="userinput"><code>ldapmodify -Y EXTERNAL -H ldapi:/// -f ssl.ldif</code></strong>
SASL/EXTERNAL authentication started
SASL username: gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth
SASL SSF: 0
modifying entry "cn=config"
</pre></div></div><div
                class="sidebar"><div
                  class="titlepage"><div><div><p
                        class="title"><strong><span
                            class="emphasis"><em>FERRAMENTA</em></span> <code
                            class="command">ldapvi</code> para editar um diretório LDAP</strong></p></div></div></div><a
                  id="idm140035050017584"
                  class="indexterm"></a><div
                  class="para">
						Com o <code
                    class="command">ldapvi</code>, você pode exibir uma saída LDIF de qualquer parte do diretório LDAP, fazer algumas mudanças no editor de texto, e deixar a ferramenta fazer as correspondentes operações LDAP para você.
					</div><div
                  class="para">
						Esta é, portanto, uma maneira coveniente de atualizar a configuração do servidor LDAP, simplesmente editando a hierarquia <code
                    class="literal">cn=config</code>.
					</div><pre
                  class="screen">
# <strong
                    class="userinput"><code>ldapvi -Y EXTERNAL -h ldapi:/// -b cn=config</code></strong></pre></div><div
                class="para">
						O último passo para habilitar a criptografia envolve alterar a variável <code
                  class="varname">SLAPD_SERVICES</code> no arquivo <code
                  class="filename">/etc/default/slapd</code>. Nós vamos torná-lo seguro e desabilitar o LDAP inseguro de uma vez só.
					</div><div
                class="example"><a
                  id="idm140035050012688"></a><p
                  class="title"><strong>Exemplo 11.33. O nome <code
                      class="filename">/etc/default/slapd</code></strong></p><div
                  class="example-contents"><pre
                    class="programlisting">
# Default location of the slapd.conf file or slapd.d cn=config directory. If
# empty, use the compiled-in default (/etc/ldap/slapd.d with a fallback to
# /etc/ldap/slapd.conf).
SLAPD_CONF=

# System account to run the slapd server under. If empty the server
# will run as root.
SLAPD_USER="openldap"

# System group to run the slapd server under. If empty the server will
# run in the primary group of its user.
SLAPD_GROUP="openldap"

# Path to the pid file of the slapd server. If not set the init.d script
# will try to figure it out from $SLAPD_CONF (/etc/ldap/slapd.conf by
# default)
SLAPD_PIDFILE=

# slapd normally serves ldap only on all TCP-ports 389. slapd can also
# service requests on TCP-port 636 (ldaps) and requests via unix
# sockets.
# Example usage:
# SLAPD_SERVICES="ldap://127.0.0.1:389/ ldaps:/// ldapi:///"
SLAPD_SERVICES="ldaps:/// ldapi:///"

# If SLAPD_NO_START is set, the init script will not start or restart
# slapd (but stop will still work).  Uncomment this if you are
# starting slapd via some other means or if you don't want slapd normally
# started at boot.
#SLAPD_NO_START=1

# If SLAPD_SENTINEL_FILE is set to path to a file and that file exists,
# the init script will not start or restart slapd (but stop will still
# work).  Use this for temporarily disabling startup of slapd (when doing
# maintenance, for example, or through a configuration management system)
# when you don't want to edit a configuration file.
SLAPD_SENTINEL_FILE=/etc/ldap/noslapd

# For Kerberos authentication (via SASL), slapd by default uses the system
# keytab file (/etc/krb5.keytab).  To use a different keytab file,
# uncomment this line and change the path.
#export KRB5_KTNAME=/etc/krb5.keytab

# Additional options to pass to slapd
SLAPD_OPTIONS=""
</pre></div></div></div><div
              class="section"><div
                class="titlepage"><div><div><h5
                      class="title"><a
                        id="idm140035050009360"></a>11.7.3.3.2. Configurando o Cliente</h5></div></div></div><div
                class="para">
						No lado do cliente, a configuração para os módulos <span
                  class="emphasis"><em>libpam-ldap</em></span> e <span
                  class="emphasis"><em>libnss-ldap</em></span> precisa ser modificada para usar a URI <code
                  class="literal">ldaps://</code>.
					</div><div
                class="para">
						Clientes LDAP também precisam ser capazes de autenticar o servidor. Em uma infraestrutura de chave pública X.509, certificados públicos são assinados pela chave da autoridade certificadora (CA, do inglês certificate authority). Com <span
                  class="emphasis"><em>easy-rsa</em></span>, os administradores da Falcot criaram seu próprio CA e agora eles precisam configurar o sistema para confiar nas assinaturas do CA da Falcot. Isso pode ser feito colocando o certificado CA em <code
                  class="filename">/usr/local/share/ca-certificates</code> e executando <code
                  class="command">update-ca-certificates</code>.
					</div><pre
                class="screen">
# <strong
                  class="userinput"><code>cp keys/ca.crt /usr/local/share/ca-certificates/falcot.crt</code></strong>
# <strong
                  class="userinput"><code>update-ca-certificates</code></strong>
Updating certificates in /etc/ssl/certs... 1 added, 0 removed; done.
Running hooks in /etc/ca-certificates/update.d....
Adding debian:falcot.pem
done.
done.
</pre><div
                class="para">
						Por último, mas não menos importante, a URI padrão do LDAP e o DN base padrão usado por várias ferramentas de linha de comando podem ser modificados em <code
                  class="filename">/etc/ldap/ldap.conf</code>. Isso irá evitar, consideravelmente, digitação.
					</div><div
                class="example"><a
                  id="idm140035050002672"></a><p
                  class="title"><strong>Exemplo 11.34. O arquivo <code
                      class="filename">/etc/ldap/ldap.conf</code></strong></p><div
                  class="example-contents"><pre
                    class="programlisting">#
# LDAP Defaults
#

# See ldap.conf(5) for details
# This file should be world readable but not world writable.

BASE   dc=falcot,dc=com
URI    ldaps://ldap.falcot.com

#SIZELIMIT      12
#TIMELIMIT      15
#DEREF          never

# TLS certificates (needed for GnuTLS)
TLS_CACERT      /etc/ssl/certs/ca-certificates.crt
</pre></div></div><div
                class="para">
						Esse capítulo mostrou apenas uma fração dos softwares de servidor disponíveis; contudo, a maioria dos serviços de rede comuns foram descritos. Agora é hora de um capítulo ainda mais técnico: nós iremos entrar mais detalhadamente ainda em alguns conceitos, descrevendo implementações massivas e virtualização.
					</div></div></div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="sect.http-ftp-proxy.html"><strong>Anterior</strong>11.6. Proxy HTTP/FTP</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>Acima</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>Principal</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="advanced-administration.html"><strong>Próxima</strong>Capítulo 12. Administração Avançada</a></li></ul><div
        id="translated_pages"><ul><li><a
              href="../ar-MA/sect.ldap-directory.html">ar-MA</a></li><li><a
              href="../da-DK/sect.ldap-directory.html">da-DK</a></li><li><a
              href="../de-DE/sect.ldap-directory.html">de-DE</a></li><li><a
              href="../el-GR/sect.ldap-directory.html">el-GR</a></li><li><a
              href="../en-US/sect.ldap-directory.html">en-US</a></li><li><a
              href="../es-ES/sect.ldap-directory.html">es-ES</a></li><li><a
              href="../fa-IR/sect.ldap-directory.html">fa-IR</a></li><li><a
              href="../fr-FR/sect.ldap-directory.html">fr-FR</a></li><li><a
              href="../hr-HR/sect.ldap-directory.html">hr-HR</a></li><li><a
              href="../id-ID/sect.ldap-directory.html">id-ID</a></li><li><a
              href="../it-IT/sect.ldap-directory.html">it-IT</a></li><li><a
              href="../ja-JP/sect.ldap-directory.html">ja-JP</a></li><li><a
              href="../pl-PL/sect.ldap-directory.html">pl-PL</a></li><li><a
              href="../pt-BR/sect.ldap-directory.html">pt-BR</a></li><li><a
              href="../ro-RO/sect.ldap-directory.html">ro-RO</a></li><li><a
              href="../ru-RU/sect.ldap-directory.html">ru-RU</a></li><li><a
              href="../tr-TR/sect.ldap-directory.html">tr-TR</a></li><li><a
              href="../zh-CN/sect.ldap-directory.html">zh-CN</a></li></ul></div></body></html>
