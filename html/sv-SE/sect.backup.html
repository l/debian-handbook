<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">9.10. Säkerhetskopia</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-9-sv-SE-1.0-1" /><meta
        name="keywords"
        content="System boot, Initskript, SSH, Telnet, Rättigheter, Behörigheter, Övervakning, Inetd, Cron, Säkerhetskopia, Inpluggninsbara, PCMCIA, APM, ACPI" /><link
        rel="home"
        href="index.html"
        title="Handbok för Debianadministratören" /><link
        rel="up"
        href="unix-services.html"
        title="Kapitel 9. Unixtjänster" /><link
        rel="prev"
        href="sect.quotas.html"
        title="9.9. Kvoter" /><link
        rel="next"
        href="sect.hotplug.html"
        title="9.11. Hot Plugging: hotplug" /><meta
        name="viewport"
        content="width=device-width, initial-scale=1" /><meta
        name="flattr:id"
        content="4pz9jq" /><link
        rel="canonical"
        href="http://l.github.io/debian-handbook/html/sv-SE/sect.backup.html" /></head><body><noscript><iframe
          src="//www.googletagmanager.com/ns.html?id=GTM-5H35QX"
          height="0"
          width="0"
          style="display:none;visibility:hidden"></iframe></noscript><script
        type="text/javascript">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&amp;l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5H35QX');</script><div
        id="banner"><a
          href="../../"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="index.html"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="sect.quotas.html"><strong>Föregående</strong></a></li><li
          class="home">Handbok för Debianadministratören</li><li
          class="next"><a
            accesskey="n"
            href="sect.hotplug.html"><strong>Nästa</strong></a></li></ul><div
        class="section"><div
          class="titlepage"><div><div><h2
                class="title"><a
                  id="sect.backup"></a>9.10. Säkerhetskopia</h2></div></div></div><div
          class="para">
			Att ta säkerhetskopior är en av huvuduppgifterna för en administratör, men det är ett komplex område och involverar kraftfulla verktyg som ofta är svårhanterliga.
		</div><a
          id="id-1.12.13.3"
          class="indexterm"></a><a
          id="id-1.12.13.4"
          class="indexterm"></a><div
          class="para">
			Det finns många program, som <code
            class="command">amanda</code>, <code
            class="command">bacula</code>, <code
            class="command">BackupPC</code>. De är klient/serversystem som innehåller många alternativ vars konfiguration är ganska svår. En del av dem tillhandahåller användarvänliga webbgränssnitt för att sköta dem. Men Debian innehåller dussintals andra säkerhetskopior som täcker alla möjliga fall, som du enkelt kan bekräfta med <code
            class="command">apt-cache search backup</code>.
		</div><a
          id="id-1.12.13.6"
          class="indexterm"></a><a
          id="id-1.12.13.7"
          class="indexterm"></a><a
          id="id-1.12.13.8"
          class="indexterm"></a><div
          class="para">
			Istället för att i detalj beskriva dem kommer detta avsnitt att presentera tankegången hos Falcot Corp-administratörerna när de definiera sin säkerhetsstrategi.
		</div><div
          class="para">
			På Falcot Corp har säkerhetskopior två mål: att återskapa felaktigt borttagna filer och att snabbt återställa datorer (server eller skrivbord) där hårddisken har fallerat.
		</div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="id-1.12.13.11"></a>9.10.1. Säkerhetskopiera med <code
                    class="command">rsync</code></h3></div></div></div><div
            class="para">
				Säkerhetskopior på band har bedömts vara för långsamma och kostsamma, data kommer att säkerhetskopieras på hårdiskar på en dedikerade server, för vilken användningen av mjukvaru-RAID (se <a
              class="xref"
              href="advanced-administration.html#sect.raid-soft">Avsnitt 12.1.1, ”Software RAID”</a> kommer att skydda data från hårddiskfel. Normalt tas inte säkerhetskopior för skrivbordsdatorer , men det rekommenderas att användarnas personliga konton på deras avdelnings filserver säkerhetkopieras. Kommandot <code
              class="command">rsync</code> från paketet med samma namn) används dagligen för att ta säkerhetskopior av de olika servrarna.
			</div><a
            id="id-1.12.13.11.3"
            class="indexterm"></a><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>GRUNDLÄGGANDE</em></span> Hårdlänken, ett till namn för filen</strong></p></div></div></div><a
              id="id-1.12.13.11.4.2"
              class="indexterm"></a><a
              id="id-1.12.13.11.4.3"
              class="indexterm"></a><div
              class="para">
				En hårdlink kan i motsats till en mjuklänk inte skiljas från den länkade filen. Att skapa en hårdlänk är i praktiken detsamma som att ge en befintlig fil ett till namn. Det är därför borttagningen av en hårdlänk endast tar bort en av namnen associerat med filen.Så länge som ett annat namn fortfarande är kopplat till filen kommer data därinne att kvarstå på filsystemet. Det är intressant att observera att, istället för en kopia så tar inte hårdlänken upp ytterligare utrymme på hårddisken.
			</div><div
              class="para">
				En hårdlänk skapas med kommandot <code
                class="command">ln <em
                  class="replaceable">mål</em> <em
                  class="replaceable">länk</em></code>. Filen <em
                class="replaceable">länk</em> är sedan det nya namnet för <em
                class="replaceable">mål</em>. Hårdlänken kan endast skapas på samma filsystem, med symboliska länkar inte har denna begränsning.
			</div></div><div
            class="para">
				Det tillgängliga hårddiskutrymmet förhindrar implementationen av en komplett daglig säkerhetskopia. Som sådant är kommandot <code
              class="command">rsync</code> föregås av en duplicering av innehållet av föregående säkerhetskopia med hårdlänkar, vilka förhindrar användning av för mycket hårddiskutrymme. Processen <code
              class="command">rsync</code> ersätter då endast filer som har modifierats sedan senaste säkerhetskopian. Med denna mekanism kommer ett stort antal säkerhetskopior att kunna lagras med ett litet utrymme. Eftersom alla säkerhetskopior är tillgängliga och direkt åtkomliga (till exempel, i olika kataloger för en given utdelning av nätverket) kan du snabbt utföra jämförelser mellan två givna datum.
			</div><a
            id="id-1.12.13.11.6"
            class="indexterm"></a><a
            id="id-1.12.13.11.7"
            class="indexterm"></a><a
            id="id-1.12.13.11.8"
            class="indexterm"></a><div
            class="para">
				Mekanismen för säkerhetskopia är enkelt implementerat med programmet <code
              class="command">dirvish</code>. Det använder ett säkerhetslagringsutrymme (”bank” i vokabulären) i vilken den placerar kopior av säkerhetskopierade filer som kallas ”valv” i dirvish-dokumentationen.
			</div><div
            class="para">
				Huvudkonfigurationen finns i filen <code
              class="filename">/etc/dirvish/master.conf</code>. Den definierar säkerhetskopiornas lagringsutrymme, listan av ”valv“ att hantera och standardvärden för utgången av säkerhetskopior. Resten av konfigurationen finns i filerna <code
              class="filename"><em
                class="replaceable">bank</em>/<em
                class="replaceable">valv</em>/dirvish/default.conf</code> och innehåller specifik konfiguration för den motsvarande filmängden.
			</div><div
            class="example"><a
              id="example.dirvish-master"></a><p
              class="title"><strong>Exempel 9.3. Filen <code
                  class="filename">/etc/dirvish/master.conf</code></strong></p><div
              class="example-contents"><pre
                class="programlisting">bank:
    /backup
exclude:
    lost+found/
    core
    *~
Runall:
    root    22:00
expire-default: +15 days
expire-rule:
#   MIN HR    DOM MON       DOW  STRFTIME_FMT
    *   *     *   *         1    +3 months
    *   *     1-7 *         1    +1 year
    *   *     1-7 1,4,7,10  1</pre></div></div><div
            class="para">
				Inställningen <code
              class="literal">bank</code> indikerar katalogen i vilken säkerhetskopian är lagrad. Inställningen <code
              class="literal">exclude</code> låter dig utesluta filer (eller filtyper) att utesluta från säkerhetskopian. <code
              class="literal">Runall</code> är en lista över filmängden att säkerhetskopiera med en tidsstämpel för varje mängd som låter dig tilldela korrekt datum till kopian, i det fall säkerhetskopian inte löses ut precis vid tilldelad tid. Du måste ange en tid för precis innan själva körtiden (vilken, som standardvärde, är 10.04 pm i Debian enligt <code
              class="filename">/etc/cron.d/dirvish</code>). Slutligen, definierar inställningarna <code
              class="literal">expire-default</code> och <code
              class="literal">expire-rule</code> reglerna för då tidsgränsen passeras för säkerhetskopian. Exemplet ovan behåller för evigt de som generas den första söndagen i varje kvartal, och tar efter ett år bort dem från de från den första söndagen i varje månad, och efter 3 månader de från andra söndagar. Andra dagliga säkerhetskopior behålls i 15 dagar. Reglernas ordning har betydelse. Dirvish använder den senast matchande regeln eller <code
              class="literal">expire-default</code> om ingen annan <code
              class="literal">expire-rule</code> matchar.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>I PRAKTIKEN</em></span> Schemalagd tidsgräns</strong></p></div></div></div><div
              class="para">
				Reglerna för tidsgränser används inte av <code
                class="command">dirvish-expire</code> för att utföra dess jobb. De tillämpas vid skapandet av en ny säkerhetskopia för att definiera utgångsdatum associerad med kopian. <code
                class="command">dirvish-expire</code> använder de lagrade kopiorna och tar bort de för vilka sista datum har passerat.
			</div></div><div
            class="example"><a
              id="example.dirvish-vault"></a><p
              class="title"><strong>Exempel 9.4. Filen <code
                  class="filename">/backup/root/dirvish/default.conf</code></strong></p><div
              class="example-contents"><pre
                class="programlisting">client: rivendell.falcot.com
tree: /
xdev: 1
index: gzip
image-default: %Y%m%d
exclude:
    /var/cache/apt/archives/*.deb
    /var/cache/man/**
    /tmp/**
    /var/tmp/**
    *.bak</pre></div></div><div
            class="para">
				The above example specifies the set of files to back up: these are files on the machine <span
              class="emphasis"><em>rivendell.falcot.com</em></span> (for local data backup, simply specify the name of the local machine as indicated by <code
              class="command">hostname</code>), especially those in the root tree (<code
              class="literal">tree: /</code>), except those listed in <code
              class="literal">exclude</code>. The backup will be limited to the contents of one filesystem (<code
              class="literal">xdev: 1</code>). It will not include files from other mount points. An index of saved files will be generated (<code
              class="literal">index: gzip</code>), and the image will be named according to the current date (<code
              class="literal">image-default: %Y%m%d</code>).
			</div><div
            class="para">
				There are many options available, all documented in the <span
              class="citerefentry"><span
                class="refentrytitle">dirvish.conf</span>(5)</span> manual page. Once these configuration files are setup, you have to initialize each file set with the <code
              class="command">dirvish --vault <em
                class="replaceable">vault</em> --init</code> command. From there on the daily invocation of <code
              class="command">dirvish-runall</code> will automatically create a new backup copy just after having deleted those that expired.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>IN PRACTICE</em></span> Remote backup over SSH</strong></p></div></div></div><div
              class="para">
				When dirvish needs to save data to a remote machine, it will use <code
                class="command">ssh</code> to connect to it, and will start <code
                class="command">rsync</code> as a server. This requires the root user to be able to automatically connect to it. The use of an SSH authentication key allows precisely that (see <a
                class="xref"
                href="sect.remote-login.html#sect.ssh-key-based-auth">Avsnitt 9.2.1.1, ”Nyckelbasera autentisering”</a>).
			</div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="id-1.12.13.12"></a>9.10.2. Restoring Machines without Backups</h3></div></div></div><div
            class="para">
				Desktop computers, which are not backed up, will be easy to reinstall from custom DVD-ROMs prepared with <span
              class="emphasis"><em>Simple-CDD</em></span> (see <a
              class="xref"
              href="sect.automated-installation.html#sect.simple-cdd">Avsnitt 12.3.3, ”Simple-CDD: The All-In-One Solution”</a>). Since this performs an installation from scratch, it loses any customization that can have been made after the initial installation. This is fine since the systems are all hooked to a central LDAP directory for accounts and most desktop applications are preconfigured thanks to dconf (see <a
              class="xref"
              href="sect.graphical-desktops.html#sect.gnome-desktop">Avsnitt 13.3.1, ”GNOME”</a> for more information about this).
			</div><div
            class="para">
				The Falcot Corp administrators are aware of the limits in their backup policy. Since they can't protect the backup server as well as a tape in a fireproof safe, they have installed it in a separate room so that a disaster such as a fire in the server room won't destroy backups along with everything else. Furthermore, they do an incremental backup on DVD-ROM once per week — only files that have been modified since the last backup are included.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>GOING FURTHER</em></span> Backing up SQL and LDAP services</strong></p></div></div></div><div
              class="para">
				Many services (such as SQL or LDAP databases) cannot be backed up by simply copying their files (unless they are properly interrupted during creation of the backups, which is frequently problematic, since they are intended to be available at all times). As such, it is necessary to use an “export” mechanism to create a “data dump” that can be safely backed up. These are often quite large, but they compress well. To reduce the storage space required, you will only store a complete text file per week, and a <code
                class="command">diff</code> each day, which is created with a command of the type <code
                class="command">diff <em
                  class="replaceable">file_from_yesterday</em> <em
                  class="replaceable">file_from_today</em></code>. The <code
                class="command">xdelta</code> program produces incremental differences from binary dumps.
			</div><a
              id="id-1.12.13.12.4.3"
              class="indexterm"></a><a
              id="id-1.12.13.12.4.4"
              class="indexterm"></a><a
              id="id-1.12.13.12.4.5"
              class="indexterm"></a></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>CULTURE</em></span> <span
                        class="emphasis"><em>TAR</em></span>, the standard for tape backups</strong></p></div></div></div><a
              id="id-1.12.13.12.5.2"
              class="indexterm"></a><a
              id="id-1.12.13.12.5.3"
              class="indexterm"></a><a
              id="id-1.12.13.12.5.4"
              class="indexterm"></a><div
              class="para">
				Historically, the simplest means of making a backup on Unix was to store a <span
                class="emphasis"><em>TAR</em></span> archive on a tape. The <code
                class="command">tar</code> command even got its name from “Tape ARchive”.
			</div></div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="sect.quotas.html"><strong>Föregående</strong>9.9. Kvoter</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>Upp</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>Hem</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.hotplug.html"><strong>Nästa</strong>9.11. Hot Plugging: hotplug</a></li></ul><div
        id="translated_pages"><ul><li><a
              href="../ar-MA/sect.backup.html">ar-MA</a></li><li><a
              href="../da-DK/sect.backup.html">da-DK</a></li><li><a
              href="../de-DE/sect.backup.html">de-DE</a></li><li><a
              href="../el-GR/sect.backup.html">el-GR</a></li><li><a
              href="../en-US/sect.backup.html">en-US</a></li><li><a
              href="../es-ES/sect.backup.html">es-ES</a></li><li><a
              href="../fa-IR/sect.backup.html">fa-IR</a></li><li><a
              href="../fr-FR/sect.backup.html">fr-FR</a></li><li><a
              href="../hr-HR/sect.backup.html">hr-HR</a></li><li><a
              href="../id-ID/sect.backup.html">id-ID</a></li><li><a
              href="../it-IT/sect.backup.html">it-IT</a></li><li><a
              href="../ja-JP/sect.backup.html">ja-JP</a></li><li><a
              href="../ko-KR/sect.backup.html">ko-KR</a></li><li><a
              href="../nb-NO/sect.backup.html">nb-NO</a></li><li><a
              href="../pl-PL/sect.backup.html">pl-PL</a></li><li><a
              href="../pt-BR/sect.backup.html">pt-BR</a></li><li><a
              href="../ro-RO/sect.backup.html">ro-RO</a></li><li><a
              href="../ru-RU/sect.backup.html">ru-RU</a></li><li><a
              href="../tr-TR/sect.backup.html">tr-TR</a></li><li><a
              href="../vi-VN/sect.backup.html">vi-VN</a></li><li><a
              href="../zh-CN/sect.backup.html">zh-CN</a></li><li><a
              href="../zh-TW/sect.backup.html">zh-TW</a></li></ul></div></body></html>
