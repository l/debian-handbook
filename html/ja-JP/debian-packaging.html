<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">第 15 章 Debian パッケージの作成</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-8-ja-JP-1.0-1" /><meta
        name="keywords"
        content="バックポート, 再ビルド, ソースパッケージ, アーカイブ, メタパッケージ, Debian 開発者, メンテナ" /><link
        rel="home"
        href="index.html"
        title="Debian 管理者ハンドブック" /><link
        rel="up"
        href="index.html"
        title="Debian 管理者ハンドブック" /><link
        rel="prev"
        href="sect.dealing-with-compromised-machine.html"
        title="14.7. 不正侵入されたマシンの取り扱い" /><link
        rel="next"
        href="sect.building-first-package.html"
        title="15.2. 最初のパッケージのビルド" /><meta
        name="viewport"
        content="width=device-width, initial-scale=1" /><link
        rel="canonical"
        href="http://l.github.io/debian-handbook/html/ja-JP/debian-packaging.html" /></head><body><noscript><iframe
          src="//www.googletagmanager.com/ns.html?id=GTM-5H35QX"
          height="0"
          width="0"
          style="display:none;visibility:hidden"></iframe></noscript><script
        type="text/javascript">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&amp;l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5H35QX');</script><div
        id="banner"><a
          href="../../"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="index.html"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="sect.dealing-with-compromised-machine.html"><strong>戻る</strong></a></li><li
          class="home">Debian 管理者ハンドブック</li><li
          class="next"><a
            accesskey="n"
            href="sect.building-first-package.html"><strong>次へ</strong></a></li></ul><div
        xml:lang="ja-JP"
        class="chapter"
        lang="ja-JP"><div
          class="titlepage"><div><div><h1
                class="title"><a
                  id="debian-packaging"></a>第 15 章 Debian パッケージの作成</h1></div></div></div><div
          class="toc"><dl
            class="toc"><dt><span
                class="section"><a
                  href="debian-packaging.html#sect.rebuilding-package">15.1. ソースを使ったパッケージの再ビルド</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="debian-packaging.html#id-1.18.4.3">15.1.1. ソースの取得</a></span></dt><dt><span
                    class="section"><a
                      href="debian-packaging.html#id-1.18.4.4">15.1.2. 修正を行う</a></span></dt><dt><span
                    class="section"><a
                      href="debian-packaging.html#id-1.18.4.5">15.1.3. 再ビルドの開始</a></span></dt></dl></dd><dt><span
                class="section"><a
                  href="sect.building-first-package.html">15.2. 最初のパッケージのビルド</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="sect.building-first-package.html#id-1.18.5.2">15.2.1. メタパッケージやフェイクパッケージ</a></span></dt><dt><span
                    class="section"><a
                      href="sect.building-first-package.html#id-1.18.5.3">15.2.2. 単純なファイルアーカイブ</a></span></dt></dl></dd><dt><span
                class="section"><a
                  href="sect.setup-apt-package-repository.html">15.3. APT 用のパッケージリポジトリの作成</a></span></dt><dt><span
                class="section"><a
                  href="sect.becoming-package-maintainer.html">15.4. パッケージメンテナになる</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="sect.becoming-package-maintainer.html#id-1.18.7.2">15.4.1. パッケージを作るための知識</a></span></dt><dt><span
                    class="section"><a
                      href="sect.becoming-package-maintainer.html#id-1.18.7.3">15.4.2. 受け入れ過程</a></span></dt></dl></dd></dl></div><div
          class="highlights"><div
            class="para">
		Debian パッケージを標準的な方法で取り扱ってきた管理者がいずれは自分自身のパッケージを作成したり、既存のパッケージを変更したりする必要性を感じるということは極めて普通のことです。この章ではパッケージングに関する最も一般的な質問に答えたり、最良のやり方で Debian インフラをうまく使うために必要な要素を提供したりすることを目標にしています。運が良ければ、ローカルパッケージを取り扱った後、さらに進んで Debian プロジェクト自体に参加する必要性を感じるかもしれません。
	</div></div><div
          class="section"><div
            class="titlepage"><div><div><h2
                  class="title"><a
                    id="sect.rebuilding-package"></a>15.1. ソースを使ったパッケージの再ビルド</h2></div></div></div><div
            class="para">
			いくつかの状況下では、バイナリパッケージの再ビルドが必要です。たとえば、管理者は特定のコンパイルオプションを付けてソフトウェアをソースからコンパイルすることで導入されるソフトウェアの機能を必要とする場合があります。そしてまた、インストール済みの Debian のバージョン用にパッケージングされたソフトウェアのバージョンが古い場合があります。ソフトウェアのバージョンが古い場合、管理者は<span
              class="distribution distribution">テスト版</span>や<span
              class="distribution distribution">不安定版</span>などの Debian の新しいバージョンから取得したより新しいパッケージをビルドすることが多いです。こうすることで、新しいパッケージを<span
              class="distribution distribution">安定版</span>ディストリビューションで動かすことが可能です。この操作は「バックポート」と呼ばれています。いつも通り、バックポート作業の前に既にバックポートパッケージが公開されているか否かを注意深く確認するべきです。対象のパッケージに対する Debian Package Tracker を一読するだけでこの種の情報が明らかになります。<div
              class="url">→ <a
                href="https://tracker.debian.org/">https://tracker.debian.org/</a></div><a
              id="id-1.18.4.2.5"
              class="indexterm"></a>
		</div><div
            class="section"><div
              class="titlepage"><div><div><h3
                    class="title"><a
                      id="id-1.18.4.3"></a>15.1.1. ソースの取得</h3></div></div></div><div
              class="para">
				Debian パッケージの再ビルドはパッケージのソースコードを取得することから始まります。最も簡単な方法は <code
                class="command">apt-get source <em
                  class="replaceable">source-package-name</em></code> コマンドを使うことです。このコマンドを実行するには <code
                class="filename">/etc/apt/sources.list</code> ファイルの中に <code
                class="literal">deb-src</code> 行が必要で、さらに最新のインデックスファイルが必要です (たとえば <code
                class="command">apt-get update</code> を実行する必要があります)。管理者が APT 設定を取り扱う章で説明した内容 (<a
                class="xref"
                href="apt.html#sect.apt-sources.list">第 6.1 節「<code
                  class="filename">sources.list</code> ファイルの内容」</a>を参照してください) に従っている場合、これらの状況は既に満足されているはずです。しかしながら、<code
                class="command">apt-get source <em
                  class="replaceable">source-package-name</em></code> コマンドは <code
                class="literal">deb-src</code> 行で言及されている Debian バージョンのソースパッケージをダウンロードする点に注意してください。もし他のバージョンのソースパッケージが必要な場合、Debian アーカイブミラーや Debian のウェブサイトから手作業でダウンロードする必要があるかもしれません。この場合には 2、3 個のファイルをダウンロードする必要があります (<span
                class="emphasis"><em>Debian Source Control</em></span> 用に <code
                class="filename">*.dsc</code> 拡張子を持つファイル、<code
                class="filename">*.tar.<em
                  class="replaceable">comp</em></code> としばしば <code
                class="filename">*.diff.gz</code> や <code
                class="filename">*.debian.tar.<em
                  class="replaceable">comp</em></code> 拡張子を持つファイル、ここで <em
                class="replaceable">comp</em> は使われている圧縮ツールに応じて <code
                class="literal">gz</code>、<code
                class="literal">bz2</code>、<code
                class="literal">xz</code> のうちのどれか 1 つです)。その後、<code
                class="command">dpkg-source -x <em
                  class="replaceable">file.dsc</em></code> コマンドを実行します。<code
                class="filename">*.dsc</code> ファイルがある URL から直接利用できるならば、<code
                class="command">dget <em
                  class="replaceable">URL</em></code> コマンドを使えばより簡単にすべてを取得することが可能です。dget コマンドは (<span
                class="pkg pkg">devscripts</span> パッケージに含まれます) 指定したアドレスから <code
                class="filename">*.dsc</code> ファイルを取得し、内容を解析し、ファイル内で参照されている単一もしくは複数のファイルを自動的に取得します。すべてのダウンロードが完了したら、dget コマンドはソースパッケージを展開します (これは <code
                class="literal">-d</code> または <code
                class="literal">--download-only</code> オプションが使われていない場合に限ります)。
			</div></div><div
            class="section"><div
              class="titlepage"><div><div><h3
                    class="title"><a
                      id="id-1.18.4.4"></a>15.1.2. 修正を行う</h3></div></div></div><div
              class="para">
				これでパッケージのソースがソースパッケージとバージョンを基に名付けられたディレクトリ (たとえば <span
                class="emphasis"><em>samba-4.1.17+dfsg</em></span> など) の中で利用できるようになりました。修正作業はこのディレクトリ内で行われます。
			</div><div
              class="para">
				最初にパッケージのバージョン番号を変更します。こうすることで、再ビルドされたパッケージを Debian の提供する元パッケージと区別することが可能です。現在のバージョンが <code
                class="literal">2:4.1.17+dfsg-2</code> の場合、バージョン <code
                class="literal">2:4.1.17+dfsg-2falcot1</code> を作成することが可能です。これはパッケージの出自を明らかに示しています。このパッケージのバージョン番号は Debian が提供する元パッケージのバージョン番号よりも大きいため、このパッケージを元パッケージの更新として簡単にインストールできます。このような作業を極めて効果的に行うには、<span
                class="pkg pkg">devscripts</span> パッケージの提供する <code
                class="command">dch</code> コマンド (<span
                class="emphasis"><em>Debian CHangelog</em></span>) を <code
                class="command">dch --local falcot</code> のように使います。これは最良の効果を発揮します。<code
                class="command">dch</code> コマンドはテキストエディタ (<code
                class="command">sensible-editor</code>。このエディタは <code
                class="varname">VISUAL</code> または <code
                class="varname">EDITOR</code> 環境変数で定義されているお気に入りのエディタです。そうでなければデフォルトエディタです) を起動します。ここで、再ビルドによって導入される変更の内容を記述してください。このエディタは <code
                class="command">dch</code> が <code
                class="filename">debian/changelog</code> ファイルを変更したことを示します。
			</div><div
              class="para">
				ビルドオプションの変更が必要な場合、<code
                class="filename">debian/rules</code> を修正します。<code
                class="filename">debian/rules</code> はパッケージビルド作業の各段階を動作させるものです。<code
                class="filename">debian/rules</code> が最も単純に書かれている場合、初期設定 (<code
                class="literal">./configure …</code>) や実際のビルド (<code
                class="literal">$(MAKE) …</code> や <code
                class="literal">make …</code>) を実行するコマンドを簡単に見つけられるでしょう。ファイル内にこれらのコマンドが明示的に書かれていない場合、このファイルの内容は別のコマンドに対する作用を書いているのかもしれません。このような場合、デフォルト挙動を変える方法をより詳細に学ぶために文書を参照してください。<code
                class="command">dh</code> を使っているパッケージのビルドオプションを変更する場合、<code
                class="command">dh_auto_configure</code> や <code
                class="command">dh_auto_build</code> コマンドを再定義する必要があるかもしれません (これを行う方法に関する説明は各コマンドのマニュアルページをご覧ください)。
			</div><div
              class="para">
				パッケージに対して行った変更の内容によっては、<code
                class="filename">debian/control</code> ファイルの内容もまた更新する必要があります。<code
                class="filename">debian/control</code> ファイルには生成されるパッケージの説明が含まれます。特に、<code
                class="filename">debian/control</code> ファイルにはパッケージのビルド時点で満足されなければいけない依存関係のリストを制御する <code
                class="literal">Build-Depends</code> 行が含まれます。<code
                class="literal">Build-Depends</code> 行で指定されているパッケージのバージョンはソースパッケージが提供されるディストリビューションに含まれるパッケージのバージョンと一致している場合が多いです。しかし、再ビルドを行うディストリビューションではここで指定されているバージョンが利用できないかもしれません。依存関係が本物か、それともビルド時にライブラリの最新版を試すことを保証するためだけ指定されているかを決定する自動的な方法はありません。<code
                class="literal">Build-Depends</code> 行を使うことが<span
                class="emphasis"><em>自動ビルドロボット</em></span>にビルド中に与えられたパッケージバージョンを使うことを強制するための唯一の方法なので、Debian メンテナはバージョンを厳しく指定したビルド依存関係を使うことが多いです。
			</div><div
              class="para">
				もしあなたが、指定されているビルド依存関係を緩めても問題ないと確信できる場合、手元で自由に依存関係を緩和することが可能です。対象のソフトウェアをビルドする標準的な方法について説明しているファイル (<code
                class="filename">INSTALL</code> と名付けられていることが多いです) を読むことは適切な依存関係を明らかにする助けになります。理想的に言えば、再ビルドに使うディストリビューションの要素を使ってすべての依存関係を満足させるべきです。しかしそれが無理ならば、対象のパッケージをバックポートする前に、再帰的に <code
                class="literal">Build-Depends</code> フィールドで言及されているパッケージを必ずバックポートしなければいけません。一部のパッケージはバックポートの必要がなく、ビルド作業中に現状のままインストールできます (特筆すべき例は <span
                class="pkg pkg">debhelper</span> です)。バックポート作業は気を付けないとすぐに複雑になる点に注意してください。それゆえ、バックポートは可能な限り厳密に必要最低限に留めるべきです。
			</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>TIP</em></span> <code
                          class="literal">Build-Depends</code> のインストール</strong></p></div></div></div><a
                id="id-1.18.4.4.7.2"
                class="indexterm"></a><div
                class="para">
				<code
                  class="command">apt-get</code> を使うことで、あるソースパッケージの <code
                  class="literal">Build-Depends</code> フィールドに指定されているすべてのパッケージをインストールすることが可能です。<code
                  class="command">apt-get</code> は <code
                  class="filename">/etc/apt/sources.list</code> ファイルの <code
                  class="literal">deb-src</code> 行で指定されているディストリビューションに含まれるソースパッケージの <code
                  class="literal">Build-Depends</code> フィールドに指定されているパッケージをインストールします。これを行うには、<code
                  class="command">apt-get build-dep <em
                    class="replaceable">source-package</em></code> コマンドを実行するだけです。
			</div></div></div><div
            class="section"><div
              class="titlepage"><div><div><h3
                    class="title"><a
                      id="id-1.18.4.5"></a>15.1.3. 再ビルドの開始</h3></div></div></div><div
              class="para">
				ソースに対するすべての必要な変更が完了したら、実際のバイナリパッケージ (<code
                class="filename">.deb</code> ファイル) を生成します。すべてのプロセスは <code
                class="command">dpkg-buildpackage</code> コマンドで管理されます。
			</div><div
              class="example"><a
                id="id-1.18.4.5.3"></a><p
                class="title"><strong>例 15.1 パッケージの再ビルド</strong></p><div
                class="example-contents"><pre
                  class="screen"><code
                    class="computeroutput">$ </code><strong
                    class="userinput"><code>dpkg-buildpackage -us -uc
</code></strong><code
                    class="computeroutput">[...]
</code></pre></div></div><div
              class="sidebar"><a
                id="sidebar.fakeroot"></a><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>TOOL</em></span> <code
                          class="command">fakeroot</code></strong></p></div></div></div><div
                class="para">
				基本的に、パッケージ作成作業とは存在する (ビルドされた) ファイル群を 1 つのアーカイブにまとめるという単純な作業に過ぎません。さらにほとんどのファイルは最終的にアーカイブ中で <span
                  class="emphasis"><em>root</em></span> によって所有されることになります。しかしながら、パッケージ全体を root で作ると暗黙のうちにリスクが増加します。しかし幸いなことに、<code
                  class="command">fakeroot</code> コマンドを使うことでこれを避けることが可能です。<code
                  class="command">fakeroot</code> 環境を使うことで、プログラムを実行したり、プログラムに自分の実行者が <span
                  class="emphasis"><em>root</em></span> であり任意の所有者とパーミッションを持つファイルを作成することが可能であると認識させたりすることが可能になります。<code
                  class="command">fakeroot</code> 環境下で Debian パッケージとなるアーカイブを作成した場合、<code
                  class="command">fakeroot</code> プログラムは <span
                  class="emphasis"><em>root</em></span> およびその他のユーザに所有されるファイルを含むアーカイブを作成します。<code
                  class="command">dpkg-buildpackage</code> がパッケージをビルドする際にデフォルトで <code
                  class="command">fakeroot</code> を使っていることからも分かる通り、<code
                  class="command">fakeroot</code> 環境下でパッケージをビルドすることはとても便利な方法です。
			</div><div
                class="para">
				<code
                  class="command">fakeroot</code> 環境下で動作するプログラムはだまされて特権アカウントとして操作するように「信じこまされる」だけです。プロセスは <code
                  class="command">fakeroot <em
                    class="replaceable">program</em></code> を実行しているユーザの権限で実行されます (作成されるファイルはそのユーザのパーミッションを与えられます)。fakeroot が実際に root 権限を取得してそれを乱用することは決してありません。
			</div></div><div
              class="para">
				<code
                class="literal">Build-Depends</code> フィールドが更新されていなかったり、関連するパッケージがインストールされていなかった場合、<code
                class="command">dpkg-buildpackage</code> コマンドは失敗します。そのような場合、<code
                class="command">dpkg-buildpackage</code> に <code
                class="literal">-d</code> オプションを指定して、依存関係確認を行わないようにすることも可能です。しかしながら、依存関係を明示的に無視すると後々の段階でビルド作業が失敗する恐れがあります。さらに悪いことに、パッケージが正常にビルドされたように見えても正しく動かない可能性があります。なぜなら一部のプログラムは必要なライブラリがビルド時に利用できない場合に一部の機能を自動的に無効化するからです。
			</div><div
              class="para">
				しばしば、Debian 開発者は <code
                class="command">debuild</code> などの高レベルプログラムを使います。<code
                class="command">debuild</code> は通常通り <code
                class="command">dpkg-buildpackage</code> を実行するだけでなく、生成されたパッケージの Debian ポリシーに対する妥当性を確認するプログラムも実行します。<code
                class="command">debuild</code> スクリプトは、手元の環境変数がパッケージビルドを「汚染」しないように、ビルド環境を整えます。<code
                class="command">debuild</code> コマンドは <span
                class="emphasis"><em>devscripts</em></span> スイートに含まれるツールの 1 つで、メンテナの作業を簡単にするためのいくつかの一貫性と設定を共有します。
			</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>QUICK LOOK</em></span> <code
                          class="command">pbuilder</code></strong></p></div></div></div><a
                id="id-1.18.4.5.7.2"
                class="indexterm"></a><div
                class="para">
				<code
                  class="command">pbuilder</code> プログラム (同名のパッケージに含まれます) を使うことで、<span
                  class="emphasis"><em>chroot された</em></span>環境の中で Debian パッケージをビルドすることが可能になります。<code
                  class="command">pbuilder</code> プログラムは最初にパッケージをビルドするために必要な最低限のシステム (と <span
                  class="emphasis"><em>Build-Depends</em></span> フィールドで指定されているパッケージ) を含む一時ディレクトリを作成します。このディレクトリは <code
                  class="command">chroot</code> コマンドビルド中に使うルートディレクトリ (<code
                  class="filename">/</code>) として使われます。
			</div><div
                class="para">
				<code
                  class="command">pbuilder</code> ツールを使うことで、ビルド作業をユーザの操作によって変更されない環境の中で行うことが可能になります。さらに、<code
                  class="command">pbuilder</code> ツールを使うことで、言及されていないビルド依存関係を素早く検出することが可能になります (なぜなら、適切な依存関係が指定されていなければビルドは失敗するからです)。最後に、<code
                  class="command">pbuilder</code> ツールを使うことで、システム用に使われている Debian バージョン以外の Debian バージョン向けのパッケージをビルドすることが可能になります。つまり、マシンは通常の作業用に<span
                  class="distribution distribution">安定版</span>を使うことが可能です。そして、同じマシン上で動作する <code
                  class="command">pbuilder</code> はパッケージビルド専用に<span
                  class="distribution distribution">不安定版</span>を使うことが可能です。
			</div></div></div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="sect.dealing-with-compromised-machine.html"><strong>戻る</strong>14.7. 不正侵入されたマシンの取り扱い</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>上に戻る</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>ホーム</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.building-first-package.html"><strong>次へ</strong>15.2. 最初のパッケージのビルド</a></li></ul><div
        id="translated_pages"><ul><li><a
              href="../ar-MA/debian-packaging.html">ar-MA</a></li><li><a
              href="../da-DK/debian-packaging.html">da-DK</a></li><li><a
              href="../de-DE/debian-packaging.html">de-DE</a></li><li><a
              href="../el-GR/debian-packaging.html">el-GR</a></li><li><a
              href="../en-US/debian-packaging.html">en-US</a></li><li><a
              href="../es-ES/debian-packaging.html">es-ES</a></li><li><a
              href="../fa-IR/debian-packaging.html">fa-IR</a></li><li><a
              href="../fr-FR/debian-packaging.html">fr-FR</a></li><li><a
              href="../hr-HR/debian-packaging.html">hr-HR</a></li><li><a
              href="../id-ID/debian-packaging.html">id-ID</a></li><li><a
              href="../it-IT/debian-packaging.html">it-IT</a></li><li><a
              href="../ja-JP/debian-packaging.html">ja-JP</a></li><li><a
              href="../ko-KR/debian-packaging.html">ko-KR</a></li><li><a
              href="../nb-NO/debian-packaging.html">nb-NO</a></li><li><a
              href="../pl-PL/debian-packaging.html">pl-PL</a></li><li><a
              href="../pt-BR/debian-packaging.html">pt-BR</a></li><li><a
              href="../ro-RO/debian-packaging.html">ro-RO</a></li><li><a
              href="../ru-RU/debian-packaging.html">ru-RU</a></li><li><a
              href="../tr-TR/debian-packaging.html">tr-TR</a></li><li><a
              href="../vi-VN/debian-packaging.html">vi-VN</a></li><li><a
              href="../zh-CN/debian-packaging.html">zh-CN</a></li><li><a
              href="../zh-TW/debian-packaging.html">zh-TW</a></li></ul></div></body></html>
