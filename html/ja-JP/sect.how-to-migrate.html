<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">3.2. 移行の方法</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.1" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-8-ja-JP-1.0-1" /><meta
        name="keywords"
        content="既存環境, 再利用, 移行" /><link
        rel="home"
        href="index.html"
        title="Debian 管理者ハンドブック" /><link
        rel="up"
        href="existing-setup.html"
        title="第3章 既存環境の解析と移行" /><link
        rel="prev"
        href="existing-setup.html"
        title="第3章 既存環境の解析と移行" /><link
        rel="next"
        href="installation.html"
        title="第4章 インストール" /><link
        rel="canonical"
        href="http://l.github.io/debian-handbook/html/ja-JP/sect.how-to-migrate.html" /></head><body
      class="draft "><noscript><iframe
          src="//www.googletagmanager.com/ns.html?id=GTM-5H35QX"
          height="0"
          width="0"
          style="display:none;visibility:hidden"></iframe></noscript><script
        type="text/javascript">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&amp;l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5H35QX');</script><div
        id="banner"><a
          href="http://debian-handbook.info/get/"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="http://debian-handbook.info"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="existing-setup.html"><strong>戻る</strong></a></li><li
          class="home">Debian 管理者ハンドブック</li><li
          class="next"><a
            accesskey="n"
            href="installation.html"><strong>次へ</strong></a></li></ul><div
        class="section"><div
          class="titlepage"><div><div><h2
                class="title"><a
                  id="sect.how-to-migrate"></a>3.2. 移行の方法</h2></div></div></div><a
          id="idm140296558791632"
          class="indexterm"></a><div
          class="para">
			サービスの継続性を保証するために、それぞれのコンピュータの移行計画を立て、計画に従って移行作業を行わなければいけません。この原則はオペレーティングシステムの種類に依存しません。
		</div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="idm140296567764288"></a>3.2.1. サービスの調査と確認</h3></div></div></div><div
            class="para">
				簡単そうに見えるかもしれませんが、この手順は絶対不可欠です。真面目な管理者はそれぞれのサーバの主たる役割をよく理解していますが、その役割が変わる可能性もありますし、経験豊かなユーザが「変わった」サービスをインストールしていたかもしれません。そのようなサービスが存在するとわかれば、少なくともこのようなサービスを場当たり的に削除するのではなく、どのように扱うか決めることが可能です。
			</div><div
            class="para">
				この目的で、サーバを移行する前にユーザに Debian プロジェクトを通知することが賢明です。ユーザを Debian プロジェクトに関わらせるために、移行前に最も一般的な (Debian への移行後に使うような) フリーソフトウェアプログラムをユーザのデスクトップにインストールすることは役に立つかもしれません; Libre Office や Mozilla スイートはこのようなソフトウェアの良い例です。
			</div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      id="idm140296567761504"></a>3.2.1.1. ネットワークとプロセス</h4></div></div></div><a
              id="idm140296567760736"
              class="indexterm"></a><div
              class="para">
					<code
                class="command">nmap</code> ツール (同名のパッケージに含まれます) を使うことで、あるネットワークに接続されたマシンにログインすることなしにそのマシンががホストするインターネットサービスを素早く特定できます。同じネットワークに接続されている他のマシンに対して以下のコマンドを実行するだけです:
				</div><pre
              class="screen">
<code
                class="computeroutput">$ </code><strong
                class="userinput"><code>nmap mirwiz</code></strong>
<code
                class="computeroutput">Starting Nmap 6.47 ( http://nmap.org ) at 2015-03-24 19:34 JST
Nmap scan report for mirwiz (192.168.1.104)
Host is up (0.0037s latency).
Not shown: 999 closed ports
PORT   STATE SERVICE
22/tcp open  ssh

Nmap done: 1 IP address (1 host up) scanned in 0.13 seconds</code></pre><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>ALTERNATIVE</em></span> 利用可能なサービスのリストを表示するために <code
                          class="command">netstat</code> を使う</strong></p></div></div></div><div
                class="para">
					Linux マシン上で <code
                  class="command">netstat -tupan</code> コマンドを実行すると、アクティブ状態および保留状態の TCP セッションと実行中のプログラムがリッスンしている UDP ポートのリストが表示されます。これはネットワーク上で提供されているサービスの識別を容易にします。
				</div></div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>GOING FURTHER</em></span> IPv6</strong></p></div></div></div><div
                class="para">
					いくつかのネットワークコマンドは IPv4 (通常デフォルト) と IPv6 を扱うことが可能です。<code
                  class="command">nmap</code> と <code
                  class="command">netstat</code> はそのようなコマンドですが、たとえば <code
                  class="command">route</code> や <code
                  class="command">ip</code> のようなコマンドは IPv6 を扱えません。慣習的に、<em
                  class="parameter"><code>-6</code></em> コマンドラインオプションを使うことで IPv6 を扱うことができるようになります。
				</div></div><div
              class="para">
					サーバがユーザにシェルアカウントを提供する Unix マシンの場合、所有者不在のプロセスがバックグラウンドで実行されているかどうかを見つけ出すことは興味深いものです。<code
                class="command">ps auxw</code> コマンドはすべてのプロセスのリストをユーザ名を含めて表示します。この情報と、ログイン中のユーザのリストを表示する <code
                class="command">who</code> コマンドの出力を比較することで、バックグラウンドで実行されている不正で無申告のサーバまたはプログラムを特定することが可能です。<code
                class="filename">crontabs</code> (ユーザが定期的に予定している自動実行の一覧表) にはしばしばサーバの果たす役割に関する興味深い情報が含まれています (<code
                class="command">cron</code> の完全な説明は<a
                class="xref"
                href="sect.task-scheduling-cron-atd.html">「<code
                  class="command">cron</code> と <code
                  class="command">atd</code> を使ったスケジューリングタスク」</a>にあります)。
				</div><div
              class="para">
					どんな場合でも、サーバのバックアップを行うことは絶対必要です: バックアップをしておけば、移行したことで生じた特定の問題がユーザから報告され、問題が起きた後でも情報を回復することが可能です。
				</div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="idm140296548324432"></a>3.2.2. 設定のバックアップ</h3></div></div></div><div
            class="para">
				更新後のサーバに同等の環境を作るれるようにするため、それぞれのサービスに対する設定を保存しておくのは賢明です。設定ファイルのバックアップコピーを取ることは最低限必要です。
			</div><div
            class="para">
				Unix マシンでは、設定ファイルは通常 <code
              class="filename">/etc/</code> にありますが、場合によっては <code
              class="filename">/usr/local/</code> サブディレクトリにあるかもしれません。これはプログラムをパッケージではなくソースコードを使ってインストールした場合です。また、設定ファイルが <code
              class="filename">/opt/</code> の下にある場合もあります。
			</div><div
            class="para">
				データ管理サービス (データベースなど) では、新しいソフトウェアで簡単に読み込むことができる一般的なフォーマットでデータを書き出すことを強く推奨します。そのようなフォーマットは通例テキストデータで文書化されています; これはたとえば、データベースでは SQL ダンプ、LDAP サーバでは LDIF ファイルのことを指します。
			</div><div
            class="figure"><a
              id="idm140296554356576"></a><div
              class="figure-contents"><div
                class="mediaobject"><img
                  src="images/existing-setup-2.png"
                  alt="データベースのバックアップ" /></div></div><p
              class="title"><strong>図3.2 データベースのバックアップ</strong></p></div><div
            class="para">
				それぞれのサーバソフトウェアには差がありますから、現存するすべての場合について詳しく述べることは不可能です。移行元と移行先のソフトウェアの文書を比較して、書き出し可能 (そして、再読み込み可能) な部分と手作業を必要とするかどうかを確認してください。本書を読めば主な Linux サーバプログラムの設定は明らかになります。
			</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="idm140296554352736"></a>3.2.3. 既存の Debian サーバの引き継ぎ</h3></div></div></div><a
            id="idm140296554351968"
            class="indexterm"></a><a
            id="idm140296554351040"
            class="indexterm"></a><a
            id="idm140296554350112"
            class="indexterm"></a><div
            class="para">
				維持管理を効率的に引き継ぐために、既に Debian が稼働中のマシンを解析する必要があるかもしれません。
			</div><div
            class="para">
				最初に確認するファイルは<code
              class="filename">/etc/debian_version</code> で、これは通常インストールされた Debian システムのバージョン番号を含んでいます (<span
              class="emphasis"><em>base-files</em></span> パッケージの一部です)。バージョン番号が <code
              class="literal"><em
                class="replaceable">codename</em>/sid</code> となっていた場合、このシステムは開発版ディストリビューション (テスト版か不安定版のどちらか) のパッケージを使って更新されたことを意味しています。
			</div><div
            class="para">
				<code
              class="command">apt-show-versions</code> プログラム (同名の Debian パッケージに含まれます) はインストールされたパッケージのリストを確認して、利用可能なバージョンを識別します。<code
              class="command">apt-show-versions</code> に比べると体系的ではありませんが、<code
              class="command">aptitude</code> を同様の目的で使うことも可能です。
			</div><div
            class="para">
				<code
              class="filename">/etc/apt/sources.list</code> ファイル (と <code
              class="filename">/etc/apt/sources.list.d/</code> ディレクトリ) をぱっと見ただけで、インストールされた Debian パッケージの取得元がわかります。ここにたくさんの未知のソースがあった場合、管理者は Debian が提供するソフトウェアとの最適な互換性を確保するために、コンピュータシステムを完全に再インストールするかもしれません。
			</div><div
            class="para">
				この <code
              class="filename">sources.list</code> ファイルは多くの場合良い指標となります: 大多数の管理者は、少なくともコメントの中で、過去に使っていた APT ソースのリストを残しています。しかし、過去に使っていたソースは削除されているかもしれないこと、インターネットから取得されたでたらめなパッケージが手作業で (<code
              class="command">dpkg</code> コマンドを使って) インストールされているかもしれないこと、を忘れるべきではありません。この場合、マシンは「標準的な」Debian の外観に偽装されている恐れがあります。そのため、外部パッケージの存在を示す兆候を見逃さないようするべきです (通常では考えにくいディレクトリに <code
              class="filename">deb</code> ファイルがあったり、パッケージのバージョン番号のサフィックスに <code
              class="literal">ubuntu</code> や<code
              class="literal">lmde</code> などの特別なものが使われていたら、それは Debian プロジェクト以外で作られたことを意味しています)。
			</div><div
            class="para">
				同様に <code
              class="filename">/usr/local/</code> ディレクトリの内容を分析するのは興味深いです。このディレクトリは手作業でコンパイルおよびインストールされたプログラムを納めるための場所です。手作業でインストールされたソフトウェアをリストアップすることは有益です。なぜならそうすることで、Debian にもそのソフトウェアに類似するパッケージがあるにもかかわらずそれを使っていない理由に疑問を提起することができるからです。
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>QUICK LOOK</em></span> <span
                        class="pkg pkg">cruft</span></strong></p></div></div></div><div
              class="para">
				<span
                class="pkg pkg">cruft</span> パッケージはいかなるパッケージによっても所有されていない利用可能なファイルをリストアップすることを目標としています。正規のファイル (Debian パッケージが生成したファイル、<code
                class="command">dpkg</code> で管理されていない生成された設定ファイル) が報告されるのを避けるためにいくつかのフィルタ (おおむね有効で、おおむね最新の) を持っています。
			</div><div
              class="para">
				<code
                class="command">cruft</code> がリストアップしたすべてを盲目的に削除しないよう気を付けてください!
			</div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="idm140296553284112"></a>3.2.4. Debian のインストール</h3></div></div></div><div
            class="para">
				現在のサーバに関するすべての必要な情報を集め終わったら、サーバを停止させ、Debian のインストールを始めることが可能です。
			</div><a
            id="idm140296553282688"
            class="indexterm"></a><div
            class="para">
				適切なバージョンを選ぶには、コンピュータのアーキテクチャを知らなければいけません。まあまあ最近の PC ならば、アーキテクチャは十中八九 amd64 でしょう (古めの PC なら i386)。それ以外の場合、以前使っていたシステムから可能性を狭めることが可能です。
			</div><div
            class="para">
				<a
              class="xref"
              href="sect.how-to-migrate.html#tab-corresp">表 3.1</a> はすべてを網羅することを意図したものではありませんが、参考になります。いかなる場合でも、コンピュータの元の文書はこの種の情報を探すには最も信頼できるソースです。
			</div><div
            class="table"><a
              id="tab-corresp"></a><p
              class="title"><strong>表3.1 オペレーティングシステムとアーキテクチャの照合</strong></p><div
              class="table-contents"><table
                xmlns:d="http://docbook.org/ns/docbook"
                class="lt-4-cols gt-7-rows"
                summary="オペレーティングシステムとアーキテクチャの照合"><colgroup><col /><col /></colgroup><thead><tr><th>オペレーティングシステム</th><th>アーキテクチャ</th></tr></thead><tbody><tr><td>DEC Unix (OSF/1)</td><td>alpha、mipsel</td></tr><tr><td>HP Unix</td><td>ia64、hppa</td></tr><tr><td>IBM AIX</td><td>powerpc</td></tr><tr><td>Irix</td><td>mips</td></tr><tr><td>OS X</td><td>amd64、powerpc、i386</td></tr><tr><td>z/OS、MVS</td><td>s390x、s390</td></tr><tr><td>Solaris、SunOS</td><td>sparc、i386、m68k</td></tr><tr><td>Ultrix</td><td>mips</td></tr><tr><td>VMS</td><td>alpha</td></tr><tr><td>Windows 95/98/ME</td><td>i386</td></tr><tr><td>Windows NT/2000</td><td>i386、alpha、ia64、mipsel</td></tr><tr><td>Windows XP / Windows Server 2008</td><td>i386、amd64、ia64</td></tr><tr><td>Windows Vista / Windows 7 / Windows 8</td><td>i386、amd64</td></tr></tbody></table></div></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>HARDWARE</em></span> 64 ビット PC 対 32 ビット PC</strong></p></div></div></div><a
              id="idm140296553255184"
              class="indexterm"></a><a
              id="idm140296553254224"
              class="indexterm"></a><div
              class="para">
				最新のコンピュータは、古めの 32 ビットプロセッサと互換性のある 64 ビット Intel もしくは AMD プロセッサを搭載しています; このため「i386」アーキテクチャ向けコンパイルされたソフトウェアが動きます。一方で、この互換モードでは新しいプロセッサの性能を十分に引き出せません。このため、Debian は「amd64」アーキテクチャを提供しています。これは最近の AMD チップおよび AMD64 によく似た Intel「em64t」プロセッサ (ほとんどの Core シリーズを含みます) に有効です。
			</div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="idm140296553251840"></a>3.2.5. 選ばれたサービスのインストールと設定</h3></div></div></div><div
            class="para">
				ひとたび Debian がインストールされると、我々はコンピュータがホストするすべてのサービスについて 1 つずつインストールと設定を行わなければいけません。移行を円滑に進めるためにも、新しい設定は古い設定を考慮して行われなければいけません。最初の 2 ステップで集めたすべての情報が、この作業を成功のうちに完了させるのに役立つでしょう。
			</div><div
            class="figure"><a
              id="idm140296553250112"></a><div
              class="figure-contents"><div
                class="mediaobject"><img
                  src="images/existing-setup-4.png"
                  alt="選ばれたサービスのインストール" /></div></div><p
              class="title"><strong>図3.3 選ばれたサービスのインストール</strong></p></div><div
            class="para">
				意気込んで行動を起こす前に、本書の残りの部分を読むことを強く推奨します。そうすることで、運用予定のサービスを設定する方法について、正確な理解を得ることができるでしょう。
			</div><div
            class="para">
			</div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="existing-setup.html"><strong>戻る</strong>第3章 既存環境の解析と移行</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>上に戻る</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>ホーム</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="installation.html"><strong>次へ</strong>第4章 インストール</a></li></ul><div
        id="translated_pages"><ul><li><a
              href="../ar-MA/sect.how-to-migrate.html">ar-MA</a></li><li><a
              href="../da-DK/sect.how-to-migrate.html">da-DK</a></li><li><a
              href="../de-DE/sect.how-to-migrate.html">de-DE</a></li><li><a
              href="../el-GR/sect.how-to-migrate.html">el-GR</a></li><li><a
              href="../en-US/sect.how-to-migrate.html">en-US</a></li><li><a
              href="../es-ES/sect.how-to-migrate.html">es-ES</a></li><li><a
              href="../fa-IR/sect.how-to-migrate.html">fa-IR</a></li><li><a
              href="../fr-FR/sect.how-to-migrate.html">fr-FR</a></li><li><a
              href="../hr-HR/sect.how-to-migrate.html">hr-HR</a></li><li><a
              href="../id-ID/sect.how-to-migrate.html">id-ID</a></li><li><a
              href="../it-IT/sect.how-to-migrate.html">it-IT</a></li><li><a
              href="../ja-JP/sect.how-to-migrate.html">ja-JP</a></li><li><a
              href="../pl-PL/sect.how-to-migrate.html">pl-PL</a></li><li><a
              href="../pt-BR/sect.how-to-migrate.html">pt-BR</a></li><li><a
              href="../ro-RO/sect.how-to-migrate.html">ro-RO</a></li><li><a
              href="../ru-RU/sect.how-to-migrate.html">ru-RU</a></li><li><a
              href="../tr-TR/sect.how-to-migrate.html">tr-TR</a></li><li><a
              href="../zh-CN/sect.how-to-migrate.html">zh-CN</a></li></ul></div></body></html>
