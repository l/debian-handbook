<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">10.3. Качество обслуживания (регулирование скорости и других характеристик трафика для программ)</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-9-ru-RU-1.0-1" /><meta
        name="keywords"
        content="Сеть, Шлюз, TCP/IP, IPv6, DNS, Bind, DHCP, QoS" /><link
        rel="home"
        href="index.html"
        title="Настольная книга администратора Debian" /><link
        rel="up"
        href="network-infrastructure.html"
        title="Глава 10. Сетевая инфраструктура" /><link
        rel="prev"
        href="sect.virtual-private-network.html"
        title="10.2. Виртуальная частная сеть" /><link
        rel="next"
        href="sect.dynamic-routing.html"
        title="10.4. Динамическая Маршрутизация" /><meta
        name="viewport"
        content="width=device-width, initial-scale=1" /><meta
        name="flattr:id"
        content="4pz9jq" /><link
        rel="canonical"
        href="http://l.github.io/debian-handbook/html/ru-RU/sect.quality-of-service.html" /></head><body><noscript><iframe
          src="//www.googletagmanager.com/ns.html?id=GTM-5H35QX"
          height="0"
          width="0"
          style="display:none;visibility:hidden"></iframe></noscript><script
        type="text/javascript">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&amp;l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5H35QX');</script><div
        id="banner"><a
          href="../../"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="index.html"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="sect.virtual-private-network.html"><strong>Пред.</strong></a></li><li
          class="home">Настольная книга администратора Debian</li><li
          class="next"><a
            accesskey="n"
            href="sect.dynamic-routing.html"><strong>След.</strong></a></li></ul><div
        class="section"><div
          class="titlepage"><div><div><h2
                class="title"><a
                  id="sect.quality-of-service"></a>10.3. Качество обслуживания (регулирование скорости и других характеристик трафика для программ)</h2></div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="sect.qos-principe"></a>10.3.1. Принципы и механизм</h3></div></div></div><div
            class="para">
				Качество обслуживания - <span
              class="emphasis"><em>Quality of Service</em></span> (или коротко <span
              class="emphasis"><em>QoS</em></span>) представляет собой набор определённых технических приёмов, который гарантирует или улучшает качество обслуживания для приложений. Большинство, существующих на сегодня, популярных технологий, работающих в этой области, классифицируют сетевой трафик по категориям, и, в зависимости от принадлежности к той или иной категории, обрабатывают трафик тем или иным образом. Основная программа, занимающаяся такой сортировкой трафика является <span
              class="emphasis"><em>traffic shaping</em></span>. Она ограничивает скорость передачи данных при подключении некоторых служб и/или хостов таким образом, чтобы они не занимали всю пропускную полосу трафика, а оставшаяся часть незанятого канала предоставляется другим важным службам. Такая классификация трафика особенно хорошо подходит для TCP трафика, поскольку данный протокол автоматически подстраивается под доступную полосу пропускания.
			</div><a
            id="id-1.13.6.2.3"
            class="indexterm"></a><a
            id="id-1.13.6.2.4"
            class="indexterm"></a><a
            id="id-1.13.6.2.5"
            class="indexterm"></a><a
            id="id-1.13.6.2.6"
            class="indexterm"></a><div
            class="para">
				Есть возможность отрегулировать первоочерёдность трафика таким образом, чтобы в первую очередь пропускались пакеты, связанные с интерактивными службами (такие как <code
              class="command">ssh</code> и <code
              class="command">telnet</code>) или службы, работающие с маленькими блоками информации.
			</div><div
            class="para">
				В ядре Debian имеются возможности, необходимые для работы QoS. Они сгруппированы в соответствующие модули. Таких модулей очень много, и каждый из них поддерживает ту или иную службу, при этом большинство из них работают по принципу планирования очерёдности прохождения IP пакетов. Широкий диапазон доступных настроек поведения планировщика охватывает весь спектр возможных требований.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>КУЛЬТУРА</em></span> LARTC — <span
                        class="emphasis"><em>Расширенные настройки маршрутизации в Linux и контроль трафика</em></span></strong></p></div></div></div><div
              class="para">
				Базовый документ HOWTO <span
                class="emphasis"><em>Расширенные настройки маршрутизации в Linux и контроль трафика</em></span> ("Linux Advanced Routing &amp; Traffic Control") является справочным пособием. В него включено всё, что необходимо знать про качество обслуживания сети. <div
                class="url">→ <a
                  href="http://www.lartc.org/howto/">http://www.lartc.org/howto/</a></div>
			</div><a
              id="id-1.13.6.2.9.3"
              class="indexterm"></a><a
              id="id-1.13.6.2.9.4"
              class="indexterm"></a><a
              id="id-1.13.6.2.9.5"
              class="indexterm"></a></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="sect.qos-config"></a>10.3.2. Настройка и выполнение</h3></div></div></div><div
            class="para">
				Параметры QoS настраиваются через команду <code
              class="command">tc</code> (включена в пакет <span
              class="pkg pkg">iproute</span>). Поскольку интерфейс данной команды является достаточно сложным к восприятию рекомендуется использовать для работы с ней высокоуровневые инструменты.
			</div><a
            id="id-1.13.6.3.3"
            class="indexterm"></a><a
            id="id-1.13.6.3.4"
            class="indexterm"></a><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      id="sect.qos-wondershaper"></a>10.3.2.1. Уменьшение Задержек: <code
                      class="command">wondershaper</code></h4></div></div></div><div
              class="para">
					Основная задача команды <code
                class="command">wondershaper</code> (в пакете с похожим именем) - уменьшение задержек перемещения пакетов по сети. Это достигается ограничением всего трафика до величины чуть ниже линии полного насыщения канала.
				</div><a
              id="id-1.13.6.3.5.3"
              class="indexterm"></a><a
              id="id-1.13.6.3.5.4"
              class="indexterm"></a><a
              id="id-1.13.6.3.5.5"
              class="indexterm"></a><div
              class="para">
					Сразу после конфигурирования сетевого интерфейса, настроить ограничение трафика можно запустив команду <code
                class="command">wondershaper <em
                  class="replaceable">interface</em> <em
                  class="replaceable">download_rate</em> <em
                  class="replaceable">upload_rate</em></code>. Для примера, интерфейс может быть <code
                class="literal">eth0</code> или <code
                class="literal">ppp0</code>, и обоим указывают скорость в килобитах в секунду. Команда <code
                class="command">wondershaper remove <em
                  class="replaceable">interface</em></code> отключит контроль трафика для указанного "interface".
				</div><div
              class="para">
					В случае подключения к сети Ethernet, правильнее будет вызвать этот сценарий сразу после настройки интерфейса. Это делается путём указания слов <code
                class="literal">up</code> и <code
                class="literal">down</code> в файле <code
                class="filename">/etc/network/interfaces</code>, что позволит определить команды к запуску. Это делается после того, как интерфейс будет сконфигурирован и перед тем, как будут сброшены настройки сконфигурированного интерфейса. Для примера:
				</div><div
              class="example"><a
                id="example.network-interfaces"></a><p
                class="title"><strong>Пример 10.9. Изменения в файле <code
                    class="filename">/etc/network/interfaces</code></strong></p><div
                class="example-contents"><pre
                  class="programlisting">
iface eth0 inet dhcp
    up /sbin/wondershaper eth0 500 100
    down /sbin/wondershaper remove eth0
</pre></div></div><div
              class="para">
					В случае с PPP, подключение сценария, вызывающего <code
                class="command">wondershaper</code>, в файл <code
                class="filename">/etc/ppp/ip-up.d/</code> запустит контроль трафика сразу же при запуске реального соединения.
				</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>УГЛУБЛЯЕМСЯ</em></span> Оптимальная настройка</strong></p></div></div></div><div
                class="para">
					Файл <code
                  class="filename">/usr/share/doc/wondershaper/README.Debian.gz</code> содержит описание, с некоторыми деталями, метода настройки, который рекомендуется разработчиками пакета. В частности, вначале советуют измерить реальные скорости загрузки и выгрузки, чтобы в дальнейшем лучше оценить вводимые в дальнейшем ограничения.
				</div></div></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      id="sect.qos-config-standard"></a>10.3.2.2. Стандартная настройка</h4></div></div></div><div
              class="para">
					Кроме QoS ядро Linux может регулировать трафик и с помощью ToS (Биты типа обслуживания), что реализовано в виде очереди планировщика <code
                class="literal">pfifo_fast</code>. В этом случае имеется несколько интересных возможностей, которые примечательны сами по себе. Очерёдность обработки каждого IP пакета определяется установленными значениями в их полях заголовка ToS (<span
                class="emphasis"><em>Type of Service</em></span>). Модифицируя поля заголовка тем или иным образом можно использовать все преимущества данного метода. Имеется пять возможных значений:
				</div><div
              xmlns:d="http://docbook.org/ns/docbook"
              class="itemizedlist"><ul><li
                  class="listitem"><div
                    class="para">
							Normal-Service (0);
						</div></li><li
                  class="listitem"><div
                    class="para">
							Minimize-Cost (2);
						</div></li><li
                  class="listitem"><div
                    class="para">
							Maximize-Reliability (4);
						</div></li><li
                  class="listitem"><div
                    class="para">
							Maximize-Throughput (8);
						</div></li><li
                  class="listitem"><div
                    class="para">
							Minimize-Delay (16).
						</div></li></ul></div><a
              id="id-1.13.6.3.6.4"
              class="indexterm"></a><a
              id="id-1.13.6.3.6.5"
              class="indexterm"></a><div
              class="para">
					Указать то или иное значение для поля заголовка ToS может само приложение, генерирующее IP пакеты, или его можно изменить "на лету" программой <span
                class="emphasis"><em>netfilter</em></span>. Следующих правил достаточно, чтобы увеличить быстродействие службы - сервера SSH:
				</div><pre
              class="programlisting scale">
iptables -t mangle -A PREROUTING -p tcp --sport ssh -j TOS --set-tos Minimize-Delay
iptables -t mangle -A PREROUTING -p tcp --dport ssh -j TOS --set-tos Minimize-Delay
</pre></div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="sect.virtual-private-network.html"><strong>Пред.</strong>10.2. Виртуальная частная сеть</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>Наверх</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>Начало</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.dynamic-routing.html"><strong>След.</strong>10.4. Динамическая Маршрутизация</a></li></ul><div
        id="translated_pages"><ul><li><a
              href="../ar-MA/sect.quality-of-service.html">ar-MA</a></li><li><a
              href="../da-DK/sect.quality-of-service.html">da-DK</a></li><li><a
              href="../de-DE/sect.quality-of-service.html">de-DE</a></li><li><a
              href="../el-GR/sect.quality-of-service.html">el-GR</a></li><li><a
              href="../en-US/sect.quality-of-service.html">en-US</a></li><li><a
              href="../es-ES/sect.quality-of-service.html">es-ES</a></li><li><a
              href="../fa-IR/sect.quality-of-service.html">fa-IR</a></li><li><a
              href="../fr-FR/sect.quality-of-service.html">fr-FR</a></li><li><a
              href="../hr-HR/sect.quality-of-service.html">hr-HR</a></li><li><a
              href="../id-ID/sect.quality-of-service.html">id-ID</a></li><li><a
              href="../it-IT/sect.quality-of-service.html">it-IT</a></li><li><a
              href="../ja-JP/sect.quality-of-service.html">ja-JP</a></li><li><a
              href="../ko-KR/sect.quality-of-service.html">ko-KR</a></li><li><a
              href="../nb-NO/sect.quality-of-service.html">nb-NO</a></li><li><a
              href="../pl-PL/sect.quality-of-service.html">pl-PL</a></li><li><a
              href="../pt-BR/sect.quality-of-service.html">pt-BR</a></li><li><a
              href="../ro-RO/sect.quality-of-service.html">ro-RO</a></li><li><a
              href="../ru-RU/sect.quality-of-service.html">ru-RU</a></li><li><a
              href="../tr-TR/sect.quality-of-service.html">tr-TR</a></li><li><a
              href="../vi-VN/sect.quality-of-service.html">vi-VN</a></li><li><a
              href="../zh-CN/sect.quality-of-service.html">zh-CN</a></li><li><a
              href="../zh-TW/sect.quality-of-service.html">zh-TW</a></li></ul></div></body></html>
