<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">9.7. Планирование задач с помощью cron и atd</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-8-ru-RU-1.0-1" /><meta
        name="keywords"
        content="Загрузка системы, Сценарии инициализации, SSH, Telnet, Права, Привилегии, Инспектирование, Inetd, Cron, Резервное копирование, Горячее подключение, PCMCIA, APM, ACPI" /><link
        rel="home"
        href="index.html"
        title="Настольная книга администратора Debian" /><link
        rel="up"
        href="unix-services.html"
        title="Глава 9. Сервисы Unix" /><link
        rel="prev"
        href="sect.inetd.html"
        title="9.6. Суперсервер inetd" /><link
        rel="next"
        href="sect.asynchronous-task-scheduling-anacron.html"
        title="9.8. Планирование асинхронных задач: anacron" /><meta
        name="viewport"
        content="width=device-width, initial-scale=1" /><link
        rel="canonical"
        href="http://l.github.io/debian-handbook/html/ru-RU/sect.task-scheduling-cron-atd.html" /></head><body><noscript><iframe
          src="//www.googletagmanager.com/ns.html?id=GTM-5H35QX"
          height="0"
          width="0"
          style="display:none;visibility:hidden"></iframe></noscript><script
        type="text/javascript">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&amp;l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5H35QX');</script><div
        id="banner"><a
          href="../../"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="index.html"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="sect.inetd.html"><strong>Пред.</strong></a></li><li
          class="home">Настольная книга администратора Debian</li><li
          class="next"><a
            accesskey="n"
            href="sect.asynchronous-task-scheduling-anacron.html"><strong>След.</strong></a></li></ul><div
        class="section"><div
          class="titlepage"><div><div><h2
                class="title"><a
                  id="sect.task-scheduling-cron-atd"></a>9.7. Планирование задач с помощью <code
                  class="command">cron</code> и <code
                  class="command">atd</code></h2></div></div></div><a
          id="id-1.12.10.2"
          class="indexterm"></a><a
          id="id-1.12.10.3"
          class="indexterm"></a><a
          id="id-1.12.10.4"
          class="indexterm"></a><a
          id="id-1.12.10.5"
          class="indexterm"></a><div
          class="para">
			<code
            class="command">cron</code> — это демон, отвечающий за запуск запланированных и повторяющихся команд (каждый день, каждую неделю и т. д.); <code
            class="command">atd</code> — демон, работающий с командами ,которые должны запускаться однократно, но в конкретный момент времени в будущем.
		</div><div
          class="para">
			В системе Unix многие задачи планируются для регулярного запуска:
		</div><div
          xmlns:d="http://docbook.org/ns/docbook"
          class="itemizedlist"><ul><li
              class="listitem"><div
                class="para">
					ротация журналов;
				</div></li><li
              class="listitem"><div
                class="para">
					обновление базы данных для программы <code
                  class="command">locate</code>;
				</div></li><li
              class="listitem"><div
                class="para">
					резервное копирование;
				</div></li><li
              class="listitem"><div
                class="para">
					сценарии обслуживания (такие как удаление временных файлов).
				</div></li></ul></div><div
          class="para">
			По умолчанию все пользователи могут планировать запуск задач. У каждого пользователя есть свой собственный <span
            class="emphasis"><em>crontab</em></span>, в который он может записывать запланированные команды. Его можно отредактировать, запустив <code
            class="command">crontab -e</code> (его содержимое хранится в файле <code
            class="filename">/var/spool/cron/crontabs/<em
              class="replaceable">пользователь</em></code>).
		</div><div
          class="sidebar"><div
            class="titlepage"><div><div><p
                  class="title"><strong><span
                      class="emphasis"><em>БЕЗОПАСНОСТЬ</em></span> Ограничение использования <code
                      class="command">cron</code> или <code
                      class="command">atd</code></strong></p></div></div></div><div
            class="para">
			Доступ к <code
              class="command">cron</code> можно ограничить, создав файл авторизации (белый список) в <code
              class="filename">/etc/cron.allow</code>, где указываются только пользователи, которым разрешено планировать задачи. Все остальные автоматически будут лишены такой возможности. Наоборот, чтобы заблокировать только одного-двух бедокуров, можно вписать их имена в файл блокировки (чёрный список), <code
              class="filename">/etc/cron.deny</code>. Такая же возможность есть и для <code
              class="command">atd</code>, соответствующие файлы называются <code
              class="filename">/etc/at.allow</code> и <code
              class="filename">/etc/at.deny</code>.
		</div></div><div
          class="para">
			У пользователя root есть свой собственный <span
            class="emphasis"><em>crontab</em></span>, но он также может использовать файл <code
            class="filename">/etc/crontab</code> или создавать дополнительные файлы <span
            class="emphasis"><em>crontab</em></span> в каталоге <code
            class="filename">/etc/cron.d</code>. У последних двух решений есть то преимущество, что можно указать пользователя, от имени которого запускается команда.
		</div><div
          class="para">
			Пакет <span
            class="emphasis"><em>cron</em></span> по умолчанию содержит некоторые запланированные задачи, которые выполняются:
		</div><div
          xmlns:d="http://docbook.org/ns/docbook"
          class="itemizedlist"><ul><li
              class="listitem"><div
                class="para">
					программы из каталога <code
                  class="filename">/etc/cron.hourly/</code> — каждый час;
				</div></li><li
              class="listitem"><div
                class="para">
					программы из каталога <code
                  class="filename">/etc/cron.daily/</code> — каждый день;
				</div></li><li
              class="listitem"><div
                class="para">
					программы из каталога <code
                  class="filename">/etc/cron.weekly/</code> — каждую неделю;
				</div></li><li
              class="listitem"><div
                class="para">
					программы из каталога <code
                  class="filename">/etc/cron.monthly/</code> — раз в месяц.
				</div></li></ul></div><div
          class="para">
			Многие пакеты Debian зависят от этого сервиса: помещая сценарии обслуживания в эти каталоги, они обеспечивают оптимальную работу своих сервисов.
		</div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="sect.format-crontab"></a>9.7.1. Формат файла <code
                    class="filename">crontab</code></h3></div></div></div><a
            id="id-1.12.10.15.2"
            class="indexterm"></a><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>СОВЕТ</em></span> Текстовые сокращения для <code
                        class="command">cron</code></strong></p></div></div></div><div
              class="para">
				<code
                class="command">cron</code> распознаёт некоторые сокращения, заменяющие первые пять полей в записи <code
                class="filename">crontab</code>. Они соответствуют наиболее классическим опциям планирования:
			</div><div
              xmlns:d="http://docbook.org/ns/docbook"
              class="itemizedlist"><ul><li
                  class="listitem"><div
                    class="para">
						<code
                      class="literal">@yearly</code> — раз в год (1 января, в 00:00);
					</div></li><li
                  class="listitem"><div
                    class="para">
						<code
                      class="literal">@monthly</code> — раз в месяц (1 числа, в 00:00);
					</div></li><li
                  class="listitem"><div
                    class="para">
						<code
                      class="literal">@weekly</code> — раз в неделю (в воскресенье, в 00:00);
					</div></li><li
                  class="listitem"><div
                    class="para">
						<code
                      class="literal">@daily</code> — раз в день (в 00:00);
					</div></li><li
                  class="listitem"><div
                    class="para">
						<code
                      class="literal">@hourly</code> — раз в час (в начале каждого часа).
					</div></li></ul></div></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>SPECIAL CASE</em></span> <code
                        class="command">cron</code> and daylight savings time</strong></p></div></div></div><div
              class="para">
				В Debian <code
                class="command">cron</code> учитывает смену времени (при переходе на летнее время, а фактически — при любом значительном изменении локального времени) лучшим образом, какой только возможен. Так, команды, которые должны были запуститься в течение часа, который никогда не существовал, (например задачи, запланированные на 2:30 утра при весенней смене времени во Франции, когда в 2:00 часы переводятся на 3:00) запускаются вскоре после изменения времени (то есть около 3:00 по летнему времени). С другой стороны, осенью, когда задачи могли бы запуститься дважды (в 2:30 по летнему времени, а потом в 2:30 по обычному времени, поскольку в 3:00 утра летнего времени часы переводятся на 2:00), запускаются только однократно.
			</div><div
              class="para">
				Следует, однако, соблюдать осторожность, если порядок запуска разных запланированных задач и величина задержки между ними имеют значение. В таком случае следует проверить совместимость этих ограничений с поведением <code
                class="command">cron</code>; при необходимости можно подготовить специальное расписание для двух проблемных ночей в году.
			</div></div><div
            class="para">
				Каждая значащая строка <span
              class="emphasis"><em>crontab</em></span> описывает запланированную команду в следующих шести (или семи) полях:
			</div><div
            xmlns:d="http://docbook.org/ns/docbook"
            class="itemizedlist"><ul><li
                class="listitem"><div
                  class="para">
						значение минуты (число от 0 до 59);
					</div></li><li
                class="listitem"><div
                  class="para">
						значение часа (от 0 до 23);
					</div></li><li
                class="listitem"><div
                  class="para">
						значение числа месяца (от 1 до 31);
					</div></li><li
                class="listitem"><div
                  class="para">
						значение месяца (от 1 до 12);
					</div></li><li
                class="listitem"><div
                  class="para">
						значение дня недели (от 0 до 7, где 1 соответствует понедельнику, а воскресенье может быть представлено как 0 или 7; также можно использовать первые три буквы англоязычного названия дня недели, например <code
                    class="literal">Sun</code>, <code
                    class="literal">Mon</code> и т. д.);
					</div></li><li
                class="listitem"><div
                  class="para">
						имя пользователя, от имени которого должна выполняться команда (в файле <code
                    class="filename">/etc/crontab</code> и в фрагментах, расположенных в <code
                    class="filename">/etc/cron.d/</code>, но не в пользовательских файлах crontab);
					</div></li><li
                class="listitem"><div
                  class="para">
						команда, которая должна быть запущена (при выполнении условий, определённых в первых пяти колонках).
					</div></li></ul></div><div
            class="para">
				Все эти подробности описаны на странице man <span
              class="citerefentry"><span
                class="refentrytitle">crontab</span>(5)</span>.
			</div><div
            class="para">
				Каждое значение может быть представлено в виде списка возможных значений (разделённого запятыми). Синтаксис <code
              class="literal">a-b</code> описывает интервал всех значений между <code
              class="literal">a</code> и <code
              class="literal">b</code>. Синтаксис <code
              class="literal">a-b/c</code> описывает интервал с промежутками <code
              class="literal">c</code> (пример: <code
              class="literal">0-10/2</code> означает <code
              class="literal">0,2,4,6,8,10</code>). Звёздочка <code
              class="literal">*</code> является шаблоном, означающим все допустимые значения.
			</div><div
            class="example"><a
              id="example.crontab"></a><p
              class="title"><strong>Пример 9.2. Пример файла <code
                  class="filename">crontab</code></strong></p><div
              class="example-contents"><pre
                class="programlisting">#Format
#min hour day mon dow  command

# Download data every night at 7:25 pm
 25  19   *   *   *    $HOME/bin/get.pl

# 8:00 am, on weekdays (Monday through Friday)
 00  08   *   *   1-5  $HOME/bin/dosomething

# Restart the IRC proxy after each reboot
@reboot /usr/bin/dircproxy
</pre></div></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>СОВЕТ</em></span> Запуск команды при загрузке</strong></p></div></div></div><div
              class="para">
				Для однократного запуска команды сразу после загрузки компьютера можно использовать макрос <code
                class="literal">@reboot</code> (простой перезапуск <code
                class="command">cron</code> не вызовет команду, запланированную с использованием <code
                class="literal">@reboot</code>). Этот макрос заменяет первые пять полей записи <span
                class="emphasis"><em>crontab</em></span>.
			</div></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>ALTERNATIVE</em></span> Emulating <code
                        class="command">cron</code> with <code
                        class="command">systemd</code></strong></p></div></div></div><div
              class="para">
				It is possible to emulate part of <code
                class="command">cron</code>'s behaviour with <code
                class="command">systemd</code>'s timer mechanism (see <a
                class="xref"
                href="unix-services.html#sect.systemd">Раздел 9.1.1, «Система инициализации systemd»</a>).
			</div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="sect.at-command"></a>9.7.2. Использование команды <code
                    class="command">at</code></h3></div></div></div><a
            id="id-1.12.10.16.2"
            class="indexterm"></a><div
            class="para">
				The <code
              class="command">at</code> executes a command at a specified moment in the future. It takes the desired time and date as command-line parameters, and the command to be executed in its standard input. The command will be executed as if it had been entered in the current shell. <code
              class="command">at</code> even takes care to retain the current environment, in order to reproduce the same conditions when it executes the command. The time is indicated by following the usual conventions: <code
              class="literal">16:12</code> or <code
              class="literal">4:12pm</code> represents 4:12 pm. The date can be specified in several European and Western formats, including <code
              class="literal">DD.MM.YY</code> (<code
              class="literal">27.07.15</code> thus representing 27 July 2015), <code
              class="literal">YYYY-MM-DD</code> (this same date being expressed as <code
              class="literal">2015-07-27</code>), <code
              class="literal">MM/DD/[CC]YY</code> (ie., <code
              class="literal">12/25/15</code> or <code
              class="literal">12/25/2015</code> will be December 25, 2015), or simple <code
              class="literal">MMDD[CC]YY</code> (so that <code
              class="literal">122515</code> or <code
              class="literal">12252015</code> will, likewise, represent December 25, 2015). Without it, the command will be executed as soon as the clock reaches the time indicated (the same day, or tomorrow if that time has already passed on the same day). You can also simply write “today” or “tomorrow”, which is self-explanatory.
			</div><pre
            class="screen">
<code
              class="computeroutput">$ </code><strong
              class="userinput"><code>at 09:00 27.07.15 &lt;&lt;END</code></strong>
<code
              class="computeroutput">&gt; </code><strong
              class="userinput"><code>echo "Don't forget to wish a Happy Birthday to Raphaël!" \</code></strong>
<code
              class="computeroutput">&gt; </code><strong
              class="userinput"><code>  | mail lolando@debian.org</code></strong>
<code
              class="computeroutput">&gt; </code><strong
              class="userinput"><code>END</code></strong>
<code
              class="computeroutput">warning: commands will be executed using /bin/sh
job 31 at Mon Jul 27 09:00:00 2015</code></pre><div
            class="para">
				Альтернативный синтаксис откладывает запуск на заданный промежуток времени: <code
              class="command">at now + <em
                class="replaceable">число</em> <em
                class="replaceable">период</em></code>. Значение <em
              class="replaceable">период</em> может быть <code
              class="literal">minutes</code>, <code
              class="literal">hours</code>, <code
              class="literal">days</code> или <code
              class="literal">weeks</code>. Значение <em
              class="replaceable">число</em> указывает число указанных единиц, которое должно пройти перед запуском программы.
			</div><div
            class="para">
				Для отмены задачи, запланированной <code
              class="command">cron</code>, нужно просто запустить <code
              class="command">crontab -e</code> и удалить соответствующую строку в файле <span
              class="emphasis"><em>crontab</em></span>. Для задач <code
              class="command">at</code> это почти так же легко: надо запустить <code
              class="command">atrm <em
                class="replaceable">номер-задачи</em></code>. Номер задачи указывается командой <code
              class="command">at</code> при её планировании, а также её можно найти с помощью команды <code
              class="command">atq</code>, выводящей текущий список запланированных задач.
			</div><a
            id="id-1.12.10.16.7"
            class="indexterm"></a><a
            id="id-1.12.10.16.8"
            class="indexterm"></a></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="sect.inetd.html"><strong>Пред.</strong>9.6. Суперсервер inetd</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>Наверх</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>Начало</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.asynchronous-task-scheduling-anacron.html"><strong>След.</strong>9.8. Планирование асинхронных задач: anacron</a></li></ul><div
        id="translated_pages"><ul><li><a
              href="../ar-MA/sect.task-scheduling-cron-atd.html">ar-MA</a></li><li><a
              href="../da-DK/sect.task-scheduling-cron-atd.html">da-DK</a></li><li><a
              href="../de-DE/sect.task-scheduling-cron-atd.html">de-DE</a></li><li><a
              href="../el-GR/sect.task-scheduling-cron-atd.html">el-GR</a></li><li><a
              href="../en-US/sect.task-scheduling-cron-atd.html">en-US</a></li><li><a
              href="../es-ES/sect.task-scheduling-cron-atd.html">es-ES</a></li><li><a
              href="../fa-IR/sect.task-scheduling-cron-atd.html">fa-IR</a></li><li><a
              href="../fr-FR/sect.task-scheduling-cron-atd.html">fr-FR</a></li><li><a
              href="../hr-HR/sect.task-scheduling-cron-atd.html">hr-HR</a></li><li><a
              href="../id-ID/sect.task-scheduling-cron-atd.html">id-ID</a></li><li><a
              href="../it-IT/sect.task-scheduling-cron-atd.html">it-IT</a></li><li><a
              href="../ja-JP/sect.task-scheduling-cron-atd.html">ja-JP</a></li><li><a
              href="../ko-KR/sect.task-scheduling-cron-atd.html">ko-KR</a></li><li><a
              href="../nb-NO/sect.task-scheduling-cron-atd.html">nb-NO</a></li><li><a
              href="../pl-PL/sect.task-scheduling-cron-atd.html">pl-PL</a></li><li><a
              href="../pt-BR/sect.task-scheduling-cron-atd.html">pt-BR</a></li><li><a
              href="../ro-RO/sect.task-scheduling-cron-atd.html">ro-RO</a></li><li><a
              href="../ru-RU/sect.task-scheduling-cron-atd.html">ru-RU</a></li><li><a
              href="../tr-TR/sect.task-scheduling-cron-atd.html">tr-TR</a></li><li><a
              href="../vi-VN/sect.task-scheduling-cron-atd.html">vi-VN</a></li><li><a
              href="../zh-CN/sect.task-scheduling-cron-atd.html">zh-CN</a></li><li><a
              href="../zh-TW/sect.task-scheduling-cron-atd.html">zh-TW</a></li></ul></div></body></html>
