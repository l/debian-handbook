<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">فصل 11. سرویس‌های شبکه: Postfix، Apache، NFS، Samba، Squid، LDAP، SIP، XMPP، Turn</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-9-fa-IR-1.0-1" /><meta
        name="keywords"
        content="Postfix, Apache, NFS, Samba, Squid, OpenLDAP, SIP" /><link
        rel="home"
        href="index.html"
        title="راهنمای جامع دبیان" /><link
        rel="up"
        href="index.html"
        title="راهنمای جامع دبیان" /><link
        rel="prev"
        href="sect.network-diagnosis-tools.html"
        title="10.8. ابزار بررسی شبکه" /><link
        rel="next"
        href="sect.http-web-server.html"
        title="11.2. سرور وب (HTTP)" /><meta
        name="viewport"
        content="width=device-width, initial-scale=1" /><meta
        name="flattr:id"
        content="4pz9jq" /><link
        rel="canonical"
        href="http://l.github.io/debian-handbook/html/fa-IR/network-services.html" /></head><body
      dir="rtl"><noscript><iframe
          src="//www.googletagmanager.com/ns.html?id=GTM-5H35QX"
          height="0"
          width="0"
          style="display:none;visibility:hidden"></iframe></noscript><script
        type="text/javascript">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&amp;l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5H35QX');</script><div
        id="banner"><a
          href="../../"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="index.html"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="sect.network-diagnosis-tools.html"><strong>قبلی</strong></a></li><li
          class="home">راهنمای جامع دبیان</li><li
          class="next"><a
            accesskey="n"
            href="sect.http-web-server.html"><strong>بعدی</strong></a></li></ul><div
        xml:lang="fa-IR"
        class="chapter"
        lang="fa-IR"><div
          class="titlepage"><div><div><h1
                class="title"><a
                  id="network-services"></a>
      فصل 11. سرویس‌های شبکه: Postfix، Apache، NFS، Samba، Squid، LDAP، SIP، XMPP، Turn</h1></div></div></div><div
          class="toc"><dl
            class="toc"><dt><span
                class="section"><a
                  href="network-services.html#sect.smtp-mail-server">11.1. سرور ایمیل</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="network-services.html#id-1.14.4.7">11.1.1. نصب Postfix</a></span></dt><dt><span
                    class="section"><a
                      href="network-services.html#sect.configuring-virtual-domains">11.1.2. پیکربندی دامنه‌های مجازی</a></span></dt><dt><span
                    class="section"><a
                      href="network-services.html#sect.restrictions-for-receiving-and-sending">11.1.3. محدودیت برای ارسال و دریافت</a></span></dt><dt><span
                    class="section"><a
                      href="network-services.html#sect.setting-up-greylisting">11.1.4. برپایی <span
                        class="foreignphrase"><em
                          class="foreignphrase">فهرست خاکستری</em></span></a></span></dt><dt><span
                    class="section"><a
                      href="network-services.html#id-1.14.4.11">11.1.5. سفارشی‌سازی فیلترها مبتنی بر گیرنده</a></span></dt><dt><span
                    class="section"><a
                      href="network-services.html#sect.postfix-antivirus">11.1.6. یکپارچه‌سازی آنتی‌ویروس</a></span></dt><dt><span
                    class="section"><a
                      href="network-services.html#sect.authenticated-smtp">11.1.7. SMTP احرازهویت شده</a></span></dt></dl></dd><dt><span
                class="section"><a
                  href="sect.http-web-server.html">11.2. سرور وب (HTTP)</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="sect.http-web-server.html#id-1.14.5.9">11.2.1. نصب آپاچی</a></span></dt><dt><span
                    class="section"><a
                      href="sect.http-web-server.html#id-1.14.5.10">11.2.2. پیکربندی گروه‌های مجازی</a></span></dt><dt><span
                    class="section"><a
                      href="sect.http-web-server.html#id-1.14.5.11">11.2.3. عبارت‌های متداول</a></span></dt><dt><span
                    class="section"><a
                      href="sect.http-web-server.html#id-1.14.5.12">11.2.4. تحلیلگرهای گزارش</a></span></dt></dl></dd><dt><span
                class="section"><a
                  href="sect.ftp-file-server.html">11.3. سرور فایل FTP</a></span></dt><dt><span
                class="section"><a
                  href="sect.nfs-file-server.html">11.4. سرور فایل NFS</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="sect.nfs-file-server.html#id-1.14.7.10">11.4.1. ایمن‌سازی NFS</a></span></dt><dt><span
                    class="section"><a
                      href="sect.nfs-file-server.html#id-1.14.7.11">11.4.2. سرور NFS</a></span></dt><dt><span
                    class="section"><a
                      href="sect.nfs-file-server.html#id-1.14.7.12">11.4.3. برنامه NFS</a></span></dt></dl></dd><dt><span
                class="section"><a
                  href="sect.windows-file-server-with-samba.html">11.5. راه‌اندازی اشتراک‌های ویندوز با Samba</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="sect.windows-file-server-with-samba.html#id-1.14.8.9">11.5.1. سرور سامبا</a></span></dt><dt><span
                    class="section"><a
                      href="sect.windows-file-server-with-samba.html#id-1.14.8.10">11.5.2. برنامه سامبا</a></span></dt></dl></dd><dt><span
                class="section"><a
                  href="sect.http-ftp-proxy.html">11.6. پروکسی HTTP/FTP</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="sect.http-ftp-proxy.html#id-1.14.9.8">11.6.1. نصب</a></span></dt><dt><span
                    class="section"><a
                      href="sect.http-ftp-proxy.html#id-1.14.9.9">11.6.2. پیکربندی یک حافظه نهان</a></span></dt><dt><span
                    class="section"><a
                      href="sect.http-ftp-proxy.html#id-1.14.9.10">11.6.3. پیکربندی یک فیلتر</a></span></dt></dl></dd><dt><span
                class="section"><a
                  href="sect.ldap-directory.html">11.7. دایرکتوی LDAP</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="sect.ldap-directory.html#id-1.14.10.7">11.7.1. نصب</a></span></dt><dt><span
                    class="section"><a
                      href="sect.ldap-directory.html#id-1.14.10.8">11.7.2. پرکردن دایرکتوری</a></span></dt><dt><span
                    class="section"><a
                      href="sect.ldap-directory.html#id-1.14.10.9">11.7.3. مدیریت حساب‌ها با LDAP</a></span></dt></dl></dd><dt><span
                class="section"><a
                  href="sect.rtc-services.html">11.8. سرویس‌های ارتباطی بلادرنگ</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="sect.rtc-services.html#sect.rtc-dns-settings">11.8.1. تنظیمات DNS برای سرویس‌های RTC</a></span></dt><dt><span
                    class="section"><a
                      href="sect.rtc-services.html#sect.turn-server">11.8.2. سرور TURN</a></span></dt><dt><span
                    class="section"><a
                      href="sect.rtc-services.html#sect.sip-server">11.8.3. سرور پروکسی SIP</a></span></dt><dt><span
                    class="section"><a
                      href="sect.rtc-services.html#sect.xmpp-server">11.8.4. سرور XMPP</a></span></dt><dt><span
                    class="section"><a
                      href="sect.rtc-services.html#sect.rtc-port-443">11.8.5. اجرای سرویس‌ها روی درگاه ۴۴۳</a></span></dt><dt><span
                    class="section"><a
                      href="sect.rtc-services.html#sect.rtc-webrtc">11.8.6. افزودن WebRTC</a></span></dt></dl></dd></dl></div><div
          class="highlights"><div
            class="para">
		سرویس‌های شبکه برنامه‌هایی هستند که کاربران به صورت روزانه با آن‌ها سر و کار دارند. این ابزارها بخش عظیمی از دنیای فناوری را شامل می‌شوند که در این فصل به بررسی آن‌ها خواهیم پرداخت؛ قسمت پنهانی که این ابزارها روی آن قرار می‌گیرند همان زیرساختی است که تاکنون بررسی کرده‌ایم.
	</div><div
            class="para">
		بسیاری سرویس‌های نوین شبکه به منظور عملکرد صحیح و امن نیازمند فناوری رمزنگاری هستند، بخصوص زمانی که در شبکه عمومی اینترنت مورد استفاده باشند. گواهینامه‌های X.509 (که به نام گواهینامه‌های SSL یا TLS نیز شناخته می‌شوند) اغلب به این منظور استفاده می‌شوند. یک گواهینامه برای دامنه‌ای بخصوص می‌تواند برای تعداد بیشتری از سرویس‌های مورد بحث در این فصل استفاده شود.
	</div><a
            id="id-1.14.3.3"
            class="indexterm"></a><a
            id="id-1.14.3.4"
            class="indexterm"></a><a
            id="id-1.14.3.5"
            class="indexterm"></a></div><div
          class="section"><div
            class="titlepage"><div><div><h2
                  class="title"><a
                    id="sect.smtp-mail-server"></a>11.1. سرور ایمیل</h2></div></div></div><div
            class="para">
			مدیرسیستم‌های شرکت فالکوت Postfix را، با توجه به قابلیت اطمینان بالا و سادگی در پیکربندی برای سرور ایمیل خود انتخاب کرده‌اند. در حقیقت، طراحی آن بگونه‌ای است که هر وظیفه با حداقل تعداد مجوزهای مورد نیاز پیاده‌سازی شود، که این روش یک عامل کاهنده در رابطه با مشکلات امنیتی است.
		</div><a
            id="id-1.14.4.3"
            class="indexterm"></a><a
            id="id-1.14.4.4"
            class="indexterm"></a><a
            id="id-1.14.4.5"
            class="indexterm"></a><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>جایگزین</em></span> سرور Exim4</strong></p></div></div></div><a
              id="id-1.14.4.6.2"
              class="indexterm"></a><div
              class="para">
			دبیان از Exim4 به عنوان سرور پیشفرض ایمیل استفاده می‌کند (به همین دلیل است که زمان نصب اولیه سیستم انتخاب شده است). پیکربندی آن در بسته جداگانه‌ای بنام <span
                class="pkg pkg">exim4-config</span> قرار دارد و به صورت خودکار توسط پرسش‌های مطرح شده از Debconf سفارشی‌سازی می‌شود، که بسیار شبیه به پرسش‌های مطرح شده توسط بسته <span
                class="pkg pkg">postfix</span> است.
		</div><div
              class="para">
			پیکربندی می‌تواند در یک فایل جداگانه قرار داشته باشد (<code
                class="filename">/etc/exim4/exim4.conf.template</code>) یا در مسیر <code
                class="filename">/etc/exim4/conf.d/</code> بین چندین فایل مختلف تقسیم گردد. در هر دو مورد، فایل‌ها توسط <code
                class="command">update-exim4.conf</code> به عنوان قالبی برای تولید <code
                class="filename">/var/lib/exim4/config.autogenerated</code> مورد استفاده قرار می‌گیرند. فایل آخر همان فایلی است که توسط Exim4 مورد استفاده قرار می‌گیرد. به لطف این مکانیزم، مقادیر بدست آمده از پیکربندی debconf در Exim - که در فایل <code
                class="filename">/etc/exim4/update-exim4.conf.conf</code> ذخیره شده‌اند - می‌توانند درون فایل پیکربندی Exim قرار گیرند، حتی زمانی که مدیرسیستم یا بسته دیگری پیکربندی پیشفرض آن را تغییر داده باشند.
		</div><div
              class="para">
			شیوه نگارش فایل پیکربندی Exim4 ویژگی‌های عجیب و غریب خود را دارد؛ اگرچه، زمانی که این قوانین فراگرفته شوند، Exim4 به یک سرور ایمیل بسیار کامل و قدرتمند تبدیل می‌شود، که گواه آن صفحات مستندات پروژه است. <div
                class="url">→ <a
                  href="http://www.exim.org/docs.html">http://www.exim.org/docs.html</a></div>
		</div></div><div
            class="section"><div
              class="titlepage"><div><div><h3
                    class="title"><a
                      id="id-1.14.4.7"></a>11.1.1. نصب Postfix</h3></div></div></div><div
              class="para">
				بسته <span
                class="pkg pkg">postfix</span> شامل فرآیند پس‌زمینه اصلی SMTP است. سایر بسته‌ها از جمله <span
                class="pkg pkg">postfix-ldap</span> و <span
                class="pkg pkg">postfix-pgsql</span> قابلیت‌های بیشتری را به آن اضافه می‌کنند از جمله دسترسی به پایگاه‌داده‌های نگاشت شده. تنها زمانی که به آن‌ها نیاز دارید باید نصبشان کنید.
			</div><div
              class="sidebar"><a
                id="sidebar.smtp"></a><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>بارگشت به مقدمات</em></span> SMTP</strong></p></div></div></div><a
                id="id-1.14.4.7.3.2"
                class="indexterm"></a><a
                id="id-1.14.4.7.3.3"
                class="indexterm"></a><a
                id="id-1.14.4.7.3.4"
                class="indexterm"></a><div
                class="para">
				SMTP یا <span
                  class="emphasis"><em>Simple Mail Transfer Protocol</em></span> پروتکل مورد استفاده سرورهای ایمیل برای تبادل و مسیریابی ایمیل‌ها است.
			</div></div><div
              class="para">
				هنگام نصب بسته، چندین پرسش از طرف Debconf مطرح می‌شود. پاسخ‌های داده شده برای تولید اولین فایل پیکربندی <code
                class="filename">/etc/postfix/main.cf</code> بکار می‌روند.
			</div><div
              class="para">
				پرسش اول درباره نوع راه‌اندازی است. تنها دو تا از پاسخ‌های پیشنهادی در مورد یک سرور متصل به اینترنت مناسب هستند، “Internet site” و “Internet with smarthost”. اولی برای سروری مناسب است که ایمیل ورودی را دریافت کرده و پاسخ را مستقیم به گیرنده می‌فرستد، که به همین دلیل برای شرکت فالکوت مناسب است. دومی برای سروری مناسب است که ایمیل ورودی را دریافت کرده، اما پاسخ را از طریق یک سرور SMTP میانی - یا همان “smarthost” - به گیرنده می‌فرستد. این گزینه اغلب برای افرادی مناسب است که از نشانی IP پویا استفاده می‌کنند، چرا که بسیاری سرورهای ایمیل از دریافت پیام‌های ارسالی از طرف چنین نشانی‌هایی خودداری می‌کنند. در این مورد، smarthost معمولا سرور SMTP شرکت ارائه دهنده خدمات اینترنتی است، که معمولا طوری پیکربندی می‌شود تا ایمیل‌های دریافتی از مشتریان خود را به درستی مسیریابی کند. این راه‌اندازی (با یک smarthost) برای سرورهایی که دائم به اینترنت متصل نیستند نیز مناسب است، چرا که از مدیریت صف پیام‌های غیرقابل ارسال که نیاز به حذف شدن در زمان دیگری را دارند، جلوگیری می‌کند.
			</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>واژگان</em></span> ISP</strong></p></div></div></div><a
                id="id-1.14.4.7.6.2"
                class="indexterm"></a><div
                class="para">
				ISP مخفف عبارت “Internet Service Provider” یا همان ارائه دهنده خدمات اینترنتی است. معمولا شامل یک شرکت تجاری است که خدمات پایه در اینترنت را فراهم می‌کند (وب، ایمیل، خبر و ...).
			</div><div
                class="para">
			</div></div><div
              class="para">
				پرسش دوم درباره نام کامل رایانه‌ای است که نشانی‌های ایمیل را از یک کاربر محلی تولید می‌کند؛ نام کامل پس از قسمت جلوی “@” می‌آید. در مورد فالکوت، پاسخ برابر است با <code
                class="literal">mail.falcot.com</code>. این تنها پرسشی است که به صورت پیشفرض مطرح می‌شود، اما پیکربندی که در پی دارد نیازهای شرکت فالکوت را تامین نمی‌کند، به همین دلیل مدیرسیستم‌های آن اقدام به اجرای <code
                class="command">dpkg-reconfigure postfix</code> می‌کنند تا بتوانند گزینه‌های بیشتری را پیکربندی نمایند.
			</div><div
              class="para">
				یکی از پرسش‌های اضافی که پرسیده می‌شود درباره تمام دامنه‌های مرتبط با این رایانه است. فهرست پیشفرض شامل نام کامل آن به همراه برخی نام‌های مترادف برای <code
                class="literal">localhost</code> است، اما دامنه اصلی <code
                class="literal">falcot.com</code> باید به صورت دستی اضافه شود. به صورت کلی، این پرسش باید با تمام نام‌های دامنه که برای آن‌ها این رایانه به عنوان یک سروی MX عمل می‌کند پاسخ داده شود؛ به عبارت دیگر، تمام دامنه‌هایی که DNS می‌گوید برای این رایانه ایمیل دریافت می‌کنند. این اطلاعات در متغیر <code
                class="literal">mydestination</code> واقع در فایل پیکربندی اصلی Postfix - <code
                class="filename">/etc/postfix/main.cf</code> - قرار می‌گیرند.
			</div><a
              id="id-1.14.4.7.9"
              class="indexterm"></a><a
              id="id-1.14.4.7.10"
              class="indexterm"></a><div
              class="figure"><a
                id="id-1.14.4.7.11"></a><div
                class="figure-contents"><div
                  class="mediaobject"><img
                    src="images/mail-server.png"
                    alt="نقش رکورد MX در DNS هنگام ارسال ایمیل" /></div></div><p
                class="title"><strong>
      شكل 11.1. نقش رکورد <span
                    class="emphasis"><em>MX</em></span> در DNS هنگام ارسال ایمیل</strong></p></div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>اضافی</em></span> پرس و جو از رکوردهای MX</strong></p></div></div></div><div
                class="para">
				زمانی که DNS برای یک دامنه شامل رکورد MX نباشد، سرور ایمیل تلاش می‌کند که پیام‌ها را مستقیم به خود سیستم میزبان بفرستد، با استفاده از رکورد A متناظر (یا AAAA در IPv6).
			</div></div><div
              class="para">
				در برخی موارد، فرآیند نصب می‌تواند شبکه‌ای را که مجاز به ارسال ایمیل است درخواست کند. در پیکربندی پیشفرض، Postfix فقط ایمیل‌های ارسالی از خود رایانه را قبول می‌کند؛ شبکه محلی نیز معمولا اضافه می‌شود. مدیرسیستم‌های فالکوت <code
                class="literal">192.168.0.0/16</code> را به پاسخ پیشفرض اضافه کرده‌اند. اگر این پرسش مطرح نشود، متغیر مربوطه در فایل پیکربندی عبارت است از <code
                class="literal">mynetworks</code>، که در نمونه زیر نیز مشاهده می‌شود.
			</div><div
              class="para">
				ایمیل محلی می‌تواند از طریق <code
                class="command">procmail</code> تحویل داده شود. این ابزار به کاربران امکان می‌دهد که ایمیل دریافتی خود را با توجه به قوانین ذخیره شده در فایل <code
                class="filename">~/.procmailrc</code> مرتب‌سازی کنند.
			</div><a
              id="id-1.14.4.7.15"
              class="indexterm"></a><a
              id="id-1.14.4.7.16"
              class="indexterm"></a><a
              id="id-1.14.4.7.17"
              class="indexterm"></a><div
              class="para">
				پس از این گام اولیه، فایل پیکربندی مقابل در اختیار مدیرسیستم‌ها قرار گرفته است؛ از این فایل به عنوان نقطه شروعی برای افزودن قابلیت‌های بیشتر در قسمت‌های بعدی استفاده می‌شود.
			</div><div
              class="example"><a
                id="id-1.14.4.7.19"></a><p
                class="title"><strong>
      مثال 11.1. فایل اولیه <code
                    class="filename">/etc/postfix/main.cf</code></strong></p><div
                class="example-contents"><pre
                  class="programlisting">
# See /usr/share/postfix/main.cf.dist for a commented, more complete version


# Debian specific:  Specifying a file name will cause the first
# line of that file to be used as the name.  The Debian default
# is /etc/mailname.
#myorigin = /etc/mailname

smtpd_banner = $myhostname ESMTP $mail_name (Debian/GNU)
biff = no

# appending .domain is the MUA's job.
append_dot_mydomain = no

# Uncomment the next line to generate "delayed mail" warnings
#delay_warning_time = 4h

readme_directory = no

# TLS parameters
smtpd_tls_cert_file=/etc/ssl/certs/ssl-cert-snakeoil.pem
smtpd_tls_key_file=/etc/ssl/private/ssl-cert-snakeoil.key
smtpd_use_tls=yes
smtpd_tls_session_cache_database = btree:${data_directory}/smtpd_scache
smtp_tls_session_cache_database = btree:${data_directory}/smtp_scache

# See /usr/share/doc/postfix/TLS_README.gz in the postfix-doc package for
# information on enabling SSL in the smtp client.

smtpd_relay_restrictions = permit_mynetworks permit_sasl_authenticated defer_unauth_destination
myhostname = mail.falcot.com
alias_maps = hash:/etc/aliases
alias_database = hash:/etc/aliases
myorigin = /etc/mailname
mydestination = mail.falcot.com, falcot.com, localhost.localdomain, localhost
relayhost = 
mynetworks = 127.0.0.0/8 [::ffff:127.0.0.0]/104 [::1]/128 192.168.0.0/16
mailbox_command = procmail -a "$EXTENSION"
mailbox_size_limit = 0
recipient_delimiter = +
inet_interfaces = all
inet_protocols = all</pre></div></div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>امنیت</em></span> گواهینامه‌های SSL <span
                          class="emphasis"><em>زهر ماری</em></span></strong></p></div></div></div><div
                class="para">
				گواهینامه‌های <span
                  class="emphasis"><em>زهر ماری</em></span> مانند "داروی" <span
                  class="emphasis"><em>زهر ماری</em></span> که توسط کلاهبرداران در زمان گذشته فروخته می‌شد، هیچ ارزشی ندارند. شما نمی‌توانید روی آن‌ها برای احرازهویت سرور حساب کنید چرا که این‌ها گواهینامه‌های بدون اعتباری هستند. با این حال، برای بهبود حریم‌شخصی در تبادل ارتباطات مفید واقع می‌شوند.
			</div><div
                class="para">
				در حالت کلی تنها برای اهداف آزمایشی باید مورد استفاده قرار گیرند، و یک سرویس عادی باید از گواهینامه‌های واقعی استفاده کند؛ این گواهینامه‌ها می‌توانند به شیوه مطرح شده در قسمت <a
                  class="xref"
                  href="sect.virtual-private-network.html#sect.easy-rsa">
      قسمت 10.2.1.1, “زیرساخت کلید عمومی: <span
                    class="emphasis"><em>easy-rsa</em></span>”
    </a> تولید گردند.
			</div></div></div><div
            class="section"><div
              class="titlepage"><div><div><h3
                    class="title"><a
                      id="sect.configuring-virtual-domains"></a>11.1.2. پیکربندی دامنه‌های مجازی</h3></div></div></div><a
              id="id-1.14.4.8.2"
              class="indexterm"></a><a
              id="id-1.14.4.8.3"
              class="indexterm"></a><div
              class="para">
				سرور ایمیل می‌تواند ایمیل‌هایی که به سایر دامنه‌ها در کنار دامنه اصلی ارسال شده‌اند را دریافت کند؛ این دامنه‌ها بنام دامنه‌های مجازی شناخته می‌شوند. در اکثر مواردی که این اتفاق می‌افتد، ایمیل‌ها الزاما به کاربران محلی مورد نظر خود ارجاع داده نمی‌شوند. Postfix دو ویژگی جالب فراهم می‌کند که برای دامنه‌های مجازی بکار می‌روند.
			</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>احتیاط</em></span> دامنه‌های مجازی و دامنه‌های استاندارد</strong></p></div></div></div><div
                class="para">
				هیچ یک از دامنه‌های مجازی نباید در متغیر <code
                  class="literal">mydestination</code> قرار بگیرند؛ این متغیر تنها شامل نام‌ دامنه‌های “استاندارد” است که به طور مستقیم با رایانه و کاربران محلی آن متناظر می‌باشد.
			</div></div><div
              class="section"><div
                class="titlepage"><div><div><h4
                      class="title"><a
                        id="id-1.14.4.8.6"></a>11.1.2.1. دامنه‌های مستعار مجازی</h4></div></div></div><a
                id="id-1.14.4.8.6.2"
                class="indexterm"></a><a
                id="id-1.14.4.8.6.3"
                class="indexterm"></a><div
                class="para">
					یک دامنه مستعار مجازی تنها شامل نام‌های مستعار است، نشانی‌هایی که ایمیل‌ها را به سایر نشانی‌ها فوروارد می‌کنند.
				</div><div
                class="para">
					چنین دامنه‌ای با افزودن نامش به متغیر <code
                  class="literal">virtual_alias_domains</code> و ارجاع دادن به یک فایل نگاشت نشانی در متغیر <code
                  class="literal">virtual_alias_maps</code>، فعال می‌شود.
				</div><div
                class="example"><a
                  id="id-1.14.4.8.6.6"></a><p
                  class="title"><strong>
      مثال 11.2. دستوراتی برای افزودن به فایل <code
                      class="filename">/etc/postfix/main.cf</code></strong></p><div
                  class="example-contents"><pre
                    class="programlisting">
virtual_alias_domains = falcotsbrand.com
virtual_alias_maps = hash:/etc/postfix/virtual</pre></div></div><div
                class="para">
					فایل <code
                  class="filename">/etc/postfix/virtual</code> یک نگاشت با شیوه‌ای ساده را توضیح می‌دهد: هر خط شامل دو فیلد است که با فاصله از یکدیگر جدا شده‌اند؛ فیلد اول نام مستعار و فیلد دوم فهرستی از نشانی‌های ایمیل است که به آن ارسال می‌شود. شیوه نگارشی بخصوص <code
                  class="literal">@domain.com</code> تمام نام‌های مستعار در یک دامنه را پوشش می‌دهد.
				</div><div
                class="example"><a
                  id="id-1.14.4.8.6.8"></a><p
                  class="title"><strong>
      مثال 11.3. نمونه فایل <code
                      class="filename">/etc/postfix/virtual</code></strong></p><div
                  class="example-contents"><pre
                    class="programlisting">
webmaster@falcotsbrand.com  jean@falcot.com
contact@falcotsbrand.com    laure@falcot.com, sophie@falcot.com
# The alias below is generic and covers all addresses within 
# the falcotsbrand.com domain not otherwise covered by this file.
# These addresses forward email to the same user name in the
# falcot.com domain.
@falcotsbrand.com           @falcot.com</pre></div></div></div><div
              class="section"><div
                class="titlepage"><div><div><h4
                      class="title"><a
                        id="id-1.14.4.8.7"></a>11.1.2.2. دامنه‌های صندوق‌پستی مجازی</h4></div></div></div><div
                class="sidebar"><div
                  class="titlepage"><div><div><p
                        class="title"><strong><span
                            class="emphasis"><em>احتیاط</em></span> دامنه مجازی ترکیبی؟</strong></p></div></div></div><div
                  class="para">
					Postfix اجازه نمی‌دهد که از یک دامنه در هر دو متغیر <code
                    class="literal">virtual_alias_domains</code> و <code
                    class="literal">virtual_mailbox_domains</code> استفاده شود. با این حال هر دامنه موجود در <code
                    class="literal">virtual_mailbox_domains</code> به طور ضمنی در <code
                    class="literal">virtual_alias_domains</code> نیز قرار داده می‌شود که امکان ترکیب نام‌های مستعار و صندوق‌های پستی در یک دامنه مجازی را فراهم می‌آورد.
				</div></div><a
                id="id-1.14.4.8.7.3"
                class="indexterm"></a><a
                id="id-1.14.4.8.7.4"
                class="indexterm"></a><div
                class="para">
					پیام‌هایی که به یک دامنه صندوق‌پستی مجازی ارسال می‌شوند در صندوق‌پستی‌هایی ذخیره می‌گردد که در اختیار کاربر محلی سیستم نیست.
				</div><div
                class="para">
					فعال‌سازی یک دامنه صندوق‌پستی مجازی نیازمند نام بردن از این دامنه در متغیر <code
                  class="literal">virtual_mailbox_domains</code> و ارجاع به یک فایل نگاشت صندوق‌پستی در <code
                  class="literal">virtual_mailbox_maps</code> است. پارامتر <code
                  class="literal">virtual_mailbox_base</code> شامل دایرکتوری است که در آن صندوق‌های پستی ذخیره می‌شوند.
				</div><div
                class="para">
					پارامتر <code
                  class="literal">virtual_uid_maps</code> (به همین ترتیب پارامتر <code
                  class="literal">virtual_gid_maps</code>) به فایلی ارجاع می‌دهد که شامل نگاشت بین نشانی ایمیل و کاربر سیستم است که "مالک" صندوق‌پستی مربوطه می‌باشد (به همین ترتیب برای گروه). برای دریافت تمام صندوق‌پستی‌هایی که توسط مالک/گروه یکسانی اداره می‌شوند، عبارت <code
                  class="literal">static:5000</code> یک شناسه‌کاربر/شناسه‌گروه ثابت را به آن اختصاص می‌دهد (در اینجا مقدار ۵۰۰۰).
				</div><div
                class="example"><a
                  id="id-1.14.4.8.7.8"></a><p
                  class="title"><strong>
      مثال 11.4. دستوراتی برای افزودن به فایل <code
                      class="filename">/etc/postfix/main.cf</code></strong></p><div
                  class="example-contents"><pre
                    class="programlisting">
virtual_mailbox_domains = falcot.org
virtual_mailbox_maps = hash:/etc/postfix/vmailbox
virtual_mailbox_base = /var/mail/vhosts</pre></div></div><div
                class="para">
					مجدد، شیوه نگارش فایل <code
                  class="filename">/etc/postfix/vmailbox</code> کاملا واضح است: دو فیلد که با فاصله از یکدیگر جدا شده‌اند. فیلد اول نشانی ایمیل یکی از دامنه‌های مجازی است و فیلد دوم مکان صندوق‌پستی مورد نظر است (نسبت به دایرکتوری مشخص شده در <span
                  class="emphasis"><em>virtual_mailbox_base</em></span>). اگر نام صندوق‌پستی با یک اسلش (<code
                  class="literal">/</code>) تمام شود، ایمیل‌ها در قالب <span
                  class="emphasis"><em>maildir</em></span> ذخیره‌سازی می‌شوند؛ در غیر اینصورت از قالب سنتی <span
                  class="emphasis"><em>mbox</em></span> استفاده می‌گردد. قالب <span
                  class="emphasis"><em>maildir</em></span> از یک دایکتوری کامل برای ذخیره‌سازی یک صندوق‌پستی استفاده می‌کند، که هر پیام آن در یک فایل جداگانه قرار می‌گیرد. از طرف دیگر، در قالب <span
                  class="emphasis"><em>mbox</em></span> تمام صندوق‌پستی در یک فایل بزرگ ذخیره می‌شود و هر خطی که با <code
                  class="literal">From </code> (به همراه یک فاصله) آغاز گردد، نشانگر ابتدای یک پیام است.
				</div><div
                class="example"><a
                  id="id-1.14.4.8.7.10"></a><p
                  class="title"><strong>
      مثال 11.5. فایل <code
                      class="filename">/etc/postfix/vmailbox</code></strong></p><div
                  class="example-contents"><pre
                    class="programlisting">
# Jean's email is stored as maildir, with
# one file per email in a dedicated directory
jean@falcot.org falcot.org/jean/
# Sophie's email is stored in a traditional "mbox" file,
# with all mails concatenated into one single file
sophie@falcot.org falcot.org/sophie</pre></div></div></div></div><div
            class="section"><div
              class="titlepage"><div><div><h3
                    class="title"><a
                      id="sect.restrictions-for-receiving-and-sending"></a>11.1.3. محدودیت برای ارسال و دریافت</h3></div></div></div><div
              class="para">
				تعداد رو به افزایش ایمیل‌های انبوه ناخواسته (<span
                class="emphasis"><em>spam</em></span>) تصمیم‌گیری درباره اینکه سرور چه ایمیل‌هایی را دریافت کند، دشوار می‌سازد. این قسمت به بررسی برخی راهبردهای موجود در Postfix می‌پردازد.
			</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>فرهنگ</em></span> مشکل اسپم</strong></p></div></div></div><a
                id="id-1.14.4.9.3.2"
                class="indexterm"></a><div
                class="para">
				"اسپم" یک عبارت عمومی برای تشخیص دادن تمام ایمیل‌های تجاری ناخواسته (که به نام UCE شناخته می‌شوند) است که به صندوق‌پستی‌های الکترونیک ما سرازیر می‌شوند؛ افرادی که به شیوه‌ای بی‌مهابا این ایمیل‌ها را ارسال می‌کنند با نام اسپمر شناخته می‌شوند. آن‌ها اهمیتی به میزان مزاحمت ایجاد شده برای کاربر نمی‌دهند و از آنجا که هزینه ارسال چنین ایمیل‌هایی بسیار پایین است اگر تنها درصد کمی از مخاطبان آن‌ها جذب این ایمیل‌ها شوند، تمام هزینه آن‌ها جبران خواهد شد. این فرآیند اغلب به صورت خودکار انجام می‌شود و هر نشانی ایمیل عمومی (برای نمونه، در یک انجمن وب، یا بایگانی یک فهرست پستی، یا یک وبلاگ و از این قبیل) توسط ربات‌های اسپمرها شناسایی شده و قربانی جریان بی‌پایانی از پیام‌های ناخواسته خواهد شد.
			</div><div
                class="para">
				تمام مدیرسیستم‌ها تلاش می‌کنند که با استفاده از فیلترهای اسپم با این مزاحمت مقابله کنند، اما اسپمرها نیز در این میان بیکار نمی‌شینند. برخی از آن‌ها برای کار خود حتی شبکه‌ای از رایانه‌ها را از اتحادیه‌های خلافکاری به اجاره می‌گیرند. محاسبات آماری اخیر نشان می‌دهد که بالغ بر ۹۵٪ از ترافیک ایمیل روی اینترنت مربوط به اسپم است!
			</div></div><div
              class="section"><div
                class="titlepage"><div><div><h4
                      class="title"><a
                        id="id-1.14.4.9.4"></a>11.1.3.1. محدودیت‌های دسترسی مبتنی بر IP</h4></div></div></div><div
                class="para">
					عبارت <code
                  class="literal">smtpd_client_restrictions</code> کنترل می‌کند که چه رایانه‌هایی مجاز به برقراری ارتباط با سرور ایمیل هستند.
				</div><div
                class="example"><a
                  id="id-1.14.4.9.4.3"></a><p
                  class="title"><strong>
      مثال 11.6. محدودیت‌های مبتنی بر نشانی میزبان</strong></p><div
                  class="example-contents"><pre
                    class="programlisting">
smtpd_client_restrictions = permit_mynetworks,
    warn_if_reject reject_unknown_client,
    check_client_access hash:/etc/postfix/access_clientip,
    reject_rbl_client sbl-xbl.spamhaus.org,
    reject_rbl_client list.dsbl.org</pre></div></div><div
                class="para">
					زمانی که یک متغیر شامل فهرستی از قوانین باشد، مانند نمونه بالا، این قوانین به ترتیب از ابتدا تا انتها ارزیابی می‌گردند. هر قانون می‌تواند پیام را دریافت، رد یا تصمیم‌گیری درباره آن را به قانون بعدی بسپارد. به همین دلیل، ترتیب قرارگیری آن‌ها مهم است و تعویض دو گزینه می‌تواند نتایج متفاوتی به همراه داشته باشد.
				</div><div
                class="para">
					عبارت <code
                  class="literal">permit_mynetworks</code>، که به عنوان قانون اول استفاده شد، تمام ایمیل‌های ارسالی از یک رایانه شبکه محلی را قبول می‌کند (به ترتیبی که در متغیر پیکربندی <span
                  class="emphasis"><em>mynetworks</em></span> بیان شده است).
				</div><div
                class="para">
					عبارت دوم ایمیل‌هایی را که از یک رایانه با پیکربندی DNS نامعتبر آمده باشند، نادیده می‌گیرد. چنین پیکربندی معتبری به این معنی است که نشانی IP بتواند به یک نام تبدیل شود و عکس آن نیز اتفاق بیفتد. این محدودیت‌ها اغلب سخت‌گیرانه هستند، چرا که بسیاری سرورهای ایمیل شامل DNS معکوس برای نشانی‌های IP خود نیستند. به همین دلیل است که مدیرسیستم‌های فالکوت از عملگر <code
                  class="literal">warn_if_reject</code> قبل از عبارت <code
                  class="literal">reject_unknown_client</code> استفاده می‌کنند: این عملگر منجر به تبدیل عملیات به یک پیام ساده اخطار در فایل‌های گزارش می‌گردد. سپس مدیرسیستم‌ها می‌توانند نگاهی به تعداد پیام‌های احتمالی برای نادیده گرفتن شدن بیندازند اگر این قانون در عمل اجرایی می‌شد، و در آینده تصمیم بگیرند که به چنین قابلیتی نیاز دارند یا خیر.
				</div><div
                class="sidebar"><div
                  class="titlepage"><div><div><p
                        class="title"><strong><span
                            class="emphasis"><em>نکته</em></span> جدول‌های <span
                            class="emphasis"><em>دسترسی</em></span></strong></p></div></div></div><div
                  class="para">
					شرایط محدودکننده شامل جدول‌های قابل تغییر توسط مدیرسیستم می‌شود که فهرستی از فرستندگان، نشانی‌های IP و نام‌های میزان مجاز و ممنوع را شامل می‌شود. این جدول‌ها می‌توانند از یک نسخه فشرده نشده فایل <code
                    class="filename">/usr/share/doc/postfix-doc/examples/access.gz</code> ایجاد گردند. این مدل در توضیحات خود بیان شده است، یعنی هر جدول شیوه نگارش خود را مشخص می‌کند.
				</div><div
                  class="para">
					جدول <code
                    class="filename">/etc/postfix/access_clientip</code> فهرستی از نشانی‌های IP و شبکه‌ها را ذخیره می‌کند؛ جدول <code
                    class="filename">/etc/postfix/access_helo</code> فهرستی از نام‌های دامنه را ذخیره می‌کند و جدول <code
                    class="filename">/etc/postfix/access_sender</code> شامل نشانی‌های ایمیل فرستنده است. تمام این فایل‌ها پس از هر تغییر با استفاده از دستور <code
                    class="command">postmap /etc/postfix/<em
                      class="replaceable">file</em></code> باید به صورت جدول‌های hash درآیند (قالبی که برای دسترسی سریع بهینه شده است).
				</div></div><div
                class="para">
					عبارت سوم به مدیرسیستم اجازه می‌دهد که فهرست سیاه و سفیدی از سرورهای ایمیل، که در فایل <code
                  class="filename">/etc/postfix/access_clientip</code> ذخیره می‌شوند، ایجاد کند. سرورهای موجود در فهرست سفید قابل اعتماد در نظر گرفته می‌شوند و ایمیل‌های ارسالی از آن‌ها از قوانین فیلترینگ گفته شده عبور داده نمی‌شوند.
				</div><div
                class="para">
					دو قانون آخر نیز تمام پیام‌های ارسالی از طرف یکی از سرورهای موجود در فهرست سیاه را رد می‌کنند. RBL مخفف عبارت <span
                  class="emphasis"><em>Remote Black List</em></span> است؛ چنین فهرست‌های موجود است اما تمام آن‌ها شامل سرورهایی هستند که به شیوه‌ای بد پیکربندی شده‌اند که اسپمرها از آن‌ها برای بازپخش ایمیل‌های خود استفاده می‌کنند، این رایانه‌ها اغلب توسط کرم‌ها یا ویروس‌ها آلوده گشته‌اند.
				</div><a
                id="id-1.14.4.9.4.10"
                class="indexterm"></a><a
                id="id-1.14.4.9.4.11"
                class="indexterm"></a><div
                class="sidebar"><div
                  class="titlepage"><div><div><p
                        class="title"><strong><span
                            class="emphasis"><em>نکته</em></span> فهرست سفید و RBLها</strong></p></div></div></div><div
                  class="para">
					فهرست‌های سیاه گاهی شامل سرورهای قانونی هستند که دچار حادثه شده‌اند. در این شرایط، تمام ایمیل‌های ارسالی از این سرورها رد می‌شوند مگر اینکه نام آن‌ها در یک فهرست سفید تعریف شده در <code
                    class="filename">/etc/postfix/access_clientip</code> وجود داشته باشد.
				</div><div
                  class="para">
					احتیاط حکم می‌کند که تمام سرورهای قابل اعتماد که اکثر ایمیل‌ها از طرف آن‌ها است درون فهرست سفید قرار دهید.
				</div></div></div><div
              class="section"><div
                class="titlepage"><div><div><h4
                      class="title"><a
                        id="id-1.14.4.9.5"></a>11.1.3.2. بررسی اعتبار دستورات <code
                        class="literal">EHLO</code> یا <code
                        class="literal">HELO</code></h4></div></div></div><div
                class="para">
					هر تبادل SMTP با یک دستور <code
                  class="literal">HELO</code> (یا <code
                  class="literal">EHLO</code>) آغاز می‌شود، به همراه نام سرور ایمیل فرستنده؛ بررسی اعتبار این نام می‌تواند کار جالبی باشد.
				</div><a
                id="id-1.14.4.9.5.3"
                class="indexterm"></a><a
                id="id-1.14.4.9.5.4"
                class="indexterm"></a><div
                class="example"><a
                  id="id-1.14.4.9.5.5"></a><p
                  class="title"><strong>
      مثال 11.7. محدودیت‌های نام اعلام شده در <code
                      class="literal">EHLO</code></strong></p><div
                  class="example-contents"><pre
                    class="programlisting">
smtpd_helo_restrictions = permit_mynetworks,
    reject_invalid_hostname,
    check_helo_access hash:/etc/postfix/access_helo,
    reject_non_fqdn_hostname,
    warn_if_reject reject_unknown_hostname</pre></div></div><div
                class="para">
					عبارت ابتدایی <code
                  class="literal">permit_mynetworks</code> به تمام رایانه‌های شبکه محلی اجازه می‌دهد که خود را آزادانه معرفی کنند. این مهم است چرا که برخی برنامه‌های ایمیل برای این بخش از پروتکل SMTP به اندازه کافی احترام قائل نیستند و آن‌ها می‌توانند خود را با نام‌های مهمل معرفی کنند.
				</div><div
                class="para">
					قانون <code
                  class="literal">reject_invalid_hostname</code> ایمیل‌هایی را که شامل غلط نگارشی در <code
                  class="literal">EHLO</code> باشند رد می‌کند. قانون <code
                  class="literal">reject_non_fqdn_hostname</code> پیام‌هایی را رد می‌کند که نام میزبان آن‌ها یک نام دامنه تمام-عیار نباشد (شامل نام دامنه به همراه نام میزبان). قانون <code
                  class="literal">reject_unknown_hostname</code> پیام‌هایی را رد می‌کند که نام میزبان آن‌ها درون DNS موجود نباشد. از آنجا که این قانون آخر منجر به رد بسیاری پیام‌ها می‌شود مدیرسیستم‌ها تصمیم گرفته‌اند که آن را با یک عملگر <code
                  class="literal">warn_if_reject</code> به صورت پیام اخطار ساده‌ای تبدیل کنند؛ آن‌ها می‌توانند در مرحله دیگری این عملگر را حذف کنند، پس از اینکه از نتایج آن باخبر شوند.
				</div><div
                class="para">
					استفاده از <code
                  class="literal">permit_mynetworks</code> به عنوان قانون اول یک تاثیر جانبی جالب دارد: قوانین پیش رو تنها برای میزبان‌های خارج از شبکه محلی اعمال می‌شوند. اینکار امکان افزودن تمام میزبان‌هایی که قصد معرفی خود بجای <code
                  class="literal">falcot.com</code> را دارند، به فهرست سیاه فراهم می‌آورد، برای نمونه، با افزودن یک خط <code
                  class="literal">گمشو بیرون، تو که تو شبکه ما نیستی!</code> به فایل <code
                  class="filename">/etc/postfix/access_helo</code>.
				</div></div><div
              class="section"><div
                class="titlepage"><div><div><h4
                      class="title"><a
                        id="id-1.14.4.9.6"></a>11.1.3.3. پذیرش یا رد مبتنی بر فرستنده اعلام شده</h4></div></div></div><div
                class="para">
					هر پیام شامل فرستنده است، که توسط دستور <code
                  class="literal">MAIL FROM</code> از پروتکل SMTP اعلام می‌شود؛ مجدد، این اطلاعات می‌توانند به چندین روش ارزیابی گردند.
				</div><a
                id="id-1.14.4.9.6.3"
                class="indexterm"></a><a
                id="id-1.14.4.9.6.4"
                class="indexterm"></a><div
                class="example"><a
                  id="id-1.14.4.9.6.5"></a><p
                  class="title"><strong>
      مثال 11.8. بررسی‌های فرستنده</strong></p><div
                  class="example-contents"><pre
                    class="programlisting">
smtpd_sender_restrictions = 
    check_sender_access hash:/etc/postfix/access_sender,
    reject_unknown_sender_domain, reject_unlisted_sender,
    reject_non_fqdn_sender</pre></div></div><div
                class="para">
					جدول <code
                  class="filename">/etc/postfix/access_sender</code> با برخی فرستندگان به شیوه‌ای خاص برخورد می‌کند. این معمولا به معنی قراردادن برخی فرستندگان در فهرست سیاه و سفید است.
				</div><div
                class="para">
					قانون <code
                  class="literal">reject_unknown_sender_domain</code> نیازمند یک دامنه معتبر فرستنده است، چرا که برای یک نشانی معتبر لازم است. قانون <code
                  class="literal">reject_unlisted_sender</code> کاربران محلی که نشانی آن‌ها موجود نباشد را رد می‌کند؛ اینکار از ارسال پیام‌هایی که از نشانی‌های نامعتبر وابسته به دامنه <code
                  class="literal">falcot.com</code> می‌آیند، جلوگیری می‌کند. پیام‌هایی که به شکل <code
                  class="literal">joe.bloggs@falcot.com</code> باشند تنها در شرایط وجود چنین نشانی پذیرفته می‌شوند.
				</div><div
                class="para">
					در نهایت، قانون <code
                  class="literal">reject_non_fqdn_sender</code> پیام‌هایی که از یک نشانی بدون نام دامنه تمام-عیار ارسال شوند را رد می‌کند. در عمل، یعنی پیام‌هایی که به صورت <code
                  class="literal">user@machine</code> باشند: نشانی باید به صورت <code
                  class="literal">user@machine.example.com</code> یا <code
                  class="literal">user@example.com</code> اعلام گردد.
				</div></div><div
              class="section"><div
                class="titlepage"><div><div><h4
                      class="title"><a
                        id="id-1.14.4.9.7"></a>11.1.3.4. پذیرش یا رد مبتنی بر گیرنده</h4></div></div></div><div
                class="para">
					هر ایمیل حداقل یک گیرنده دارد، که توسط دستور <code
                  class="literal">RCPT TO</code> از پروتکل SMTP معرفی می‌شود. این نشانی‌ها همچنین عملیات اعتبارسنجی را تضمین می‌کنند، حتی اگر از بررسی‌های انجام شده روی نشانی فرستنده مشخص نباشد.
				</div><a
                id="id-1.14.4.9.7.3"
                class="indexterm"></a><a
                id="id-1.14.4.9.7.4"
                class="indexterm"></a><div
                class="example"><a
                  id="id-1.14.4.9.7.5"></a><p
                  class="title"><strong>
      مثال 11.9. بررسی‌های گیرنده</strong></p><div
                  class="example-contents"><pre
                    class="programlisting">
smtpd_recipient_restrictions = permit_mynetworks, 
    reject_unauth_destination, reject_unlisted_recipient, 
    reject_non_fqdn_recipient</pre></div></div><div
                class="para">
					<code
                  class="literal">reject_unauth_destination</code> قانون پایه‌ای است که پیام‌های خارجی را ملزم می‌سازد نشانی ما را داشته باشند؛ پیام‌هایی که به نشانی خارج از محدوده پوشش این سرور فرستاده شوند رد می‌شوند. بدون این قانون، یک سرور به سیستم بازی تبدیل می‌شود که به اسپمرها اجازه می‌دهد پیام‌های ناخواسته خود را ارسال کنند؛ بنابراین این قانون الزامی است و بهتر است که در قسمت ابتدایی فهرست قرار گیرد، تا قبل از مشخص نشدن گیرنده یک پیام، هیچ قانون دیگری نتواند آن را بررسی کند.
				</div><div
                class="para">
					قانون <code
                  class="literal">reject_unlisted_recipient</code> پیام‌های ارسالی به کاربران غیرواقعی را رد می‌کند، که با عقل جور در می‌آید. در نهایت، قانون <code
                  class="literal">reject_non_fqdn_recipient</code> نشانی‌هایی که تمام-عیار نباشند را رد می‌کند؛ این قانون منجر می‌شود که پیام به <code
                  class="literal">jean</code> یا <code
                  class="literal">jean@machine</code> ارسال نشود و نیازمند نشانی کامل می‌باشد از جمله <code
                  class="literal">jean@machine.falcot.com</code> یا <code
                  class="literal">jean@falcot.com</code>.
				</div></div><div
              class="section"><div
                class="titlepage"><div><div><h4
                      class="title"><a
                        id="id-1.14.4.9.8"></a>11.1.3.5. محدودیت‌های مرتبط با دستور <code
                        class="literal">DATA</code></h4></div></div></div><div
                class="para">
					دستور <code
                  class="literal">DATA</code> از پروتکل SMTP قبل از محتوای پیام قرار می‌گیرد. با اینکه هیچ اطلاعات خاصی را فراهم نمی‌کند، بجز معرفی قسمت بعدی، می‌تواند مورد بررسی قرار گیرد.
				</div><a
                id="id-1.14.4.9.8.3"
                class="indexterm"></a><div
                class="example"><a
                  id="id-1.14.4.9.8.4"></a><p
                  class="title"><strong>
      مثال 11.10. بررسی‌های <code
                      class="literal">DATA</code></strong></p><div
                  class="example-contents"><pre
                    class="programlisting">
smtpd_data_restrictions = reject_unauth_pipelining</pre></div></div><div
                class="para">
					عبارت <code
                  class="literal">reject_unauth_pipelining</code> زمانی منجر به رد پیام می‌شود که فرستنده آن دستوری را قبل از پاسخ به دستور قبلی فرستاده باشد. این عملکرد در مقابل شیوه کار ربات‌های اسپمر قرار می‌گیرد، چرا که آن‌ها اغلب اهمیتی به پاسخ‌ها نمی‌دهند و تمرکز خود را روی ارسال بیشترین پیام در کمترین زمان معطوف می‌سازند.
				</div></div><div
              class="section"><div
                class="titlepage"><div><div><h4
                      class="title"><a
                        id="id-1.14.4.9.9"></a>11.1.3.6. اعمال محدودیت‌ها</h4></div></div></div><div
                class="para">
					با اینکه دستورات بالا اطلاعات را در مرحله‌های گوناگونی از فرآیند تبادل SMTP بررسی می‌کنند، Postfix عملیات رد پیام را در پاسخ به دستور <code
                  class="literal">RCPT TO</code> ارسال می‌کند.
				</div><div
                class="para">
					یعنی حتی اگر پیام مبتنی بر یک دستور نامعتبر ... رد شده باشد، Postfix از فرستنده و گیرنده پیام هنگام اعلام رد آن آگاه است. در این مرحله است که می‌تواند پیام مرتبط‌تری را در فایل‌های گزارش قرار دهد تا اینکه همان ابتدای کار این فرآیند متوقف می‌شد. علاوه بر این، تعدادی از برنامه‌های SMTP انتظار شکست عملیات در همان دستورات ابتدایی SMTP را ندارند و این برنامه‌ها کمتر با این عملیات رد دیرموقع، مختل می‌‌شوند.
				</div><div
                class="para">
					مزیت نهایی این انتخاب این است که قوانین می‌توانند طی مراحل مختلف تبادل SMTP اطلاعات زیادی کسب کنند؛ این باعث می‌شود مجوزهای بهتری را بتوان تعریف کرد، از جمله رد یک ارتباط غیر-محلی که خود را به عنوان یک فرستنده محلی معرفی کرده باشد.
				</div></div><div
              class="section"><div
                class="titlepage"><div><div><h4
                      class="title"><a
                        id="id-1.14.4.9.10"></a>11.1.3.7. فیلترکردن مبتنی بر محتوای پیام</h4></div></div></div><div
                class="para">
					سیستم ارزیابی و ایجاد محدودیت بدون ایجاد روشی برای بررسی متن پیام کامل نیست. Postfix بین بررسی‌های انجام گرفته روی سرآیند ایمیل و بدنه آن تفاوت قائل می‌شود.
				</div><div
                class="example"><a
                  id="id-1.14.4.9.10.3"></a><p
                  class="title"><strong>
      مثال 11.11. فعال‌سازی فیلترهای محتوا-محور</strong></p><div
                  class="example-contents"><pre
                    class="programlisting">
header_checks = regexp:/etc/postfix/header_checks
body_checks = regexp:/etc/postfix/body_checks</pre></div></div><a
                id="id-1.14.4.9.10.4"
                class="indexterm"></a><div
                class="para">
					هر دو فایل شامل فهرستی از عبارت‌های منظم (که به نام <span
                  class="emphasis"><em>regexps</em></span> یا <span
                  class="emphasis"><em>regexes</em></span> نیز شاخته می‌شوند) و اقدامات مربوط به هر کدام در صورت تطبیق سرآیند یا بدنه ایمیل با آن‌ها می‌باشند.
				</div><div
                class="sidebar"><div
                  class="titlepage"><div><div><p
                        class="title"><strong><span
                            class="emphasis"><em>نگاه سریع</em></span> جدول‌های Regexp</strong></p></div></div></div><div
                  class="para">
					فایل <code
                    class="filename">/usr/share/doc/postfix-doc/examples/header_checks.gz</code> شامل توضیحاتی است که می‌تواند به عنوان نقطه آغازی برای ایجاد فایل‌های <code
                    class="filename">/etc/postfix/header_checks</code> و <code
                    class="filename">/etc/postfix/body_checks</code> بکار رود.
				</div></div><div
                class="example"><a
                  id="id-1.14.4.9.10.7"></a><p
                  class="title"><strong>
      مثال 11.12. نمونه فایل <code
                      class="filename">/etc/postfix/header_checks</code></strong></p><div
                  class="example-contents"><pre
                    class="programlisting">
/^X-Mailer: GOTO Sarbacane/ REJECT I fight spam (GOTO Sarbacane)
/^Subject: *Your email contains VIRUSES/ DISCARD virus notification</pre></div></div><div
                class="sidebar"><a
                  id="sidebar.regexp"></a><div
                  class="titlepage"><div><div><p
                        class="title"><strong><span
                            class="emphasis"><em>بازگشت به مقدمات</em></span> عبارت منظم</strong></p></div></div></div><div
                  class="para">
					اصطلاح <span
                    class="emphasis"><em>regular expression</em></span> (که به طور مخفف <span
                    class="emphasis"><em>regexp</em></span> یا <span
                    class="emphasis"><em>regex</em></span> خوانده می‌شود) به یک شیوه نگارش عمومی از توضیح درباره محتوا و/یا ساختار رشته‌ای از کاراکترها گفته می‌شود. برخی کاراکترهای خاص امکان تعریف جایگزین را می‌دهند (برای نمونه، <code
                    class="literal">foo|bar</code> برابر با “foo” یا “bar” است)، مجموعه‌ای از کاراکترهای مجاز (برای نمونه، <code
                    class="literal">[0-9]</code> به معنی هر رقم و <code
                    class="literal">.</code> - یک نقطه - به معنی هر کاراکتر است)، کمیت رشته‌ها (<code
                    class="literal">s?</code> برابر با <code
                    class="literal">s</code> یا رشته خالی، به عبارت دیگر ۰ یا ۱ تکرار از <code
                    class="literal">s</code>؛ <code
                    class="literal">s+</code> برابر با ۱ یا تعداد بیشتر از <code
                    class="literal">s</code> و به همین ترتیب). پرانتزها امکان گروه‌بندی نتایج جستجو را فراهم می‌آورند.
				</div><div
                  class="para">
					شیوه نگارش دقیق این عبارت‌ها بسته به ابزارهای استفاده کننده از آن متفاوت است، اما از اصول پایه یکسانی استفاده می‌کنند. <div
                    class="url">→ <a
                      href="http://en.wikipedia.org/wiki/Regular_expression">http://en.wikipedia.org/wiki/Regular_expression</a></div>
				</div></div><div
                class="para">
					اولی به بررسی سرآیند می‌پردازد که آیا شامل نرم‌افزار ایمیل هست یا خیر؛ اگر <code
                  class="literal">GOTO Sarbacane</code> (یک نرم‌افزار ایمیل انبوه) پیدا شد، پیام رد می‌شود. عبارت دوم نیز به بررسی محتوای پیام می‌پردازد؛ اگر شامل یک اطلاعیه ویروس باشد، می‌توان تصمیم گرفت بجای رد ایمیل، آن را نادیده بگیریم.
				</div><div
                class="para">
					استفاده از این فیلترها مانند راه رفتن روی لبه تیغ است، چرا که در صورت عمومی در نظر گرفتن این قوانین ممکن است بسیاری از ایمیل‌های معتبر و قانونی را از دست بدهیم. در این موارد، نه تنها پیام‌ها از دست می‌روند، بلکه برای فرستندگان آنان نیز پیام‌های خطای آزاردهنده ارسال می‌گردد.
				</div></div></div><div
            class="section"><div
              class="titlepage"><div><div><h3
                    class="title"><a
                      id="sect.setting-up-greylisting"></a>11.1.4. برپایی <span
                      class="foreignphrase"><em
                        class="foreignphrase">فهرست خاکستری</em></span></h3></div></div></div><a
              id="id-1.14.4.10.2"
              class="indexterm"></a><div
              class="para">
				"فهرست خاکستری" یک تکنیک فیلترکردن است به طوری که در ابتدا پیام به صورت موقت رد می‌شود و در صورت گذشت یک بازه زمانی و تلاش مجدد، مورد پذیرش قرار می‌گیرد. این تکنیک اغلب در مورد رایانه‌هایی که توسط کرم‌ها و ویروس‌ها آلوده شده‌اند به خوبی جواب می‌دهد، چرا که این گونه نرم‌افزارها به ندرت به عنوان یک برنامه کامل SMTP عمل می‌کنند (با بررسی کد خطا و تلاش مجدد برای ارسال پیام در زمان دیگر)، به خصوص که بسیاری از نشانی‌های برداشت شده برای اینکار در حقیقت نامعتبر هستند و تلاش مجدد برای ارسال فقط به معنی اتلاف زمان است.
			</div><div
              class="para">
				Postfix به خودی خود شامل فهرست خاکستری نیست، اما گزینه‌ای وجود دارد که تصمیم‌گیری برای پذیرش یا رد یک پیام را می‌توان به یک برنامه خارجی سپرد. بسته <span
                class="pkg pkg">postgrey</span> شامل همین عملکرد است، که به منظور سیاست دسترسی به عنوان سرویس نماینده طراحی شده است.
			</div><div
              class="para">
				زمانی که <span
                class="pkg pkg">postgrey</span> نصب شود، به عنوان یک فرآیند پس‌زمینه به درگاه ۱۰۰۲۳ گوش می‌کند. سپس می‌توان با تنظیم پارامتر <code
                class="literal">check_policy_service</code> در Postfix، آن را به این منظور پیکربندی کرد:
			</div><pre
              class="programlisting">
smtpd_recipient_restrictions = permit_mynetworks,
    [...]
    check_policy_service inet:127.0.0.1:10023</pre><div
              class="para">
				هر زمان که Postfix به این قانون می‌رسد، به فرآیند پس‌زمینه <code
                class="command">postgrey</code> متصل شده و اطلاعات مرتبط با پیام را به آن ارسال می‌کند. Postgrey در سمت خود، سه‌گانه نشانی IP/فرستنده/گیرنده را برای وجود در پایگاه‌داده خود مورد بررسی قرار می‌دهد. اگر وجود داشت، Postgrey اطلاع می‌دهد که پیام باید پذیرفته شود؛ در غیر اینصورت، پاسخی که نشان‌دهنده رد موقتی پیام است به همراه سه‌گانه مذکور در پایگاه‌داده خود ذخیره‌سازی می‌کند.
			</div><div
              class="para">
				اشکال اصلی فهرست خاکستری این است که پیام‌های قانونی با تاخیر مواجه می‌شوند، که برای همیشه قابل قبول نیست. همچنین بار سرورهایی که بسیاری ایمیل‌های قانونی را ارسال می‌کنند، افزایش می‌‌دهد.
			</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>در عمل</em></span> نقطه ضعف فهرست خاکستری</strong></p></div></div></div><div
                class="para">
				به لحاظ نظری، فهرست خاکستری تنها باید اولین پیام ارسالی از یک فرستنده به گیرنده را با تاخیر همراه سازد، که این تاخیر در حد چند دقیقه است. اما حقیقت چیزی دیگری است. برخی شرکت‌های بزرگ ارائه‌دهنده خدمات اینترنت، خوشه‌ای از سرورهای SMTP را استفاده می‌کنند و زمانی که یک پیام در ابتدا رد می‌شود، سروری که به این کد خطا پاسخ می‌دهد الزاما با سروری که پیام اولیه را فرستاده است، یکسان نیست. زمانی که این اتفاق می‌افتد، سرور دوم نیز این پیام خطای موقت را دریافت می‌کند و به همین ترتیب؛ ممکن است چندین ساعت طول بکشد تا همان سرور اولیه به مسیر تبادل پیام بازگردد، چرا که سرورهای SMTP با هر بار مواجه پیام خطا، زمان ارسال مجدد آن را افزایش می‌دهند.
			</div><div
                class="para">
				به عنوان یک پیامد، نشانی IP دریافتی حتی برای یک فرستنده نیز می‌تواند در طول زمان تغییر کند. اما مشکل دیگری نیز وجود دارد: حتی نشانی فرستنده نیز می‌تواند تغییر کند. برای نمونه، بسیاری سروهای میلینگ-لیست به منظور تعامل با پیام‌های خطا اقدام به رمزگذاری اطلاعات اضافی در قسمت نشانی فرستنده می‌کنند (که به عنوان <span
                  class="emphasis"><em>bounces</em></span> شناخته می‌شود). هر پیام جدید که به میلینگ-لیست ارسال می‌شود نیاز به عبور از فهرست خاکستری را دارد، که به معنی ذخیره‌سازی (موقت) آن در سرور فرستنده است. برای میلینگ‌-لیست‌های بسیار بزرگ (با ده‌ها هزار مشترک) این امر به زودی مشکل بزرگی می‌شود.
			</div><div
                class="para">
				برای مقابله با این مشکلات، Postgrey فهرست سفیدی از چنین سایت‌هایی را مدیریت می‌کند و پیام‌هایی که از آن‌ها ارسال شود را بدون عبور از فهرست خاکستری مورد پذیرش قرار می‌دهد. این فهرست به سادگی می‌تواند برای نیازهای شبکه محلی سازگار شود، چرا که در فایل <code
                  class="filename">/etc/postgrey/whitelist_clients</code> قرار گرفته است.
			</div></div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>مطالعه بیشتر</em></span> فهرست خاکستری انتخابی با استفاده از <span
                          class="pkg pkg">milter-greylist</span></strong></p></div></div></div><div
                class="para">
				اشکالات موجود در فهرست خاکستری می‌تواند با اعمال آن‌ها بر مجموعه‌ای از رایانه‌ها که منبع احتمالی اسپم هستند، رفع گردد (چرا که آن‌ها در یک فهرست سیاه DNS قرار می‌گیرند). اینکار با استفاده از <span
                  class="pkg pkg">postgrey</span> ممکن نیست اما از <span
                  class="pkg pkg">milter-greylist</span> برای چنین مواقعی استفاده می‌گردد.
			</div><div
                class="para">
				در این سناریو، از آنجا که فهرست‌های سیاه DNS منجر به رد قعطی یک پیام نمی‌شود، استفاده از فهرست‌های سیاه تهاجمی منطقی به نظر می‌رسد، از جمله آن‌هایی که نشانی‌های IP پویا رایانه‌های ISP را شامل می‌شوند (از جمله <code
                  class="literal">pbl.spamhaus.org</code> یا <code
                  class="literal">dul.dnsbl.sorbs.net</code>).
			</div><div
                class="para">
				از آنجا که milter-greylist از رابط milter در Sendmail استفاده می‌کند، پیکربندی قسمت postfix آن محدود است به “<code
                  class="literal">smtpd_milters = unix:/var/run/milter-greylist/milter-greylist.sock</code>”. صفحه راهنمای <span
                  class="citerefentry"><span
                    class="refentrytitle">greylist.conf</span>(5)</span> به مستندسازی <code
                  class="filename">/etc/milter-greylist/greylist.conf</code> و راه‌های مختلف برای پیکربندی <code
                  class="filename">/etc/default/milter-greylist</code> می‌پردازد. برای فعال‌سازی این سرویس همچنین باید ... را ویرایش کنید.
			</div></div></div><div
            class="section"><div
              class="titlepage"><div><div><h3
                    class="title"><a
                      id="id-1.14.4.11"></a>11.1.5. سفارشی‌سازی فیلترها مبتنی بر گیرنده</h3></div></div></div><div
              class="para">
				قسمت‌های <a
                class="xref"
                href="network-services.html#sect.restrictions-for-receiving-and-sending">
      قسمت 11.1.3, “محدودیت برای ارسال و دریافت”
    </a> و <a
                class="xref"
                href="network-services.html#sect.setting-up-greylisting">
      قسمت 11.1.4, “برپایی <span
                  class="foreignphrase"><em
                    class="foreignphrase">فهرست خاکستری</em></span>”
    </a> بسیاری محدودیت‌های ممکن را بررسی کرده‌اند. همگی آن‌ها کاربرد خود برای محدودکردن بخشی از اسپم‌ها را دارند اما شامل نواقصی نیز هستند. بنابراین بسیار متداول است که مجموعه فیلترهای بکار رفته روی گیرنده را سفارشی‌سازی کرد. در شرکت فالکوت، استفاده از فهرست خاکستری در کار اغلب کاربران مشکلی بوجود نمی‌آورد اما برخی نیز نیاز به تاخیر بسیار کمی در کار خود دارند (از جمله واحد پشتیبانی فنی). به همین شکل، واحد تجاری گاهی اوقات مشکلاتی با برخی مشتریان آسیایی دارد که در فهرست سیاه قرار گرفته‌اند؛ این واحد درخواست یک نشانی بدون فیلتر به منظور مکاتبه با آن‌ها را دارد.
			</div><div
              class="para">
				Postfix با استفاده از مفهوم “کلاس محدودیت” امکان سفارشی‌سازی فیلترها را فراهم می‌کند. کلاس‌ها در پارامتر <code
                class="literal">smtpd_restriction_classes</code> قرار گرفته و به شیوه مشابه <code
                class="literal">smtpd_recipient_restrictions</code> تعریف شده‌اند. عبارت <code
                class="literal">check_recipient_access</code> نگاشتی بین یک گیرنده و مجموعه‌ای از محدودیت‌های آن برقرار می‌کند.
			</div><div
              class="example"><a
                id="id-1.14.4.11.4"></a><p
                class="title"><strong>
      مثال 11.13. تعریف کلاس‌های محدودیت در <code
                    class="filename">main.cf</code></strong></p><div
                class="example-contents"><pre
                  class="programlisting">smtpd_restriction_classes = greylisting, aggressive, permissive

greylisting = check_policy_service inet:127.0.0.1:10023
aggressive = reject_rbl_client sbl-xbl.spamhaus.org,
        check_policy_service inet:127.0.0.1:10023
permissive = permit

smtpd_recipient_restrictions = permit_mynetworks,
        reject_unauth_destination,
        check_recipient_access hash:/etc/postfix/recipient_access</pre></div></div><div
              class="example"><a
                id="id-1.14.4.11.5"></a><p
                class="title"><strong>
      مثال 11.14. فایل <code
                    class="filename">/etc/postfix/recipient_access</code></strong></p><div
                class="example-contents"><pre
                  class="programlisting">
# Unfiltered addresses
postmaster@falcot.com  permissive
support@falcot.com     permissive
sales-asia@falcot.com  permissive

# Aggressive filtering for some privileged users
joe@falcot.com         aggressive

# Special rule for the mailing-list manager
sympa@falcot.com       reject_unverified_sender

# Greylisting by default
falcot.com             greylisting</pre></div></div></div><div
            class="section"><div
              class="titlepage"><div><div><h3
                    class="title"><a
                      id="sect.postfix-antivirus"></a>11.1.6. یکپارچه‌سازی آنتی‌ویروس</h3></div></div></div><a
              id="id-1.14.4.12.2"
              class="indexterm"></a><div
              class="para">
				طیف گسترده ویروس‌هایی که به عنوان فایل ضمیمه در ایمیل‌ها قرار می‌گیرند نیاز به استفاده از یک آنتی‌ویروس در نقطه ابتدایی شبکه شرکت را با اهمیت می‌سازد، چرا که با وجود آگاهی‌رسانی‌های بسیار، هنوز برخی کاربران اقدام به باز کردن فایل‌های ضمیمه پیام‌های ناخواسته می‌کنند.
			</div><div
              class="para">
				مدیرسیستم‌های فالکوت <code
                class="command">clamav</code> را به عنوان آنتی‌ویروس آزاد خود انتخاب کرده‌اند. بسته اصلی <span
                class="pkg pkg">clamav</span> نام دارد، اما آن‌ها اقدام به نصب بسته‌های اضافی از جمله <span
                class="pkg pkg">arj</span>، <span
                class="pkg pkg">unzoo</span>، <span
                class="pkg pkg">unrar</span> و <span
                class="pkg pkg">lha</span> نیز کرده‌اند چرا که استفاده از این بسته‌ها به منظور بررسی محتوای فایل‌های ضمیمه با قالب‌های مختلف مورد نیاز است.
			</div><a
              id="id-1.14.4.12.5"
              class="indexterm"></a><a
              id="id-1.14.4.12.6"
              class="indexterm"></a><div
              class="para">
				وظیفه برقراری ارتباط بین آنتی‌ویروس و سرور ایمیل بر عهده <code
                class="command">clamav-milter</code> است. یک <span
                class="emphasis"><em>milter</em></span> (که مخفف <span
                class="emphasis"><em>mail filter</em></span> است) یک برنامه فیلترکردن بخصوص است که برای تعامل با سرورهای ایمیل طراحی شده است. یک milter از یک رابط استاندارد برنامه‌نویسی یا API استفاده می‌کند که عملکرد بهتری در مقایسه با فیلترهای خارجی برای سرورهای ایمیل فراهم می‌کند. milterها در ابتدا توسط <span
                class="emphasis"><em>Sendmail</em></span> معرفی شدند اما <span
                class="emphasis"><em>Postfix</em></span> به زودی از آن‌ها پشتیبانی کرد.
			</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>نگاه سریع</em></span> فیلتر ایمیل برای Spamassassin</strong></p></div></div></div><a
                id="id-1.14.4.12.8.2"
                class="indexterm"></a><div
                class="para">
				بسته <span
                  class="pkg pkg">spamass-milter</span> فیلتر ایمیلی مبتنی بر <span
                  class="emphasis"><em>SpamAssassin</em></span> فراهم می‌کند، برنامه معروف شناسایی ایمیل ناخواسته. می‌تواند برای پرچم‌گذاری پیام‌ها به عنوان اسپم احتمالی استفاده شود (با افزودن یک سرآیند اضافی) و/یا رد پیام‌هایی که امتیاز “spamminess” آن‌ها بیش از محدوده استاندارد باشد.
			</div></div><div
              class="para">
				زمانی که بسته <span
                class="pkg pkg">clamav-milter</span> نصب شود، فیلتر ایمیل باید به گونه‌ای پیکربندی شود که روی یک درگاه TCP جدا از مقدار پیشفرض سوکت نامگذاری شده قرار بگیرد. اینکار با استفاده از <code
                class="command">dpkg-reconfigure clamav-milter</code> صورت می‌گیرد. زمانی که پرسش “Communication interface with Sendmail” مطرح می‌شود، “<code
                class="literal">inet:10002@127.0.0.1</code>” را پاسخ دهید.
			</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>یادداشت</em></span> درگاه واقعی TCP در مقایسه با سوکت نامگذاری شده</strong></p></div></div></div><div
                class="para">
				دلیلی که از درگاه واقعی TCP بجای سوکت نامگذاری شده استفاده می‌کنیم این است که فرآیندهای پس‌زمینه postfix اغلب به صورت chroot شده اجرا می‌گردند که در این حالت به دایرکتوری قرار گرفته در سوکت نامگذاری شده دسترسی ندارند. همچنین می‌توانید تصمیم بگیرید که هنگام استفاده از سوکت نامگذاری شده از یک محل درون chroot (<code
                  class="filename">/var/spool/postfix/</code>) استفاده کنید.
			</div></div><div
              class="para">
				پیکربندی استاندارد ClamAV برای اکثر موقعیت‌های مناسب است، اما برخی پارامترهای مهم هنوز می‌توانند با استفاده از دستور <code
                class="command">dpkg-reconfigure clamav-base</code> سفارشی گردند.
			</div><div
              class="para">
				گام آخر اطلاع‌رسانی به Postfix درباره فیلتر تازه-پیکربندی شده است که به سادگی افزودن عبارت زیر به <code
                class="filename">/etc/postfix/main.cf</code> است:
			</div><pre
              class="programlisting">
# Virus check with clamav-milter
smtpd_milters = inet:[127.0.0.1]:10002</pre><div
              class="para">
				اگر آنتی‌ویروس مشکلاتی را بوجود آورد، می‌توان این خط را حذف و با اجرای دستور <code
                class="command">service postfix reload</code> تغییرات اعمال شده را تنظیم کرد.
			</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>در عمل</em></span> آزمایش آنتی‌ویروس</strong></p></div></div></div><div
                class="para">
				زمانی که آنتی‌ویروس برپا شود، عملکرد صحیح آن باید مورد آزمایش قرار گیرد. ساده‌ترین راه برای اینکار ارسال یک ایمیل همراه با فایل ضمیمه <code
                  class="filename">eicar.com</code> (یا <code
                  class="filename">eicar.com.zip</code>) است، که می‌تواند به صورت آنلاین نیز دانلود شود: <div
                  class="url">→ <a
                    href="http://www.eicar.org/86-0-Intended-use.html">http://www.eicar.org/86-0-Intended-use.html</a></div>
			</div><div
                class="para">
				این فایل یک ویروس واقعی نیست، بلکه به عنوان فایل آزمایشی توسط تمام آنتی‌ویروس‌های موجود در بازار به منظور آزمایش عملکرد صحیح برنامه مورد استفاده قرار می‌گیرد.
			</div></div><div
              class="para">
				اکنون تمام پیام‌های ارسالی به Postfix از طریق فیلتر آنتی‌ویروس عبور داده می‌شوند.
			</div></div><div
            class="section"><div
              class="titlepage"><div><div><h3
                    class="title"><a
                      id="sect.authenticated-smtp"></a>11.1.7. SMTP احرازهویت شده</h3></div></div></div><div
              class="para">
				به منظور امکان ارسال ایمیل ابتدا باید به سرور SMTP دسترسی داشت؛ همچنین نیازمند سرور SMTP گفته شده به منظور ارسال ایمیل از درون خود است. برای کاربران رومینگ، اینکار نیازمند تغییر مداوم پیکربندی برنامه SMTP است چرا که سرور SMTP فالکوت پیام‌هایی را که نشانی‌های IP خارج از شرکت را داشته باشند رد می‌کند. دو راه حل موجود است: یا کاربر رومینگ سرور SMTP را روی رایانه خود نصب کند یا کماکان به شیوه‌ای از سرور شرکت استفاده کنند که به عنوان یک کارمند احرازهویت شوند. راه اول توصیه نمی‌شود چرا که رایانه ممکن است همیشه متصل نباشد و در صورت بروز مشکل امکان ارسال مجدد پیام وجود نخواهد داشت؛ ما روی راه حل دوم تمرکز می‌کنیم.
			</div><div
              class="para">
				احرازهویت SMTP در Postfix نیازمند SASL یا <span
                class="emphasis"><em>Simple Authentication and Security Layer</em></span> است. اینکار نیازمند نصب بسته‌های <span
                class="pkg pkg">libsasl2-modules</span> و <span
                class="pkg pkg">sasl2-bin</span>، سپس ثبت گذرواژه در پایگاه‌داده SASL برای هر کاربری که نیازمند احرازهویت با استفاده از سرور SMTP است. اینکار با استفاده از دستور <code
                class="command">saslpasswd2</code> انجام می‌شود که چندین پارامتر را دریافت می‌کند. گزینه <code
                class="literal">-u</code> دامنه احرازهویت را تعریف می‌کند که باید با پارامتر <code
                class="literal">smtpd_sasl_local_domain</code> در پیکربندی Postfix یکسان باشد. گزینه <code
                class="literal">-c</code> اجازه تعریف یک کاربر جدید و <code
                class="literal">-f</code> اجازه تعریف فایل پیکربندی آن را می‌دهد در صورتی که نیاز باشد پایگاه‌داده SASL در مسیر دیگری بجز <code
                class="filename">/etc/sasldb2</code> قرار بگیرد.
			</div><pre
              class="screen scale">
<code
                class="computeroutput"># </code><strong
                class="userinput"><code>saslpasswd2 -u `postconf -h myhostname` -f /var/spool/postfix/etc/sasldb2 -c jean</code></strong>
<code
                class="computeroutput">[... type jean's password twice ...]</code></pre><div
              class="para">
				نکته اینکه پایگاه‌داده SASL در دایرکتوی Postfix ایجاده شده است. به منظور حصوص اطمینان از یکپارچگی، فایل <code
                class="filename">/etc/sasldb2</code> را با دستور <code
                class="command">ln -sf /var/spool/postfix/etc/sasldb2 /etc/sasldb2</code> به یک پیوند نمادین پایگاه‌داده مورد استفاده Postfix تبدیل کرده‌ایم.
			</div><div
              class="para">
				اکنون نیازمند پیکربندی Postfix برای استفاده از SALS هستیم. ابتدا کاربر <code
                class="literal">postfix</code> باید به گروه <code
                class="literal">sasl</code> اضافه گردد تا بتواند به پایگاه‌داده SASL دسترسی داشته باشد. برای فعال‌سازی SASL به چندین پارامتر دیگر نیاز است و پارامتر <code
                class="literal">smtpd_recipient_restrictions</code> نیز به منظور اجازه به برنامه‌های احرازهویت شده با SASL برای ارسال ایمیل، مورد نیاز است.
			</div><div
              class="example"><a
                id="id-1.14.4.13.7"></a><p
                class="title"><strong>
      مثال 11.15. فعال‌سازی SASL در <code
                    class="filename">/etc/postfix/main.cf</code></strong></p><div
                class="example-contents"><pre
                  class="programlisting">
# Enable SASL authentication
smtpd_sasl_auth_enable = yes
# Define the SASL authentication domain to use
smtpd_sasl_local_domain = $myhostname
[...]
# Adding permit_sasl_authenticated before reject_unauth_destination
# allows relaying mail sent by SASL-authenticated users
smtpd_recipient_restrictions = permit_mynetworks,
    permit_sasl_authenticated,
    reject_unauth_destination,
[...]</pre></div></div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>اضافی</em></span> برنامه SMTP احرازهویت شده</strong></p></div></div></div><div
                class="para">
				اکثر برنامه‌های ایمیل قبل از ارسال پیام‌های خارجی، قادر به احزارهویت توسط سرور SMTP هستند که استفاده از این ویژگی به سادگی پیکربندی چند پارامتر متناسب با آن است. اگر برنامه مورد نظر چنین قابلیتی نداشته باشد، راهکار پیشنهادی استفاده از یک سرور Postfix محلی به منظور ارسال مجدد ایمیل از طریق سرور SMTP راه‌دور است. در این مورد، خود Postfix محلی برنامه‌ای است که با SASL احرازهویت می‌شود. پارامترهای مورد نیاز عبارتند از:
			</div><pre
                class="programlisting">
smtp_sasl_auth_enable = yes
smtp_sasl_password_maps = hash:/etc/postfix/sasl_passwd
relay_host = [mail.falcot.com]</pre><div
                class="para">
				فایل <code
                  class="filename">/etc/postfix/sasl_passwd</code> باید شامل نام کاربری و گذرواژه مورد نیاز برای احرازهویت در سرور <code
                  class="literal">mail.falcot.com</code> است. برای نمونه:
			</div><pre
                class="programlisting">
[mail.falcot.com]   joe:LyinIsji</pre><div
                class="para">
				مانند تمام نگاشت‌های Postfix، نیاز است که این فایل توسط دستور <code
                  class="command">postmap</code> به <code
                  class="filename">/etc/postfix/sasl_passwd.db</code> تبدیل شود.
			</div></div></div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="sect.network-diagnosis-tools.html"><strong>قبلی</strong>10.8. ابزار بررسی شبکه</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>بالا</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>خانه</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.http-web-server.html"><strong>بعدی</strong>11.2. سرور وب (HTTP)</a></li></ul><div
        id="translated_pages"><ul><li><a
              href="../ar-MA/network-services.html">ar-MA</a></li><li><a
              href="../da-DK/network-services.html">da-DK</a></li><li><a
              href="../de-DE/network-services.html">de-DE</a></li><li><a
              href="../el-GR/network-services.html">el-GR</a></li><li><a
              href="../en-US/network-services.html">en-US</a></li><li><a
              href="../es-ES/network-services.html">es-ES</a></li><li><a
              href="../fa-IR/network-services.html">fa-IR</a></li><li><a
              href="../fr-FR/network-services.html">fr-FR</a></li><li><a
              href="../hr-HR/network-services.html">hr-HR</a></li><li><a
              href="../id-ID/network-services.html">id-ID</a></li><li><a
              href="../it-IT/network-services.html">it-IT</a></li><li><a
              href="../ja-JP/network-services.html">ja-JP</a></li><li><a
              href="../ko-KR/network-services.html">ko-KR</a></li><li><a
              href="../nb-NO/network-services.html">nb-NO</a></li><li><a
              href="../pl-PL/network-services.html">pl-PL</a></li><li><a
              href="../pt-BR/network-services.html">pt-BR</a></li><li><a
              href="../ro-RO/network-services.html">ro-RO</a></li><li><a
              href="../ru-RU/network-services.html">ru-RU</a></li><li><a
              href="../tr-TR/network-services.html">tr-TR</a></li><li><a
              href="../vi-VN/network-services.html">vi-VN</a></li><li><a
              href="../zh-CN/network-services.html">zh-CN</a></li><li><a
              href="../zh-TW/network-services.html">zh-TW</a></li></ul></div></body></html>
