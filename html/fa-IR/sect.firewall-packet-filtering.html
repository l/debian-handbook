<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">14.2. فایروال یا فیلترینگ بسته</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-9-fa-IR-1.0-1" /><meta
        name="keywords"
        content="فایروال, Netfilter, IDS/NIDS" /><link
        rel="home"
        href="index.html"
        title="راهنمای جامع دبیان" /><link
        rel="up"
        href="security.html"
        title="فصل 14. امنیت" /><link
        rel="prev"
        href="security.html"
        title="فصل 14. امنیت" /><link
        rel="next"
        href="sect.supervision.html"
        title="14.3. نظارت: پیشگیری، شناسایی، بازدارندگی" /><meta
        name="viewport"
        content="width=device-width, initial-scale=1" /><meta
        name="flattr:id"
        content="4pz9jq" /><link
        rel="canonical"
        href="http://l.github.io/debian-handbook/html/fa-IR/sect.firewall-packet-filtering.html" /></head><body
      dir="rtl"><noscript><iframe
          src="//www.googletagmanager.com/ns.html?id=GTM-5H35QX"
          height="0"
          width="0"
          style="display:none;visibility:hidden"></iframe></noscript><script
        type="text/javascript">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&amp;l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5H35QX');</script><div
        id="banner"><a
          href="../../"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="index.html"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="security.html"><strong>قبلی</strong></a></li><li
          class="home">راهنمای جامع دبیان</li><li
          class="next"><a
            accesskey="n"
            href="sect.supervision.html"><strong>بعدی</strong></a></li></ul><div
        class="section"><div
          class="titlepage"><div><div><h2
                class="title"><a
                  id="sect.firewall-packet-filtering"></a>14.2. فایروال یا فیلترینگ بسته</h2></div></div></div><a
          id="id-1.17.5.2"
          class="indexterm"></a><a
          id="id-1.17.5.3"
          class="indexterm"></a><div
          class="sidebar"><div
            class="titlepage"><div><div><p
                  class="title"><strong><span
                      class="emphasis"><em>بازگشت به مقدمات</em></span> فایروال</strong></p></div></div></div><a
            id="id-1.17.5.4.2"
            class="indexterm"></a><div
            class="para">
			یک <span
              class="emphasis"><em>فایروال</em></span> تجهیزات رایانه‌ای به صورت سخت‌افزار یا نرم‌افزار است که بسته‌های دریافتی یا ارسالی شبکه (از و یا به شبکه محلی) را مرتب‌سازی کرده و تنها به ماشین‌هایی اجازه دسترسی می‌دهد که شرایط از پیش تعریف شده را داشته باشند.
		</div></div><div
          class="para">
			فایروال یک دروازه فیلترینگ شبکه است که تنها برای بسته‌های ارسالی از میان آن کاربرد دارد. بنابراین، در صورتی که عبور از فایروال تنها مسیر موجود برای این بسته‌ها باشد موثر خواهد بود.
		</div><div
          class="para">
			نبود یک پیکربندی استاندارد (و شعار “فرآیند، نه محصول”) نبود یک راهکار جامع را توضیح می‌دهد. اگرچه، ابزارهایی وجود دارند که پیکربندی فایروال <span
            class="emphasis"><em>netfilter</em></span> با یک نمایش گرافیکی از قوانین فیلترینگ ساده می‌کنند. <code
            class="command">fwbuilder</code> بدون شک یکی از بهترین آن‌ها است.
		</div><a
          id="id-1.17.5.7"
          class="indexterm"></a><div
          class="sidebar"><div
            class="titlepage"><div><div><p
                  class="title"><strong><span
                      class="emphasis"><em>مورد ویژه</em></span> فایروال محلی</strong></p></div></div></div><div
            class="para">
			یک فایروال می‌تواند به یک ماشین بخصوص محدود شود (در مقایسه با یک شبکه کامل)، که در این صورت نقش آن فیلتر یا محدودکردن دسترسی به برخی سرویس‌ها است، یا احتمالا پیشگیری از برقراری ارتباط توسط نرم‌افزارهایی که ممکن است یک کاربر، آگاهانه یا بدون اطلاع، نصب کرده باشد.
		</div></div><div
          class="para">
			کرنل لینوکس شامل فایروال <span
            class="emphasis"><em>netfilter</em></span> می‌باشد. این نرم‌افزار می‌تواند از فضای کاربری توسط دستورات <code
            class="command">iptables</code> و <code
            class="command">ip6tables</code> کنترل شود. تفاوت این دو دستور در نحوه عملکرد آن‌ها روی شبکه‌های IPv4 و IPv6 است. از آنجا که این دو پروتکل شبکه برای سالیان طولانی کار خواهند کرد، نیاز است که از هر دو ابزار به صورت موازی استفاده کنیم.
		</div><a
          id="id-1.17.5.10"
          class="indexterm"></a><a
          id="id-1.17.5.11"
          class="indexterm"></a><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="sect.netfilter"></a>14.2.1. عملکرد Netfilter</h3></div></div></div><div
            class="para">
				<span
              class="emphasis"><em>netfilter</em></span> از چهار جدول متمایز برای ذخیره‌سازی قوانین مرتبط با سه نوع عملیات روی بسته‌ها استفاده می‌کند:
			</div><div
            xmlns:d="http://docbook.org/ns/docbook"
            class="itemizedlist"><ul><li
                class="listitem"><div
                  class="para">
						... برای قوانین فیلترینگ بکار می‌رود (دریافت، امتناع یا رد یک بسته)؛
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">nat</code> برای ترجمه نشانی‌های مبدا، مقصد و درگاه‌های مرتبط با بسته بکار می‌رود؛
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">mangle</code> برای سایر تغییرات اعمال شده در بسته‌های IP بکار می‌رود (از جمله فیلد <span
                    class="emphasis"><em>Type of Service</em></span> و گزینه‌های دیگر)؛
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">raw</code> امکان سایر تغییرات دستی روی بسته‌ها قبل از اینکه به سیستم رهگیری ارتباط برسند را فراهم می‌کند.
					</div></li></ul></div><div
            class="para">
				هر جدول شامل فهرستی از قوانین بنام <span
              class="emphasis"><em>زنجیره</em></span> است. فایروال با استفاده از زنجیره‌های استاندارد بسته‌هایی را که در شرایط خاصی قرار می‌گیرند مدیریت می‌کند. مدیر سیستم می‌تواند زنجیره‌های دیگری را ایجاد کند، که تنها در صورت ارجاع از یک زنجیره استاندارد (به صورت مستقیم یا غیرمستقیم) مورد استفاده قرار می‌گیرند.
			</div><a
            id="id-1.17.5.12.5"
            class="indexterm"></a><a
            id="id-1.17.5.12.6"
            class="indexterm"></a><div
            class="para">
				جدول <code
              class="literal">filter</code> دارای سه زنجیره استاندارد است:
			</div><div
            xmlns:d="http://docbook.org/ns/docbook"
            class="itemizedlist"><ul><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">INPUT</code>: به بسته‌هایی مربوط می‌شود که مقصدشان خود فایروال باشد؛
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">OUTPUT</code>: به بسته‌های ارسال شده از طرف فایروال مربوط می‌شود؛
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">FORWARD</code>: به بسته‌هایی مربوط می‌شود که از میان فایروال می‌گذرند (بسته‌هایی که مبدا یا مقصد فایروال نباشند).
					</div></li></ul></div><div
            class="para">
				جدول <code
              class="literal">nat</code> نیز دارای سه زنجیره استاندارد است:
			</div><div
            xmlns:d="http://docbook.org/ns/docbook"
            class="itemizedlist"><ul><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">PREROUTING</code>: برای تغییر بسته‌ها به محض رسیدن به فایروال؛
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">POSTROUTING</code>: برای تغییر بسته‌ها زمانی که آماده ارسال از فایروال باشند؛
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">OUTPUT</code>: برای تغییر بسته‌هایی که از خود فایروال تولید شده‌اند.
					</div></li></ul></div><div
            class="figure"><a
              id="figure.chaines-netfilter"></a><div
              class="figure-contents"><div
                class="mediaobject"><img
                  src="images/netfilter.png"
                  alt="چگونگی نامگذاری زنجیره‌های netfilter" /></div></div><p
              class="title"><strong>
      شكل 14.1. چگونگی نامگذاری زنجیره‌های <span
                  class="emphasis"><em>netfilter</em></span></strong></p></div><div
            class="para">
				هر زنجیره فهرستی از قوانین است؛ هر قانون مجموعه‌ای از شرایط و اقدامات لازم در صورت برآورده شدن شرط مربوطه است. هنگام پردازش یک بسته، فایروال اقدام به پویش زنجیره مرتبط با آن می‌کند که هر قانون پس از دیگری فراخوانده می‌شود؛ زمانی که شرایط یک قانون برآورده شود، فرآیند به اقدام مربوط به آن “پرش” (گزینه <code
              class="literal">-j</code> در دستورات) کرده تا پردازش ادامه یابد. متداول‌ترین عملکردها به صورت استاندارد هستند که اقدامات اختصاصی مربوط به خود را دارا هستند. استفاده یکی از این اقدامات استاندارد منجر به مختل شدن پردازش زنجیره می‌شود، چرا که سرنوشت بسته از این لحظه رقم خورده است (بجز استثنایی که در ادامه می‌آید):
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>بازگشت به مقدمات</em></span> ICMP</strong></p></div></div></div><div
              class="para">
				ICMP یا <span
                class="emphasis"><em>Internet Control Message Protocol</em></span> پروتکلی است که برای انتقال اطلاعات مکمل ارتباطی استفاده می‌شود. این پروتکل امکان آزمون برقراری شبکه را با استفاده از دستور <code
                class="command">ping</code> صادر می‌کند (که در آن یک پیام <span
                class="emphasis"><em>ICMP Echo Request</em></span> فرستاده می‌شود و گیرنده باید با یک پیام <span
                class="emphasis"><em>ICMP Echo Reply</em></span> پاسخ دهد). هنگام رد بسته توسط فایروال، که overflow در حافظه دریافتی را شامل می‌شود، یک مسیر بهتر برای بسته‌های بعدی هنگام ارتباط پیشنهاد می‌کند. این پروتکل توسط چندین سند RFC تعریف شده است؛ اسناد اولیه RFC777 و RFC792 کامل شده و توسعه یافته‌اند. <div
                class="url">→ <a
                  href="http://www.faqs.org/rfcs/rfc777.html">http://www.faqs.org/rfcs/rfc777.html</a></div> <div
                class="url">→ <a
                  href="http://www.faqs.org/rfcs/rfc792.html">http://www.faqs.org/rfcs/rfc792.html</a></div>
			</div><div
              class="para">
				برای اشاره، بافر دریافتی یک حافظه کوچک برای ذخیره‌سازی داده است که از زمان رسیدن به شبکه تا پردازش توسط کرنل استفاده می‌شود. اگر این منطقه پر باشد، داده جدید نمی‌تواند دریافت شود و ICMP مشکل را مشخص می‌کند تا فرستنده‌ها سرعت انتقال داده را کاهش دهند (که پس از گذشت زمان به نرخ متعادل خود می‌رسد).
			</div><a
              id="id-1.17.5.12.13.4"
              class="indexterm"></a><a
              id="id-1.17.5.12.13.5"
              class="indexterm"></a><a
              id="id-1.17.5.12.13.6"
              class="indexterm"></a><a
              id="id-1.17.5.12.13.7"
              class="indexterm"></a><a
              id="id-1.17.5.12.13.8"
              class="indexterm"></a><div
              class="para">
				به یاد داشته باشید اگرچه یک شبکه IPv4 می‌تواند بدون ICMP کار کند، استفاده از ICMP6 برای یک شبکه IPv6 بشدت مورد نیاز است، چرا که چندین قابلیت که در دنیای IPv4 بوده‌اند را با یکدیگر ترکیب می‌کند، از جمله IGMP یا <span
                class="emphasis"><em>Address Resolution Protocol</em></span> و ARP یا <span
                class="emphasis"><em>Address Resolution Protocol</em></span>. پروتکل ICMP6 در RFC4443 تعریف شده است. <div
                class="url">→ <a
                  href="http://www.faqs.org/rfcs/rfc4443.html">http://www.faqs.org/rfcs/rfc4443.html</a></div>
			</div></div><div
            class="para">
			</div><div
            xmlns:d="http://docbook.org/ns/docbook"
            class="itemizedlist"><ul><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">ACCEPT</code>: اجازه ادامه مسیر به بسته را می‌دهد؛
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">REJECT</code>: بسته را همراه با یک خطای ICMP رد می‌کند (گزینه <code
                    class="literal">--reject-with <em
                      class="replaceable">type</em></code> برای <code
                    class="command">iptables</code> امکان انتخاب نوع خطا را فراهم می‌کند)؛
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">DROP</code>: منجر به حذف (نادیده گرفتن) بسته می‌شود؛
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">LOG</code>: همراه با یک پیام و توضیحات بسته و استفاده از <code
                    class="command">syslogd</code> آن را گزارش می‌کند؛ به یاد داشته باشید که این اقدام پردازش را مختل نمی‌کند و اجرای زنجیره ادامه می‌یابد، به همین دلیل است که عملیات گزارش از بسته‌های شامل قانون LOG و REJECT/DROP امتناع می‌کند؛
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">ULOG</code>: یک پیام را با استفاده از <code
                    class="command">ulogd</code> گزارش می‌کند، که برای مدیریت تعداد بالای پیام نسبت به <code
                    class="command">syslogd</code> عملکرد بهتری دارد؛ به یاد داشته باشید که این اقدام نیز مانند LOG پردازش را به قانون بعدی موجود در زنجیره می‌سپارد؛
					</div></li><li
                class="listitem"><div
                  class="para">
						<em
                    class="replaceable">chain_name</em>: به زنجیره اشاره شده پرش کرده و قوانین آن را ارزیابی می‌کند؛
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">RETURN</code>: پردازش زنجیره فعلی را متوقف کرده و به زنجیره فراخوان باز می‌گردد؛ در حالتی که زنجیره فعلی از نوع استاندارد باشد، فراخوان دیگری وجود ندارد بنابراین اقدام پیشفرض (که با گزینه <code
                    class="literal">-P</code> در <code
                    class="command">iptables</code> مشخص می‌شود) بجای آن اجرا می‌شود؛
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">SNAT</code> (فقط در جدول <code
                    class="literal">nat</code>): <span
                    class="emphasis"><em>Source NAT</em></span> را اعمال می‌کند (گزینه‌های اضافی که تغییرات مورد نظر را شامل می‌شوند)؛
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">DNAT</code> (فقط در جدول <code
                    class="literal">nat</code>): <span
                    class="emphasis"><em>Destination NAT</em></span> را اعمال می‌کند (گزینه‌های اضافی که تغییرات مورد نظر را شامل می‌شوند)؛
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">MASQUERADE</code> (فقط در جدول <code
                    class="literal">nat</code>): <span
                    class="emphasis"><em>masquerading</em></span> را اعمال می‌کند (یک مورد بخصوص از <span
                    class="emphasis"><em>Source NAT</em></span>)؛
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">REDIRECT</code> (فقط در جدول <code
                    class="literal">nat</code>): یک بسته را به درگاه داده شده از خود فایروال هدایت می کند؛ از این گزینه می‌توان برای راه‌اندازی یک پروکسی وب بدون هیچ پیکربندی در سمت برنامه کاربردی استفاده کرد، چرا که برنامه فکر می‌کند به صورت مستقیم به گیرنده متصل شده در حالی که از طریق پروکسی این ارتباط برقرار شده است.
					</div></li></ul></div><div
            class="para">
				سایر اقدامات، بخصوص آن‌هایی که مرتبط با جدول <code
              class="literal">mangle</code> هستند، خارج از محدوده این متن می‌باشند. صفحات راهنمای <span
              class="citerefentry"><span
                class="refentrytitle">iptables</span>(8)</span> و <span
              class="citerefentry"><span
                class="refentrytitle">ip6tables</span>(8)</span> فهرستی از این اقدامات را شامل می‌شوند.
			</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="sect.iptables"></a>14.2.2. شیوه نگارش <code
                    class="command">iptables</code> و <code
                    class="command">ip6tables</code></h3></div></div></div><div
            class="para">
				دستورات <code
              class="command">iptables</code> و <code
              class="command">ip6tables</code> امکان تغییر جدول‌ها، زنجیره‌ها و قوانین را فراهم می‌سازند. گزینه <code
              class="literal">-t <em
                class="replaceable">table</em></code> مشخص می‌کند که عملیات روی کدام جدول انجام شود (به صورت پیشفرض، <code
              class="literal">filter</code>).
			</div><a
            id="id-1.17.5.13.3"
            class="indexterm"></a><a
            id="id-1.17.5.13.4"
            class="indexterm"></a><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      id="sect.iptables-command"></a>14.2.2.1. دستورات</h4></div></div></div><div
              class="para">
					گزینه <code
                class="literal">-N <em
                  class="replaceable">chain</em></code> یک زنجیره جدید ایجاد می‌کند. گزینه <code
                class="literal">-X <em
                  class="replaceable">chain</em></code> یک زنجیره خالی و بدون استفاده را حذف می‌کند. گزینه <code
                class="literal">-A <em
                  class="replaceable">chain</em> <em
                  class="replaceable">rule</em></code> یک قانون به انتهای زنجیره اشاره شده اضافه می‌کند. گزینه <code
                class="literal">-I <em
                  class="replaceable">chain</em> <em
                  class="replaceable">rule_num</em> <em
                  class="replaceable">rule</em></code> یک قانون قبل از قانون شماره <em
                class="replaceable">rule_num</em> درج می‌کند. گزینه <code
                class="literal">-D <em
                  class="replaceable">chain</em> <em
                  class="replaceable">rule_num</em></code> یا <code
                class="literal">-D <em
                  class="replaceable">chain</em> <em
                  class="replaceable">rule</em></code> یک قانون را از زنجیره حذف می‌کند؛ عبارت اول قانون را بر اساس شماره، در حالی که عبارت دوم قانون را بر اساس محتوا شناسایی می‌کند. گزینه <code
                class="literal">-F <em
                  class="replaceable">chain</em></code> یک زنجیره را پاکسازی (حذف تمام قوانین) می‌کند؛ اگر زنجیره‌ای مشخص نشود، تمام قوانین موجود در جدول حذف می‌شوند. گزینه <code
                class="literal">-L <em
                  class="replaceable">chain</em></code> فهرستی از قوانین موجود در زنجیره را نمایش می‌دهد. در نهایت، گزینه <code
                class="literal">-P <em
                  class="replaceable">chain</em> <em
                  class="replaceable">action</em></code> اقدام یا “خط مشی” پیشفرض برای یک زنجیره را مشخص می‌کند؛ به یاد داشته باشید که تنها زنجیره‌های استاندارد می‌توانند چنین خط مشی داشته باشند.
				</div></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      id="sect.iptables-rules"></a>14.2.2.2. قوانین</h4></div></div></div><a
              id="id-1.17.5.13.6.2"
              class="indexterm"></a><div
              class="para">
					هر قانون به صورت <code
                class="literal"><em
                  class="replaceable">conditions</em> -j <em
                  class="replaceable">action</em> <em
                  class="replaceable">action_options</em></code> بیان می‌شود. اگر از چندین شرایط در یک قانون استفاده شود، آنگاه معیار پیوستگی (<span
                class="emphasis"><em>and</em></span> منطقی) شرایط خواهد بود، که به اندازه هر یک از شرایط می‌تواند محدودکننده باشد.
				</div><div
              class="para">
					شرط <code
                class="literal">-p <em
                  class="replaceable">protocol</em></code> با فیلد پروتکل از بسته IP منطبق است. متداول‌ترین مقادیر آن عبارتند از <code
                class="literal">tcp</code>، <code
                class="literal">udp</code>، <code
                class="literal">icmp</code> و <code
                class="literal">icmpv6</code>. قرار دادن یک علامت تعجب قبل از شرط منجر به منفی شدن مفهوم آن می‌گردد، که به معنای “هر بسته‌ای با پروتکل مختلف بجز گزینه اشاره شده” خواهد بود. این مکانیزم منفی‌سازی مختص به گزینه ... نیست و می‌تواند در مورد سایر شرایط نیز بکار رود.
				</div><div
              class="para">
					شرط <code
                class="literal">-s <em
                  class="replaceable">address</em></code> یا <code
                class="literal">-s <em
                  class="replaceable">network/mask</em></code> با نشانی مبدا از بسته منطبق است. به همین ترتیب، شرط <code
                class="literal">-d <em
                  class="replaceable">address</em></code> یا <code
                class="literal">-d <em
                  class="replaceable">network/mask</em></code> با نشانی مقصد از بسته منطبق است.
				</div><div
              class="para">
					شرط <code
                class="literal">-i <em
                  class="replaceable">interface</em></code> بسته‌هایی را انتخاب می‌کند که از رایط شبکه اشاره شده دریافت شوند. شرط <code
                class="literal">-o <em
                  class="replaceable">interface</em></code> بسته‌هایی را انتخاب می‌کند که به رابط شبکه اشاره شده ارسال شوند.
				</div><div
              class="para">
					علاوه بر شرایط عمومی اشاره شده، شرایط بخصوصی نیز وجود دارند. برای نمونه، شرط <code
                class="literal">-p tcp</code> می‌تواند مکمل شرایط درگاه TCP باشد، با بندهایی نظیر <code
                class="literal">--source-port <em
                  class="replaceable">port</em></code> و <code
                class="literal">--destination-port <em
                  class="replaceable">port</em></code>.
				</div><div
              class="para">
					شرط <code
                class="literal">--state <em
                  class="replaceable">state</em></code> با وضعیت یک بسته در یک ارتباط منطبق است (اینکار نیازمند ماژول کرنل <code
                class="command">ipt_conntrack</code> برای رهگیری ارتباط است). حالت <code
                class="literal">NEW</code> بسته‌ای با ارتباط جدید را تعریف می‌کند؛ حالت <code
                class="literal">ESTABLISHED</code> منطبق با بسته‌هایی است که به یک ارتباط موجود متعلق باشند و حالت <code
                class="literal">RELATED</code> منطبق با بسته‌هایی است که از یک ارتباط موجود نشات می‌گیرند (که در مورد ارتباط‌های <code
                class="literal">ftp-data</code> در حالت “active” از پروتکل FTP کاربرد دارد).
				</div><div
              class="para">
					قسمت قبل به توضیح اقدامات موجود پرداخت، ولی نه گزینه‌های مربوط به آن. برای نمونه، اقدام <code
                class="literal">LOG</code> گزینه‌های زیر را شامل می‌شود:
				</div><div
              xmlns:d="http://docbook.org/ns/docbook"
              class="itemizedlist"><ul><li
                  class="listitem"><div
                    class="para">
							<code
                      class="literal">--log-level</code>، با مقدار پیشفرض <code
                      class="literal">warning</code>، سطح شدت <code
                      class="command">syslog</code> را مشخص می‌کند؛
						</div></li><li
                  class="listitem"><div
                    class="para">
							<code
                      class="literal">--log-prefix</code> امکان مشخص کردن یک متن پیشوند برای تفاوت قائل شدن بین پیام‌های گزارش شده را فراهم می‌کند؛
						</div></li><li
                  class="listitem"><div
                    class="para">
							<code
                      class="literal">--log-tcp-sequence</code>، <code
                      class="literal">--log-tcp-options</code> و <code
                      class="literal">--log-ip-options</code> داده اضافی برای ادغام شدن درون پیام را مشخص می‌کند: به ترتیب، شماره ترتیبی TCP، گزینه‌های TCP و گزینه‌های IP.
						</div></li></ul></div><div
              class="para">
					اقدام <code
                class="literal">DNAT</code> گزینه <code
                class="literal">--to-destination <em
                  class="replaceable">address</em>:<em
                  class="replaceable">port</em></code> را به منظور نشانی IP جدید مقصد و/یا درگاه مشخص می‌کند. به طور مشابه، اقدام <code
                class="literal">SNAT</code> گزینه <code
                class="literal">--to-source <em
                  class="replaceable">address</em>:<em
                  class="replaceable">port</em></code> را به منظور نشانی IP جدید مبدا و/یا درگاه مشخص می‌کند.
				</div><div
              class="para">
					اقدام <code
                class="literal">REDIRECT</code> (که تنها در صورت موجود بودن NAT استفاده می‌شود) گزینه <code
                class="literal">--to-ports <em
                  class="replaceable">port(s)</em></code> را برای مشخص کردن درگاه یا محدوده درگاهی که بسته‌ها باید به آن هدایت شوند بکار می‌برد.
				</div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="sect.creating-rules"></a>14.2.3. ایجاد قوانین</h3></div></div></div><div
            class="para">
				ایجاد هر قانون مستلزم فراخوانی یکی از دستورات <code
              class="command">iptables</code> یا <code
              class="command">ip6tables</code> است. نوشتن این دستورات به صورت دستی می‌تواند خسته کننده باشد، از این رو فراخوانی آن‌ها معمولا از طریق یک اسکریپت در زمان راه‌اندازی اولیه به صورت خودکار صورت می‌گیرد. این اسکریپت می‌تواند به صورت دستی نوشته شود اما ابزار جالب و پیشرفته‌تری برای اینکار وجود دارد که <code
              class="command">fwbuilder</code> نامیده می‌شود.
			</div><pre
            class="screen">
<code
              class="computeroutput"># </code><strong
              class="userinput"><code>apt install fwbuilder</code></strong></pre><div
            class="para">
				اصول آن ساده است. در گام اول، باید مشخص گردد از چه عناصری در ایجاد قوانین استفاده می‌شود:
			</div><div
            xmlns:d="http://docbook.org/ns/docbook"
            class="itemizedlist"><ul><li
                class="listitem"><div
                  class="para">
						خود فایروال، همراه با رابط‌های شبکه‌اش؛
					</div></li><li
                class="listitem"><div
                  class="para">
						شبکه‌ها، همراه با محدوده‌های IP مشخص؛
					</div></li><li
                class="listitem"><div
                  class="para">
						سرورها؛
					</div></li><li
                class="listitem"><div
                  class="para">
						درگاه‌های متعلق به سرویس‌های موجود در سرورها.
					</div></li></ul></div><div
            class="para">
				سپس قوانین می‌توانند با عملیات ساده کشیدن و رهاکردن روی اشیاء موجود ایجاد گردند. چندین منوی زمینه‌ای می‌توانند شرایط را تغییر دهند (برای نمونه، منفی کردن یک شرط). در این مرحله است که اقدام مورد نظر باید انتخاب و پیکربندی شود.
			</div><div
            class="para">
				تا آنجا که به IPv6 مرتبط است، می‌توان دو مجموعه قانون مختلف برای IPv4 و IPv6 ایجاد کرد یا با ایجاد یکی از آن‌ها و استفاده از <code
              class="command">fwbuilder</code> نسبت به ترجمه دیگری همراه با نشانی‌های منتسب به اشیاء اقدام کرد.
			</div><div
            class="figure"><a
              id="figure.fwbuilder"></a><div
              class="figure-contents"><div
                class="mediaobject"><img
                  src="images/fwbuilder.png"
                  alt="پنجره اصلی fwbuilder" /></div></div><p
              class="title"><strong>
      شكل 14.2. پنجره اصلی fwbuilder</strong></p></div><a
            id="id-1.17.5.14.9"
            class="indexterm"></a><div
            class="para">
				<code
              class="command">fwbuilder</code> می‌تواند برای تولید اسکریپتی استفاده شود که پیکربندی فایروال مبتنی بر قوانین تعریف شده را در خود داشته باشد. معماری ماژولار آن باعث می‌شود که توانایی ایجاد اسکریپت برای چندین سیستم مختلف وجود داشته باشد (<code
              class="command">iptables</code> برای لینوکس، <code
              class="command">ipf</code> برای FreeBSD و <code
              class="command">pf</code> برای OpenBSD).
			</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="sect.install-rules-at-boot"></a>14.2.4. اجرای قوانین در هر مرتبه راه‌اندازی</h3></div></div></div><div
            class="para">
				در سایر موارد، روش توصیه شده ثبت اسکریپت پیکربندی در یک عبارت <code
              class="literal">up</code> از فایل <code
              class="filename">/etc/network/interfaces</code> است. در مثال زیر، اسکریپت <code
              class="filename">/usr/local/etc/arrakis.fw</code> ذخیره‌سازی شده است.
			</div><div
            class="example"><a
              id="example.network-interfaces-firewall"></a><p
              class="title"><strong>
      مثال 14.1. فایل <code
                  class="filename">interfaces</code> که اسکریپت فایروال را فراخوانی می‌کند</strong></p><div
              class="example-contents"><pre
                class="programlisting">auto eth0
iface eth0 inet static
    address 192.168.0.1
    network 192.168.0.0
    netmask 255.255.255.0
    broadcast 192.168.0.255
    up /usr/local/etc/arrakis.fw</pre></div></div><div
            class="para">
				تصور بر این است که از <span
              class="pkg pkg">ifupdown</span> برای پیکربندی رابط‌های شبکه استفاده می‌کنید. اگر از ابزار دیگری برای اینکار بهره می‌برید (مانند <span
              class="emphasis"><em>NetworkManager</em></span> یا <span
              class="emphasis"><em>systemd-networkd</em></span>)، بهتر است به مستندات آن‌ها مراجعه کرده تا روش فراخوانی اسکریپت پس از بالا آمدن رابط را پیدا کنید.
			</div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="security.html"><strong>قبلی</strong>
      فصل 14. امنیت</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>بالا</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>خانه</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.supervision.html"><strong>بعدی</strong>14.3. نظارت: پیشگیری، شناسایی، بازدارندگی</a></li></ul><div
        id="translated_pages"><ul><li><a
              href="../ar-MA/sect.firewall-packet-filtering.html">ar-MA</a></li><li><a
              href="../da-DK/sect.firewall-packet-filtering.html">da-DK</a></li><li><a
              href="../de-DE/sect.firewall-packet-filtering.html">de-DE</a></li><li><a
              href="../el-GR/sect.firewall-packet-filtering.html">el-GR</a></li><li><a
              href="../en-US/sect.firewall-packet-filtering.html">en-US</a></li><li><a
              href="../es-ES/sect.firewall-packet-filtering.html">es-ES</a></li><li><a
              href="../fa-IR/sect.firewall-packet-filtering.html">fa-IR</a></li><li><a
              href="../fr-FR/sect.firewall-packet-filtering.html">fr-FR</a></li><li><a
              href="../hr-HR/sect.firewall-packet-filtering.html">hr-HR</a></li><li><a
              href="../id-ID/sect.firewall-packet-filtering.html">id-ID</a></li><li><a
              href="../it-IT/sect.firewall-packet-filtering.html">it-IT</a></li><li><a
              href="../ja-JP/sect.firewall-packet-filtering.html">ja-JP</a></li><li><a
              href="../ko-KR/sect.firewall-packet-filtering.html">ko-KR</a></li><li><a
              href="../nb-NO/sect.firewall-packet-filtering.html">nb-NO</a></li><li><a
              href="../pl-PL/sect.firewall-packet-filtering.html">pl-PL</a></li><li><a
              href="../pt-BR/sect.firewall-packet-filtering.html">pt-BR</a></li><li><a
              href="../ro-RO/sect.firewall-packet-filtering.html">ro-RO</a></li><li><a
              href="../ru-RU/sect.firewall-packet-filtering.html">ru-RU</a></li><li><a
              href="../tr-TR/sect.firewall-packet-filtering.html">tr-TR</a></li><li><a
              href="../vi-VN/sect.firewall-packet-filtering.html">vi-VN</a></li><li><a
              href="../zh-CN/sect.firewall-packet-filtering.html">zh-CN</a></li><li><a
              href="../zh-TW/sect.firewall-packet-filtering.html">zh-TW</a></li></ul></div></body></html>
