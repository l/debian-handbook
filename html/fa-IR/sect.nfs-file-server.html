<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">11.4. NFS File Server</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-8-fa-IR-1.0-1" /><meta
        name="keywords"
        content="Postfix, Apache, NFS, Samba, Squid, OpenLDAP, SIP" /><link
        rel="home"
        href="index.html"
        title="The Debian Administrator's Handbook" /><link
        rel="up"
        href="network-services.html"
        title="فصل 11. Network Services: Postfix, Apache, NFS, Samba, Squid, LDAP, SIP, XMPP, TURN" /><link
        rel="prev"
        href="sect.ftp-file-server.html"
        title="11.3. FTP File Server" /><link
        rel="next"
        href="sect.windows-file-server-with-samba.html"
        title="11.5. Setting Up Windows Shares with Samba" /><meta
        name="viewport"
        content="width=device-width, initial-scale=1" /><link
        rel="canonical"
        href="http://l.github.io/debian-handbook/html/fa-IR/sect.nfs-file-server.html" /></head><body
      dir="rtl"><noscript><iframe
          src="//www.googletagmanager.com/ns.html?id=GTM-5H35QX"
          height="0"
          width="0"
          style="display:none;visibility:hidden"></iframe></noscript><script
        type="text/javascript">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&amp;l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5H35QX');</script><div
        id="banner"><a
          href="../../"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="index.html"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="sect.ftp-file-server.html"><strong>قبلی</strong></a></li><li
          class="home">The Debian Administrator's Handbook</li><li
          class="next"><a
            accesskey="n"
            href="sect.windows-file-server-with-samba.html"><strong>بعدی</strong></a></li></ul><div
        class="section"><div
          class="titlepage"><div><div><h2
                class="title"><a
                  id="sect.nfs-file-server"></a>11.4. NFS File Server</h2></div></div></div><div
          class="para">
			NFS (<span
            class="emphasis"><em>Network File System</em></span>) is a protocol allowing remote access to a filesystem through the network. All Unix systems can work with this protocol; when Windows systems are involved, Samba must be used instead.
		</div><a
          id="id-1.14.7.3"
          class="indexterm"></a><a
          id="id-1.14.7.4"
          class="indexterm"></a><a
          id="id-1.14.7.5"
          class="indexterm"></a><a
          id="id-1.14.7.6"
          class="indexterm"></a><a
          id="id-1.14.7.7"
          class="indexterm"></a><div
          class="para">
			NFS is a very useful tool but, historically, it has suffered from many limitations, most of which have been addressed with version 4 of the protocol. The downside is that the latest version of NFS is harder to configure when you want to make use of basic security features such as authentication and encryption since it relies on Kerberos for those parts. And without those, the NFS protocol must be restricted to a trusted local network since data goes over the network unencrypted (a <span
            class="emphasis"><em>sniffer</em></span> can intercept it) and access rights are granted based on the client's IP address (which can be spoofed).
		</div><div
          class="sidebar"><div
            class="titlepage"><div><div><p
                  class="title"><strong><span
                      class="emphasis"><em>DOCUMENTATION</em></span> NFS HOWTO</strong></p></div></div></div><div
            class="para">
			Good documentation to deploy NFSv4 is rather scarce. Here are some pointers with content of varying quality but that should at least give some hints on what should be done. <div
              class="url">→ <a
                href="https://help.ubuntu.com/community/NFSv4Howto">https://help.ubuntu.com/community/NFSv4Howto</a></div> <div
              class="url">→ <a
                href="http://wiki.linux-nfs.org/wiki/index.php/Nfsv4_configuration">http://wiki.linux-nfs.org/wiki/index.php/Nfsv4_configuration</a></div>
		</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="id-1.14.7.10"></a>11.4.1. Securing NFS</h3></div></div></div><a
            id="id-1.14.7.10.2"
            class="indexterm"></a><div
            class="para">
				If you don't use the Kerberos-based security features, it is vital to ensure that only the machines allowed to use NFS can connect to the various required RPC servers, because the basic protocol trusts the data received from the network. The firewall must also block <span
              class="emphasis"><em>IP spoofing</em></span> so as to prevent an outside machine from acting as an inside one, and access to the appropriate ports must be restricted to the machines meant to access the NFS shares.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>BACK TO BASICS</em></span> RPC</strong></p></div></div></div><div
              class="para">
				RPC (<span
                class="emphasis"><em>Remote Procedure Call</em></span>) is a Unix standard for remote services. NFS is one such service.
			</div><a
              id="id-1.14.7.10.4.3"
              class="indexterm"></a><a
              id="id-1.14.7.10.4.4"
              class="indexterm"></a><div
              class="para">
				RPC services register to a directory known as the <span
                class="emphasis"><em>portmapper</em></span>. A client wishing to perform an NFS query first addresses the <span
                class="emphasis"><em>portmapper</em></span> (on port 111, either TCP or UDP), and asks for the NFS server; the reply usually mentions port 2049 (the default for NFS). Not all RPC services necessarily use a fixed port.
			</div></div><div
            class="para">
				Older versions of the protocol required other RPC services which used dynamically assigned ports. Fortunately, with NFS version 4, only port 2049 (for NFS) and 111 (for the portmapper) are needed and they are thus easy to firewall.
			</div><a
            id="id-1.14.7.10.6"
            class="indexterm"></a></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="id-1.14.7.11"></a>11.4.2. NFS Server</h3></div></div></div><div
            class="para">
				The NFS server is part of the Linux kernel; in kernels provided by Debian it is built as a kernel module. If the NFS server is to be run automatically on boot, the <span
              class="pkg pkg">nfs-kernel-server</span> package should be installed; it contains the relevant start-up scripts.
			</div><div
            class="para">
				The NFS server configuration file, <code
              class="filename">/etc/exports</code>, lists the directories that are made available over the network (<span
              class="emphasis"><em>exported</em></span>). For each NFS share, only the given list of machines is granted access. More fine-grained access control can be obtained with a few options. The syntax for this file is quite simple:
			</div><a
            id="id-1.14.7.11.4"
            class="indexterm"></a><a
            id="id-1.14.7.11.5"
            class="indexterm"></a><pre
            class="programlisting">
/directory/to/share machine1(option1,option2,...) machine2(...) ...
</pre><div
            class="para">
				Note that with NFSv4, all exported directories must be part of a single hierarchy and that the root directory of that hierarchy must be exported and identified with the option <code
              class="literal">fsid=0</code> or <code
              class="literal">fsid=root</code>.
			</div><div
            class="para">
				Each machine can be identified either by its DNS name or its IP address. Whole sets of machines can also be specified using either a syntax such as <code
              class="literal">*.falcot.com</code> or an IP address range such as <code
              class="literal">192.168.0.0/255.255.255.0</code> or <code
              class="literal">192.168.0.0/24</code>.
			</div><div
            class="para">
				Directories are made available as read-only by default (or with the <code
              class="literal">ro</code> option). The <code
              class="literal">rw</code> option allows read-write access. NFS clients typically connect from a port restricted to root (in other words, below 1024); this restriction can be lifted by the <code
              class="literal">insecure</code> option (the <code
              class="literal">secure</code> option is implicit, but it can be made explicit if needed for clarity).
			</div><a
            id="id-1.14.7.11.10"
            class="indexterm"></a><div
            class="para">
				By default, the server only answers an NFS query when the current disk operation is complete (<code
              class="literal">sync</code> option); this can be disabled with the <code
              class="literal">async</code> option. Asynchronous writes increase performance a bit, but they decrease reliability since there is a data loss risk in case of the server crashing between the acknowledgment of the write and the actual write on disk. Since the default value changed recently (as compared to the historical value of NFS), an explicit setting is recommended.
			</div><div
            class="para">
				In order to not give root access to the filesystem to any NFS client, all queries appearing to come from a root user are considered by the server as coming from the <code
              class="literal">nobody</code> user. This behavior corresponds to the <code
              class="literal">root_squash</code> option, and is enabled by default. The <code
              class="literal">no_root_squash</code> option, which disables this behavior, is risky and should only be used in controlled environments. The <code
              class="literal">anonuid=<em
                class="replaceable">uid</em></code> and <code
              class="literal">anongid=<em
                class="replaceable">gid</em></code> options allow specifying another fake user to be used instead of UID/GID 65534 (which corresponds to user <code
              class="literal">nobody</code> and group <code
              class="literal">nogroup</code>).
			</div><div
            class="para">
				With NFSv4, you can add a <code
              class="literal">sec</code> option to indicate the security level that you want: <code
              class="literal">sec=sys</code> is the default with no special security features, <code
              class="literal">sec=krb5</code> enables authentication only, <code
              class="literal">sec=krb5i</code> adds integrity protection, and <code
              class="literal">sec=krb5p</code> is the most complete level which includes privacy protection (with data encryption). For this to work you need a working Kerberos setup (that service is not covered by this book).
			</div><div
            class="para">
				Other options are available; they are documented in the <span
              class="citerefentry"><span
                class="refentrytitle">exports</span>(5)</span> manual page.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>CAUTION</em></span> First installation</strong></p></div></div></div><div
              class="para">
				The <code
                class="filename">/etc/init.d/nfs-kernel-server</code> boot script only starts the server if the <code
                class="filename">/etc/exports</code> lists one or more valid NFS shares. On initial configuration, once this file has been edited to contain valid entries, the NFS server must therefore be started with the following command:
			</div><pre
              class="screen">
<code
                class="computeroutput"># </code><strong
                class="userinput"><code>service nfs-kernel-server start</code></strong></pre></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="id-1.14.7.12"></a>11.4.3. NFS Client</h3></div></div></div><a
            id="id-1.14.7.12.2"
            class="indexterm"></a><a
            id="id-1.14.7.12.3"
            class="indexterm"></a><div
            class="para">
				As with other filesystems, integrating an NFS share into the system hierarchy requires mounting. Since this filesystem has its peculiarities, a few adjustments were required in the syntaxes of the <code
              class="command">mount</code> command and the <code
              class="filename">/etc/fstab</code> file.
			</div><div
            class="example"><a
              id="id-1.14.7.12.5"></a><p
              class="title"><strong>
      مثال 11.22. Manually mounting with the <code
                  class="command">mount</code> command</strong></p><div
              class="example-contents"><pre
                class="screen">
          <code
                  class="computeroutput"># </code><strong
                  class="userinput"><code>mount -t nfs4 -o rw,nosuid arrakis.internal.falcot.com:/shared /srv/shared</code></strong></pre></div></div><div
            class="example"><a
              id="id-1.14.7.12.6"></a><p
              class="title"><strong>
      مثال 11.23. NFS entry in the <code
                  class="filename">/etc/fstab</code> file</strong></p><div
              class="example-contents"><pre
                class="programlisting">
arrakis.internal.falcot.com:/shared /srv/shared nfs4 rw,nosuid 0 0
</pre></div></div><div
            class="para">
				The entry described above mounts, at system startup, the <code
              class="filename">/shared/</code> NFS directory from the <code
              class="literal">arrakis</code> server into the local <code
              class="filename">/srv/shared/</code> directory. Read-write access is requested (hence the <code
              class="literal">rw</code> parameter). The <code
              class="literal">nosuid</code> option is a protection measure that wipes any <code
              class="literal">setuid</code> or <code
              class="literal">setgid</code> bit from programs stored on the share. If the NFS share is only meant to store documents, another recommended option is <code
              class="literal">noexec</code>, which prevents executing programs stored on the share. Note that on the server, the <code
              class="filename">shared</code> directory is below the NFSv4 root export (for example <code
              class="filename">/export/shared</code>), it is not a top-level directory.
			</div><div
            class="para">
				The <span
              class="citerefentry"><span
                class="refentrytitle">nfs</span>(5)</span> manual page describes all the options in some detail.
			</div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="sect.ftp-file-server.html"><strong>قبلی</strong>11.3. FTP File Server</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>بالا</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>خانه</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.windows-file-server-with-samba.html"><strong>بعدی</strong>11.5. Setting Up Windows Shares with Samba</a></li></ul><div
        id="translated_pages"><ul><li><a
              href="../ar-MA/sect.nfs-file-server.html">ar-MA</a></li><li><a
              href="../da-DK/sect.nfs-file-server.html">da-DK</a></li><li><a
              href="../de-DE/sect.nfs-file-server.html">de-DE</a></li><li><a
              href="../el-GR/sect.nfs-file-server.html">el-GR</a></li><li><a
              href="../en-US/sect.nfs-file-server.html">en-US</a></li><li><a
              href="../es-ES/sect.nfs-file-server.html">es-ES</a></li><li><a
              href="../fa-IR/sect.nfs-file-server.html">fa-IR</a></li><li><a
              href="../fr-FR/sect.nfs-file-server.html">fr-FR</a></li><li><a
              href="../hr-HR/sect.nfs-file-server.html">hr-HR</a></li><li><a
              href="../id-ID/sect.nfs-file-server.html">id-ID</a></li><li><a
              href="../it-IT/sect.nfs-file-server.html">it-IT</a></li><li><a
              href="../ja-JP/sect.nfs-file-server.html">ja-JP</a></li><li><a
              href="../ko-KR/sect.nfs-file-server.html">ko-KR</a></li><li><a
              href="../nb-NO/sect.nfs-file-server.html">nb-NO</a></li><li><a
              href="../pl-PL/sect.nfs-file-server.html">pl-PL</a></li><li><a
              href="../pt-BR/sect.nfs-file-server.html">pt-BR</a></li><li><a
              href="../ro-RO/sect.nfs-file-server.html">ro-RO</a></li><li><a
              href="../ru-RU/sect.nfs-file-server.html">ru-RU</a></li><li><a
              href="../tr-TR/sect.nfs-file-server.html">tr-TR</a></li><li><a
              href="../zh-CN/sect.nfs-file-server.html">zh-CN</a></li><li><a
              href="../zh-TW/sect.nfs-file-server.html">zh-TW</a></li></ul></div></body></html>
