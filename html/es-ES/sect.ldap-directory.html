<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">11.7. Directorio LDAP</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-8-es-ES-1.0-1" /><meta
        name="keywords"
        content="Postfix, Apache, NFS, Samba, Squid, OpenLDAP, SIP" /><link
        rel="home"
        href="index.html"
        title="El manual del Administrador de Debian" /><link
        rel="up"
        href="network-services.html"
        title="Capítulo 11. Servicios de red: Postfix, Apache, NFS, Samba, Squid, LDAP, SIP, XMPP, TURN" /><link
        rel="prev"
        href="sect.http-ftp-proxy.html"
        title="11.6. Proxy HTTP/FTP" /><link
        rel="next"
        href="sect.rtc-services.html"
        title="11.8. Servicios de comunicación en tiempo real" /><meta
        name="viewport"
        content="width=device-width, initial-scale=1" /><link
        rel="canonical"
        href="http://l.github.io/debian-handbook/html/es-ES/sect.ldap-directory.html" /></head><body><noscript><iframe
          src="//www.googletagmanager.com/ns.html?id=GTM-5H35QX"
          height="0"
          width="0"
          style="display:none;visibility:hidden"></iframe></noscript><script
        type="text/javascript">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&amp;l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5H35QX');</script><div
        id="banner"><a
          href="../../"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="index.html"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="sect.http-ftp-proxy.html"><strong>Anterior</strong></a></li><li
          class="home">El manual del Administrador de Debian</li><li
          class="next"><a
            accesskey="n"
            href="sect.rtc-services.html"><strong>Siguiente</strong></a></li></ul><div
        class="section"><div
          class="titlepage"><div><div><h2
                class="title"><a
                  id="sect.ldap-directory"></a>11.7. Directorio LDAP</h2></div></div></div><a
          id="id-1.14.10.2"
          class="indexterm"></a><a
          id="id-1.14.10.3"
          class="indexterm"></a><a
          id="id-1.14.10.4"
          class="indexterm"></a><div
          class="para">
			OpenLDAP es una implementación del protocolo LDAP; en otras palabras, es una base de datos de propósito especial diseñada para almacenar directorios (N.T. directorio en el sentido de directorio/agenda de personas, equipos o configuraciones, no directorio de un sistema de archivos). En el caso de uso más común, utilizar un servidor LDAP permite centralizar la administración de las cuentas de usuario y los permisos relacionados. Además se puede replicar fácilmente una base de datos LDAP, lo que permite configurar varios servidores LDAP sincronizados. Cuando la red y la cantidad de usuarios crecen rápidamente se puede balancear la carga entre varios servidores.
		</div><div
          class="para">
			Los datos LDAP son estructurados y jerárquicos. La estructura es definida por «esquemas» («schemas») que describen el tipo de objetos que la base de datos puede almacenar junto con una lista de todos sus atributos posibles. La sintaxis utilizada para hacer referencia a un objeto particular en la base de datos está basada en esta estructura, lo que explica su complejidad.
		</div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="id-1.14.10.7"></a>11.7.1. Instalación</h3></div></div></div><div
            class="para">
				El paquete <span
              class="pkg pkg">slapd</span> contiene el servidor OpenLDAP. El paquete <span
              class="pkg pkg">ldap-utils</span> incluye herramientas de línea de órdenes para interactuar con servidores LDAP.
			</div><a
            id="id-1.14.10.7.3"
            class="indexterm"></a><div
            class="para">
				La instalación de <span
              class="pkg pkg">slapd</span> normalmente solicita muy poca información, a menos que haya configurado debconf para que realice preguntas con menor prioridad. Afortunadamente basta ejecutar <code
              class="command">dpkg-reconfigure slapd</code> para reconfigurar la base de datos LDAP más detalladamente:
			</div><div
            xmlns:d="http://docbook.org/ns/docbook"
            class="itemizedlist"><ul><li
                class="listitem"><div
                  class="para">
						¿Evitar la configuración del servidor OpenLDAP? No, por supuesto que deseamos configurar este servicio.
					</div></li><li
                class="listitem"><div
                  class="para">
						Nombre de dominio DNS: «<code
                    class="literal">falcot.com</code>».
					</div></li><li
                class="listitem"><div
                  class="para">
						Nombre de la organización: “Falcot Corp”.
					</div></li><li
                class="listitem"><div
                  class="para">
						Debe ingresar la contraseña de administración.
					</div></li><li
                class="listitem"><div
                  class="para">
						Base de datos a utilizar: «MDB».
					</div></li><li
                class="listitem"><div
                  class="para">
						¿Desea eliminar la base de datos cuando se purge <span
                    class="pkg pkg">slapd</span>? No. No tiene sentido arriesgarse a perder la base de datos por error.
					</div></li><li
                class="listitem"><div
                  class="para">
						¿Mover una base de datos anterior? Esta pregunta sólo es realizada cuando se intenta configurarlo y ya existe una base de datos. Sólo responda «yes» si realmente desea iniciar nuevamente desde una base de datos limpia; por ejemplo, si ejecuta <code
                    class="command">dpkg-reconfigure slapd</code> inmediatamente después de instalarlo por primera vez.
					</div></li><li
                class="listitem"><div
                  class="para">
						¿Permitir el protocol LDAPv2? No, no tiene sentido. Todas las herramientas que utilizaremos entienden el protocolo LDAPv3.
					</div></li></ul></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>VOLVER A LOS CIMIENTOS</em></span> Formato LDIF</strong></p></div></div></div><div
              class="para">
				Un archivo LDIF (<span
                class="emphasis"><em>formato de intercambios de datos LDAP</em></span>: «LDAP Data Interchange Format») es un archivo de texto portable que describe el contenido de una base de datos LDAP (o una porción de la misma); puede utilizarlo para introducir datos en otro servidor LDAP.
			</div><a
              id="id-1.14.10.7.6.3"
              class="indexterm"></a></div><div
            class="para">
				Ahora tiene configurada una base de datos mínima, como podrá ver con la siguiente consulta:
			</div><pre
            class="screen">
<code
              class="computeroutput">$ </code><strong
              class="userinput"><code>ldapsearch -x -b dc=falcot,dc=com</code></strong>
<code
              class="computeroutput"># extended LDIF
#
# LDAPv3
# base &lt;dc=falcot,dc=com&gt; with scope sub
# filter: (objectclass=*)
# requesting: ALL
#

# falcot.com
dn: dc=falcot,dc=com
objectClass: top
objectClass: dcObject
objectClass: organization
o: Falcot Corp
dc: falcot

# admin, falcot.com
dn: cn=admin,dc=falcot,dc=com
objectClass: simpleSecurityObject
objectClass: organizationalRole
cn: admin
description: LDAP administrator

# search result
search: 2
result: 0 Success

# numResponses: 3
# numEntries: 2
</code></pre><div
            class="para">
				La consulta devolvió dos objetos: la organización en sí mismo y el usuario de administración.
			</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="id-1.14.10.8"></a>11.7.2. Relleno del directorio</h3></div></div></div><div
            class="para">
				Debido a que una base de datos vacía no es particularmente útil, se trata ahora de integrar en ella todos los directorios existenes; esto incluye las bases de datos de usuarios, grupos, servicios y equipos.
			</div><div
            class="para">
				El paquete <span
              class="pkg pkg">migrationtools</span> proporciona un conjunto de scripts para extraer los datos de los directorios estándar de Unix (<code
              class="filename">/etc/passwd</code>, <code
              class="filename">/etc/group</code>, <code
              class="filename">/etc/services</code>, <code
              class="filename">/etc/hosts</code>, etc.), convetir estos datos y agregarlos en la base de datos LDAP.
			</div><a
            id="id-1.14.10.8.4"
            class="indexterm"></a><div
            class="para">
				Una vez que instaló el paquete, es necesario editar el archivo <code
              class="filename">/etc/migrationtools/migrate_common.ph</code>; debe activar las opciones <code
              class="varname">IGNORE_UID_BELOW</code> y <code
              class="varname">IGNORE_GID_BELOW</code> (descomentarlas es suficiente) y debe actualizar <code
              class="varname">DEFAULT_MAIL_DOMAIN</code>/<code
              class="varname">DEFAULT_BASE</code>.
			</div><div
            class="para">
				La operación de migración en sí es gestionada por el script <code
              class="command">migrate_all_online.sh</code>, como sigue:
			</div><pre
            class="screen">
<code
              class="computeroutput"># </code><strong
              class="userinput"><code>cd /usr/share/migrationtools</code></strong>
<code
              class="computeroutput"># </code><strong
              class="userinput"><code>LDAPADD="/usr/bin/ldapadd -c" ETC_ALIASES=/dev/null ./migrate_all_online.sh</code></strong></pre><div
            class="para">
				<code
              class="command">migrate_all_online.sh</code> realizará unas pocas preguntas sobre la base de datos LDAP a la que migrará los datos. La <a
              class="xref"
              href="sect.ldap-directory.html#tab-migrate-all">Tabla 11.1</a> resume las respuestas dadas en el caso de uso de Falcot.
			</div><div
            class="table"><a
              id="tab-migrate-all"></a><p
              class="title"><strong>Tabla 11.1. Respuestas a las preguntas del script <code
                  class="command">migrate_all_online.sh</code></strong></p><div
              class="table-contents"><table
                xmlns:d="http://docbook.org/ns/docbook"
                class="lt-4-cols lt-7-rows"
                summary="Respuestas a las preguntas del script migrate_all_online.sh"><colgroup><col
                    align="justify" /><col
                    align="justify" /></colgroup><thead><tr><th
                      align="justify">Pregunta</th><th
                      align="justify">Respuesta</th></tr></thead><tbody><tr><td
                      align="justify">Contexto de nombre X.500</td><td
                      align="justify"><code
                        class="literal">dc=falcot,dc=com</code></td></tr><tr><td
                      align="justify">Nombre del servidor LDAP</td><td
                      align="justify"><code
                        class="literal">localhost</code></td></tr><tr><td
                      align="justify">Administrador del DN</td><td
                      align="justify"><code
                        class="literal">cn=admin,dc=falcot,dc=com</code></td></tr><tr><td
                      align="justify">Credenciales Bind</td><td
                      align="justify">la contraseña de administración</td></tr><tr><td
                      align="justify">Crear DUAConfigProfile</td><td
                      align="justify">no</td></tr></tbody></table></div></div><div
            class="para">
				Deliberadamente evitamos migrar el archivo <code
              class="filename">/etc/aliases</code>, ya que el esquema estándar provisto por Debian no incluye la estructura que utiliza este script para describir alias de correo. Si quisiéramos integrar estos datos en el directorio, debe agregar el archivo <code
              class="filename">/etc/ldap/schema/misc.schema</code> al esquema estándar.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>HERRAMIENTA</em></span> Navegación de un directorio LDAP</strong></p></div></div></div><div
              class="para">
				El programa <code
                class="command">jxplorer</code> (en el paquete del mismo nombre) es una herramienta gráfica que permite navegar y editar una base de datos LDAP. Es una herramienta interesante que proporciona al administrador una buena visión de la estructura jerárquica de los datos de LDAP.
			</div><a
              id="id-1.14.10.8.11.3"
              class="indexterm"></a></div><div
            class="para">
				Sepa también que el programa <code
              class="command">ldapadd</code> tiene una opción <code
              class="literal">-c</code>; esta opción solicita que no se detenga el proceso en caso de errores. Es necesario utilizar esta opción debido a que la conversión del archivo <code
              class="filename">/etc/services</code> genera unos pocos errores que puede ignorar sin problemas.
			</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="id-1.14.10.9"></a>11.7.3. Administración de cuentas con LDAP</h3></div></div></div><div
            class="para">
				Ahora que la base de datos LDAP contiene información útil, es momento de utilizar estos datos. Esta sección se enfoca en cómo configurar un sistema Linux para que los directorios de sistema utilicen la base de datos LDAP.
			</div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      id="sect.config-nss"></a>11.7.3.1. Configuración de NSS</h4></div></div></div><div
              class="para">
					El sistema NSS (cambio de servicio de nombres: «Name Service Switch», revise el recuadro <a
                class="xref"
                href="sect.user-group-databases.html#sidebar.intro-nss"><span
                  class="emphasis"><em>YENDO MÁS ALLÁ</em></span> NSS y bases de datos de sistema</a>) es un sistema modular diseñado para definir u obtener información para directorios de sistemas. Utilizar LDAP como fuente de datos para NSS requiere instalar el paquete <span
                class="pkg pkg">libnss-ldap</span>. Al hacerlo, se harán unas pocas preguntas cuyas respuestas están resumidas en la <a
                class="xref"
                href="sect.ldap-directory.html#tab-libnss-ldap">Tabla 11.2</a>.
				</div><a
              id="id-1.14.10.9.3.3"
              class="indexterm"></a><div
              class="table"><a
                id="tab-libnss-ldap"></a><p
                class="title"><strong>Tabla 11.2. Configuración del paquete <span
                    class="pkg pkg">lbnss-ldap</span></strong></p><div
                class="table-contents"><table
                  xmlns:d="http://docbook.org/ns/docbook"
                  class="lt-4-cols gt-7-rows"
                  summary="Configuración del paquete lbnss-ldap"><colgroup><col
                      align="justify" /><col
                      align="justify" /></colgroup><thead><tr><th
                        align="justify">Pregunta</th><th
                        align="justify">Respuesta</th></tr></thead><tbody><tr><td
                        align="justify">Identificar de recurso uniforme (URI) del servidor LDAP</td><td
                        align="justify"><code
                          class="literal">ldap://ldap.falcot.com</code></td></tr><tr><td
                        align="justify">Nombre distinguido de la base de búsqueda</td><td
                        align="justify"><code
                          class="literal">dc=falcot,dc=com</code></td></tr><tr><td
                        align="justify">Versión LDAP a utilizar</td><td
                        align="justify"><code
                          class="literal">3</code></td></tr><tr><td
                        align="justify">¿La base de datos LDAP requiere inicio de sesión?</td><td
                        align="justify">no</td></tr><tr><td
                        align="justify">Permisos LDAP especiales para root</td><td
                        align="justify">si</td></tr><tr><td
                        align="justify">Modifique el archivo de configuración para que sólo pueda ser leído/escrito por su dueño</td><td
                        align="justify">no</td></tr><tr><td
                        align="justify">cuenta LDAP para root</td><td
                        align="justify"><code
                          class="literal">cn=admin,dc=falcot,dc=com</code></td></tr><tr><td
                        align="justify">contraseña de la cuenta root de LDAP</td><td
                        align="justify">la contraseña de administración</td></tr></tbody></table></div></div><div
              class="para">
					Luego necesita modificar el archivo <code
                class="filename">/etc/nsswitch.conf</code> para configurar que NSS utilice el módulo <code
                class="command">ldap</code> recién instalado.
				</div><div
              class="example"><a
                id="id-1.14.10.9.3.6"></a><p
                class="title"><strong>Ejemplo 11.26. El archivo <code
                    class="filename">/etc/nsswitch.conf</code></strong></p><div
                class="example-contents"><pre
                  class="programlisting">
# /etc/nsswitch.conf
#
# Ejemplo de configuración de la funcionalidad de GNU Name Service
# Switch. Si están instalados los paquetes «glibc-doc» e «info»,
# intente «info libc "Name Service Switch"» para más información
# sobre este archivo.

passwd: ldap compat
group: ldap compat
shadow: ldap compat

hosts: files dns ldap
networks: ldap files

protocols: ldap db files
services: ldap db files
ethers: ldap db files
rpc: ldap db files

netgroup: ldap files</pre></div></div><div
              class="para">
					Generalmente agregará el módulo <code
                class="command">ldap</code> antes que los demás para que, de esa forma, sea consultado primero. La excepción notable es el servicio <code
                class="literal">hosts</code> ya que para contactar el servidor LDAP necesita una consulta de DNS primero (para resolver <code
                class="literal">ldap.falcot.com</code>). Sin esta excepción, una consulta de nombres intentaría consultar al servidor LDAP; esto dispararía una resolución de nombres para el servidor LDAP, y así sucesivamente en un ciclo infinito.
				</div><div
              class="para">
					Si se debe considerar al servidor LDAP como autoritativo (e ignorar los archivos locales utilizados por el módulo <code
                class="command">files</code>), puede configurar los servicios con la siguiente sintaxis:
				</div><div
              class="para">
					<code
                class="literal"><em
                  class="replaceable">servicio</em>: ldap [NOTFOUND=return] files</code>.
				</div><div
              class="para">
					Si la entrada solicitada no existe en la base de datos LDAP, la consulta devolverá la respuesta «inexistente» aún cuando el recurso exista en uno de los archivos locales; sólo se utilizarán estos archivos locales cuando el servicio LDAP esté caído.
				</div></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      id="sect.config-pam"></a>11.7.3.2. Configuración de PAM</h4></div></div></div><div
              class="para">
					Esta sección describe una configuración PAM (revise el recuadro <a
                class="xref"
                href="basic-configuration.html#sidebar.intro-pam"><span
                  class="emphasis"><em>TRAS BAMBALINAS</em></span> <code
                  class="filename">/etc/environment</code> y <code
                  class="filename">/etc/default/locale</code></a>) que permitirá a las aplicaciones realizar las autenticaciones necesarias contra la base de datos LDAP.
				</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>PRECAUCIÓN</em></span> Autenticación rota</strong></p></div></div></div><div
                class="para">
					Modificar la configuración estándar de PAM utilizada por varios programas es una operación delicada. Un error puede llevar a una autenticación rota, lo que podría impedir iniciar sesiones. Por lo que recomendamos mantener una consola de root abierta. Si ocurriera cualquier error de configuración, podría solucionarlo y reiniciar los servicios fácilmente.
				</div></div><div
              class="para">
					El paquete <span
                class="pkg pkg">libpam-ldap</span> provee el módulo LDAP para PAM. La instalación de este paquete realiza unas pocas preguntas muy similares a aquellas en el paquete <span
                class="pkg pkg">libnss-ldap</span>; algunos parámetros de configuración (como el URI del servidor LDAP) son inclusive compartidos con el paquete <span
                class="pkg pkg">libnss-ldap</span>. Encontrará resumidas las respuestas en la <a
                class="xref"
                href="sect.ldap-directory.html#tab-libpam-ldap">Tabla 11.3</a>.
				</div><a
              id="id-1.14.10.9.4.5"
              class="indexterm"></a><div
              class="table"><a
                id="tab-libpam-ldap"></a><p
                class="title"><strong>Tabla 11.3. Configuración de <span
                    class="emphasis"><em>libpam-ldap</em></span></strong></p><div
                class="table-contents"><table
                  xmlns:d="http://docbook.org/ns/docbook"
                  class="lt-4-cols lt-7-rows"
                  summary="Configuración de libpam-ldap"><colgroup><col
                      align="justify" /><col
                      align="justify" /></colgroup><thead><tr><th
                        align="justify">Pregunta</th><th
                        align="justify">Respuesta</th></tr></thead><tbody><tr><td
                        align="justify">¿Permitir a la cuenta de administración LDAP comportarse como root local?</td><td
                        align="justify">Sí. Esto permite utilizar el programa <code
                          class="command">passwd</code> típico para modificar las contraseñas almacenadas en la base de datos LDAP.</td></tr><tr><td
                        align="justify">¿La base de datos LDAP requiere inicio de sesión?</td><td
                        align="justify">no</td></tr><tr><td
                        align="justify">cuenta LDAP para root</td><td
                        align="justify"><code
                          class="literal">cn=admin,dc=falcot,dc=com</code></td></tr><tr><td
                        align="justify">contraseña de la cuenta root de LDAP</td><td
                        align="justify">la contraseña de administración de la base de datos LDAP</td></tr><tr><td
                        align="justify">Algoritmo local de cifrado para las contraseñas</td><td
                        align="justify">crypt</td></tr></tbody></table></div></div><div
              class="para">
					Instalar el paquete <span
                class="pkg pkg">libpam-ldap</span> automáticamente adapta la configuración PAM predeterminada definida en los archivos <code
                class="filename">/etc/pam.d/common-auth</code>, <code
                class="filename">/etc/pam.d/common-password</code> y <code
                class="filename">/etc/pam.d/common-account</code>. Este mecanismo utiliza la herramienta dedicada <code
                class="command">pam-auth-update</code> (provista por el paquete <span
                class="pkg pkg">libpam-runtime</span>). El administrador también puede utilizar esta herramienta si desea activar o desactivar módulos PAM.
				</div><a
              id="id-1.14.10.9.4.8"
              class="indexterm"></a><a
              id="id-1.14.10.9.4.9"
              class="indexterm"></a><a
              id="id-1.14.10.9.4.10"
              class="indexterm"></a><a
              id="id-1.14.10.9.4.11"
              class="indexterm"></a><a
              id="id-1.14.10.9.4.12"
              class="indexterm"></a><a
              id="id-1.14.10.9.4.13"
              class="indexterm"></a></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      id="id-1.14.10.9.5"></a>11.7.3.3. Protección de intercambios de datos LDAP</h4></div></div></div><a
              id="id-1.14.10.9.5.2"
              class="indexterm"></a><div
              class="para">
					De forma predeterminada, el protocolo LDAP se transmite por la red como texto plano; incluyendo las contraseñas (cifradas). Debido a que se pueden obtener las claves cifradas de la red, pueden ser vulnerables a ataques de tipo diccionario. Puede evitarlo aplicando una capa extra de cifrado; el tema de esta sección es cómo activar esta capa.
				</div><div
              class="section"><div
                class="titlepage"><div><div><h5
                      class="title"><a
                        id="id-1.14.10.9.5.4"></a>11.7.3.3.1. Configuración del servidor</h5></div></div></div><a
                id="id-1.14.10.9.5.4.2"
                class="indexterm"></a><a
                id="id-1.14.10.9.5.4.3"
                class="indexterm"></a><div
                class="para">
						El primer paso es crear un par de llaves (compuestas de una llave pública y una llave privada) para el servidor LDAP. Los administradores de Falcot reutilizaron <span
                  class="emphasis"><em>easy-rsa</em></span> para generarlas (revise la <a
                  class="xref"
                  href="sect.virtual-private-network.html#sect.easy-rsa">Sección 10.2.1.1, “Infraestructura de llave pública: <span
                    class="emphasis"><em>easy-rsa</em></span>”</a>. Si ejecuta <code
                  class="command">./build-server-key ldap.falcot.com</code> deberá responder unas pocas preguntas mundanas (ubicación, nombre de la organización, etc.). La respuesta a la pregunta por el «nombre común» («common name») <span
                  class="emphasis"><em>debe</em></span> ser el nombre de equipo completamente calificado del servidor LDAP; en nuestro caso: <code
                  class="literal">ldap.falcot.com</code>.
					</div><div
                class="para">
						Este programa crea un certificado en el archivo <code
                  class="filename">keys/ldap.falcot.com.crt</code>; la llave privada correspondiente es almacenada en <code
                  class="filename">keys/ldap.falcot.com.key</code>.
					</div><div
                class="para">
						Ahora debe instalar estas llaves en sus ubicaciones estándar y debemos asegurarnos que el servidor LDAP, que ejecuta bajo la identidad del usuario <code
                  class="literal">openldap</code>, pueda leer el archivo privado:
					</div><pre
                class="screen"><code
                  class="computeroutput"># </code><strong
                  class="userinput"><code>adduser openldap ssl-cert
</code></strong><code
                  class="computeroutput">Adding user `openldap' to group `ssl-cert' ...
Adding user openldap to group ssl-cert
Done.
# </code><strong
                  class="userinput"><code>mv keys/ldap.falcot.com.key /etc/ssl/private/ldap.falcot.com.key
</code></strong><code
                  class="computeroutput"># </code><strong
                  class="userinput"><code>chown root:ssl-cert /etc/ssl/private/ldap.falcot.com.key
</code></strong><code
                  class="computeroutput"># </code><strong
                  class="userinput"><code>chmod 0640 /etc/ssl/private/ldap.falcot.com.key
</code></strong><code
                  class="computeroutput"># </code><strong
                  class="userinput"><code>mv newcert.pem /etc/ssl/certs/ldap.falcot.com.pem
</code></strong></pre><div
                class="para">
						También necesita indicarle al demonio <code
                  class="command">slapd</code> que utilice estas llaves para el cifrado. La configuración del servidor LDAP es gestionada de forma dinámica: puede actualizar la configuración con operaciones LDAP normales en la jerarquía de objetos <code
                  class="literal">cn=config</code> y el servidor actualizará <code
                  class="filename">/etc/ldap/slapd.d</code> en tiempo real para que la configuración sea persistente. Por lo tanto, <code
                  class="command">ldapmodify</code> es la herramienta correcta para actualizar la configuración:
					</div><div
                class="example"><a
                  id="id-1.14.10.9.5.4.9"></a><p
                  class="title"><strong>Ejemplo 11.27. Configuración de <code
                      class="command">slapd</code> para cifrado</strong></p><div
                  class="example-contents"><pre
                    class="screen"><code
                      class="computeroutput"># </code><strong
                      class="userinput"><code>cat &gt;ssl.ldif &lt;&lt;END
dn: cn=config
changetype: modify
add: olcTLSCertificateFile
olcTLSCertificateFile: /etc/ssl/certs/ldap.falcot.com.pem
-
add: olcTLSCertificateKeyFile
olcTLSCertificateKeyFile: /etc/ssl/private/ldap.falcot.com.key
-
END
</code></strong><code
                      class="computeroutput"># </code><strong
                      class="userinput"><code>ldapmodify -Y EXTERNAL -H ldapi:/// -f ssl.ldif
</code></strong><code
                      class="computeroutput">SASL/EXTERNAL authentication started
SASL username: gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth
SASL SSF: 0
modifying entry "cn=config"
</code></pre></div></div><div
                class="sidebar"><div
                  class="titlepage"><div><div><p
                        class="title"><strong><span
                            class="emphasis"><em>HERRAMIENTA</em></span> <code
                            class="command">ldapvi</code> para editar un directorio LDAP</strong></p></div></div></div><a
                  id="id-1.14.10.9.5.4.10.2"
                  class="indexterm"></a><div
                  class="para">
						Con <code
                    class="command">ldapvi</code> puede mostrar cualquier sección del directorio LDAP en formato LDIF, realizar cambios en el editor de texto y dejar que la herramienta realice las operaciones LDAP correspondientes.
					</div><div
                  class="para">
						Por lo tanto, es una forma conveniente para actualizar la configuración del servidor LDAP simplemente editando la jerarquía <code
                    class="literal">cn=config</code>.
					</div><pre
                  class="screen"><code
                    class="computeroutput"># </code><strong
                    class="userinput"><code>ldapvi -Y EXTERNAL -h ldapi:/// -b cn=config
</code></strong></pre></div><div
                class="para">
						El último paso para activar el cifrado involucra cambiar la variable <code
                  class="varname">SLAPD_SERVICES</code> en el archivo <code
                  class="filename">/etc/default/slapd</code>. Para esta más seguros desactivaremos LDAP inseguro completamente.
					</div><div
                class="example"><a
                  id="id-1.14.10.9.5.4.12"></a><p
                  class="title"><strong>Ejemplo 11.28. El archivo <code
                      class="filename">/etc/default/slapd</code></strong></p><div
                  class="example-contents"><pre
                    class="programlisting">
# Ubicación predeterminada del archivo slapd.conf o el directorio cn=config
# de slapd.d. Si está vacío, utilice el valor predeterminado durante la
# compilación (/etc/ldap/slapd.d con /etc/ldap/slapd.conf como respaldo).
SLAPD_CONF=

# Cuenta del sistema bajo la que se ejecutará el servidor slapd. Si está
# vacío, el servidor ejecutará como root.
SLAPD_USER="openldap"

# Grupo del sistema bajo el que se ejecutará el servidor slapd. Si está
# vacío, el servidor ejecutará en el grupo primario de su usuario.
SLAPD_GROUP="openldap"

# Ruta al archivo de pid del servidor slapd. Si no está definido, el script
# init.d intentará adivinarlo basándose en $SLAPD_CONF
# (/etc/ldap/slapd.conf de forma predeterminada)
SLAPD_PIDFILE=

# slapd normalmente provee sólo ldap en todos los puertos TCP 389. slapd
# también puede atender pedidos en el puerto TCP 636 (ldaps) y a través
# de zócalos unix.
# Ejemplo de uso:
# SLAPD_SERVICES="ldap://127.0.0.1:389/ ldaps:/// ldapi:///"
SLAPD_SERVICES="ldaps:/// ldapi:///"

# Si está definida SLAPD_NO_START, el script de inicialización no iniciará
# o reiniciará slapd (podrá detenerlo, sin embargo). Descomente esta línea
# si está iniciando slapd por otros medios o no desea que inicie slapd
# durante el arranque del equipo.
#SLAPD_NO_START=1

# Si SLAPD_SENTINEL_FILE está configurado como la ruta a un archivo y dicho
# archivo exist, el script de inicialización no iniciará o reiniciará slapd
# (podrá detenerlo, sin embargo). Utilícelo para desactivar temporalmente
# el inicio de slapd (por ejemplo, mientras realiza mantenimiento o con un
# sistema de administración de configuraciones) cuando no desee editar
# un archivo de configuración.
SLAPD_SENTINEL_FILE=/etc/ldap/noslapd

# Para autenticación Kerberos (a través de SASL), slapd utiliza el archivo
# keytab del sistema (/etc/krb5.keytab) de forma predeterminada. Descomente
# esta línea y cambie la ruta si desea utilizar otro archivo keytab.
#export KRB5_KTNAME=/etc/krb5.keytab

# Opciones adicionales para slapd
SLAPD_OPTIONS=""</pre></div></div></div><div
              class="section"><div
                class="titlepage"><div><div><h5
                      class="title"><a
                        id="id-1.14.10.9.5.5"></a>11.7.3.3.2. Configuración del cliente</h5></div></div></div><div
                class="para">
						En lado cliente, necesita modificar la configuración de los módulos <span
                  class="emphasis"><em>libpam-ldap</em></span> y <span
                  class="emphasis"><em>libnss-ldap</em></span> para que utilicen una URI <code
                  class="literal">ldaps://</code>.
					</div><div
                class="para">
						Los clientes LDAP también necesitan poder autenticar el servidor. En una infraestructura de llave pública X.509, los certificados públicos están firmados con la llave de una autoridad de certificación (CA). Con <span
                  class="emphasis"><em>easy-rsa</em></span>, los administradores de Falcot crearon su propia CA y ahora necesitan configurar el sistema para confiar en las firmas de la CA de Falcot. Puede lograr esto ubicando el certificado de la CA En <code
                  class="filename">/usr/local/share/ca-certificates</code> y ejecutando <code
                  class="command">update-ca-certificates</code>.
					</div><pre
                class="screen"><code
                  class="computeroutput"># </code><strong
                  class="userinput"><code>cp keys/ca.crt /usr/local/share/ca-certificates/falcot.crt
</code></strong><code
                  class="computeroutput"># </code><strong
                  class="userinput"><code>update-ca-certificates
</code></strong><code
                  class="computeroutput">Updating certificates in /etc/ssl/certs... 1 added, 0 removed; done.
Running hooks in /etc/ca-certificates/update.d....
Adding debian:falcot.pem
done.
done.
</code></pre><div
                class="para">
						Por último, puede modificar la URI LDAP predeterminada y el DN base predeterminado utilizado por varias herramientas de línea de órdenes en el archivo <code
                  class="filename">/etc/ldap/ldap.conf</code>. Esto le ahorrará bastante tiempo.
					</div><div
                class="example"><a
                  id="id-1.14.10.9.5.5.6"></a><p
                  class="title"><strong>Ejemplo 11.29. El archivo <code
                      class="filename">/etc/ldap/ldap.conf</code></strong></p><div
                  class="example-contents"><pre
                    class="programlisting">#
# Valores predeterminados para LDAP
#

# Revise ldap.conf(5) para más detalles
# Este archivo debe poder ser leído (pero no escrito) por cualquiera.

BASE   dc=falcot,dc=com
URI    ldaps://ldap.falcot.com

#SIZELIMIT      12
#TIMELIMIT      15
#DEREF          never

# Certificados TLC (necesarios para GnuTLS)
TLS_CACERT /etc/ssl/certs/ca-certificates.crt</pre></div></div></div></div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="sect.http-ftp-proxy.html"><strong>Anterior</strong>11.6. Proxy HTTP/FTP</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>Subir</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>Inicio</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.rtc-services.html"><strong>Siguiente</strong>11.8. Servicios de comunicación en tiempo real</a></li></ul><div
        id="translated_pages"><ul><li><a
              href="../ar-MA/sect.ldap-directory.html">ar-MA</a></li><li><a
              href="../da-DK/sect.ldap-directory.html">da-DK</a></li><li><a
              href="../de-DE/sect.ldap-directory.html">de-DE</a></li><li><a
              href="../el-GR/sect.ldap-directory.html">el-GR</a></li><li><a
              href="../en-US/sect.ldap-directory.html">en-US</a></li><li><a
              href="../es-ES/sect.ldap-directory.html">es-ES</a></li><li><a
              href="../fa-IR/sect.ldap-directory.html">fa-IR</a></li><li><a
              href="../fr-FR/sect.ldap-directory.html">fr-FR</a></li><li><a
              href="../hr-HR/sect.ldap-directory.html">hr-HR</a></li><li><a
              href="../id-ID/sect.ldap-directory.html">id-ID</a></li><li><a
              href="../it-IT/sect.ldap-directory.html">it-IT</a></li><li><a
              href="../ja-JP/sect.ldap-directory.html">ja-JP</a></li><li><a
              href="../ko-KR/sect.ldap-directory.html">ko-KR</a></li><li><a
              href="../nb-NO/sect.ldap-directory.html">nb-NO</a></li><li><a
              href="../pl-PL/sect.ldap-directory.html">pl-PL</a></li><li><a
              href="../pt-BR/sect.ldap-directory.html">pt-BR</a></li><li><a
              href="../ro-RO/sect.ldap-directory.html">ro-RO</a></li><li><a
              href="../ru-RU/sect.ldap-directory.html">ru-RU</a></li><li><a
              href="../tr-TR/sect.ldap-directory.html">tr-TR</a></li><li><a
              href="../vi-VN/sect.ldap-directory.html">vi-VN</a></li><li><a
              href="../zh-CN/sect.ldap-directory.html">zh-CN</a></li><li><a
              href="../zh-TW/sect.ldap-directory.html">zh-TW</a></li></ul></div></body></html>
